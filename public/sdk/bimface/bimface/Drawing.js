"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_get=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},_slicedToArray=function(){function e(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),version="2021-1-27-21-20",Glodon$1=window.Glodon||{};Glodon$1.Version=version,function(){function e(e,t){for(var i=t.split("."),n=e,o=i.length,r=0;r<o;r++)void 0===n[i[r]]&&(n[i[r]]={}),n=n[i[r]];return n}e(Glodon$1,"Web.Lang.Utility.Namespace").ensureNamespace=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Common"),t=function(e){"string"==typeof e&&(e=JSON.parse(res)),this.code=e.code,this.message=e.message};t.prototype={getErrorCode:function(){return this.code},getErrorMessage:function(){return this.message}},e.Error=t}();var Vector3$1=function(){function e(t,i,n){_classCallCheck(this,e),this.x=t||0,this.y=i||0,this.z=n||0}return _createClass(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}}]),e}(),Box3=function(){function e(t,i){_classCallCheck(this,e),this.min=t||new Vector3$1(1/0,1/0,1/0),this.max=i||new Vector3$1(-1/0,-1/0,-1/0)}return _createClass(e,[{key:"getSize",value:function(){return new Vector3$1(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)}},{key:"setFromCenterAndSize",value:function(e,t){var i=new Vector3$1(t.x,t.y).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"getCenter",value:function(){return new Vector3$1(this.min.x+this.max.x,this.min.y+this.max.y,this.min.z+this.max.z).multiplyScalar(.5)}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}}]),e}();!function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Algorithm"),t=function(){function e(t,i){_classCallCheck(this,e),this.points=t,this.searchRangeSquared=Math.pow(i,2),this.EPSILON_SQR=.1,this.clusters=[],this._clusterId=1}return _createClass(e,[{key:"setSearchRange",value:function(e){this.searchRangeSquared=Math.pow(e,2)}},{key:"setPoints",value:function(e){this.points=e}},{key:"meanShift",value:function(e){for(var t=e.clone(),i=[];;){var n=this.rangeSearch(t);this.connect(i,n);var o=this.mean(n);if(t.distanceToSquared(o)<=this.EPSILON_SQR)break;t=o}return i}},{key:"mean",value:function(e){var t=new Vector3$1,i=!0,n=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;t.add(s)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}return t.multiplyScalar(1/e.length),t}},{key:"rangeSearch",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,a=this.points[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;e.distanceToSquared(s)<=this.searchRangeSquared&&t.push(s)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}return t}},{key:"clustering",value:function(e,t){var i=this;if(this.tmpPoints=this.points,this.clusters.length>0){1===this.clusters.length&&1===this.clusters[0].parents.length&&(this._clusterId=1),this.points=[];var n=[].concat(_toConsumableArray(this.clusters));this.clusters=[];for(var o=0;o<n.length;o++){var r=n[o],a=[];t?this.points=r.points:(this.resetClusterPoints(r.points),this.points=r.points);var s=[],l=0;e?(l=++this._clusterId,s=r.parents):(l=r.parents.pop(),void 0===l&&(l=0),s=r.parents);var u=!0,c=!1,h=void 0;try{for(var d,f=r.points[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var g=d.value;if(!g.stopMoving){var v=this.meanShift(g);e?this.mergeClustersInTarget({points:v,center:this.mean(v),id:l,parents:[].concat(_toConsumableArray(s))},a):this.mergeClusters({points:v,center:this.mean(v),id:l,parents:[].concat(_toConsumableArray(s))})}}}catch(e){c=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw h}}e&&this.clusters.push.apply(this.clusters,a)}}else{var m=!0,p=!1,y=void 0;try{for(var w,b=this.points[Symbol.iterator]();!(m=(w=b.next()).done);m=!0){var C=w.value;if(!C.stopMoving){var x=this.meanShift(C),E=++this._clusterId,k=[0];k.push(E),this.mergeClusters({points:x,center:this.mean(x),id:this._clusterId++,parents:k})}}}catch(e){p=!0,y=e}finally{try{!m&&b.return&&b.return()}finally{if(p)throw y}}}this.clusters.forEach(function(e){i.resetPointStatus(e.points)})}},{key:"mergeClusters",value:function(e){var t=!1,i=!0,n=!1,o=void 0;try{for(var r,a=this.clusters[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,l=e.center.distanceToSquared(s.center)<=4*this.searchRangeSquared,u=JSON.stringify(s.parents)===JSON.stringify(e.parents);if(l&&u){this.connect(s.points,e.points,!0),s.center=this.mean(s.points),this.updateClusterBbox(s),t=!0;break}}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}!1===t&&(this.updateClusterBbox(e),this.clusters.push(e))}},{key:"mergeClustersInTarget",value:function(e,t){var i=!1,n=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;if(e.center.distanceToSquared(l.center)<=4*this.searchRangeSquared){this.removeNodeFromParents(e.id,l.parents),this.connect(l.points,e.points,!0),l.center=this.mean(l.points),this.updateClusterBbox(l),i=!0;break}}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}!1===i&&(this.updateClusterBbox(e),e.id=++this._clusterId,e.parents.push(e.id),t.push(e))}},{key:"removeNodeFromParents",value:function(e,t){var i=t.indexOf(e);i>=0&&t.splince(i,1)}},{key:"updateClusterBbox",value:function(e){var t=(new Box3).setFromPoints(e.points);e.bbox=t}},{key:"connect",value:function(e,t,i){var n=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;l.stopMoving&&!i||e.push(l),l.stopMoving=!0}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}return e}},{key:"resetPointStatus",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){o.value.stopMoving=!1}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"resetClusterPoints",value:function(e){for(var t=0;t<e.length;t++)for(var i=0;i<this.tmpPoints.length;i++)if(e[t].index===this.tmpPoints[i].index){e[t]=this.tmpPoints[i];break}}}]),e}();e.MeanShift=t}();var Vector2$1=function(){function e(t,i){_classCallCheck(this,e),this.x=t||0,this.y=i||0}return _createClass(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"normalize",value:function(){return this.multiplyScalar(1/this.length())}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),n=Math.sin(t),o=this.x-e.x,r=this.y-e.y;return this.x=o*i-r*n+e.x,this.y=o*n+r*i+e.y,this}},{key:"setLength",value:function(e){return this.multiplyScalar(e/this.length())}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}}]),e}(),Box2=function(){function e(t,i){_classCallCheck(this,e),this.min=t||new Vector2$1(1/0,1/0),this.max=i||new Vector2$1(-1/0,-1/0)}return _createClass(e,[{key:"getSize",value:function(){return new Vector2$1(this.max.x-this.min.x,this.max.y-this.min.y)}},{key:"setFromCenterAndSize",value:function(e,t){var i=new Vector2$1(t.x,t.y).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"getCenter",value:function(){return new Vector2$1(this.min.x+this.max.x,this.min.y+this.max.y).multiplyScalar(.5)}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}}]),e}();!function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Algorithm"),t=function e(){_classCallCheck(this,e)};t.toThreeJsBox2=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[],n=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u=Math.min(t,100)/100,c=Math.max(l[1][1]-l[0][1],l[1][0]-l[0][0]),h=c*u,d=new Vector2$1(l[0][0],l[0][1]),f=new Vector2$1(l[1][0],l[1][1]),g=new Box2(d,f),v=g.getSize();i.push((new Box2).setFromCenterAndSize(g.getCenter(),v.addScalar(2*h)))}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}var m=0,p=!0,y=!1,w=void 0;try{for(var b,C=i[Symbol.iterator]();!(p=(b=C.next()).done);p=!0){b.value.indices=[m++]}}catch(e){y=!0,w=e}finally{try{!p&&C.return&&C.return()}finally{if(y)throw w}}return i},t.toDrawingBox2=function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,l=[];l.push([s.min.x,s.min.y]),l.push([s.max.x,s.max.y]),t.push(l)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}return t},t.merge=function(e,t){for(var i=e.length,n=0;n<=i;n++){if(n===i){e.push(t);break}var o=e[n];if(o.intersectsBox(t)){o.union(t),o.indices=o.indices.concat(t.indices);break}}},t.mergeBoundingBox=function(e){for(var i=e,n=[];;){for(var o=0;o<i.length;o++)t.merge(n,i[o]);if(n.length===i.length)break;i=n.slice(0,n.length),n=[]}return n},e.BoundingBoxUtil=t}(),function(){function e(e){function t(){}return t.prototype=e,new t}function t(t,i){var n=e(i.prototype);n.constructor=t,t.prototype=n}Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Type").inheritPrototype=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),t=function(e){var t,i={type:"get",cache:!0,headers:{"Content-type":"application/x-www-form-urlencoded"},data:null,async:!0,success:null,failure:null},n=Object.assign(i,e);t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState){var e=t.status;e>=200&&e<300||0==e?n.success&&n.success(t.responseText,t.responseXML):n.failure&&n.failure(e)}},t.open(n.type,n.url,n.async);for(var o in n.headers)t.setRequestHeader(o,n.headers[o]);t.send(n.data)},i=function(e,t){var i={};if(i[e])t&&t();else{var n=document.createElement("script");n.type="text/javascript",n.src=e,document.head.appendChild(n),i[e]=!0,n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,t&&t())}:n.onload=function(){t&&t()}}},n=function e(t,n){t.length>1?i(t.shift(),function(){e(t,n)}):i(t.shift(),n)},o=function(e,i){var n=void 0;return n="string"==typeof e?{url:e,status:i}:e,new Promise(function(e,o){t(Object.assign({},n,{success:function(t){try{var r=JSON.parse(t)}catch(i){return e(t)}"success"==r.code||"noCode"==n.status?e("noCode"==i?r:r.data):o("requestError，dataCode:"+r.code+", dataMessage:"+r.message)},failure:function(e){o(e)}}))})};e.ajax=t,e.promiseJSONRequest=o,e.getScript=i,e.getScripts=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.FullScreen"),t=function(e){if(!e)return!1;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},i=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},n=function(){return document.webkitIsFullScreen||!!document.mozFullScreenElement||!!document.msFullScreenElement||!1},o=function(e){var t=function(){e&&e()};document.onfullscreenchange=t,document.onwebkitfullscreenchange=t,document.documentElement.onwebkitfullscreenchange=t,document.onmozfullscreenchange=t,document.onmsfullscreenchange=t};e.fullScreen=t,e.exitFullScreen=i,e.onFullScreenChanged=o,e.isFullScreen=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.ClientHelper"),t=null;if(!e.getIsDesktop){var i=function(){if("Mobile"===t)return!1;if("Web"===t)return!0;var e=navigator.userAgent,i=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||i,o=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),a=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||o&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e));return!(/(?:iPhone)/.test(e)&&!a||o||n||a)},n=function(e){t=e},o=function(){return/(?:iPhone)/.test(navigator.userAgent)},r=function(e){var t=function(e){return e.replace("viewToken.json","").replace(/\.\//g,"/").replace(/\/\//g,"/")};if(e.indexOf("://")>-1){var i=e.split("://");e=i[0]+"://"+t(i[1])}else e="//"===e.slice(0,2)?"//"+t(e.slice(2)):"./"!=e.slice(0,2)?t(e):"."+t(e.slice(1));return e},a=function(e,t,i){i=i||"asc";var n=!1;return t?t.indexOf(".")>-1&&(n=!0):t="name",e=e.sort(function(e,o){if(n){var r=c(e,t),a=c(o,t);return"asc"==i?r.localeCompare(a):a.localeCompare(r)}return"asc"==i?e[t].localeCompare(o[t]):o[t].localeCompare(e[t])}),u(e,t,n)},s=function(e,t,i){i=i||"asc";var n=!1;return t?t.indexOf(".")>-1&&(n=!0):t="name",e=e.sort(l(t,n)),u(e,t,n)},l=function(e,t){return function(i,n){function o(e,t,i){if(i){for(s=t;(i=o(e,s))<76&&i>65;)++s;return+e.slice(t-1,s)}return i=f&&f.indexOf(e.charAt(t)),i>-1?i+76:(i=e.charCodeAt(t)||0)<45||i>127?i:i<46?65:i<48?i-1:i<58?i+18:i<65?i-11:i<91?i+11:i<97?i-37:i<123?i+5:i-63}var r,a;t?(r=c(i,e),a=c(n,e)):(r=i[e],a=n[e]);var s,l,u=1,h=0,d=0,f=String.alphabet;if((r+="")!=(a+=""))for(;u;)if(l=o(r,h++),u=o(a,d++),l<76&&u<76&&l>66&&u>66&&(l=o(r,h,h),u=o(a,d,h=s),d=s),l!=u)return l<u?-1:1;return 0}},u=function(e,t,i){var n=[],o=[],r=[],a=[];return e.map(function(e,s){var l;l=i?c(e,t):e[t],/^[a-zA-Z]*$/.test(l.slice(0,1))?n.push(e):/^[\u4e00-\u9fa5]*$/.test(l.slice(0,1))?o.push(e):/^\d+(\.\d+)?$/.test(l.slice(0,1))?r.push(e):a.push(e)}),a.concat(r,n,o)},c=function(e,t){var i=t.split("."),n=e;return i.map(function(e,t){n=n[e]}),n},h=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},d=function(e,t,i,n,o,r){var a=void 0,s=void 0,l=void 0,u=void 0,c=0,h=Math.sqrt((i-e)*(i-e)+(n-t)*(n-t));if(0===h)return[0,{x:i,y:n}];var d=Math.sqrt((o-e)*(o-e)+(r-t)*(r-t));if(0===d)return[0,{x:o,y:r}];var f=Math.sqrt((i-o)*(i-o)+(n-r)*(n-r));if(0===f)return c=h,[c,{x:i,y:n}];if(h<d){if(n===r?a=i<o?0:Math.PI:(u=(o-i)/f,u-1>1e-5&&(u=1),a=Math.acos(u),n>r&&(a=2*Math.PI-a)),u=(e-i)/h,u-1>1e-5&&(u=1),s=Math.acos(u),n>t&&(s=2*Math.PI-s),l=s-a,l<0&&(l=-l),l>Math.PI&&(l=2*Math.PI-l),l>Math.PI/2)return[h,{x:i,y:n}];if(i===o)return[d*Math.sin(l),{x:i,y:t}];if(n===r)return[d*Math.sin(l),{x:e,y:n}];var g=0,v=0,m=(r-n)/o-i,p=-1/m,y=t-e*p;return g=(r-o*m-y)/(p-m),v=p*g+y,[h*Math.sin(l),{x:g,y:v}]}if(n===r?a=i<o?Math.PI:0:(u=(i-o)/f,u-1>1e-5&&(u=1),a=Math.acos(u),r>n&&(a=2*Math.PI-a)),u=(e-o)/d,u-1>1e-5&&(u=1),s=Math.acos(u),r>t&&(s=2*Math.PI-s),l=s-a,l<0&&(l=-l),l>Math.PI&&(l=2*Math.PI-l),l>Math.PI/2)return[d,{x:o,y:r}];if(i===o)return[d*Math.sin(l),{x:i,y:t}];if(n===r)return[d*Math.sin(l),{x:e,y:n}];var w=0,b=0,C=(r-n)/o-i,x=-1/C,E=t-e*x;return w=(r-o*C-E)/(x-C),b=x*w+E,[d*Math.sin(l),{x:w,y:b}]},f=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},g=function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}};e.getIsDesktop=i,e.setNavigatorType=n,e.getIsIphone=o,e.getIsIE=h,e.formatURL=r,e.sortByName=a,e.sortByRules=s,e.PointToLineDistance=d,e.isWebGLAvailable=f,e.isWebGL2Available=g}}();var Cursor={pan:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABjRJREFUWAnFlstvU1cQxu/1fcR2HMd52DV5kVABUZ4tkIqIx6KRKBKbCqJukKjURbtghSr4S1gg0U2zQqjbthISYkElVCoEIZAQkiYpCXm/4zh+u7+xcoxDbCe0UjvS6B7fO2fmOzPfzLGm/c+i/4v4uXvT/9RPrpNiPpSdY9tIfovKbwmeylGW+xfluNgOsTFQEy1B1R55JyoSQyNoElWA5LlnZpQzbHeJ+iZBJHAZWurz+by2bSfD4XDK7/d/YllWgPWTqampYb7HUQEhgERVZljmFzlVPlHB5buNusvKysrr6uouezyer3UklUrFq6qq3IZhOBYXF58C5Ifl5eUxPqVXV1cX2bOGhtGimVApxG6HCAAJ7kQ9LpfLGQgEWg8ePHj+2rVrrZcuXXItLCykL1686Llx44YvFovVjo2NnaysrLxcXV39LeqLx+PDW1tbm+xXZWG5W4plwMLcS+DGAwcOfEPaewmUxrHW1dXlGR4ettfX1/XS0lK9ubk51tTU5Ozt7fU2NjYat2/f/hzbUTLShw9Virx8yJcBOb2w24WWE7znzJkzX1y/fj1ACSycagQ00un01uvXr9fcbrfe2trqXllZMQFjnjt3zkVJyvr7+xcTicQQ/FjFT8EsqLbCZpcIEAlkojplSJ89e1bDafjx48fh48ePl0HIyhcvXlhwwWhoaNCmp6ejb9++TbS3tyf53klJTuJDyigHVbxi+U4KZUAspDyukpISN+lsOnz48McAcFFrg/o72traTE4XHhkZCQHEcejQIWtoaChO3TXs3PPz85XPnj2bZ+8A79bxJR2xqwz5AGCXQSuI7Wg0Gie19cFgsAUQFt2QJNAGWUmfOHFCuGDCBcfp06ftN2/epMmCduTIEclchNbUKNkc+ie+pEUFxA4pBEAZGbSbTRYkSFVtbW2NnG50dNSizuaxY8eMpaWlyPj4+BYzwQSk/vLlyzCg06dOnfKQhcDAwMBcJBJ5yjtpyV1ZKARA1SuTBRxE6ILG+vr6jpaWFpPej7569WrdNE2ts7PTRUa0jY0NHXBO6Yry8nIDW3NtbS08MTERB/wMJJ0AgOoIdcDsKM2+YKGCqyHkJAslkNCi5BU1NTV+0u2h9hanN7q7u03mgwMSGl6v10EWLDTT3pDTJlPBwcHBWUA8gcBR/EtHZCVfBgSAOHCj3m21IdMqJ68j0KcdHR0G7ZkisF5RUZEJLMGx3SFOp1OHsFF4EmZ+TJOFKQwSaJYL7wOQ4OJIWqeCIdQCu78jnd9zmnaItQSjY2Shivq7JTijF9PCQocIT4JkbGZubu4JlpKFogAEVClaSeDenp6er65evVrNpPsIVjfMzs7WcPpysqAz/zErLtwdDpkNz58/n8dyFF7IU7KQacl8GZB3mSlIBj5jCnZduHChRGbA0aNHTUhlAiRGKRIAlItqT4GgMVo0DJARWnKUDdKSBQEoDrioYenMzEyAU/hhv0XNbSacRurj2223dwqIFAqFUnTKJu3bDykHtwFkypBhKy9yRT5Iu2xMTk7+To2dt27dsql925UrV5yc3BbN3bDXWuYCJIzBoezJ1Z73S6DeS3oESJqaLfCcg0R+xoFfLiJasjjzlJftJyM58uDBgyFK95D/CuO8FiLmLYHaqgBkyEINl0E/wz1QRTqDcEEXcinjYk9mh3b//n0H+hst+QuZXMa+IAlzfeWCSBF4NZlMUpVJH/1cS3sKFwplMOvn3r17oTt37gzRgr+SgT/4ICM5O4z2ciAgxFgQy//AENNsnAvHA5BaukBXU4/vO4SMaY8ePQr39fVtMrZ/JvhdhtkKRjsupb0AiFMFQoAkSWF4c3NzhFrq1LYGcunyR0X+mIixCExPS+CbN2+uwZ2fCP4jo3iaT1uoHCYr2U3ZN/kXYic1F/bLv2MfF5Hcjt1Mui8J3ow6uIgSZMkiWArm9/O8S+8/5ORC5BC66zLaLwD2vvuPwFoGlQCRu8LNPVANKYNMRjcl2qBz/oIzKqj8GZG6Z8rIc4d8CADZKPaiUjoZQnJniMpazRQplbSZUjm1vMvOf9ZZ+VAAslHtkaeURcCIym9RFUw9hUOieUU5y/txHy9z9+euiwbdh9//zuRvyW3yFM73IK0AAAAASUVORK5CYII=",orbit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAB55JREFUWAntlltM1PkVx2eG28ww3EdA5CKgSBXEKO6Klxq3dsFbDTZa120Tre1ufdjY1sRoNqm1aaPxYetjEy/RxLrbpGiiVWQbUPfBW8CqRHe1UapVizCIIMMwwMz0852d34RycdOnvvSXnPld/7/zPed8z/mNxfI/btb/Qr/OjhbzeYjBaDF7b+y/CcBIhTHcNFJszM33QcYBZDjSazwSENPxm7lgvF3tSYmUxiHxiB1JiIxj6bUvRVI8iAwg/ogM0QuIwOnMuG0iALpYIiVSmoi4CgsLv52YmPhOfHx8ZUxMTGYoFEq0Wq2DwWCw3e/33+7v7//86dOnFwcHB19zvh8RIAERCMmYNh4AY7msdiIpRUVFNampqb9IS0vLqKmpCVRXV2fk5ubakpOTLT6fz/LkyZPQ+fPnXzU0NIRe0l69evXJo0ePPufbXsSLyDvjgpgIgNzuSElJmVRQUPA7FK3Ys2dP/Jw5cxzHjh3zXL58OeTxeBKHh4cT4uLifADzLV++3Lpp0yZ3S0uLd//+/UPd3d0NDx48+A3e8HBXXwSE4QbTr9tIABobkeuds2fP3mO323926tSphMOHD3vOnTvnwOK/9vX1Xezt7f2KcY/D4UgDYInL5VrG+LsrVqzwbd++3b1t27ZOADy4d+/eB4Do5D4DYkJOmJiLZC4kIyEhoRgQdZWVlYP0lzIyMr7D+gwkH8lBsiO95jPS09Ory8vLL61atcrT2dkZ2rBhQ0dZWdln7BUjaYiILD1jmhZNzNPz8vLKmE9GpiBTp02b9j59ISKlbkSXpY4QzbWeh5TNnDnzjwLR1dUVWrJkSTcc2sa67hKZFd5o00RuFwChc+Xk5JRkZ2efY9yIq3voffDqPr1YLTIppQTWpKTCpaZUFOOHsb6F0FX29PS4Nm7caL969WoZYOoCgYBSVOcUhnATAGO90KWB9iCuLiC9Sl+8eNHAmlJJIgLpvAtXT83Pz38PoGsYl5KOHvjgYy8MgN4CQb9C6fs7duxIrK+vt6C8DWI+ipzRXWpWXSiRNSnFxcXrsrKyNpw5cybl9OnTqeT6Cz76O3u6WEBd7H+rpKTkL4sXL160evXq+awtGBoa+pBaUO/1epV2utwKniDZUUiWuDHKdvfu3Tg88wV78qIBwPBr5Zkw+S3I5rly5coAFoXUa87625yZguRgbdW8efNCR48e1ZFo03zhwoW9KFzEuVxEpKzAS7tXrlzZifLg3Llz/8Ga7hKXxBkZHaP4hasd+f5zFAaqqqqUBRb18+fP76HCbW9tbf01S8FJkyatgtX+LVu2hM/onBpzy82bN2OoDSvx2LHS0tIavDcbhFnwxwkQq81my2H9o9jY2D7WWwD1KZ8G5FYbLiqnvP4gKSnJtm/fvm5deuDAgW5y26Z1wJWzFMelOQsWLBABx7RZs2bZuVyZE4v7n0PCH5MJVbW1tX7usaxbt65vzZo11aT2T7XPOekO/wQpIJOx9NDZs2cbKDou2G+BAwkUnqsDAwNHtc9ZeDX8L5CLyWPatWvXhrTPxtDjx49bKT5/ev36dXDnzp1yt2X37t1pmmudMt3KkjIh/EgpFjqk2LxNrNoUM9B3KoasVSCKaa5irFiPxwFxQxzhnGrFFHFnAk69xX4mIr02ZYCaQWPjknJevCwywgIQC8xtYl+vmx9vePFU0/37938ESf3t7e2248ePD+CpAaxeDQceck6PzxDnAnjuZXNzc9X69evtW7du7SOt9/HNjch9yoagipApREKUCh++h/z2xIkTacSs/+HDh9+HSF9GPqKzOAGZJ0IS82zy+3lHR0c9Z/7JnpTrYt0ZrisVFRV/4Ow8Fafbt29/wPpLRO+CUjtoPMA43GzkcidkrIWxdizwPXv2bAYKGtlVBZMMQqIeisxN5TVWNzPXi6diJU/qTmWWSBaC/X+jFtRi/YdwQBxRRZXycPxHA7BikU2uu3PnzrKDBw+mNzU1JXHBZFkQ+UhKVEh0iaw1l0mpA0ni7XgHj7QzDkDoLjz1ZwxpY26Um5D/x8Mgt6lZyeXnkKjgxo0b2YcOHXLz/ueotqu8Yq2UyjqBl+gNkeJkSvi06dOnfwKHPnK73VP5Y3IRg7w83V3sy0PmHRCAcBvtAS3KNSE+bsZ9i65fv+44cuSIWw8Lbv8h8S9yOp129mRxAkDzKc9L+If0k8zMzI/Xrl2bRg1JqqurK+JfVAyuv8Q5pa6Uh++mjzZjtVnQ3Fjlogi5qfu/Iv2qd+3aFUeqOU+ePNnV2Niov14O3gAH7vVjrXfp0qXWzZs3u2/duuXbu3fvIFbXkxkfA1x/RnyIwhaOO320jQagjXB1pJdrxeRksuJdrPkl1qfzf9BKfU9VeYUrFhRZ+CMa5P9g14ULF2IIXxfe+z3F5gLf6jkfE3fWom08ANo0IMy778QbSbh5Ge5/l3JaQQiyqenxPNte4txBhWsmg5ra2tq+4HulmVJy3LizHm0TAdAB7RmyCYgeIInqhbwjDuiMCBVOT3rFWkpNdsjtUcYzHtPeBECHtW/EsF6KNRY4NcVVSqRspBjCjYk756LtmwBEDzIwQEb2Zn+kMjM2e//v3+iBfwN/OI2ZyYaa1QAAAABJRU5ErkJggg==",measure:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAbCAYAAAH3zbSEAAAAAXNSR0IArs4c6QAAAn5JREFUSA29lr9uGkEQxu8A47MTKSf5j2RbjnDhAAUVVKbhBeiiNHmLPIxbt64i+QF4A3iBpEiUIkWUCEVBcSz/uXy/1S1aH3fxcoKM9LG7szv77c7MzhEEQRAKFWEutXkvCKoMqkmS3Foly+vCa6ugjdwBm907imoo+8QqwjCMavp5axVqzWTUarWuNKg6E/MurJvCS2F+lHR2Q+0XFkSiuU6VjxrRbaHg3OyyIJVut3sj7cHCjBTWOZ+zkzJKrLMa2UnGISvyJtAZy/F4vDDf6/VMUAaaOVyYDYKv6OpsPZ1Ok06nc6Hxs5yFharNfr9/qdmGkOvuIksTBjH/KVpQpJ9MJhF+fCha8ITe2EXcOU/+pdfGhrmQIC8E7mLuDEgzmwrufFGfI99iiIcJNv27FGqeliPuOhwOyekTwZu9KSPSeSAslRg8r7NljbhXLNBOBR/ZZhFOiRW7Tz4Wdo0y6QSmhrArfBd8xKzFcE+M33ws7Box7mN4qmh8sEqfVmXnFTHzjpuzaaWMkbEvbUg4ZjrzG7Uku49Qi2c4x01yH0PK4p013FJIfmWt4jg+H41G76SHpWzlyG5rxnwETqkaVFAeS7vdfi8duX8k8D0r7UfZ5gqbGtKUbKBxQ+CFLlWFtd5LcC+BfCHwQCkJPFDqifuB1rC0wAHwFiFK6KCoyb0fUQgIB8EDqwAeO9D+5MWesEHqQmyLXUv9mUC5XZXA8TzdjPYnt+QfxU6K3yiFVZMSPurljxSG9JjsdWUdYxEeC3VcC0zVVrtugQc+kyzN7M3cW6+iz/7iasJnWGH+n0JmcQJT4vj3t2Yx75Tsperwx9hm2DpuD5l9Gdd/AVIlXMI9fgkPAAAAAElFTkSuQmCC",section:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABBpJREFUWAntVUtLG1EUniRjEo2amKjVxBiFqlAXRUVFEBFKF6KLgii47kIKXVX36rra0lXRnd1IFftYqFAoBFyJ2AdUixqoMU18a3ylSZwk/b6pCRmfP6AZuJlz7znfd8797rkTQUg9KQVSCqQUSClwgwKxWEzV0NBgrq6u/tbf36/m/IZw2cUYxhJD7G0Y9XWEJGlsbKw5Ozv7qlKp7h8eHuoGBgZuLYAxjCWGWHKQ67o8VxISMDMz8yASiUyUlZUZV1ZWhNra2jvRaPTAarVGpqamHsF+AVLHObFbrVY/a21t/eDz+TSwc+bn57fKy8uF1dXVQ41G09HS0vIZvNGLhVyqjMmR4LEkSZ/a2tqMw8PDMgZzQzgc1kxPT7cj+WRzc7ODPg7aXKOPMYwliD5ykIucVymhKKCjo4MJXoFspKurS+jr6xOysrLkAtLS0rSwtfANIaEwODgo1NTUyIM21+hjDGMJIpYc5CInuZlDJjz/kQtgo9TV1VnW1tZGIftTVCr09PQkxwk4U7Xb7S5ErJ2EFx+u0RcKhQyMTfaTi5zkZg7mijenHNjZ2aluamoK4ux0ycBkGzvQYGeyHNzZdQ+SZzL2Oj9zMBdzMkb+qaysVB0dHaVXVVU9B/l7Vjs0NKTg4K4sFksIBDsjIyMKHydjY2MCfUjOY1I0N7nISW7mYC7mJE4hFSSKVVRUvMvPz39LQlwp4fj4mHGJJzc3943T6RR6e3uFhYUFgTeENtfgG00EwiCWHOQiJ7mZIzlGPJ/wegS0Wu02Agx2u33GYDD40LlPlpeX9YzBmUUxwkVFRU7s1DQ7O9uOpCb6cM38BQUFkzabzQmlwhjyUXZ3dwsulytYWlr62mw2f8f6b+bA9yEAmHwlE1KxOx0Ohx7yWJDADhkdfr+/en19vQsAa319/T1cJz9IbPDdxTsfI50FoLA/GNvAufD2iqJompubW0LP+IqLi8dMJtMX+NzAebKzs/fQzMGJiYkIsYlmWVpaimEHUcgYCgQCQZBIOp3uBIAf+/v7FbA/Go3GDRTBZpWADeN9iiL8SLoF28PkiDvd3d214mv4EB+ilzj3n/D9wvdhHfaex+MJxZOzgIQCnPBBs6hxVbR6vT4bUxtIefUkyOzC2sbBwUEMdgZGJpLLUsMfwtGdYARycnJUwWCwEDZVEjE2wOPF2lFJSUkY/Iqv4aUC4kXgLe7s7GShcgtsqJm2h/k+uldaXFwkToNzl/Gbm5tsrAh8MfjEvLw8M46NuDOc+R7m7GTpYnKsXVaAi3ywKxWaCCch6kAi4ljC2L1Cvn+Ryl/2ElTQZWRkaFE8TkwK4ZMsQQlF98dRimsYX+SbAAJxfQJer/cYf0LB8fFxhXzJ8XGbMYwlhtibkscxqXdKgf9bgb8e4D98kWiZrgAAAABJRU5ErkJggg==",rotate:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABUhJREFUWAntVmssZGcY/s6YGYPBYC3WfRsqS2tTiawUcUuUSFRdE3GtS2ormuxqJEK1iR9t0jaSjVtRIUII5U9VdhsjVSl1DSK2a+LaDcZl3OZiZk6fz8ZkzVKxPzZp6kuO855z3u99nu95L4OQ63WtwLUC/3cFmNcRIDMz03Rra0skEAiER0dHips3b8rq6up2GIZhrxrvUgIsy3KioqLeR/APARimUChcNRoNTIHa0NBQe3x8zCiVSgO1Ws2YmJisarXaYfh0ubq6/lJZWXlwGaELCZSVlXFHR0fvczicInNzc7PAwECBj48Px9nZmQCYQAGyvb1NhEIhsbKyInw+n6yurpLZ2Vl2YGBAvrCwwPB4vEYjI6MvW1tb1y8ici6B6OjoOzhxN8CcsrKyDHEqIhaLWRBiKKiBgQExNjYmUIHFycnh4SEjl8uJqakp8fT0ZAMCAhh3d3fS1dWlefLkiRyHyOru7m4/L0WvEEhMTPRCXoeys7OFLi4uTEVFBQVg7ezsjmxsbGQikUiFQMc4kQx3KrEAlzlSZQQ/7vr6unBzc9Nsd3eXk5aWRtzc3EhxcTHdc7+zs7Nen8QZAjU1NbzHjx9PJycnvw1H0tzcTLy8vKT29vbzAOjFyf/AXQK5VVBFg2ct8s/A5oAED8+2qA8f7P1AJpO9NzMzc8vJyYmTnp5OCgoKlI6Ojneqqqok8NUtrs6CMT4+7ge53vL29iYPHz5kkfdZSP0Nl8sVA3gXEivj4+OP9U9xGqO/v//vlZWVWZDqsrCw8PLz8/tseHg4fGxsjBcSEsIfGhr6tL29vTAhIUFzukdHAJu5TU1N9yA7B8yJtbX1HgroE+R5IiUl5egi0NNA9B4cHKzGjV6HANpBGlZsbW2tRkZG7gUFBTGTk5OB6BCaskNcJ4tKd7JQRAaQ6HBpaYnx8PAgGxsbgsXFRem/gUNaUWRk5HdQ50wqaUCcUgXya8vLy3ykkSAuLVo1UsR7gfjir44ATqtB1Y/jpGq0EImJieHPzc39FhsbG3QeAN67geQo/JMaGhqELweldlJS0q2enh6aCu/Q0FCmr6+PxWwQY1ZQhXRLR4DKh7V49+7dP6urqwmKh3nw4MEN5P9ngI2iNSMpEXrBDkOeJ8LDw28joAj9bkQj5ufnm2FoJcfFxfXu7+8v4HtYYWEht6ioiHbDhqWl5U9IrUKHDuOMdMgbH3kLRK8/Qs+7gwyDjiD19fWap0+ftkdERGSinz/Gvm9LSkoM6QDKy8tjUagSTEQrlUolxCnVyLcAs4BgIJG2tjaCmSAFga9B/ofc3FzZhQToB7SiMWQNQLAvnj179g7qQAibBZnK+fn55wcHB1+hlTgAIrDJ1NQULViCaUnoUKLpGxwcJKh+ggJUA3gJs+MRWrQlIyNDql/MZxSgBKjEvb29/LW1tduwY1E0CSBhgUD5GFDWExMT30N2k/LycoJnUlpaSjB4TsjQsQyZtbgOHBwctqGMGG39I2JM5eTk7OmDU7xXCNCXdAGc09LSQn/tbPHoiUADeGcOu2x6evojgAoxLQl+cFhfX99NFDH9cdqBz1/w6Yf/7xhQS7BlkJ1OznPXhQROvSmRxsZGPlpO2dHRwdnZ2bFH8ByJRJID+a0BrESxxaFYJZBZhj5X4p0cLad4eeCcxtO/X0pAfwMlhBF9A3MjRiqVfg41RCjOd1NTU59DYq2+/2XPukl4mePpdwoCEpu1tbVt+Edkxd/fPxwdIH8dcBrzygToJlpMWHso1l9RrGNmZmZnWov6vLEFIldO4xsjdw30n1DgH4y0hp8mM/gUAAAAAElFTkSuQmCC",translate:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABLxJREFUWAntVllIZEcUvd1jOxrbNW7jihoRxQWhjaKixiUS42DEBZn8iCGifghxIWAQhsjgR0JIPiL4pRkTFDU/CsK4oOJCUHFBUVEEcUSNg6Ktjt3a7cupgtdp5fXrkTDkx4LuV6+We86799xbRfTQHjzwP3tAcR/8oqIij/Pz8xfY461Wq+svLy81RqPxCfq/9fT0vLmPLXGtUuxYe1ZVValPT0836urqvi4sLHx6cnKyEBQU9HtmZuYPZ2dnf7W1tdlZsyE1b9UDgiAo8vPz47C5VK/XV/b19XE7JSUl1NjYSDExMVRTU0MHBwcVIPgYk64RERE/ol1IAd4ds+qB4uLiGGyazMvLq3RwcKCZmRmysbGhtLQ0WllZ4faysrLo6Ojo19jY2F/S09Ofr66u9nR3dz+6Cyb1LktgdHTUxtbW9llSUpKqtLSUysrKaGhoyAQq9lNSUugRWkVFBdXW1pK/v/9nS0tLPlKAd8dkCWxsbNgGBgbqxC9lQAsLCwQhUlhYGCkUClpbWyPmmcTERAKoidzOzk4hwidrny22tuA6ODh4XKvVGkQgjUZD4+PjHAgCpOHhYROo2EcYCCL9tqOjw55PyvzJEigvLzeoVKp1X1/f16Jxc1DWZ2QMBgMxYru7u7S/v0+urq4UGRnptbi4+JEMNp+SJQAXCzCuBYHesbExDhQXF2cC8vLyooCAAC5MSIALc2RkhBtm5EColOlIjoQsAbYRIbh0c3P7E57QswxgQKmpqSQCsQyYnp7mGNnZ2TQ/P8/7TBPX19eV0JEDH7DwJ5kqLPchqE8hwJdTU1NPUe0mXVxcPt7b23vCwJ2dnQmVj3JzcykkJITXAmQLgShlZGSQUqnkqQoh2kA7r+bm5rYt4EsPI4ft8TVabBT6+/uFnJycNw0NDT8D8AZVD/wE4fj4mD/l/iYmJoSCgoKXra2tKmkkC1mAiucCl9v7+fnxr0TFc0cqfoWvNIgZwIRmrYWHh5NOp/scaWoxGyQ1AOEJUPVmfX09F1xCQgI1NTWpMa4Ss8EaOJt3cnKim5sbR/wsnhOSBLD3xMfH5zkq2t+szq+vr1N0dDShvrOaTzgF3wWfLi4uuBawXlJrzIgkAZRdPWL7Cqfdd1FRUbuIP0+10NBQ6uzsJHt7ix69RWxra4twVL9F6IRbE2YvkgRY/qMIaeG6Xm9v79r4+PjN5uZmQaz9Zvtlu4ODg+Tp6bmJrLi2tFCSAFsskkD6Dbi7u1cnJycvtbS0CF1dXZZs3RpHBtHs7KwRafoHbOluTZq9vNN9ADlvh7Neg1i+mJycxOGYpGQnH8t9qXZ4eMhPRWTBLLT0JUK6BRI3UmstekBczDyBO8ElyvEMYv8N7gEDy8vLV9XV1bwCokiJS+nq6ooGBgaIzaFE73t4eHyPydeWwNlGqx4wWUeHFRRcRoKRjlU4dJ5BZG4oTEoA8WXsIIJQdXD7NrzzE4TczbTEPsLcjnn/XgTYRnbTQXH5EMXqEwB8AaEmIDQfgJjRzs7uAEt6AdiHGrCNS+yFHDizd28CbBOAFe3t7Y/hcjUU7oifE7yiBwktps8cHR3fImz/xoZtel+NkWFewdOqnt4Xhwe7/8kD/wDeTzMCbKkf6QAAAABJRU5ErkJggg==",
zoom:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAA6pJREFUWAntVltIk2EY/rZ/bO7gNCx1aswrYzSGkKAYIUE3mg6TlPBwIcEoJnRVkCFOJAblTeAo5lUIEi5spLCbBCUSBIOh1KAbldIxSZdzOZ079L6jf/yb23/q0n7Yvu89Ps/3fkdC/n9nvQLUvxSgp6enqqKiwt3Q0DC/trYWEpNLKiYIY/r7+y/s7e3NG43G69iiLCaXKAI2m00TCAQ8bW1tNWNjYwRblFEvhoSgGACRt7S0zNvt9iTzQxn1aBeUUIgzAEpbW1tdg4ODyVgsxsRPyahHO/rxzSvh64hJodSOo6Oje3TMxMQEqa6uJuvr68RisdBqUlBQ8Gp2dtYqkUgSaWWejiyP/pTa5XKpzGbzVzB4gUzZzMyMrry8POWn0+kIRVGko6PDD6ABUH5Ff2jDKQeWP96l6uzsPFSpVK8B6ObW1tZdrVaLI02lxhZl1KMd/dCfBTdt4k0Ay9nb2xsqLCwM+P3+Mhw180MZ9WhHPz7lx3jeBBhgVDweN+YigHrwE3S4CSYQDAZlJycnNbkIoB7tDLKcXcEE1Go1EtDnIaBHOycqw0EwAZhbKhqNlsEdwEhDCBJCPdozDByCYALHx8cy+BVnVwAJoR7tHJgZZsEEYKtpEomEoqSkJCMRyqhHe4aBQxBEAA4gCWy1S9mjpzFQj3b0o3VcrSACCwsLFJTYxEYA7ejHBUzbWZniSOByeQBJn0NAem7b29uJ1Wqlc6Rbh8NB3G53WoZOTKFQPJybm3sBizPJNNB9VgLT09PK/f19M8zrk5WVlctw4eCFRMfmbeEiIk6nM1FXV/elsrLyaVFR0fuurq5IrgBWAliBqamp4nA4fOPg4MC2tLRkaGpqkgwMDBCp9PTswSIk4+PjZHFxMdnY2OiDY9mm0Wg+dHd3/xJVAWSMJCYnJ1Wwx6/AVWxbXl6+VlpaKhseHiYAkB4UECQjIyNkZ2cnVl9f/xEuKJtcLv/c19d3mA8cg1krkM4OHZgOeSgUqoHz/tHq6upt6CtHR0eJXq8nm5ubZGhoCG/EiMlkegs34jPof4OyR5k5cvV5E8BgIEEBcBWQsGxsbNz3+Xzn4A1A4G1ADAZDEB4nLwHcCeA/ADyeCzBbJ4gABsOUSGFKzkcikVu7u7uPvV7vxdra2u9wENmVSuU7KPlPKDnnS4gmIpjAXxISWOVaWIhXgdAdAHwDC/AT7BJ8B+TcbjRgdiuKAE3C4/HIt7e31XAP/G5ubo4KBc8mczblP8eTrmVjlSb0AAAAAElFTkSuQmCC"};if(function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.MouseMotion"),t=function(e){function t(){i&&"walk"==e.getViewer().getEditorManager().editor.name||(n.addClass("motion-zoom"),o=Date.now(),setTimeout(function(){Date.now()-o>180&&n.removeClass("motion-zoom")},200))}var i=!1,n=e.getDomElement(),o=void 0,r=!1,a=!1,s=null;Glodon$1.Bimface.Viewer.Viewer3D&&e instanceof Glodon$1.Bimface.Viewer.Viewer3D&&(i=!0),n.addEventListener("keydown",function(e){17==event.keyCode&&(r=!0)}),n.addEventListener("keyup",function(e){17==event.keyCode&&(r=!1)}),n.addEventListener("mousedown",function(t){e._opt.enableZoomRect||r||(s={x:t.clientX,y:t.clientY})}),n.addEventListener("mousemove",function(t){if(s&&!a&&!(Math.abs(s.x-t.clientX)<2&&Math.abs(s.y-t.clientY)<2)){if(i){var o=e.getUseLeftHandedInput();if("walk"==e.getViewer().getEditorManager().editor.name)1==t.buttons&&n.addClass("motion-rotate");else{var r=e._getIsCursorEnabled();1==t.buttons?r&&n.addClass(o?"motion-rotate":"motion-translate"):n.addClass(o?"motion-translate":"motion-rotate")}}else 1==t.buttons&&n.addClass("motion-translate");a=!0}}),n.addEventListener("mousewheel",t,!1),n.addEventListener("DOMMouseScroll",t,!1),n.addEventListener("mouseup",function(e){s=!1,a=!1,n.removeClass("motion-translate"),n.removeClass("motion-rotate")})};e.setCursor=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=function(e,t){var i=document.createElement(e);return i.setAttribute("class",t),i};e.create=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);return i.setAttribute("class",t),i};e.createNS=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=function(e){return e.indexof("#")?document.getElementById(e.replace("#","")):e.indexof(".")?document.getElementsByClassName(e.replace(".","")):document.getElementsByTagName(e)};e.select=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=function(e){var t=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop(),i={element:null,handle:null,axis:"all",cursor:"move",distance:0,start:null,move:null,stop:null,bBoxDetection:!1},n=Object.assign(i,e),o=n.element;if(!o)return!1;var r=n.handle||o,a=void 0,s=!1,l=this,u=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(n.distance,2)&&(n.start&&n.start(a),!0)},c=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e};this.resize=function(e,t,i){t=t||{x:0,y:0};var o=e.getBoundingClientRect(),r=e.parentElement.getBoundingClientRect(),a=o.left-r.left,s=o.top-r.top,l=e.offsetWidth,u=e.offsetHeight,c=e.parentElement.offsetWidth,h=e.parentElement.offsetHeight,d=Math.min(a+t.x,c-l),f=Math.min(s+t.y,h-u),g=a+t.x<0?0:d>0&&d||0,v=s+t.y<0?0:f>0&&f||0;i&&0!=g&&0!=v||(e.style.left=g+"px",e.style.top=v+"px",e.style.transform="none",n.record&&n.record(g,v))};var h=function(e){var t=o.getBoundingClientRect(),i=o.parentElement.getBoundingClientRect(),r=t.left-i.left,a=t.top-i.top;if(n.bBoxDetection)l.resize(o,e);else{var s=r+e.x,u=a+e.y;switch(n.axis){case"x":o.style.left=s+"px";break;case"y":o.style.top=u+"px";break;case"all":default:o.style.left=s+"px",o.style.top=u+"px"}}},d=function(e){var i=e;if(t){if(!c(i.button))return;a={x:i.clientX,y:i.clientY},document.addEventListener("mousemove",f)}else a={x:i.touches[0].clientX,y:i.touches[0].clientY},r.addEventListener("touchmove",f);n.start&&n.start(a)},f=function(e){var i=e;if(t)var o={x:i.clientX,y:i.clientY};else var o={x:i.touches[0].clientX,y:i.touches[0].clientY};var r={x:o.x-a.x,y:o.y-a.y};s?(n.move&&n.move(a,o,r),a=o,h(r)):s=u(r),e.preventDefault(),e.stopPropagation()},g=function(){s&&n.end&&n.end(a),s=!1,document.removeEventListener("mousemove",f),r.removeEventListener("touchmove",f)};t?(r.style.cursor=n.cursor,r.style.userSelect="none",r.addEventListener("mousedown",d),document.addEventListener("mouseup",g)):(r.addEventListener("touchend",g),r.addEventListener("touchstart",d))};e.drag=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=function(t){var i={element:null,axis:"all",minWidth:100,minHeight:100,distance:0,start:null,sizable:null,stop:null},n=Object.assign(i,t),o=n.element;if(!o)return!1;var r,a,s=void 0,l=!1,u=e.create("div","bf-resize"),c=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(n.distance,2)&&(n.start&&n.start(s),!0)},h=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e},d=function(e){var t=o.offsetLeft,i=o.offsetTop,s=r+e.x<n.minWidth?n.minWidth:r+e.x,l=a+e.y<n.minHeight?n.minHeight:a+e.y;switch(n.resize&&n.resize(s,l),o.style.left=t+"px",o.style.top=i+"px",n.axis){case"x":o.style.width=s+"px";break;case"y":o.style.height=l+"px";break;case"all":default:o.style.width=s+"px",o.style.height=l+"px"}},f=function(e){r=o.clientWidth,a=o.clientHeight;var t=e;h(t.button)&&(s={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",g),document.addEventListener("touchmove",g))},g=function(e){var t=e,i={x:t.clientX,y:t.clientY},o={x:i.x-s.x,y:i.y-s.y};l?(n.sizable&&n.sizable(s,i,o),d(o)):l=c(o)},v=function(){l&&n.end&&n.end(s),l=!1,document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",g)};o.addClass("bf-sizable"),o.appendChild(u),u.addEventListener("mousedown",f),u.addEventListener("touchstart",f),document.addEventListener("mouseup",v),document.addEventListener("touchend",v)};e.sizable=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=function(t){var i=this,n={element:null,min:0,max:100,cur:50,step:1,isShowProgress:!0,input:null,change:null,currentColor:"#11dab7",defaultColor:"#999"},o=Object.assign(n,t);this._opt=o;var r=e.create("div","bf-range"),a=e.create("input","bf-input-range");i.input=a,a.setAttribute("type","range"),a.setAttribute("step",o.step),a.setAttribute("min",o.min),a.setAttribute("max",o.max),a.setAttribute("value",o.cur);var s=e.create("span","bf-range-min");s.innerText=o.min;var l=e.create("span","bf-range-cur");i.cur=l,l.innerText=o.cur;var u=e.create("span","bf-range-max");u.innerText=o.max;var c=e.create("span","bf-range-progress");r.appendChild(a),o.isShowProgress&&(r.appendChild(s),r.appendChild(l),r.appendChild(u)),r.appendChild(c),o.element.appendChild(r),i.setProgress(o.cur),a.addEventListener("input",function(){i.setProgress(this.value),o.input&&o.input(this.value)}),a.addEventListener("change",function(){i.setProgress(this.value),o.change&&o.change(this.value)})};t.prototype.setProgress=function(e){var t=this._opt,i=t.max-t.min,n=this.input,o=this.cur,r=(e-t.min)/i*100;n.value=e,n.style.background="linear-gradient(to right,"+t.currentColor+" 0%,"+t.currentColor+"  "+r+"%,"+t.defaultColor+" "+r+"%, "+t.defaultColor+" 100%)",o.innerText=e},t.prototype.reset=function(){this.setProgress(this._opt.cur)},e.range=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=function(e){var t={element:null,min:0,max:100,from:null,to:null,step:1,currentColor:"#11dab7",defaultColor:"#999",change:null};this._opt=Object.assign(t,e),this._opt.from=this._opt.from||this._opt.min,this._opt.to=this._opt.to||this._opt.max,this.init()};t.prototype={init:function(){var t=e.create("div","bf-multiple-range"),i=e.create("div","bf-range-track"),n=e.create("span","bf-slider bf-slider-min");n.id="minSlider",n.type="minimum";var o=e.create("span","bf-slider bf-slider-max");o.id="maxSlider",o.type="maximum",this._state={from:this._opt.from,to:this._opt.to},i.style.backgroundColor=this._opt.currentColor,t.style.backgroundColor=this._opt.defaultColor,t.appendChild(i),t.appendChild(n),t.appendChild(o),this._opt.element.appendChild(t),this._track=i,this._sliders={min:n,max:o},this._element=t,this.bindEvent(),this.update(!1)},bindEvent:function(){var e,t,i=this,n=!1,o=function(i){var i=i||event;t=i.screenX,e=this,n=!0},r=function(o){if(n){var o=o||event,r=o.screenX-t,a=Math.round(r/i._pix/i._opt.step)*i._opt.step;0!=a&&(t=a*i._pix+t,"minimum"==e.type?i._state.from+=a:i._state.to+=a,i.recalculate(e),i.update(!0))}},a=function(){e=null,n=!1};this._sliders.min.addEventListener("mousedown",o),this._sliders.max.addEventListener("mousedown",o),document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)},update:function(e){var t=this._sliders.min.offsetWidth,i=this._sliders.max.offsetWidth;if(!this._pix){var n=this._element.offsetWidth,o=this._opt.max-this._opt.min,r=(n-t-i)/o;this._pix=r}var a=(this._state.from-this._opt.min)*this._pix,s=(this._state.to-this._opt.min)*this._pix+t+i;this._track.style.left=a+t/2+"px",this._track.style.width=s-a-t/2-i/2+"px",this._sliders.min.style.left=a+"px",this._sliders.max.style.left=s+"px",this._opt.change&&e&&this._opt.change(this._state)},recalculate:function(e){this._state.to>=this._opt.max&&(this._state.to=this._opt.max),this._state.from<=this._opt.min&&(this._state.from=this._opt.min),e&&("maximum"==e.type&&this._state.to<=this._state.from&&(this._state.to=this._state.from),"minimum"==e.type&&this._state.from>=this._state.to&&(this._state.from=this._state.to))},getProgress:function(){return this._state},setProgress:function(e){this._state=e,this.recalculate(),this.update(!1)}},e.multipleRange=t}(),function(){var e=function(e){var t,i;this.addEventListener("touchstart",function(e){t=Date.now()}),this.addEventListener("touchend",function(n){(i=Date.now())-t<200&&e(n)})};HTMLElement.prototype.tap=e}(),function(){(window.ActiveXObject||"ActiveXObject"in window)&&(HTMLElement.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)},window.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,i=(t.parentNode||t.document).querySelectorAll(e),n=-1;i[++n]&&i[n]!=t;);return!!i[n]}}(Element.prototype),window.Element&&function(e){e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(Element.prototype))}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.UUID"),t=function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")};e.createUUID=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=function(e,t){var i=null,n=Date.now();return void 0==t&&(t=30),function(){var o=Date.now(),r=t-(o-n),a=this,s=arguments;clearTimeout(i),r<=0?(e.apply(a,s),n=Date.now()):i=setTimeout(e,r)}};e.throttle=t}(),function(){Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility").DataUtil={assertType:function(e,t){var i=function(t){return Object.prototype.toString.call(e)==="[object "+t+"]"};switch(t){case"obj":case"Obj":case"object":case"Object":return i("Object");case"arr":case"Arr":case"array":case"Array":return i("Array");case"num":case"Num":case"number":case"Number":return i("Number");case"func":case"Func":case"function":case"Function":return i("Function");case"str":case"Str":case"string":case"String":return i("String");default:return i(t)}},assertParamsType:function(){for(var e=this,t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];if(i.length>1){var o=i.splice(i.length-1,1),r=_slicedToArray(o,1),a=r[0],s=!0;return i.every(function(t){return s=e.assertType(t,a)}),s}},hasProperty:function(e,t){if(this.assertType(e,"obj"))return void 0!==e[t]}}}(),function(){Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Utils").Transformation={getTranslation:function(e){var t=this._getDecompose(e);return{x:t.position.x,y:t.position.y,z:t.position.z}},getQuaternion:function(e){var t=this._getDecompose(e);return{x:t.quaternion._x,y:t.quaternion._y,z:t.quaternion._z,w:t.quaternion._w}},getScaling:function(e){var t=this._getDecompose(e);return{x:t.scale.x,y:t.scale.y,z:t.scale.z}},quaternionToEulerAngles:function(e,t){var i=new THREE.Euler,n=new THREE.Quaternion(e.x,e.y,e.z,e.w),o=i.setFromQuaternion(n,t||"XYZ");return{x:o._x,y:o._y,z:o._z,order:o._order}},eulerAnglesToQuaternion:function(e){var t=new THREE.Quaternion,i=new THREE.Euler(e.x,e.y,e.z,e.order),n=t.setFromEuler(i);return{x:n._x,y:n._y,z:n._z,w:n._w}},_getDecompose:function(e){var t=new THREE.Matrix4,i=new THREE.Vector3,n=new THREE.Quaternion,o=new THREE.Vector3;return t.fromArray(e),t.decompose(i,n,o),{position:i,quaternion:n,scale:o}}}}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang"),t=function(){this.container={}};t.prototype.addEvent=function(e,t){return"string"==typeof e&&"function"==typeof t&&(void 0===this.container[e]?this.container[e]=[t]:this.container[e].push(t)),this},t.prototype.fireEvent=function(e){if(e&&this.container[e]){var t=Array.prototype.slice.call(arguments);t.shift();for(var i=[].concat(_toConsumableArray(this.container[e])),n=i.length,o=0;o<n;o++){i[o].apply(null,t)}}return this},t.prototype.removeEvent=function(e,t){if("function"==typeof t&&"string"==typeof e){var i=this.container[e];if(i instanceof Array){for(var n=0,o=i.length;n<o;n+=1)if(i[n]===t){i.splice(n,1);break}0==i.length&&delete this.container[e]}return this}},e.EventManager=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Geometry"),t=function(e,t,i){this.x=e,this.y=t,this.z=i};t.prototype={get:function(){return{x:this.x,y:this.y,z:this.z}},set:function(e,t,i){this.x=e,this.y=t,this.z=i}},e.Point3d=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Geometry"),t=function(t,i){var n={},o=new e.Point3d,r=new e.Point3d;return o.set(t.x,t.y,t.z),r.set(i.x,i.y,i.z),n.min=o,n.max=r,n};e.BoundingBox=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Graphics.Utility"),t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t};e.RGBToHex=t}(),!hostConfig)var hostConfig={APIHost:"https://api.bimface.com",resourceHost:"https://m.bimface.com",staticHost:"https://static.bimface.com",dataEnvType:"BIMFACE"};!function(){function e(e,t){function i(e){return"FloorPlan"==e||"CeilingPlan"==e}if("DrawingSheet"!=t.viewType)return null;var n=t.viewInfo,o=n.preview.width,r=n.preview.height,a=n.outline[0],s=n.outline[2],l=n.outline[1],u=n.outline[3],c=s-a,h=u-l;n=t;for(var d=n.portsAndViews,f=0;f<d.length;f++){var g=d[f];if(i(g.viewType)){var v=function(t,i,n,s,u){var d=e.x/o,f=(r-e.y)/r;if("Elevation"==u.viewType){f=(o-e.x)/o,d=e.y/r;var g=u.viewPoint.viewDirection;1!=Math.round(g[0])&&-1!=Math.round(g[1])||(d=(r-e.y)/r)}var v=(t-a)/c,m=(i-a)/c;if(d<v||d>m)return null;var p=(n-l)/h,y=(s-l)/h;if(f<p||f>y)return null;var w=(d-v)/(m-v),b=(f-p)/(y-p),C=((u.outline[2]-u.outline[0])*w+u.outline[0])*u.viewPoint.scale,x=((u.outline[3]-u.outline[1])*b+u.outline[1])*u.viewPoint.scale;return new THREE.Vector3(C,x,0)}(g.viewport[0],g.viewport[3],g.viewport[1],g.viewport[4],g);if(null!=v){if(i(g.viewType))null!==v&&(v.z=g.elevation);else if("Elevation"==g.viewType){var m=g.viewPoint.viewDirection,p=g.cropBox;0!=Math.round(m[0])?null!==v&&(v.z=v.y,v.y=v.x,v.x=m[0]<0?p[3]:p[0]):0!=Math.round(m[1])&&null!==v&&(v.z=v.y,v.y=m[1]<0?p[4]:p[1])}return v}}}return null}function t(e,t,i){if("DrawingSheet"!=t.viewType)return!1;var n=t.preview.width,o=t.preview.height,r=t.outline[0],a=t.outline[2],s=t.outline[1],l=t.outline[3],u=t.portsAndViews;for(var c in u){var h=u[c];if("FloorPlan"===h.viewType){var d=h.viewPoint.scale,f=h.outline[0]*d,g=h.outline[2]*d,v=h.outline[1]*d,m=h.outline[3]*d;if(!(e.x<f||e.x>g||e.y<v||e.y>m)){var p=(e.x-f)/(g-f),y=(e.y-v)/(m-v),w=h.viewport[3]-h.viewport[0],b=h.viewport[4]-h.viewport[1];i(n*((h.viewport[0]+w*p-r)/(a-r)),o-o*((h.viewport[1]+b*y-s)/(l-s)),h)}}}return!0}var i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Graphics.Utility.Relation"),n=function(e,t,i){Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/views.json",success:function(n){var o=JSON.parse(n).viewList,n=[];for(var r in o){var a=o[r];a.viewType==t&&(a.preview.path=hostConfig.resourceHost+"/"+e+"/"+a.preview.path,n.push(a))}i&&i(n)}})},o=function(e,t,i){Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/drawings.json",success:function(e){for(var n=JSON.parse(e).drawingList,o=0;o<n.length;o++){var r=n[o];if(r.viewInfo.id==t){i&&i(r);break}}}})},r=function(t,i){if("DrawingSheet"==i.viewType)return e(t,i);if("FloorPlan"!=i.viewType)return console.warn("Not support yet!"),null;var n=i.preview.width,o=i.preview.height,r=i.outline[0],a=i.outline[2],s=i.outline[1],l=i.outline[3],u=a-r,c=l-s,h=(0-r)/u,d=l/c,f=(t.x-n*h)/n,g=(o*d-t.y)/o;return f=f*u*i.viewPoint.scale,g=g*c*i.viewPoint.scale,new Glodon$1.Web.Geometry.Point3d(f,g,i.elevation)},a=function(e,i){var n=[];if(t(e,i,function(e,t,i){n.append({x:e,y:t})}))return 0==n.length?null:n;if("FloorPlan"!=i.viewType)return console.warn("Not support yet!"),null;var o=i.preview.width,r=i.preview.height,a=i.outline[0],s=i.outline[2],l=i.outline[1],u=i.outline[3],c=s-a,h=u-l,d=(0-a)/(s-a),f=u/(u-l),g=e.x/(c*i.viewPoint.scale),v=e.y/(h*i.viewPoint.scale);return g=g*o+o*d,v=r*f-v*r,{x:g,y:v,z:0}};i.getViews=n,i.getDrawingSheets=o,i.point2DToPoint3D=r,i.point3DToPoint2D=a}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Graphics.Utility"),t=function(e){var t=new Image;return new Promise(function(i,n){t.onload=function(){i(t)},t.onerror=function(e){n(e)},t.crossOrigin="anonymous",t.src=e,!0===t.complete&&i(t)})};e.ImageContainer=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Graphics"),t=Glodon$1.Web.Graphics.Utility.RGBToHex,i=function(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n},n=function(e,t){/^#[0-9a-fA-F]{6}$/.test(e)&&(this.red=parseInt(e.slice(1,3),16),this.green=parseInt(e.slice(3,5),16),this.blue=parseInt(e.slice(5),16)),"number"==typeof t?(t>1&&(t=1),t<0&&(t=0),this.alpha=t):this.alpha=1},o=function(){arguments.length<4?n.apply(this,arguments):i.apply(this,arguments)};o.prototype={getRGB:function(){return"rgba("+this.red+","+this.green+","+this.blue+")"},getRGBA:function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")"},getHEX:function(){return""+t(this.red)+t(this.green)+t(this.blue)},getAlpha:function(){return this.alpha},fromObject:function(e){return this.red=e.red,this.green=e.green,this.blue=e.blue,this.alpha=e.alpha,this}},e.Color=o}(),function(){SVGElement.prototype.getClass=HTMLElement.prototype.getClass=function(e){return this.getAttribute("class")},SVGElement.prototype.hasClass=HTMLElement.prototype.hasClass=function(e){var t=this.getClass();return!!t&&(t&&t.split(" ")).indexOf(e)>-1},SVGElement.prototype.addClass=HTMLElement.prototype.addClass=function(e){var t=this.getClass(),i=t&&t.split(" ");return t?-1==i.indexOf(e)&&(i.push(e),t=i.join(" "),this.setAttribute("class",""+t)):this.setAttribute("class",""+e),this},SVGElement.prototype.removeClass=HTMLElement.prototype.removeClass=function(e){if(!this.hasClass(e))return this;var t=this.getClass().replace(e,"").trim();return t?this.setAttribute("class",""+t):this.removeAttribute("class"),this},SVGElement.prototype.toggleClass=HTMLElement.prototype.toggleClass=function(e,t){var i=(this.getClass(),this.hasClass(e));return void 0!=t?(t&&!i&&this.addClass(e),t||this.removeClass(e)):i?this.removeClass(e):this.addClass(e),!i}}(),function(){Array.prototype.getObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0;o<n;o++)if(i[o][e]==t)return i[o];return!1},Array.prototype.removeObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0;o<n;o++)if(i[o][e]==t)return i=i.splice(o,1);return!1},Array.prototype.getAllObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0,r=[];o<n;o++)i[o][e]==t&&r.push(i[o]);return r},Array.prototype.removeByValue=function(e){for(var t=this,i=t.length,n=i-1;n>=0;n--)t[n]==e&&t.splice(n,1);return t},Array.prototype.insert=function(e,t){return this.splice(e,0,t),this}}(),function(){SVGElement.prototype.setCss=HTMLElement.prototype.setCss=function(e){if(e)for(var t in e)this.style[t]=e[t]},SVGElement.prototype.getCss=HTMLElement.prototype.getCss=function(){return this.style}}(),function(){var e=Object.freeze({Google:"Google",Tianditu:"Tianditu",OSM:"OSM",Amap:"Amap",ArcGIS:"ArcGIS",None:"None",Custom:"Custom"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Common").Credit=e}(),function(){Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Common").ImageStyle=Object.freeze({DarkBlue:"DarkBlue",DarkGreen:"DarkGreen",CustomColor:"CustomColor"})}(),function(){var e=Object.freeze({Millimeter:"Millimeter",Centimeter:"Centimeter",Meter:"Meter",Kilometer:"Kilometer",None:"None"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Common.Units").LengthUnits=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Authentication"),t=function(){return{APIHost:hostConfig.APIHost,viewToken:null}};e.AuthenticationConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Authentication"),t=(Glodon$1.Web,Glodon$1.Web.Lang.Utility.HttpRequest),i=function(e){this.config=e};i.prototype.authenticate=function(e,i){var n=this,o=n.config;t.ajax({url:o.APIHost+"/inside/databag?viewToken="+o.viewToken,success:function(t){var r=JSON.parse(t);"success"==r.code?(r.data.viewToken=o.viewToken,n.data=r.data,e&&e(r.data)):i&&i(r)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.AuthenticationManager=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.MetaDataManagerConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=Glodon$1.Web.Lang.Utility.HttpRequest.promiseJSONRequest,i=Glodon$1.Web.Lang.Utility.HttpRequest.ajax,n={getAreas:function(e){var i=e.relativeUrl+"/data/spaces.json";return t(i)},getMepSystem:function(e,i){if("integrateModel"==i.modelType)var n=i.relativeUrl+"/metadata/"+e+"/mepsystem.json";else var n=i.relativeUrl+"/metadata/mepsystem.json";return t(n,"noCode")},getTreeOldData:function(e){if("singleModel"==e.modelType)var i=e.relativeUrl+"/data/tree.json";else var i=e.relativeUrl+"/data/specialtyTree.json";return t(i)},getTreeNewData:function(e){var i=e.relativeUrl+"/data/tree.json";return t(i)},getObjectData:function(e,t){return new Promise(function(i,n){if(t._objectData)i(t._objectData);else{var o=new Glodon$1.Bimface.Data.ObjectPropertyManager(e.relativeUrl+"/property");o.load(function(){t._objectData=o,i(t._objectData)})}})},getMaterialProperty:function(e,i){var n=i.split(".");if("singleModel"==e.modelType)var o=e.relativeUrl+"/metadata/materialmap.json";else var o=e.relativeUrl+"/metadata/"+n[0]+"/materialmap.json";return t(o,"noCode")},getMaterialPropertyItem:function(e,i,n){var o=i.split("."),r="singleModel"==e.modelType?e.relativeUrl+"/metadata/materials/"+n+".json":e.relativeUrl+"/metadata/"+o[0]+"/materials/"+n+".json";return t(r,"noCode")},getAreaProperty:function(e,i){var n=e.split("_");if("singleModel"==i.modelType)var o=i.relativeUrl+"/metadata/areas.json";else var o=i.relativeUrl+"/metadata/"+n[0]+"/areas.json";return t(o,"noCode")},getRoomProperty:function(e,i){var n=e.split("_");if("singleModel"==i.modelType)var o=i.relativeUrl+"/metadata/rooms.json";else var o=i.relativeUrl+"/metadata/"+n[0]+"/rooms.json";return t(o,"noCode")},getFiles:function(e){var i=e.relativeUrl+"/data/files.json";return t(i)},getDrawingsheets:function(e,i){var n=e.relativeUrl+"/metadata/drawings.json";return t(n,"noCode")},getMapInfo:function(e){var t=this,n=(t._opt,{}),o=[];t._helper;i({url:e.relativeUrl+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,r=t.grids.length;o<r;o++){var a=t.grids[o];a.start.X=a.start.x,a.start.Y=a.start.y,a.start.Z=a.start.z,a.end.X=a.end.x,a.end.Y=a.end.y,a.end.Z=a.end.z,i.push(a)}n.Grids=i}}),i({async:!1,url:e.relativeUrl+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),i({async:!1,url:e.relativeUrl+"/resource/v3/maps/output.json",dataType:"text",success:function(t){var i=JSON.parse(t);for(var n in i){var r=i[n];void 0==r.id&&(r.id=n),r.path=e.relativeUrl+"/resource/v3/maps/"+r.id+".png",r.name=n,o.push(r)}}});var r=n.Levels;if(r)for(var a=0;a<r.length;a++)(function(e){var t=!1;return o.some(function(i){return t=i.id.toString()===e.toString()}),t})(r[a].id)||(r.splice(a,1),a--);return{axisGrid:n,floors:o}},getLevels:function(e,i){var n=i.relativeUrl+"/metadata/levels.json";return e&&(n=i.relativeUrl+"/metadata/"+e+"/levels.json"),t(n,"noCode")},getFloors:function(e){var i=e.relativeUrl+"/data/spaces.json";return t(i,"noCode")},getViews:function(e){var t={data:null,resourceHost:"./"};return i({url:e.relativeUrl+"/metadata/views.json",async:!1,success:function(e){t.data=e}}),t},getViewsById:function(e){var t={data:null,resourceHost:"./"};return i({url:e.relativeUrl+"/metadata/"+e.fileId+"/views.json",async:!1,success:function(e){t.data=e}}),t},getViewData:function(e){var i=e.relativeUrl+"/metadata/viewStates/"+e.viewId+".json";return t(i,"noCode")},getRooms:function(e){var t=null;return i({url:e.relativeUrl+"/metadata/rooms.json",async:!1,success:function(e){t=e}}),t},getRoomBoundary:function(e,t){var n=null;return i({url:t.relativeUrl+"/metadata/roomsboundary/"+e+".json",async:!1,success:function(e){n=e}}),n},getAllDrawingsheets:function(e){var i=e.relativeUrl+"/metadata/drawings.json";return t(i,"noCode")},decodeElementId:function(e,t){if(/^[0-9]*\.*[0-9]*$/.test(t))return Promise.resolve(t);var i=t.split("."),n=i[0];return this.getFiles(e).then(function(e){var t=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=a.value,u=!0,c=!1,h=void 0;try{for(var d,f=l.linkedBy[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){if(d.value==n)return l.fileId+"."+i[1]}}catch(e){c=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw h}}}}catch(e){o=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw r}}}).then(function(e){return e})},getCategoryVisibility:function(e){var i=e.relativeUrl+"/metadata/categoryVisibility.json";return t(i,"noCode")},getText:function(e){var i=e.relativeUrl+"/metadata/text.json";return t(i,"noCode")},getSegmentGroups:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(i,"noCode")},getSegmentFromGroups:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+i+"/segments?view_token="+e.viewToken;return t(n,"noCode")},getSegmentTree:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(i,"noCode")},getSegmentById:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"?view_token="+e.viewToken;return t(n,"noCode")},getSegmentElementIds:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"/elementIds?view_token="+e.viewToken;return t(n,"noCode")},getPartialElementsMetadata:function(e,i){var n=e.relativeUrlWithoutDatabagId+"/"+i+"/metadata/partial_elements_metadata.json";return t(n,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/resource/v3/model"},getModelGroup:function(e,i){var n=e.relativeUrl+"/metadata/modelSetsTree.json";return t(n,"noCode")},getManifest:function(e){var i=e.relativeUrl+"/manifest.json";return t(i,"noCode")},getNestedComponents:function(e){var i=e.relativeUrl+"/metadata/nestedComponents.json";return t(i,"noCode")},getWalkthrough:function(e){var i=e.relativeUrl+"/data_ext/walkthrough.json";return t(i,"noCode")},getProjectInfo:function(e){var i=e.relativeUrl+"/metadata/project.json";return t(i,"noCode")},getModelInfo:function(e){var i=e.relativeUrl+"/resource/v3/model/config.json";return t(i,"noCode")},getShpStyle:function(e){var i=e.relativeUrl+"/resource/v3/model/shpStyle.json";return t(i,"noCode")}};e.OfflineDataProdiver=n}(),function(){function e(e){this._config=e}var t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data.OfflineDataProdiver");e.prototype={getComponentProperty:function(e,t,n){var o=this;if(!e)return console.warn("elementId must not be empty!."),void(n&&n());var r=null;i.getObjectData(this._config,this).then(function(t){return r=t,i.decodeElementId(o._config,e)}).then(function(e){var i=r.getBoundingBox(e),n=r.getElementProperties(e),o={},a=!0,s=!1,l=void 0;try{for(var u,c=n[0].items[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;o[h.key]=h.value}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}t({boundingBox:i,elementId:o.ID,familyGuid:"",guid:o.GUID,name:o.familyType,properties:n})})},getMaterialProperty:function(e,t,n){var o=this;i.decodeElementId(o._config,e).then(function(e){i.getMaterialProperty(o._config,e).then(function(r){var a=e.split(".");a="singleModel"==o._config.modelType?a[0]:a[1];var s=[];if(r[a]){var l=!0,u=!1,c=void 0;try{for(var h,d=r[a][Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=h.value;s.push(i.getMaterialPropertyItem(o._config,e,f))}}catch(e){u=!0,c=e}finally{try{!l&&d.return&&d.return()}finally{if(u)throw c}}Promise.all(s).then(function(e){t&&t(e)})}else n&&n(r)})})},getAreas:function(e,t){i.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getMepSystem:function(e,t,n){var o=this;i.getMepSystem(e,o._config).then(function(e){t&&t(e,o._config.modelType)}).catch(function(e){n&&n(e)})},getTreeOldData:function(e,t){var n=this;i.getTreeOldData(n._config).then(function(t){
e&&e(t,n._config.modelType,"old")}).catch(function(e){t&&t(e)})},getTreeNewData:function(e,t){var n=this;i.getTreeNewData(n._config).then(function(t){var i=!0;t&&t.length>0&&function e(t){"familyType"===t.type?t.items&&0!==t.items.length||(i=!1):t.items&&t.items.length>0&&e(t.items[0])}(t[0]),e&&e(t,n._config.modelType,i?void 0:"old")}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,n){var o=this;i.getRoomProperty(e,this._config).then(function(n){var r="singleModel"==o._config.modelType?e:e.split("_")[1],a=!0,s=!1,l=void 0;try{for(var u,c=n[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;if(h.id==r)return void i.getObjectData(o._config,o).then(function(i){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var n=i.getElementProperties(e);n.splice(0,1),h.properties=n,t&&t(h)})}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}})},getAreaProperty:function(e,t,n){var o=this;i.getAreaProperty(e,this._config).then(function(n){var r="singleModel"==o._config.modelType?e:e.split("_")[1],a=!0,s=!1,l=void 0;try{for(var u,c=n.areas[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;h.id==r&&i.getObjectData(o._config,o).then(function(i){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var n=i.getElementProperties(e);n.splice(0,1),h.properties=n,t&&t(h)})}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}})},getModelGroup:function(e,t){i.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getFiles:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getLinkGraph:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,n,o){var r=this;i.getDrawingsheets(this._config,e).then(function(e){n&&n(e,r._config.modelType,r._config.dataEnvType)})},getFloors:function(e,t){var n=this;i.getFloors(this._config).then(function(t){var i=!0,o=!1,r=void 0;try{for(var a,s=t.data[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;l.miniMap=n._config.databagId+"/resource/v3/maps/"+l.name+".png"}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}e&&e(t.data)})},getElementByConditions:function(e,t,n){var o=this;i.getObjectData(this._config,o).then(function(i){n&&n(i.getElementByConditions(e,t,o._config))})},getMapInfo:function(e){var t=i.getMapInfo(this._config);e&&e(t)},getLevels:function(e,t,n){i.getLevels(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getViews:function(e){var t=i.getViews(this._config);e&&e(t)},getViewsById:function(e,t){var n=this._config;n.fileId=e;var o=i.getViewsById(n);t&&t(o)},getViewData:function(e,t){var n=Object.assign({},this._config);n.viewId=e,i.getViewData(n).then(function(e){"[object Function]"===Object.prototype.toString.call(t)&&t(e)}).catch(function(e){"[object Function]"===Object.prototype.toString.call(failure)&&failure(e)})},getRooms:function(e){var t=i.getRooms(this._config);e&&e(t)},getRoomBoundary:function(e,t){var n=i.getRoomBoundary(e,this._config);t&&t(n)},getAllDrawingsheets:function(e,t,n,o){var r=this;i.getAllDrawingsheets(this._config).then(function(e){n&&n(e,r._config.modelType)}).catch(function(e){n&&n({drawingList:[]},r._config.modelType)})},getCategoryVisibility:function(e,t){i.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getText:function(e,t){i.getText(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentGroups:function(e,t){i.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,n){i.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentTree:function(e,t){i.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,n){i.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentElementIds:function(e,t,n){i.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadata:function(e,t,n){i.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadataFile:function(e){return i.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return i.getDatabagResource(this._config,e)},getManifest:function(e,t){i.getManifest(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getNestedComponents:function(e,t){i.getNestedComponents(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getWalkthrough:function(e,t){i.getWalkthrough(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getProjectInfo:function(e,t){var n=this;i.getProjectInfo(n._config).then(function(t){e&&e(t,n._config.modelType)}).catch(function(e){t&&t(e)})},getModelInfo:function(e,t){i.getModelInfo(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getShpStyle:function(e,t){i.getShpStyle(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}},t.OfflineDataManager=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=Glodon$1.Web.Lang.Utility.HttpRequest.promiseJSONRequest,i=Glodon$1.Web.Lang.Utility.HttpRequest.ajax,n={getMepSystem:function(e,i){if("integrateModel"==i.modelType)var n=i.resourceHost+"/"+i.databagId+"/metadata/"+e+"/mepsystem.json";else var n=i.resourceHost+"/"+i.databagId+"/metadata/mepsystem.json";return t(n,"noCode")},getTreeNewData:function(e){var i=e.resourceHost+"/"+e.databagId+"/data/tree.json";return t(i)},getTreeOldData:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/tree?v=2.0&view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/tree?view_token="+e.viewToken+"&treeType=specialty";return t(i)},getDrawingList:function(e){function i(i,n){var o=e.APIHost+"/data/v2/files/"+i+"/drawingsheets?elementId="+n+"&view_token="+e.viewToken;return t(o)}function n(i,n,o){var r=e.APIHost+"/data/v2/integrations/"+i+"/drawingsheets?fileIdHash="+n+"&elementId="+o+"&view_token="+e.viewToken;return t(r)}var e=e;return{fromSingleModel:i,fromIntegrateModel:n}},getAreas:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;return t(i)},getRoomProperty:function(e,i){if("singleModel"==i.modelType)var n=i.APIHost+"/data/v2/files/"+i.modelId+"/rooms/"+e+"?view_token="+i.viewToken;else var n=i.APIHost+"/data/v2/integrations/"+i.modelId+"/rooms/"+e+"?view_token="+i.viewToken;return t(n)},getAreaProperty:function(e,i){if("singleModel"==i.modelType)var n=i.APIHost+"/data/v2/files/"+i.modelId+"/areas/"+e+"?view_token="+i.viewToken;else var n=i.APIHost+"/data/v2/integrations/"+i.modelId+"/areas/"+e+"?view_token="+i.viewToken;return t(n)},getObjectData:function(e,i){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;else if("integrateModel"==e.modelType){var o=i.split(".");if(1==o.length)var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?view_token="+e.viewToken}else var n=e.APIHost+"/data/v2/sections/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;return t(n)},getEditedObjectData:function(e,i){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+i+"?includeOverrides=true&view_token="+e.viewToken;else{var o=i.split(".");if(1==o.length)var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+i+"?includeOverrides=true&view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?includeOverrides=true&view_token="+e.viewToken}return t(n)},getFiles:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files?includeDrawingSheet=true&view_token="+e.viewToken;return t(i)},getMaterialOverride:function(e,i,n){i=void 0==i?n.viewToken:i,e=void 0==e?n.modelId:e;var o=n.APIHost+"/data/v2/materialoverridesets/"+e+"?materialFormat=FULL_INSTANCE_JSON&sort=true&view_token="+i+"&compact=true";return t(o)},getLinkGraph:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/linkGraph?view_token="+e.viewToken;return t(i)},getMaterialProperty:function(e,i){if(!i)return void(failure&&failure({}));var n=i.split(".");if("singleModel"==e.modelType)var o=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+n[0]+"/materials?view_token="+e.viewToken;else if("integrateModel"==e.modelType)var o=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+n[0]+"/elements/"+n[1]+"/materials?view_token="+e.viewToken;else var o=e.APIHost+"/data/v2/sections/"+e.modelId+"/elements/"+i+"/materials?view_token="+e.viewToken;return t(o)},getDrawingsheets:function(e,i){var n=e.APIHost+"/data/v2/files/"+i+"/drawingsheets?fileId="+i+"&view_token="+e.viewToken;return t(n)},getAllDrawingsheets:function(e,i){var n=e.resourceHost+"/"+(e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId)+"/metadata/drawings.json";return t(n,"noCode")},getLinksJson:function(e,i){var n=e.resourceHost+"/"+e.databagId+"/metadata/links.json";return t(n,"noCode")},getFloors:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?view_token="+e.viewToken;return t(i)},getElementByConditions:function(e,i,n){var o="";for(var r in n)o+="&"+r+"="+n[r];if("singleModel"==e.modelType)var a=e.APIHost+"/data/element/id?fileId="+i+o+"&view_token="+e.viewToken;else var a=e.APIHost+"/data/v2/integrations/"+i+"/elementIds?view_token="+e.viewToken+o;return t(a)},getComponentsByConditions:function(e,i,n,o,r){for(var a={targetIds:[String(i)],targetType:"file",query:{boolOr:[]}},s=0;s<n.length;s++){var l=n[s],u={boolAnd:[]};for(var c in l)u.boolAnd.push({match:_defineProperty({},"levelName"===c&&"floor"||c,l[c])});1==u.boolAnd.length&&u.boolAnd.push(u.boolAnd[0]),a.query.boolOr.push(u)}1==a.query.boolOr.length&&a.query.boolOr.push(a.query.boolOr[0]);var h=e.APIHost+"/data/v2/query/elementIds?view_token="+e.viewToken;return t({url:h,type:"post",data:JSON.stringify(a),headers:{"Content-Type":"application/json"}})},getMapInfo:function(e){var t=this,n=(t._opt,{}),o=[];t._helper;i({url:e.resourceHost+"/"+e.databagId+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,r=t.grids.length;o<r;o++){var a=t.grids[o];a.start.X=a.start.x,a.start.Y=a.start.y,a.start.Z=a.start.z,a.end.X=a.end.x,a.end.Y=a.end.y,a.end.Z=a.end.z,i.push(a)}n.Grids=i}}),i({async:!1,url:e.resourceHost+"/"+e.databagId+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),i({async:!1,url:e.resourceHost+"/"+e.databagId+"/resource/model/maps/output.json",dataType:"text",success:function(t){var i=JSON.parse(t);for(var n in i){var r=i[n];void 0==r.id&&(r.id=n),r.path=e.resourceHost+"/"+e.databagId+"/resource/model/maps/"+r.id+".png",r.name=n,o.push(r)}}});var r=n.Levels;if(r)for(var a=0;a<r.length;a++)(function(e){var t=!1;return o.some(function(i){return t=i.id.toString()===e.toString()}),t})(r[a].id)||(r.splice(a,1),a--);return{axisGrid:n,floors:o}},getLevels:function(e,i){var n=i.resourceHost+"/"+i.databagId+"/metadata/levels.json";return e&&(n=i.resourceHost+"/"+i.databagId+"/metadata/"+e+"/levels.json"),t(n,"noCode")},getViews:function(e){var t={data:null,resourceHost:e.resourceHost};return i({url:e.resourceHost+"/"+e.databagId+"/metadata/views.json",async:!1,success:function(e){t.data=e}}),t},getViewsById:function(e){var t={data:null,resourceHost:e.resourceHost};return i({url:e.resourceHost+"/"+e.databagId+"/metadata/"+e.fileId+"/views.json",async:!1,success:function(e){t.data=e}}),t},getViewData:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/viewStates/"+e.viewId+".json";return t(i,"noCode")},getRooms:function(e){var t=null;return i({url:e.resourceHost+"/"+e.databagId+"/metadata/rooms.json",async:!1,success:function(e){t=e}}),t},getRoomBoundary:function(e,t){var n=null;return i({url:t.resourceHost+"/"+t.databagId+"/metadata/roomsboundary/"+e+".json",async:!1,success:function(e){n=e}}),n},getCategoryVisibility:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/categoryVisibility.json";return t(i,"noCode")},getText:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/text.json";return t(i,"noCode")},getScheduleList:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/schedule.json";return t(i,"noCode")},getScheduleById:function(e,i){var n=i.resourceHost+"/"+i.databagId+"/metadata/schedule/"+e+".txt";return t(n,"noCode")},getSegmentGroups:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(i,"noCode")},getSegmentFromGroups:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+i+"/segments?view_token="+e.viewToken;return t(n,"noCode")},getSegmentTree:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(i,"noCode")},getSegmentById:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"?view_token="+e.viewToken;return t(n,"noCode")},getSegmentElementIds:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"/elementIds?view_token="+e.viewToken;return t(n,"noCode")},getPartialElementsMetadata:function(e,i){var n=e.resourceHost+"/"+i+"/metadata/partial_elements_metadata.json";return t(n,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.resourceHost+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.resourceHost+"/"+t+"/resource/v3/model"},getModelGroup:function(e,i){var n=e.resourceHost+"/"+e.databagId+"/metadata/modelSetsTree.json";return t(n,"noCode")},getManifest:function(e){var i=e.resourceHost+"/"+e.databagId+"/manifest.json";return t(i,"noCode")},getNestedComponents:function(e){var i=e.relativeUrl+"/metadata/nestedComponents.json";return t(i,"noCode")},getWalkthrough:function(e){var i=e.relativeUrl+"/data_ext/walkthrough.json";return t(i,"noCode")},getProjectInfo:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/project.json";return t(i,"noCode")},getModelInfo:function(e){var i=e.relativeUrl+"/resource/v3/model/config.json";return t(i,"noCode")},getShpStyle:function(e){var i=e.relativeUrl+"/resource/v3/model/shpStyle.json";return t(i,"noCode")}};e.OnlineDataProdiver=n}(),function(){function e(e){this._config=e}var t,i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data.OnlineDataProdiver");e.prototype=(t={getComponentProperty:function(e,t,i){if(!e)return console.warn("elementId must not be empty!."),void(i&&i());n.getObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getComponentOverriddenProperty:function(e,t,i){if(!e)return console.warn("elementId must not be empty!."),void(i&&i());n.getEditedObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getMaterialProperty:function(e,t,i){n.getMaterialProperty(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getTreeOldData:function(e,t){var i=this;n.getTreeOldData(i._config).then(function(t){e&&e(t,i._config.modelType,"old")}).catch(function(e){t&&t(e)})},getTreeNewData:function(e,t){var i=this;n.getTreeNewData(i._config).then(function(t){e&&e(t,i._config.modelType)}).catch(function(e){t&&t(e)})},getMepSystem:function(e,t,i){var o=this;n.getMepSystem(e,o._config).then(function(e){t&&t(e,o._config.modelType)}).catch(function(e){i&&i(e)})},getAreas:function(e,t){n.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,i){n.getRoomProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getDrawingList:function(e,t,i,o){var r=this._config.modelType;if("integrateModel"==r){var a=t.split(".")[0],s=t.split(".")[1];n.getDrawingList(this._config).fromIntegrateModel(e,a,s).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})}else"singleModel"==r&&n.getDrawingList(this._config).fromSingleModel(e,t).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})},getModelGroup:function(e,t){n.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getAreaProperty:function(e,t,i){n.getAreaProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getFiles:function(e,t){n.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getMaterialOverride:function(e,t,i,o){n.getMaterialOverride(e,t,this._config).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})},getLinkGraph:function(e,t){n.getLinkGraph(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,i,o){var r=this;e=e||r._config.modelId,n.getDrawingsheets(this._config,e).then(function(e){i&&i(e,r._config.modelType)}).catch(function(e){o&&o(e)})},getAllDrawingsheets:function(e,t,i,o){var r=this;e=e||r._config.modelId,n.getAllDrawingsheets(this._config,e).then(function(e){i&&i(e,r._config.modelType)}).catch(function(e){o&&o(e)})},getLinksJson:function(e,t,i,o){var r=this;e=e||r._config.modelId,n.getLinksJson(this._config,e).then(function(e){i&&i(e,r._config.modelType)}).catch(function(e){o&&o(e)})},getFloors:function(e,t){n.getFloors(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getElementByConditions:function(e,t,i,o){n.getElementByConditions(this._config,e,t).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})},getComponentsByConditions:function(e,t,i,o){n.getComponentsByConditions(this._config,e,t).then(function(e){i&&i(e&&e[0].elementIds)}).catch(function(e){o&&o(e)})},getMapInfo:function(e){var t=n.getMapInfo(this._config);e&&e(t)},getLevels:function(e,t,i){n.getLevels(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getViews:function(e){var t=n.getViews(this._config);e&&e(t)},getViewsById:function(e,t){var i=this._config;i.fileId=e;var o=n.getViewsById(i);t&&t(o)},getViewData:function(e,t,i){var o=Object.assign({},this._config);o.viewId=e,n.getViewData(o).then(function(e){"[object Function]"===Object.prototype.toString.call(t)&&t(e)}).catch(function(e){"[object Function]"===Object.prototype.toString.call(i)&&i(e)})},getRooms:function(e){var t=n.getRooms(this._config);e&&e(t)},getRoomBoundary:function(e,t){var i=n.getRoomBoundary(e,this._config);t&&t(i)},getCategoryVisibility:function(e,t){n.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getText:function(e,t){n.getText(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getScheduleList:function(e,t){n.getScheduleList(this._config).then(function(t){e&&e(t.scheduleList)}).catch(function(e){t&&t(e)})},getScheduleById:function(e,t,i){n.getScheduleById(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentGroups:function(e,t){n.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,i){n.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentTree:function(e,t){n.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,i){n.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentElementIds:function(e,t,i){n.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getPartialElementsMetadata:function(e,t,i){n.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getPartialElementsMetadataFile:function(e){return n.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return n.getDatabagResource(this._config,e)}},_defineProperty(t,"getDatabagResource",function(e){return n.getDatabagResource(this._config,e)}),_defineProperty(t,"getManifest",function(e,t){n.getManifest(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getNestedComponents",function(e,t){n.getNestedComponents(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getWalkthrough",function(e,t){n.getWalkthrough(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getProjectInfo",function(e,t){var i=this;n.getProjectInfo(i._config).then(function(t){e&&e(t,i._config.modelType)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getModelInfo",function(e,t){n.getModelInfo(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getShpStyle",function(e,t){n.getShpStyle(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),t),i.OnlineDataManager=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=(Glodon$1.Web.Lang.Utility.HttpRequest,function(t){if(this._config=t,this._objectData=null,this._cache={},"Local"==t.dataEnvType?this.dataManager=new e.OfflineDataManager(t):this.dataManager=new e.OnlineDataManager(t),!t.viewToken)return!1});t.prototype={getComponentProperty:function(e,t,i){this.dataManager.getComponentProperty(e,t,i)},getComponentOverriddenProperty:function(e,t,i){this.dataManager.getComponentOverriddenProperty(e,t,i)},getDrawingList:function(e,t,i,n){this.dataManager.getDrawingList(e,t,i,n)},getTreeOldData:function(e,t){this.dataManager.getTreeOldData(e,t)},getTreeNewData:function(e,t){this.dataManager.getTreeNewData(e,t)},getMepSystem:function(e,t,i){this.dataManager.getMepSystem(e,t,i)},getModeTree:function(e,t){console.warn("This function is deprecated. Please use getTreeOldData instead."),this.getTreeOldData(e,t)},getFloors:function(e,t){this.dataManager.getFloors(e,t)},getAreas:function(e,t){this.dataManager.getAreas(e,t)},getAreaProperty:function(e,t,i){this.dataManager.getAreaProperty(e,t,i)},getModelGroup:function(e,t){this.dataManager.getModelGroup(e,t)},getMaterialProperty:function(e,t,i){this.dataManager.getMaterialProperty(e,t,i)},getRoomProperty:function(e,t,i){this.dataManager.getRoomProperty(e,t,i)},getFiles:function(e,t){this.dataManager.getFiles(e,t)},getMaterialOverride:function(e,t,i,n){this.dataManager.getMaterialOverride(e,t,i,n)},getLinkGraph:function(e,t){this.dataManager.getLinkGraph(e,t)},getDrawingsheets:function(e,t,i,n){this.dataManager.getDrawingsheets(e,t,i,n)},getElementByConditions:function(e,t,i,n){this.dataManager.getElementByConditions(e,t,i,n)},getComponentsByConditions:function(e,t,i,n){this.dataManager.getComponentsByConditions(e,t,i,n)},getAllDrawingsheets:function(e,t,i,n){this.dataManager.getAllDrawingsheets(e,t,i,n)},getLinksJson:function(e,t,i,n){this.dataManager.getLinksJson(e,t,i,n)},getMapInfo:function(e){this.dataManager.getMapInfo(e)},getCategoryVisibility:function(e,t){this.dataManager.getCategoryVisibility(e,t)},getText:function(e,t){this.dataManager.getText(e,t)},getScheduleList:function(e,t){this.dataManager.getScheduleList(e,t)},getScheduleById:function(e,t,i){this.dataManager.getScheduleById(e,t,i)},getSegmentGroups:function(e,t){this.dataManager.getSegmentGroups(e,t)},getSegmentFromGroups:function(e,t,i){this.dataManager.getSegmentFromGroups(e,t,i)},getSegmentTree:function(e,t){this.dataManager.getSegmentTree(e,t)},getSegmentById:function(e,t,i){this.dataManager.getSegmentById(e,t,i)},getSegmentElementIds:function(e,t,i){this.dataManager.getSegmentElementIds(e,t,i)},getPartialElementsMetadata:function(e,t,i){this.dataManager.getPartialElementsMetadata(e,t,i)},getPartialElementsMetadataFile:function(e){return this.dataManager.getPartialElementsMetadataFile(e)},getDatabagResource:function(e){return this.dataManager.getDatabagResource(e)},getManifest:function(e,t){return this.dataManager.getManifest(e,t)},getNestedComponents:function(e){return this.dataManager.getNestedComponents(e)},getWalkthrough:function(e){return this.dataManager.getWalkthrough(e)},getViews:function(e){return this.dataManager.getViews(e)},getViewData:function(e,t,i){return this.dataManager.getViewData(e,t,i)},getProjectInfo:function(e,t){this.dataManager.getProjectInfo(e,t)},getModelInfo:function(e,t){return this.dataManager.getModelInfo(e,t)},getShpStyle:function(e,t){return this.dataManager.getShpStyle(e,t)}},e.MetaDataManager=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.resourceHost,databagId:null}};e.FamilyDataManagerConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=Glodon$1.Web.Lang.Utility.HttpRequest,i=function(e){if(!e.databagId)return!1;this.__config=e};i.prototype.getFamilyTypes=function(e,i){var n=this.__config,o=void 0;o="Local"==n.dataEnvType?"./"+n.databagId+"/metadata/floorTree.json":n.resourceHost+"/"+n.databagId+"/metadata/familyInfo.json",t.ajax({url:o,success:function(t){for(var t=JSON.parse(t),i=t.Types||t.types,n=0,o=i.length;n<o;n++)i[n].id=i[n].Id||i[n].id,i[n].name=i[n].Name||i[n].name,delete i[n].Id,delete i[n].Name;e&&e(i)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.FamilyDataManager=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.staticHost}};e.IBLManagerConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=Glodon$1.Web.Lang.Utility.HttpRequest,i=function(e){this.__config=e};i.prototype.getIBLConfig=function(e,i){var n=this.__config,o=void 0;if("Local"==n.dataEnvType)return!1;o=n.resourceHost+"/resources/IBL/IBLConfig.json",t.ajax({url:o,success:function(t){var i=JSON.parse(t);e&&e(i)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.IBLManager=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=(Glodon$1.Web.Lang.Utility.HttpRequest,t||{});t.version=1,t.EnumObjectTableIndex={OTI_OBJECTS_VALUES:0,OTI_PROPERTY_SCHEMAS:1,OTI_ELEMENT_PROPERTIES:2,OTI_FAMILY_PROPERTIES:3,OTI_FAMILIES:4,OTI_ELEMENTS:5,OTI_BOUNDING_BOX:6,OTI_ELEMENTS_CLASS:7};var i=function(e){this.url=e,this.objectsDB=[]};i.prototype={load:function(e){for(var t=this,i=["Values.json","Schemas.json","ElementProperties.json","FamilyTypeProperties.json","Families.json","Elements.json","BoundingBox.json","ElementsClass.json"],n=i.length,o=0,r=i.length;o<r;++o)!function(o){(new THREE.FileLoader).load(t.url+"/"+i[o]+CLOUD.GlobalData.ZipResourcePostfix,function(i){t.objectsDB[o]=JSON.parse(i),0==(n-=1)&&e()})}(o)},getFamilyTypeProperties:function(e){var i=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILIES],n=i[e];if(void 0===n)return null;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILY_PROPERTIES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,l=0,u=0,c={},h=[],d=0,f=0,g=n[2],v=n[1];f<g;++f){s=2*(v+f),l=4*r[s],u=r[s+1],d=a[l];var m=c[d];void 0===m&&(m=[],c[d]=m,h.push(d)),m.push({key:o[a[l+1]],unit:o[a[l+3]],valueType:a[l+2],value:o[u]})}for(var p=[],f=0,y=h.length;f<y;++f)d=h[f],p.push({group:o[d],items:c[d]});return p},getElementProperties:function(e){if(null==e)return null;var i=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS],n=i[e];if(void 0===n)return null;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENT_PROPERTIES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,l=0,u=0,c={},h=[],d=0,f=0,g=n[2],v=n[1];f<g;++f){s=2*(v+f),l=4*r[s],u=r[s+1],d=a[l];var m=c[d];void 0===m&&(m=[],c[d]=m,h.push(d)),m.push({key:o[a[l+1]],unit:o[a[l+3]],valueType:a[l+2],value:o[u]})}for(var p=[],f=0,y=h.length;f<y;++f)d=h[f],p.push({group:o[d],items:c[d]});var w=this.getFamilyTypeProperties(n[3]);if(!w)return p;var b={},C=[];p=w.concat(p);var x=!0,E=!1,k=void 0;try{for(var P,_=p[Symbol.iterator]();!(x=(P=_.next()).done);x=!0){var M=P.value;if(b[M.group]){var I=[].concat.apply(b[M.group].items,M.items),S=[],B=!0,D=!1,T=void 0;try{for(var A,L=I[Symbol.iterator]();!(B=(A=L.next()).done);B=!0){var O=A.value,G=!0,R=!0,V=!1,N=void 0;try{for(var U,H=S[Symbol.iterator]();!(R=(U=H.next()).done);R=!0){var W=U.value;O.key==W.key&&(G=!1)}}catch(e){V=!0,N=e}finally{try{!R&&H.return&&H.return()}finally{if(V)throw N}}G&&S.push(O)}}catch(e){D=!0,T=e}finally{try{!B&&L.return&&L.return()}finally{if(D)throw T}}b[M.group]={group:b[M.group].group,items:S}}else b[M.group]=M}}catch(e){E=!0,k=e}finally{try{!x&&_.return&&_.return()}finally{if(E)throw k}}for(var M in b)"基本属性"==b[M].group?C.unshift(b[M]):C.push(b[M]);return C},getElementByConditions:function(e,i,n){var o=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS_CLASS],r=Object.keys(i),a=[],s=[],l={},u={min:{x:null,y:null,z:null},max:{x:null,y:null,z:null}},c=[],h=!0,d=!1,f=void 0;try{for(var g,v=r[Symbol.iterator]();!(h=(g=v.next()).done);h=!0){var m=g.value;c.push({typeIndex:this._getGroupsKey(m,i[m],o),typeValue:i[m]})}}catch(e){d=!0,f=e}finally{try{!h&&v.return&&v.return()}finally{if(d)throw f}}for(var p=0;p<o.groups.length;p+=3){var y=!0,w=!0,b=!1,C=void 0;try{for(var x,E=c[Symbol.iterator]();!(w=(x=E.next()).done);w=!0){var k=x.value,P=o.groups[p][k.typeIndex];if(o.values[P]!=k.typeValue){y=!1;break}}}catch(e){b=!0,C=e}finally{try{!w&&E.return&&E.return()}finally{if(b)throw C}}if(y)if("singleModel"==n.modelType)a=a.concat(o.groups[p+1][""]);else{var _=o.groups[p+1],M=o.groups[p+2];for(var I in _){var S=!0,B=!1,D=void 0;try{for(var T,A=_[I][Symbol.iterator]();!(S=(T=A.next()).done);S=!0){var L=T.value;s.push({fileId:I,elementId:L})}}catch(e){B=!0,D=e}finally{try{!S&&A.return&&A.return()}finally{if(B)throw D}}}(u.min.x>M[0]||null==u.min.x)&&(u.min.x=M[0]),(u.min.y>M[1]||null==u.min.y)&&(u.min.y=M[1]),(u.min.z>M[2]||null==u.min.z)&&(u.min.z=M[2]),(u.max.x<M[3]||null==u.max.x)&&(u.max.x=M[3]),(u.max.y<M[4]||null==u.max.y)&&(u.max.y=M[4]),(u.max.z<M[5]||null==u.max.z)&&(u.max.z=M[5])}}return"singleModel"==n.modelType?a:0==s.length?[]:(l.elements=s,l.boundingBox=u,l)},_getGroupsKey:function(e,t,i){for(var n=0,o=0;o<i.keys.length;o++)if(i.keys[o]==e){n=o;break}return n},getBoundingBox:function(e){if(null==e)return null;var i=this.objectsDB[t.EnumObjectTableIndex.OTI_BOUNDING_BOX],n="";try{n={min:{x:i[e][0],y:i[e][1],z:i[e][2]},max:{x:i[e][3],y:i[e][4],z:i[e][5]}}}catch(e){console.log("no boundingBox Data"),n=""}return n}},e.ObjectPropertyManager=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.FileManagerConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Data"),t=Glodon$1.Web.Lang.Utility.HttpRequest,i=function(e){this.__config=e};i.prototype.getViewToken=function(e,i,n){var o=this.__config,r=void 0
;return"singleModel"!=o.modelType&&("Local"==o.dataEnvType?void(i&&i()):(r=o.APIHost+"/data/v2/integrations/"+o.modelId+"/files/"+e+"/viewToken?view_token="+o.viewToken,void t.ajax({url:r,type:"post",success:function(e){var t=JSON.parse(e);i&&i(t.data)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);n&&n(t)})})))},e.FileManager=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Common"),t=function(){function e(){_classCallCheck(this,e),this.consoleType="log",this._enable=!0}return _createClass(e,[{key:"formatData",value:function(e){return e=e.toString(),"."!==e[e.length-1]&&(e+="."),e}},{key:"setConsoleType",value:function(e){["log","warn","error","info"].indexOf(e)>=0&&(this.consoleType=e)}},{key:"warn",value:function(e){this._enable&&console[this.consoleType]("[BIMFACE WARN]: "+this.formatData(e))}},{key:"info",value:function(e){this._enable&&console[this.consoleType]("[BIMFACE INFO]: "+this.formatData(e))}},{key:"error",value:function(e){this._enable&&console[this.consoleType]("[BIMFACE ERROR]: "+this.formatData(e))}},{key:"obsolete",value:function(e,t){if(this._enable){var i=function(e){return e=e.toString(),")"!==e[e.length-1]&&(e+="()"),e};e=i(e),t=i(t);var n=e+" is obsolete, please use "+t+" instead.";this.warn(n)}}},{key:"updateDataSource",value:function(e){this._enable&&console.error("[BIMFACE ERROR]:"+e+" is not compatible with the data source. Please upgrade the data source and try again.")}},{key:"open",value:function(){this._enable=!0,this.info("Console opened")}},{key:"close",value:function(){this.info("Console closed"),this._enable=!1}}]),e}();e.Console=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=Glodon$1.Web.Lang.Utility.ClientHelper.isWebGLAvailable(),n=(Object.freeze({TranslucentOthers:"",HideOthers:""}),function(){var e=new Glodon$1.Web.Lang.EventManager;this.viewerType="Viewer",this.getEventManager=function(){return e}});n.prototype.destroy=function(){this.getEventManager=null},n.prototype.init=function(){},n.prototype.getViewerType=function(e){return this.viewerType},n.prototype.addView=function(e,t,n){if(i){var o=this,r=Glodon$1.Bimface.Authentication.AuthenticationManager,a=(o._opt,new Glodon$1.Bimface.Authentication.AuthenticationConfig);a.viewToken=e,a.APIHost=this._opt.APIHost;(this.authenticate=new r(a)).authenticate(function(e){"bimView"==e.renderType&&("pdf-transfer"!==e.workerType?e.renderType="3DView":e.renderType="pdfView"),o.loadViewCore(e,t,n)},function(e){var t=Glodon$1.Bimface.Viewer.Viewer3DEvent;o.getEventManager().fireEvent(t.Error,e)})}},n.prototype.loadViewCore=function(){},n.prototype.addEventListener=function(e,t){this.getEventManager().addEvent(e,t)},n.prototype.removeEventListener=function(e,t){this.getEventManager().removeEvent(e,t)},n.prototype.enableFullScreen=function(e){var t=this._opt.domElement,i=this;e?Glodon$1.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon$1.Web.Lang.Utility.FullScreen.exitFullScreen(),setTimeout(function(){i.resize()},200)},n.prototype._loadNotSuportPromptPage=function(e){var i=t.create("div","bf-waring-container"),n=t.create("div","bf-waring"),o=t.create("span","bf-waring-icon"),r=t.create("span","bf-waring-text");r.innerText=BimfaceLanguage.bf_browser_notSupported,n.appendChild(o),n.appendChild(r),i.appendChild(n);var a=t.create("div","bf-suggestion");a.innerText=BimfaceLanguage.bf_browser_suggestion,i.appendChild(a);var s=t.create("div","bf-logo");i.appendChild(s),e.appendChild(i)},e.Viewer=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer"),t=function(){return{domElement:null,resourceHost:hostConfig.resourceHost,staticHost:hostConfig.staticHost+"/api/Glodon",APIHost:hostConfig.APIHost,sdkUrl:null,staticPath:"/api/Glodon",enableLineWidth:!1,displayMode:0,enableHover:!0,enableViewport:!1}};e.ViewerDrawingConfig=t}(),function(){var e=Object.freeze({ViewAdded:"ViewAdded",ViewLoading:"ViewLoading",ComponentsSelectionChanged:"ComponentsSelectionChanged",ComponentsHoverChanged:"ComponentsHoverChanged",Error:"Error",Loaded:"Loaded",MouseClicked:"MouseClicked",MouseDragged:"MouseDragged",ContextMenu:"ContextMenu",Rendered:"Rendered",ViewChanged:"ViewChanged",ViewMoving:"ViewMoving",ViewMoved:"ViewMoved",ViewZooming:"ViewZooming",ViewZoomed:"ViewZoomed",Hover:"Hover",ZoomFactorChanged:"ZoomFactorChanged",ButtonOnToolbarClicked:"ButtonOnToolbarClicked"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer").ViewerDrawingEvent=e}(),function(){var e=Object.freeze({Pan:"pan",RectZoom:"rectZoom",Zoom:"zoom",AreaMeasure:"AreaMeasure",AngleMeasure:"AngleMeasure",Pick:"pick",Measure:"DistanceMeasure"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer").NavigationModeDrawing=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer"),t=Object.freeze({Endpoint:"endpoint",Midpoint:"midpoint",Intersection:"intersection",Line:"line",Face:"face"});e.SnapObject=t}(),function(){var e=(Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer")),t=function(){function e(){_classCallCheck(this,e),this.snapList={},this.snapConditions=[]}return _createClass(e,[{key:"setSnap2DList",value:function(e){this.snapList=e}},{key:"getSnap2DList",value:function(){return this.snapList}},{key:"setSnap3DList",value:function(e){this.snapList=e}},{key:"getSnap3DList",value:function(){return this.snapList}},{key:"setSnapConditions",value:function(e){this.snapConditions=e}},{key:"getSnapConditions",value:function(){return this.snapConditions}}]),e}();e.SnapMode=t}(),function(){var e="Glodon.Bimface.Viewer.ViewerDrawing",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"GlobalData"),o=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),r=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Graphics"),a=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),s=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),Glodon$1.Bimface.Viewer.ViewerDrawingEvent);n.isInitialized=n.isInitialized||!1;var l=Glodon$1.Web.Lang.Utility.ClientHelper.isWebGLAvailable(),u=function(n){var o=this;i.Viewer.call(this);var r=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop();if(l){var u=this;this.viewerType="ViewerDrawing";var c=n;this._opt=n,this.isInitialized=!1,this.hasBindEvents=!1,this.grids=null,this.cursorReady=!1,this.snapIsEnabled=!1,this.console=new Glodon$1.Web.Common.Console,this._cache={};var h=a.create("div","bf-drawing-container ");if(r)var d=a.create("div","bf-drawing-wrap");else{var d=a.create("div","bf-drawing-wrap bf-mobile"),f=n.domElement.offsetWidth,g=n.domElement.offsetHeight;d.style.fontSize=90*Math.min(f,g,414)/750+"px"}var v,m=n.domElement;m.addClass("viewerDrawingWrap"),m.id?v=m.id:(v=Glodon$1.Web.Lang.Utility.UUID.createUUID(),m.id=v),h.id="Drawing"+v,h.setCss({width:"100%",height:"100%",position:"relative",zIndex:1,background:0==this._opt.displayMode?"rgb(50, 50, 55)":""}),d.setCss({width:"100%",height:"100%",position:"relative",overflow:"hidden"}),d.appendChild(h),m.appendChild(d),c.domElement=h,this._domElement=m,this._viewConfig=c,this.rootElement=h,this.getDomElement=function(){return d},this.getRootElement=function(){return h},this.getViewer=function(){return this._drawingViewer},this._pressAlt=!1,r?(document.addEventListener("keydown",function(e){18==(e.keyCode||e.which||e.charCode)&&(o._pressAlt=!0)}),document.addEventListener("keyup",function(e){18==(e.keyCode||e.which||e.charCode)&&(o._pressAlt=!1)}),h.addEventListener("mousedown",function(e){if(e.preventDefault(),e.stopPropagation(),this.oldMouseX=e.clientX,this.oldMouseY=e.clientY,2===e.button&&"2"==u.version){var t={},i=u.getDomElement().getBoundingClientRect(),n={x:e.clientX-i.left,y:e.clientY-i.top},o={width:i.width,height:i.height};t.clientPosition=n,t.containerBox=o,u.getEventManager().fireEvent(s.ContextMenu,t)}}),h.addEventListener("mouseup",function(e){e.preventDefault();var t=Math.abs(this.oldMouseX-e.clientX)<=1&&Math.abs(this.oldMouseY-e.clientY)<=1;if(0===e.button){var i,n,o,r=this.getBoundingClientRect(),a={};if(i=e.clientX-r.left,n=e.clientY-r.top,o={x:i,y:n},t){if(!e.target.hasClass("bf-drawable-context")&&"canvas"!=e.target.tagName.toLocaleLowerCase())return;var l,c;if(c=u._drawingViewer.toWorldPoint([i,n]),u._drawingViewer.preSelect(i,n),l=u._drawingViewer.getHighlightIds(),a={worldPosition:{x:c[0],y:c[1]},clientPosition:o,objectId:l[0]||null,clientX:e.clientX,clientY:e.clientY,event:e},a.objectId){var h=u.getLayerIdFromElementId(a.objectId),d=u.getLayerById(h);a.layerId=h||null,a.layerName=d&&d.name||null}else a.layer=null;if(u.grids&&(a.grid=u.getNearestGrid({x:i,y:n})),u.snapIsEnabled){var f=u._drawingViewer.snapToPoint(i,n);if(0!=f.GetID()){var g=f.GetSnapType(),v={x:f.GetPoint()[0],y:f.GetPoint()[1]},m=u._drawingViewer.toScreenPoint([v.x,v.y]),o={x:m[0],y:m[1]};a.snapPoint={type:g,clientPosition:o,worldPosition:v}}}u.getEventManager().fireEvent(s.MouseClicked,a),u._pressAlt&&console.log(a)}else a={clientPosition:o},u.getEventManager().fireEvent(s.MouseDragged,a)}})):(h.addEventListener("touchstart",function(e){if(e.target.hasClass("bf-drawable-context")||"canvas"==e.target.tagName.toLocaleLowerCase()){var t=e.targetTouches[0];this.oldTouchX=t.clientX,this.oldTouchY=t.clientY}}),h.addEventListener("touchend",function(e){var t,i,n,o=e.changedTouches[0],r=this.oldTouchX==o.clientX&&this.oldTouchY==o.clientY,a=this.getBoundingClientRect(),l={};if(t=o.clientX-a.left,i=o.clientY-a.top,n={x:t,y:i},r){if(!e.target.hasClass("bf-drawable-context")&&"canvas"!=e.target.tagName.toLocaleLowerCase())return;var c,h;if(h=u._drawingViewer.toWorldPoint([t,i]),u._drawingViewer.preSelect(t,i),c=u._drawingViewer.getHighlightIds(),l={worldPosition:{x:h[0],y:h[1]},clientPosition:n,objectId:c[0]||null,clientX:o.clientX,clientY:o.clientY,event:e},l.objectId){var d=u.getLayerIdFromElementId(l.objectId),f=u.getLayerById(d);l.layerId=d||null,l.layerName=f&&f.name||null}else l.layer=null;u.grids&&(l.grid=u.getNearestGrid({x:t,y:i})),u.getEventManager().fireEvent(s.MouseClicked,l)}else l={clientPosition:n},u.getEventManager().fireEvent(s.MouseDragged,l)})),Glodon$1.Bimface.WebglDrawingSheet.onLoadProgress=function(e){var t=document.querySelector(".bf-drawing-container  .bf-loading-text");t&&e&&(t.innerText=parseInt(100*e)+"%")},u.addEventListener(s.Loaded,function(){var i={eventId:"加载",loadModel:"expert",type:"drawing"};t.send(e,"Loaded",i)})}else this._loadNotSuportPromptPage(n.domElement)};o.Type.inheritPrototype(u,i.Viewer),u.prototype=Object.assign({},i.Viewer.prototype,{addModel:function(e,t,i,o){if(!l||this._data&&this._data.renderVersion!=e.renderVersion)return console.log("this model can not be added."),!1;var r=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance();r.modelType=e.modelType,r.modelId=e.modelId;var a=this.getDomElement();a.removeClass("drawingFrame");var s,u=this,c=(u.getViewer(),u._opt,e.dataPath,e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId),h=Glodon$1.Web.Lang.Utility.ClientHelper.formatURL((e.path||this._viewConfig.resourceHost)+"/"+c+"/resource/drawing");e.drawingUrl=h,u._data=e;var s,d;if(void 0!=o){d=!0;var f=e.split&&e.split.databagId;s=f?Glodon$1.Web.Lang.Utility.ClientHelper.formatURL((e.path||u._viewConfig.resourceHost)+"/"+f+"/resource/drawing/Frames"):h+"/Frames"}else s=h,d=!1;if(d){var a=this.getDomElement();a.addClass("drawingFrame")}u.isInitialized||n.isInitialized?u.loadIndexJson(e,t,i,function(){"1"==u.version||"1"==u.prevVersion?u.destroy(!0):u.destroy(),"1"==u.version&&(u._drawingViewer=u.createDrawingViewer(u.rootElement.id)),u._drawingViewer&&u._drawingViewer.clearAll(),"2"==u.version?u.loadWebGL(s,t,i,o):u.loadModel(s,t,i),u._viewMetaData=e}):u.loadIndexJson(e,t,i,function(){"1"==u.version||"1"==u.prevVersion?u.destroy(!0):u.destroy();var r=e.sdkPath?e.sdkPath+"/bimface":e.sdkPath;if("bimView"==e.renderType&&e.subRenders&&0!=e.subRenders.length)for(var a=0;a<e.subRenders.length;a++)"drawingView"==e.subRenders[a].renderType&&(Glodon$1.Bimface.DrawingSheet.sdkUrl=u._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||r||u._viewConfig.staticHost+"/"+e.subRenders[a].jsSDKVersion);else Glodon$1.Bimface.DrawingSheet.sdkUrl=u._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||r||u._viewConfig.staticHost+"/"+e.jsSDKVersion;"2"==u.version?u.loadWebGL(s,t,i,o,d):Glodon$1.Bimface.DrawingSheet.initialize(function(){u._drawingViewer=u.createDrawingViewer(u.rootElement.id),u.loadModel(s,t,i),n.isInitialized=!0})}),this.showLoading()},showLoading:function(){this.rootElement.style.zIndex=5;var e=a.create("div","bf-loading"),t=a.create("div","bf-loading-gif"),i=a.create("div","bf-loading-text");e.appendChild(t),e.appendChild(i),this.loading=e,this.rootElement.appendChild(e)},enableHover:function(i){t.send(e,"enableHover"),this._opt.enableHover=i,this._drawingViewer.enableHover(i)},enableSnap:function(i){t.send(e,"enableSnap"),this.snapIsEnabled=i,this._drawingViewer.mouseEditorMgr.enableSnap(i)},enablePickEffect:function(e){this._drawingViewer.mouseEditorMgr.enablePickEffect(e)},setSnapMode:function(i){t.send(e,"setSnapMode"),this.getViewer().setSnapMode(i)},destroy:function(e){if(this._drawingViewer&&this._drawingViewer.mouseEditorMgr&&this._drawingViewer.mouseEditorMgr.unbindAllEvent(),e){this._drawingViewer=null;for(var t=document.querySelectorAll("#"+this.rootElement.id+" canvas"),i=0;i<t.length;i++)t[i].remove()}this.hasBindEvents=!1},enableMiniMap:function(i,n){t.send(e,"enableMiniMap");var o=this._drawingViewer;if(!0===i){if(1==o.hasMinimap())return void o.enableMinimap(!0);var r=this.rootElement.id,a={width:300,height:240},s=this._viewConfig.resourceHost,l=this.authenticate.data.databagId,u=s+"/"+l+"/thumbnail/512.png",c=s+"/"+l+"/resource/preview/Model_4028.json";Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:c,success:function(e){function t(e){var t=e.indexOf("{"),i=e.indexOf("}"),n=e.slice(t+1,i).split(",");return{x:parseFloat(n[0]),y:parseFloat(n[1])}}var i=JSON.parse(e).boundingbox,s=t(i.minPoint),l=t(i.maxPoint);o.createMinimap(r,u,a.width,a.height),n&&n(),o.setMinimapBoundingBox({min:s,max:l})}})}else o.enableMinimap(!1)},getDrawingFrame:function(e){function t(t){var n=(Glodon$1.Web.Lang.Utility.HttpRequest,t.split&&t.split.databagId),o=n||t.integrateDrawings&&t.integrateDrawings.databagId||t.databagId,r=Glodon$1.Web.Lang.Utility.ClientHelper.formatURL((t.path||i._viewConfig.resourceHost)+"/"+o+"/resource/drawing/Frames");i.getIndexJson(r,e)}var i=this,n=i._viewMetaData||i._data,o=window.BimfaceLoaderConfig.dataEnvType,r=window.BimfaceLoaderConfig.viewToken;if(n)t(n);else if("Local"==o){var a=window.BimfaceLoaderConfig.path;i._ajaxGet(a,function(e){var o=a.split("/");o.pop(),e.path=o.join("/")+"/",i._data=n,t(e)})}else i.getViewMetaData(r,function(e){t(e)})},loadFrame:function(e,t){var i=this;this.destroy(),this.showLoading(),this.getDomElement().addClass("drawingFrame"),this.getViewMetaData(e,function(e){var n=e.drawingUrl;i.getIndexJson(n,function(n){"2"==n.metadata.version||"2"==n.metadata["version:"]?i.version="2":i.version="1";var o=e.split&&e.split.databagId,r=void 0;r=o?Glodon$1.Web.Lang.Utility.ClientHelper.formatURL((e.path||i._viewConfig.resourceHost)+"/"+o+"/resource/drawing/Frames"):e.drawingUrl+"/Frames",i._drawingViewer&&i._drawingViewer.clearAll(),i.loadWebGL(r,null,null,t,!0),i._viewMetaData=e})})},load:function(e,t,i){if(!l)return!1;var o=this,r=arguments;if(this.getDomElement().removeClass("drawingFrame"),n.loading)return setTimeout(function(){o.load.apply(o,r)},500);n.loading=!0,o.isInitialized||n.isInitialized?e&&this.getViewMetaData(e,function(e){o.loadIndexJson(e,t,i,function(){"1"==o.version||"1"==o.prevVersion?o.destroy(!0):o.destroy(),"1"==o.version&&(o._drawingViewer=o.createDrawingViewer(o.rootElement.id)),o._drawingViewer&&o._drawingViewer.clearAll(),"2"==o.version?o.loadWebGL(e.drawingUrl,t,i):o.loadModel(e.drawingUrl,t,i),o._viewMetaData=e})}):e&&this.getViewMetaData(e,function(e){o._viewMetaData=e,o.loadIndexJson(e,t,i,function(){"1"==o.version||"1"==o.prevVersion?o.destroy(!0):o.destroy();var n=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance();n.modelType=e.modelType,n.modelId=e.modelId,o.initialize(e,t,i)})}),this.showLoading()},loadIndexJson:function(e,t,i,n){var o=this,r=e.drawingUrl;t&&(r=r+(i?"/"+i:"")+"/"+t),this.url=r,this.getIndexJson(r,function(e){var t=document.querySelector(".bf-drawing-container  .bf-loading-text");o.version&&(o.prevVersion=o.version),"2"==e.metadata.version||"2"==e.metadata["version:"]?(o.version="2",t.innerText="0%"):(o.version="1",t.innerText=BimfaceLanguage.bf_load),n()})},getViews:function(){return this._drawingViewer.getLayouts()},getModelPosition:function(i,n,o){t.send(e,"getModelPosition");var r=this.authenticate.data.databagId,a=null,s=this._drawingViewer.getModelBBox().GetMinPt(),l=this._drawingViewer.getModelBBox().GetMaxPt(),u=new THREE.Vector2(s[0],s[1]),c=new THREE.Vector2(l[0],l[1]),h=new THREE.Box2(u,c),d=(n.x-h.min.x)/h.getSize().x,f=(n.y-h.min.y)/h.getSize().y,g=new THREE.Vector3(d,f);Glodon$1.Web.Graphics.Utility.Relation.getDrawingSheets(r,i,function(e){a=e,a.viewType=e.viewInfo.viewType;var t=a.viewInfo.preview.width,i=a.viewInfo.preview.height,n=new THREE.Vector2(t*g.x,i*(1-g.y)),r=Glodon$1.Web.Graphics.Utility.Relation.point2DToPoint3D(n,a);o&&o(r)})},getLayers:function(){return this._drawingViewer.getLayers()},getLayerIdFromElementId:function(e){if(this._drawingViewer.getLayerIdFromElementId)return this._drawingViewer.getLayerIdFromElementId(e)},changeLayers:function(i){t.send(e,"changeLayers"),this._drawingViewer.changeLayers(i),this.update()},getColor:function(e){return"rgba("+(255&e)+", "+(e>>8&255)+", "+(e>>16&255)+", 1)"},hideLayer:function(i){t.send(e,"hideLayer");for(var n=this.getLayers(),o=0,r=n.length;o<r;++o){var a=n[o];if(a.id==i){a.visible=!1;break}}this.changeLayers(n)},getLayerById:function(e){for(var t=this.getLayers(),i=0,n=t.length;i<n;++i){var o=t[i];if(o.id==e)return o}return!1},showLayer:function(i){t.send(e,"showLayer");for(var n=this.getLayers(),o=0,r=n.length;o<r;++o){var a=n[o];if(a.id==i){a.visible=!0;break}}this.changeLayers(n)},hideAllLayers:function(){t.send(e,"hideAllLayers");for(var i=this.getLayers(),n=0,o=i.length;n<o;++n){i[n].visible=!1}this.changeLayers(i)},showAllLayers:function(i){t.send(e,"showAllLayers");for(var n=this.getLayers(),o=0,r=n.length;o<r;++o){n[o].visible=!0}this.changeLayers(n)},showAllElements:function(){this._drawingViewer.showAllElements()},getElementBoxColor:function(){t.send(e,"getElementBoxColor");var i=this._drawingViewer.getElementBoxColor();return new Glodon$1.Web.Graphics.Color(i.red,i.green,i.blue,i.alpha)},setElementBoxColor:function(i){t.send(e,"setElementBoxColor"),this._drawingViewer.setElementBoxColor(i.red,i.green,i.blue,i.alpha)},getElementBoxStyle:function(){return t.send(e,"getElementBoxStyle"),this._drawingViewer.getElementBoxStyle()},setElementBoxStyle:function(i){return t.send(e,"setElementBoxStyle"),-1==["Rectangle","CloudRect"].indexOf(i)?void console.error("params error!"):this._drawingViewer.setElementBoxStyle(i)},showViewById:function(i){t.send(e,"showViewById"),this._drawingViewer.activeLayoutById(i||0),this.getEventManager().fireEvent(s.ViewChanged,i)},getCurrentViewId:function(){return this._drawingViewer.getActiveLayoutId()},rectZoom:function(){t.send(e,"rectZoom"),this._drawingViewer.mouseEditorMgr.activeEditorByName("zoom"),this._opt.enableZoomRect=!0},getZoomFactor:function(){return this._drawingViewer.getZoomFactor()},getCurrentState:function(){return this._drawingViewer.getState()},setState:function(i){t.send(e,"setState"),this._drawingViewer&&(this._drawingViewer.setState(i),this._drawingViewer.update())},createSnapshotAsync:function(i,n){t.send(e,"createSnapshotAsync"),i&&(i="rgba("+i.red+","+i.green+","+i.blue+","+i.alpha+")"),n&&n(this._drawingViewer.snapshot(i))},enableFullScreen:function(e){var t=this.getDomElement();e?Glodon$1.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon$1.Web.Lang.Utility.FullScreen.exitFullScreen()},home:function(){var e="2"===this.version?.2:void 0;this.modelBBox?this._drawingViewer.zoomToWorldBox(this.modelBBox[0],this.modelBBox[1],e):this._drawingViewer.zoomToExtent(e),this._drawingViewer.update()},getViewMetaData:function(e,t,i){var n=this,o=Glodon$1.Bimface.Authentication.AuthenticationManager,r=new Glodon$1.Bimface.Authentication.AuthenticationConfig,a=void 0;r.viewToken=e,r.APIHost=this._viewConfig.APIHost,a=i?new o(r):this.authenticate=new o(r),a.authenticate(function(e){var i=e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId;e.drawingUrl=n._viewConfig.resourceHost+"/"+i+"/resource/drawing",t(e)})},getIndexJson:function(e,t){Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:e+"/index.json",success:function(e){var i=JSON.parse(e);i&&t(i)}})},initialize:function(e,t,i){if(this.isInitialized)return!1;var o=this;if("bimView"==e.renderType&&e.subRenders&&0!=e.subRenders.length)for(var r=0;r<e.subRenders.length;r++)"drawingView"==e.subRenders[r].renderType&&(Glodon$1.Bimface.DrawingSheet.sdkUrl=o._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||o._viewConfig.staticHost+"/"+e.subRenders[r].jsSDKVersion);else Glodon$1.Bimface.DrawingSheet.sdkUrl=o._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||o._viewConfig.staticHost+"/"+e.jsSDKVersion;"2"==o.version||"2.0"==e.renderVersion?this.loadWebGL(e.drawingUrl,t,i):Glodon$1.Bimface.DrawingSheet.initialize(function(){o._drawingViewer=o.createDrawingViewer(o.rootElement.id),o.loadModel(e.drawingUrl,t,i),n.isInitialized=!0})},loadWebGL:function(e,t,i,o,r){var a=this;this.grids=null,t&&(e=e+(i?"/"+i:"")+"/"+t);var l;a._drawingViewer?l=a._drawingViewer:a._drawingViewer=l=a.createDrawingViewer(a.rootElement.id),Glodon$1.Bimface.WebglDrawingSheet.loadModel(e,a.rootElement.id,l,function(e){for(var i=document.querySelectorAll(".bf-drawing-container .bf-loading"),o=i.length,u=0;u<o;u++)i[u].remove();a.rootElement.style.zIndex=1,n.loading=!1,a.enableViewport(a._opt.enableViewport);var c=l.getLayouts();if(r&&c.length>1)a._drawingViewer.activeLayoutById(c[1].id);else if(t){for(var h=null,u=0;u<c.length;u++)if("Layout1"==c[u].name){h=c[u].id;break}h&&a.showViewById(h),l.model={Url:e.url+"/"};var d;d=new Glodon$1.Bimface.RevitInterop,d.initialize(l),l.revitInterop=d}var f=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop();a._drawingViewer.mouseEditorMgr=f?Glodon$1.Bimface.WebglDrawingSheet.createMouseEditorManager(l):Glodon$1.Bimface.WebglDrawingSheet.createTouchEditorManager(l),a._drawingViewer.mouseEditorMgr.bindEvents(),a.observer(a._drawingViewer.mouseEditorMgr),a._drawingViewer.mouseEditorMgr.activeEditorByName("pick"),window.addEventListener("resize",function(){l&&l.onResize()}),a._drawingViewer.onViewChanges=function(){a.getEventManager().fireEvent(s.Rendered,a._drawingViewer)},a.setDisplayMode(a._opt.displayMode),!a._opt.enableViewport&&a.home(),a.getManifest(function(e){e=e||{};var t=e.Features,i=Object.assign({},t||{}),n=a._viewMetaData||a._data,o=!0,r=!0,l=!1,u=!1;t&&(o=t.HasLayout,r=t.HasMiniMap,l=t.HasText),(n.split&&n.split.databagId||n.config&&n.config.split)&&(u=!0),i=Object.assign(i,{HasLayout:o,HasMiniMap:r,HasText:l,HasSplitDrawing:u}),a._manifest=Object.assign(e,{Features:i}),a.getEventManager().fireEvent(s.Loaded,a._drawingViewer.mouseEditorMgr)}),a.cursorReady||(Glodon$1.Web.Lang.Utility.MouseMotion.setCursor(a),a.cursorReady=!0),a.enableHover(a._opt.enableHover)},o)},observer:function(e){var t=null,i=this;e.observer=function(e,n,o,r,a,l){if("zoom"==e&&"exit"==n&&(i.getEventManager().fireEvent(s.ViewZoomed),i._opt.enableZoomRect=!1),"zoomFactorChanged"==n&&i.getEventManager().fireEvent(s.ZoomFactorChanged,o),("DistanceMeasure"==e||"AngleMeasure"==e||"AreaMeasure"==e)&&"change"==n){var u=i.getViewScale(),c=null;o&&"Distance"===o.type?c="measured"===o.status?{type:o.type,distance:o.distance*u,points:o.points,start:[o.start[0]*u,o.start[1]*u],end:[o.end[0]*u,o.end[1]*u],isOnLayout:o.isOnLayout}:{type:o.type,points:o.points}:o&&"Area"===o.type?c={type:"Area",points:o.points,area:"measured"===o.status&&o.area*u*u||null}:o&&"Angle"===o.type&&(c=o),"measuring"===o.status?i.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measuring,c):"measured"===o.status?i.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measured,c):"reset"===o.status&&i.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset)}if("pick"==e&&"selection"==n&&i.getEventManager().fireEvent(s.ComponentsSelectionChanged,o),"pick"==e&&"highlight"==n)if(o.length>0){if(t==o[0])return;var h=i._drawingViewer.toWorldPoint([r,a]);i.getEventManager().fireEvent(s.Hover,{objectId:o[0],clientPosition:{x:r,y:a},worldPosition:{x:h[0],y:h[1]},event:l}),t=o[0]}else t=null}},createDrawingViewer:function(e,t){var i;"2"==this.version?i=Glodon$1.Bimface.WebglDrawingSheet:(i=Glodon$1.Bimface.DrawingSheet,this.isInitialized=!0);var n=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop(),o=i.createDrawing(e,t);return o.mouseEditorMgr=n?i.createMouseEditorManager(o):i.createTouchEditorManager(o),o},zoomToBoundingBox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if("2"!==this.version)return void console.log("Drawing of old version doesn't support zoomToBoundingBox.");if(!e)return void console.log("Parameter boundingBox is required.");var i=void 0,n=void 0;"[object Object]"===e.toString()?(i=[e.min.x,e.min.y,0],n=[e.max.x,e.max.y,0]):(i=e[0].concat([0]),n=e[1].concat([0])),this.getViewer().zoomToWorldBox(i,n,t),this.update()},getAxisGridsIntersection:function(e,t){var i=this.url+"/AxisGrid.json",n=[];this.getAxisGrid(i,function(i){for(var o=0;o<e.length-1;o++)for(var r=e[o],a=o+1;a<e.length;a++){var s=e[a],l=r>s?s:r,u=r>s?r:s,c=i[l]&&i[l][u];c&&n.push({intersection:c,axisNames:[l,u]})}t&&t(n)})},getAxisGrid:function(e,t){var i=this._cache;if(i.AxisGrid)return t(i.AxisGrid);Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:e,success:function(e){var n=JSON.parse(e);if(n){for(var o={},r=n.intersection,a=0;a<r.length;a++){var s=r[a].axisGrids[0],l=r[a].axisGrids[1],u=s>l?l:s,c=s>l?s:l;o[u]||(o[u]={}),o[u][c]||(o[u][c]=[]),o[u][c].push(r[a].intersection)}i.AxisGrid=o,t(o)}}})},toRevitId:function(e){return this.console.obsolete("ViewerDrawing.toRevitId","ViewerDrawing.toModelId"),this.toModelId(e)},toLinkRevitId:function(i,n){return t.send(e,"toLinkRevitId"),this._drawingViewer.revitInterop.toLinkRevitId(i,n)},fromRevitId:function(e){return this._drawingViewer.revitInterop.fromRevitId(e)},fromLinkRevitId:function(i,n){return t.send(e,"fromLinkRevitId"),this._drawingViewer.revitInterop.fromLinkRevitId(i,n)},toModelId:function(i){return t.send(e,"toModelId"),this._drawingViewer.revitInterop.toRevitId(i)},toDrawingId:function(i){return t.send(e,"toDrawingId"),this._drawingViewer.revitInterop.fromRevitId(i)},zoomToObject:function(i,n){t.send(e,"zoomToObject"),n=n||.5,this.clearSelection(),this._drawingViewer.zoomToObject(i,n),this._drawingViewer.canSelectInBlock()?this.selectIdWithBlock(0,i):this.selectByIds(i)},zoomToObjectWithBlock:function(e,t,i){i=i||.5,this.clearSelection(),this._drawingViewer.zoomToObjectWithBlock(e,t[0],i);for(var n=0;n<t.length;n++)this.selectIdWithBlock(e,t[n]);this.update()},setZoomRatio:function(e){e=e||1.1,(e>=2||e<0)&&(e=1.9),this._drawingViewer.setZoomRatio(e)},getZoomRatio:function(){return this._drawingViewer.getZoomRatio()},selectByIds:function(i){t.send(e,"selectByIds"),Array.isArray(i)||(i=[i]),this._drawingViewer.selectByIds(i),this.update()},getSelectedIds:function(){return this._drawingViewer.getSelectedIds()},selectIdWithBlock:function(e,t){("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this._drawingViewer.selectIdWithBlock(e,t)},clearSelection:function(){this._drawingViewer.clearSelection(),this.update(!0)},showLineWidth:function(i){t.send(e,"showLineWidth"),this._opt.enableLineWidth=i,this._drawingViewer.viewer.ShowLineWidth=i,this.update(!0)},isEnableLineWidth:function(){return this._opt.enableLineWidth},loadModel:function(e,t,i){var o=this,r=this._drawingViewer,a=r.mouseEditorMgr;r.touchEditorMgr;this.grids=null,t&&(e=e+(i?"/"+i:"")+"/"+t,Glodon$1.Bimface.DrawingSheet.loadGrids(e,function(e){e&&(o.grids=e.grids,console.log(e))})),Glodon$1.Bimface.DrawingSheet.loadModel(e,function(e){if(null===e){console.log("failed to load model!"),n.loading=!1;for(var i=document.querySelectorAll(".bf-drawing-container  .bf-loading"),l=0;l<i.length;l++)i[l].remove();return void(o.rootElement.style.zIndex=1)}if(r.setModel(e),r.clearSelection(),t){for(var u=r.getLayouts(),c=null,l=0;l<u.length;l++)if("Layout1"==u[l].name){c=u[l].id;break}c&&o.showViewById(c);var h;h=new Glodon$1.Bimface.RevitInterop,h.initialize(r),r.revitInterop=h}o.hasBindEvents||(a.bindEvents(),o.hasBindEvents=!0),o.observer(a),a.activeEditorByName("pick"),n.loading=!1;for(var i=document.querySelectorAll(".bf-drawing-container .bf-loading"),d=i.length,l=0;l<d;l++)i[l].remove();o.rootElement.style.zIndex=1,window.addEventListener("resize",function(){r&&r.onResize()}),r.onViewChanges=function(){o.getEventManager().fireEvent(s.Rendered,r)},o.enableViewport(o._opt.enableViewport),o.setDisplayMode(o._opt.displayMode),!o._opt.enableViewport&&o.home(),o.showLineWidth(o._opt.enableLineWidth),o.getManifest(function(e){e=e||{};var t=e.Features,i=Object.assign({},t||{}),n=o._viewMetaData||o._data,r=!0,a=!0,l=!1,u=!1;t&&(r=t.HasLayout,a=t.HasMiniMap,l=t.HasText),(n.split&&n.split.databagId||n.config&&n.config.split)&&(u=!0),i=Object.assign(i,{HasLayout:r,HasMiniMap:a,HasText:l,HasSplitDrawing:u}),o._manifest=Object.assign(e,{Features:i}),o.getEventManager().fireEvent(s.Loaded,o._drawingViewer.mouseEditorMgr)}),o.cursorReady||(Glodon$1.Web.Lang.Utility.MouseMotion.setCursor(o),o.cursorReady=!0),o.enableHover(o._opt.enableHover)})},setNavigationMode:function(i){t.send(e,"setNavigationMode"),"rectZoom"==i?this.rectZoom():this._drawingViewer.mouseEditorMgr.activeEditorByName(i)},zoomIn:function(){this._drawingViewer.zoomPan(1.1)},zoomOut:function(){this._drawingViewer.zoomPan(.9)},zoom:function(e){this._drawingViewer.zoomPan(e)},resize:function(){this._drawingViewer.onResize()},worldToClient:function(e){var t=this._drawingViewer.toScreenPoint([e.x,e.y]);return{x:t[0],y:t[1]}},clientToWorld:function(e){var t=this._drawingViewer.toWorldPoint([e.x,e.y]);return{x:t[0],y:t[1]}},update:function(e){this._drawingViewer.update(e)},setPrintMode:function(e){this._drawingViewer&&(this._drawingViewer.setPrintMode(e),this._drawingViewer.update(!0))},setGlobalOpacity:function(e){this._drawingViewer.dc.setGlobalOpacity(e),this._drawingViewer.update(!0)},setDisplayMode:function(i){if(t.send(e,"setDisplayMode"),i=i||0,"1"==this.version&&3==i)return this.console.updateDataSource("ViewerDrawing.setDisplayMode(3)");0==i?(this.rootElement.style.background="rgb(50,50,55)","2"==this.version&&this._drawingViewer.setSelectWireframeColor(1,1,1,1)):3!=i&&(this.rootElement.style.background="rgb(255,255,255)","2"==this.version&&this._drawingViewer.setSelectWireframeColor(.733,.733,.733,1)),1!=i&&2!=i||"2"!=this.version?"2"==this.version&&this._drawingViewer.enableReplaceElementColor(!1):(this._drawingViewer.enableReplaceElementColor(!0),this._drawingViewer.replaceElementColor(1,1,1,0,0,0)),this._opt.displayMode=i
;var n=["Normal","White","Black","Custom"];this.setPrintMode(n[i])},getGlobalOpacity:function(){return this._drawingViewer.dc.getGlobalOpacity()},setGlobalColor:function(e){e instanceof r.Color?(this._drawingViewer.setGlobalColor(e),this._drawingViewer.update(!0)):console.error("param use Glodon.Web.Graphics.Color ")},restoreGlobalColor:function(){if("1"==this.version)return this.console.updateDataSource("ViewerDrawing.restoreGlobalColor");this._drawingViewer.restoreGlobalColor(),this._drawingViewer.update(!0)},getGlobalColor:function(){if(3==this.getDisplayMode())return this._drawingViewer.getGlobalColor();console.error("Only available when using customized display mode.")},restoreGlobalOpacity:function(){this._drawingViewer.dc.restoreGlobalOpacity(),this._drawingViewer.update(!0)},getDisplayMode:function(){return this._opt.displayMode},getViewScale:function(){return this._drawingViewer.getViewScale()},setViewScale:function(e){this._drawingViewer.setViewScale(e)},setSnapDistance:function(e){"number"!=typeof e||e<0||e>25||this._drawingViewer.setSnapDistance(e)},showMergedBoundingBoxById:function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;i.push(this.getObjectBoundingBox(l))}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}var u=Glodon$1.Web.Algorithm.BoundingBoxUtil,c=u.toThreeJsBox2(i,t),h=u.mergeBoundingBox(c),d=u.toDrawingBox2(h),f=!0,g=!1,v=void 0;try{for(var m,p=d[Symbol.iterator]();!(f=(m=p.next()).done);f=!0){var y=m.value;this._drawingViewer.showElementBoxByBBox(y,0)}}catch(e){g=!0,v=e}finally{try{!f&&p.return&&p.return()}finally{if(g)throw v}}this._drawingViewer.update()},showElementBox:function(e,t){this.showElementBoxByBBox(this.getObjectBoundingBox(e),t)},showElementBoxByBBox:function(e,t){if("[object Object]"===e.toString()&&(e=[[e.min.x,e.min.y],[e.max.x,e.max.y]]),t){t=Math.min(t,100)/100;var i=Math.max(e[1][1]-e[0][1],e[1][0]-e[0][0])}this._drawingViewer.showElementBoxByBBox(e,t&&i*t),this._drawingViewer.update()},hideElementBox:function(e){this._drawingViewer.hideElementBox(parseInt(e)),this._drawingViewer.update(!0)},clearElementBox:function(){this._drawingViewer.clearElementBox(),this._drawingViewer.update(!0)},getObjectBoundingBox:function(e){return this._drawingViewer.getObjectBoundingBox(parseInt(e))},getVisibleBoxIds:function(){return this._drawingViewer.getVisibleBoxIds()},enableHighlightEvent:function(e){this._drawingViewer.enableHighlightEvent(e)},highlightById:function(e){if(Array.isArray(e))for(var t=0,i=e.length;t<i;t++)this._drawingViewer.highlightById(parseInt(e[t]));else this._drawingViewer.highlightById(parseInt(e));this._drawingViewer.update(!0)},clearHighlight:function(){this._drawingViewer.clearHighlight(),this._drawingViewer.update(!0)},ignoreImage:function(e){this._drawingViewer.dc.ignoreImage=e,this._drawingViewer.update(!0)},clientToModelWorld:function(e){var t=this._drawingViewer.viewer.ToModelWorldPoint([e.x,e.y]);return[t[0],t[1]]},getNearestGrid:function(e){e=this.clientToModelWorld(e);for(var t=this.grids,i=null,n=t.length-1;n>=0;n--){var o=t[n].gridInfo;o.distance=Glodon$1.Web.Lang.Utility.ClientHelper.PointToLineDistance(e[0],e[1],o.start.x,o.start.y,o.end.x,o.end.y),i?i.distance[0]>o.distance[0]&&(i=o):i=o}return i},scale:function(e,t){this._drawingViewer.scaleDrawing(e,t)},getScaleFactor:function(){return this._drawingViewer.getAlignScale()},getExternalReferencesList:function(e){var t=this.url+"/externalBlocks.json";this._ajaxGet(t,e)},getAlignState:function(){return this._drawingViewer.getAlignState()},setAlignState:function(e){this._drawingViewer.setAlignState(e)},overrideElementsColorById:function(e,t){if("1"==this.version)return this.console.updateDataSource("ViewerDrawing.overrideElementsColorById");t instanceof r.Color?this._drawingViewer.overrideElementsColorById(e,t):console.error("param use Glodon.Web.Graphics.Color ")},restoreElementsColorById:function(e){if("1"==this.version)return this.console.updateDataSource("ViewerDrawing.restoreElementsColorById");this._drawingViewer.restoreElementsColorById(e)},addImage:function(e,t,i,n,o){var r=this._drawingViewer.customManager,a=r.markups,s=this,l=new Image;l.src=t;for(var u=0;u<a.length;u++){if(a[u].id==e)return console.error("id"+e+"已经存在,图片添加失败!"),!1}r.setStyle("Chartlet"),r.add([i.x,n.y],[n.x,i.y],0,l,e),l.onload=function(){s.update(),o&&o()},this.calculateBBox()},calculateBBox:function(){for(var e=this._drawingViewer.customManager,t=e.markups,i=this._drawingViewer.getModelBBox().GetMinPt(),n=this._drawingViewer.getModelBBox().GetMaxPt(),o=0;o<t.length;o++){var r=t[o];r.min&&(i[0]=Math.min(r.min[0],i[0]),i[1]=Math.min(r.min[1],i[1]),n[0]=Math.max(r.max[0],n[0]),n[1]=Math.max(r.max[1],n[1]))}this.modelBBox=[i,n]},clearImages:function(){this._drawingViewer.customManager.markups=[],this.modelBBox=null},removeImagesById:function(e){for(var t=this._drawingViewer.customManager,i=t.markups,n=0;n<e.length;n++)for(var o=e[n],r=0;r<i.length;r++){var a=i[r];if(a.id==o){i.splice(r,1);break}}this.calculateBBox(),this.update()},enableViewport:function(e){this._drawingViewer.enableViewport&&this._drawingViewer.enableViewport(e)},getRenderInfo:function(e,t){var i=this;this.getViewMetaData(e,function(e){var n=e.drawingUrl;i.getIndexJson(n,function(e){t&&t(e)})})},getAxisInfo:function(e){var t=this.url+"/AxisGrid.json";this._ajaxGet(t,e)},getManifest:function(e){var t=this,i=Glodon$1.Web.Lang.Utility.HttpRequest,n=t._viewMetaData||t._data,o=n.integrateDrawings&&n.integrateDrawings.databagId||n.databagId,r=Glodon$1.Web.Lang.Utility.ClientHelper.formatURL((n.path||this._viewConfig.resourceHost)+"/"+o+"/manifest.json");i.ajax({url:""+r,success:function(t){var i=JSON.parse(t);i&&e(i)},failure:function(t){e(t)}})},_ajaxGet:function(e,t){Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:e,success:function(e){var i=JSON.parse(e);i&&t(i)}})},hideElementsById:function(e){this._drawingViewer.hideElementsById&&this._drawingViewer.hideElementsById(e)},showElementsById:function(e){this._drawingViewer.showElementsById&&this._drawingViewer.showElementsById(e)},getObjectViews:function(){for(var e=this.getViews(),t={},i=0;i<e.length;i++)t[e[i].name]=e[i].id;return t},getDrawingFeatures:function(e){if(this._drawingFeatures)e(this._drawingFeatures);else{var t=this,i=this._viewMetaData||this._data,n=i.integrateDrawings&&i.integrateDrawings.databagId||i.databagId,o=Glodon$1.Web.Lang.Utility.ClientHelper.formatURL((i.path||t._viewConfig.resourceHost)+"/"+n+"/resource/drawing/drawingFeatures.json.gz");this._ajaxGet(o,function(i){t._drawingFeatures=i,e(i)})}},searchText:function(e,t){if(void 0===e||""===e||!t)return console.error("搜索文本内容和回调函数不能为空");var i=this;this.getDrawingFeatures(function(n){if(n){n.text.model.name="Model";for(var o=[n.text.model].concat(n.text.layouts),r=[],a=i.getObjectViews(),s=0;s<o.length;s++)for(var l=o[s].data,u=o[s].name,c=0;c<l.length;c++)if(l[c].content.indexOf(e)>-1){for(var h=[],d=0;d<l[c].items.length;d++){var f=l[c].items[d].bbox;h.push({max:{x:f[2],y:f[3]},min:{x:f[0],y:f[1]}})}r.push({viewId:a[u],content:l[c].content,boundingBox:h})}t(r)}else t(null)})}}),i.ViewerDrawing=u}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer"),t=function(){return{domElement:null,resourceHost:hostConfig.resourceHost,staticHost:hostConfig.staticHost+"/api/Glodon",APIHost:hostConfig.APIHost,sdkUrl:null,staticPath:"/api/Glodon",enableLineWidth:!1,displayMode:0,enableViewport:!1}};e.ViewerDrawingSetConfig=t}(),function(){var e=Object.freeze({ViewAdded:"ViewAdded",ViewLoading:"ViewLoading",ComponentsSelectionChanged:"ComponentsSelectionChanged",ComponentsHoverChanged:"ComponentsHoverChanged",Error:"Error",Loaded:"Loaded",MouseClicked:"MouseClicked",ActiveViewChanged:"ActiveViewChanged",MouseDragged:"MouseDragged",ContextMenu:"ContextMenu",Rendered:"Rendered",ViewChanged:"ViewChanged",ViewMoving:"ViewMoving",ViewMoved:"ViewMoved",ViewZooming:"ViewZooming",ViewZoomed:"ViewZoomed",AddDrawing:"AddDrawing",Hover:"Hover",ZoomFactorChanged:"ZoomFactorChanged"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer").ViewerDrawingSetEvent=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Viewer"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"GlobalData"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),o=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),Glodon$1.Bimface.Viewer.ViewerDrawingSetEvent);t.isInitialized=t.isInitialized||!1;var r=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),a=function(t){e.Viewer.call(this);var i=this;this.viewerType="ViewerDrawingSet";var a=t;this._opt=t,this.isAlignment=!1,this.sets=[],this.activeState=null,this._displayMode=t.displayMode,this._state={},this.hasInit=!1,this._databagId=null;var s,l=n.create("div","bf-drawingSet-container "),u=t.domElement;u.id?s=u.id:(s=Glodon$1.Web.Lang.Utility.UUID.createUUID(),u.id=s),l.id="DrawingSet"+s,l.setCss({width:"100%",height:"100%",position:"relative"}),u.appendChild(l),a.domElement=l,this.getRenderInfo=function(e,t){var i=this;this.getViewMetaData(e,function(e){var n=e.drawingUrl;i.getIndexJson(n,function(e){t&&t(e)})})},this._domElement=u,this._viewConfig=a,this.rootElement=l,this.haveActiveDrawing=!1,this.getRootElement=function(){return l},i.addEventListener(o.Loaded,function(){var e={eventId:"加载",loadModel:"expert",type:"DrawingSet"};r.send("Glodon.Bimface.Viewer.ViewerDrawingSet","Loaded",e)})};i.Type.inheritPrototype(a,e.Viewer),a.prototype=Object.assign({},e.Viewer.prototype,{addDrawing:function(e,t,i){var n=this;this.getViewMetaData(t,function(o){var r=new Glodon$1.Bimface.Viewer.ViewerDrawingSetConfig,a=n.createWrap(e);r.domElement=a,r.drawingUrl=o.drawingUrl,r.displayMode=n._displayMode,r.viewToken=t,r.enableViewport=n._viewConfig.enableViewport,n.getViewMetaData(t,function(e){n._databagId=e.databagId});var s=Glodon$1.Bimface.Viewer.ViewerDrawingSetEvent,l=void 0;l=new Glodon$1.Bimface.Viewer.ViewerDrawing(r),l.load(r.viewToken);var u={id:e,wrap:a,viewerDrawing:l,active:!1,visible:!0,fileName:o.name};n.sets.push(u),n.haveActiveDrawing||(n.haveActiveDrawing=!0,n.setActiveDrawing(e,!0)),l.addEventListener(s.MouseClicked,function(t){n.onMouseClick(e,t)}),l.addEventListener(s.Rendered,function(e){n.activeState=e.getState(),n.sync(),n.getEventManager().fireEvent(s.Rendered,n)}),l.addEventListener(s.Loaded,function(e){n.setDisplayMode(n.getDisplayMode()),n.hasInit||(n.getEventManager().fireEvent(s.Loaded,n),n.hasInit=!0),n.getEventManager().fireEvent(s.AddDrawing,n),n.getEventManager().fireEvent(s.ViewChanged,n),i&&i(e)}),l.addEventListener(s.ViewZoomed,function(){n.getEventManager().fireEvent(s.ViewZoomed,n)}),l.addEventListener(s.ZoomFactorChanged,function(e){n.getEventManager().fireEvent(s.ZoomFactorChanged,e)}),l.addEventListener(s.MouseDragged,function(e){n.getEventManager().fireEvent(s.MouseDragged,e)}),l.addEventListener(s.ContextMenu,function(e){n.getEventManager().fireEvent(s.ContextMenu,e)})})},addDrawings:function(e,t){var i=e.slice(),n=i.shift(),o=n.viewToken,r=n.id,a=t,s=this;void 0==r&&(r=Date.now()),this.addDrawing(r,o);var l=function e(){var t=i.shift();if(t){var n=t.id;void 0==n&&(n=Date.now()),s.addDrawing(n,t.viewToken)}else a&&a(s),s.removeEventListener("AddDrawing",e)};this.addEventListener("AddDrawing",l)},sync:function(){for(var e=this.sets,t=this.activeState,i=0;i<e.length;i++)e[i].active||e[i].viewerDrawing.setState(t)},setNavigationMode:function(e){this.getActiveDrawing().viewerDrawing.setNavigationMode(e)},removeDrawing:function(e){if(null==e||void 0==e)return console.error("id is necessary!"),!1;var t=this.getDrawingById(e);t.active&&(1==this.sets.length?this.haveActiveDrawing=!1:this.setActiveDrawing(this.sets[this.sets[0].id==e?1:0].id)),t.wrap.remove(),this.sets.removeObjectByAttribute("id",e),this.getEventManager().fireEvent(o.ViewChanged,self)},rectZoom:function(){this._state.rectZoom=!0,this.getActiveDrawing().viewerDrawing.rectZoom()},enableFullScreen:function(e){var t=this.getRootElement();e?Glodon$1.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon$1.Web.Lang.Utility.FullScreen.exitFullScreen();var i=this;setTimeout(function(){i.getActiveDrawing().viewerDrawing.resize()},500)},getCurrentState:function(){for(var e=[],t=this.sets,i=0;i<t.length;i++){var n=t[i],o=n.id,r=n.active,a=n.visible,s=n.viewerDrawing,l=this.getOffsetDistance(o),u=s.getAlignState(),c=s.getCurrentState(),h={id:o,active:r,visible:a,alignState:u,allState:c,translate:l};e.push(h)}return e},setCurrentState:function(e){for(var t=this.sets,i=0;i<t.length;i++){var n=t[i],o=n.id,r=n.active,a=n.visible,s=n.viewerDrawing,l=e.getObjectByAttribute("id",o);l&&(l.visible!=a&&(l.visible?this.showDrawing(o):this.hideDrawing(o)),l.active&&!r&&this.setActiveDrawing(o),l.alignState&&s.setAlignState(l.alignState),l.allState&&s.setState(l.allState))}},onMouseClick:function(e,t){t.id=e;var i=this.alignmentPoints,n=this.getSelectDrawing(),r=n.viewerDrawing.getViewer();if(this.isAlignment){if(this.selectId){var a=r.toModelWorld([t.clientPosition.x,t.clientPosition.y]);this.alignmentPoints.push({x:a[0],y:a[1]})}else this.alignmentPoints.push(t.worldPosition);if(1==i.length){var s=r,l=s.snapToPoint(t.clientPosition.x,t.clientPosition.y),u=l.GetPoint();if(0!=l.GetID())i[0]={x:u[0],y:u[1]};else{var c=this.verify([t.clientPosition.x,t.clientPosition.y]);if(c){var h=s.toModelWorld(c),d=h.slice(0,2);i[0]={x:d[0],y:d[1]}}}}else if(2==i.length){var f=r;"capture"!=f.mouseEditorMgr.editors[0].name&&n.viewerDrawing.setNavigationMode("capture");var g=this.verify([t.clientPosition.x,t.clientPosition.y]);if(g){var v=f.toModelWorld(g),m=v.slice(0,2);i[1]={x:m[0],y:m[1]}}this.moveDrawing(n.id,[i[1].x-i[0].x,i[1].y-i[0].y]),this.alignmentPoints=[]}}else if(this.snapping){var p=r.snapToPoint(t.clientPosition.x,t.clientPosition.y);if(0!=p.GetID()){var y=p.GetSnapType(),w={x:p.GetPoint()[0],y:p.GetPoint()[1]},b=r.toScreenPoint([w.x,w.y]),C={x:b[0],y:b[1]};t.snapPoint={type:y,clientPosition:C,worldPosition:w}}else this.tempSnapPoint&&(t.snapPoint={type:this.tempSnapPoint.type,clientPosition:{x:this.tempSnapPoint.screenPoint[0],y:this.tempSnapPoint.screenPoint[1]},worldPosition:{x:this.tempSnapPoint.worldPoint[0],y:this.tempSnapPoint.worldPoint[1]}})}this.getEventManager().fireEvent(o.MouseClicked,t)},convertCoordinates:function(e,t,i){var n=this.getDrawingById(e),o=this.getDrawingById(t),r=n.viewerDrawing.worldToClient({x:i[0],y:i[1]});return o.viewerDrawing.clientToWorld(r)},showDrawing:function(e){var t=this.getDrawingById(e);t.wrap.setCss({display:"block"}),t.visible=!0},hideDrawing:function(e){var t=this.getDrawingById(e);if(t.active)return void console.log("can't hide active drawing");t.wrap.setCss({display:"none"}),t.visible=!1},moveDrawing:function(e,t){var i=this.getDrawingById(e);i.viewerDrawing.getViewer().alignDrawing([0,0],[t[0],t[1]]),i.viewerDrawing.update(!0)},startMoving:function(){var e=this;this.isAlignment=!0,this.alignmentPoints=[];var t=this.getActiveDrawing(),i=t.viewerDrawing.getViewer();t.viewerDrawing.setNavigationMode("capture"),i.mouseEditorMgr.editors[0].setIsOnlySnap(!1),i.mouseEditorMgr.editors[0].captureFail=function(t,i,n){return e.verify(t,i,n,!0),!1},this.enterMode(!0)},enableSnap:function(e){var t=this,i=this.getActiveDrawing(),n=i.viewerDrawing.getViewer();this.snapping=e,e?(i.viewerDrawing.setNavigationMode("capture"),n.mouseEditorMgr.editors[0].setIsOnlySnap(!0),n.mouseEditorMgr.editors[0].captureFail=function(e,i,n){return t.verify(e,i,n,!0,!0),!1}):i.viewerDrawing.setNavigationMode("pick")},setSnapMode:function(e){var t=this.getActiveDrawing(),i=t.viewerDrawing;this.snapMode=e,i.getViewer().setSnapMode(e)},enterMode:function(e){var t=void 0;t=e?this.getSelectDrawing():this.getActiveDrawing();for(var i=this.sets,n=0;n<i.length;n++)if(i[n].id!=t.id)i[n].viewerDrawing.setPrintMode("Custom"),i[n].viewerDrawing.setGlobalColor(new Glodon$1.Web.Graphics.Color("#7D888A"));else if(e)i[n].viewerDrawing.setPrintMode("Custom"),0==this._displayMode?i[n].viewerDrawing.setGlobalColor(new Glodon$1.Web.Graphics.Color("#ffffff")):i[n].viewerDrawing.setGlobalColor(new Glodon$1.Web.Graphics.Color("#000000"));else{var o=["Normal","White","Black","Custom"];i[n].viewerDrawing.setPrintMode(o[this._displayMode])}},selectDrawing:function(e){this.selectId=e,this.enterMode(!0)},verify:function(e,t,i,n,o){if(e){for(var r=this.sets,a=null,s=this.getActiveDrawing().id,l=n?s:this.selectId||s,u=0;u<r.length;u++)if(r[u].id!=l){var c=r[u].viewerDrawing.getViewer(),h=c.snapToPoint(e[0],e[1]),d=h.GetPoint(),f=h.GetID();if(0!=f){var g=h.GetSnapTypeName(),v=function(e,t){if(!e)return!1;if(!t)return!0;var i=e.GetSnapTypeName(),n=t.snapList,o={PointOnLine:"line",Intersection:"intersection",MiddlePoint:"midpoint",EndPoint:"endpoint"};return n.includes(o[i])}(h,this.snapMode);if(!v)continue;var m=this.getActiveDrawing(),p=m.viewerDrawing.getViewer();return e=c.toScreenPoint(d),p.mouseEditorMgr.editors[0].drawTmpPoint(t,i,e,g),this.tempSnapPoint={worldPoint:d,id:f,screenPoint:e,type:g},a=e}}return this.tempSnapPoint=null,a}},getSelectDrawing:function(){return this.selectId?this.getDrawingById(this.selectId):this.getActiveDrawing()},endMoving:function(){this.isAlignment=!1,this.selectId=null,this.getActiveDrawing().viewerDrawing.setNavigationMode("pick"),this.enterMode(!1)},createWrap:function(e){var t=n.create("div",this.rootElement.id+e);return this.rootElement.appendChild(t),t},getOffsetDistance:function(e){return this.getDrawingById(e).viewerDrawing.getViewer().getAlignTranslate()},setActiveDrawing:function(e,t){if(null==e||void 0==e)return console.error("id is necessary!"),!1;var i=this.sets.getObjectByAttribute("active",!0);if(!i||i.id!=e){i&&(i.active=!1,i.wrap.setCss({"z-index":0}));var n=this.getDrawingById(e);n.active=!0,n.wrap.setCss({"z-index":5});var r=this.getRootElement().querySelector(".bf-drawable-context");r&&n.wrap.querySelector(".bf-drawing-container ").appendChild(r),t||this.setDisplayMode(this.getDisplayMode()),this.getEventManager().fireEvent(o.ActiveViewChanged,this),this.snapping&&this.enableSnap(!0)}},getActiveDrawing:function(){return this.sets.getObjectByAttribute("active",!0)},getDrawingById:function(e){return null==e||void 0==e?(console.error("id is necessary!"),!1):this.sets.getObjectByAttribute("id",e)},createSnapshotAsync:function(e,t){var i=void 0,n=document.createElement("canvas"),o=this.getRootElement();n.width=o.clientWidth,n.height=o.clientHeight,e&&(e="rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")");var r=n.getContext("2d");r.beginPath(),r.fillStyle=e||o.style.background,r.fillRect(0,0,n.width,n.height),this.sets.reverse().forEach(function(e){if(e.active)i=e.viewerDrawing.getViewer().snapshotPure();else{var t=e.viewerDrawing.getViewer().snapshotPure();r.drawImage(t,0,0)}}),r.drawImage(i,0,0),t(n.toDataURL())},showLineWidth:function(e){this.sets.forEach(function(t){t.viewerDrawing.showLineWidth(e)})},getBBox:function(e){var t=this.sets.getObjectByAttribute("id",e),i=t.viewerDrawing.getViewer().getModelBBox(),n=i.GetMinPt(),o=i.GetMaxPt();return{min:n.slice(0,2),max:o.slice(0,2)}},zoomToBoundingBox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.getActiveDrawing().viewerDrawing.zoomToBoundingBox(e,t)},home:function(){for(var e=this.sets,t=void 0,i=void 0,n=void 0,r=0;r<e.length;r++){var a=e[r],s=a.id,l=a.active,u=a.viewerDrawing,c=this.getOffsetDistance(s),h=this.getBBox(s);l&&(n=u),t?(t=[Math.min(h.min[0]+c[0],t[0]),Math.min(h.min[1]+c[1],t[1])],i=[Math.max(h.max[0]+c[0],i[0]),Math.max(h.max[1]+c[1],i[1])]):(t=[h.min[0]+c[0],h.min[1]+c[1]],i=[h.max[0]+c[0],h.max[1]+c[1]])}n.getViewer().zoomToWorldBox([t[0],t[1],0],[i[0],i[1],0],1),n.update(),this.activeState=n.getCurrentState(),this.sync(),this.getEventManager().fireEvent(o.Rendered,self)},setDisplayMode:function(e){e=e||0,this.sets.forEach(function(t){"2"==t.viewerDrawing.version&&t.viewerDrawing.getViewer().enableReplaceElementColor(!1),t.active?t.viewerDrawing.setDisplayMode(e):0==e?(t.viewerDrawing.setPrintMode("Custom"),t.viewerDrawing.setGlobalColor(new Glodon$1.Web.Graphics.Color("#7D888A"))):(t.viewerDrawing.setPrintMode("Custom"),t.viewerDrawing.setGlobalColor(new Glodon$1.Web.Graphics.Color("#778BA3")))}),this.getRootElement().setCss({background:0==e?"rgb(50,50,55)":"#fff"}),this._displayMode=e},getDisplayMode:function(){return this._displayMode},getViewMetaData:function(e,t){var i=this,n=Glodon$1.Bimface.Authentication.AuthenticationManager,o=new Glodon$1.Bimface.Authentication.AuthenticationConfig;o.viewToken=e,o.APIHost=this._viewConfig.APIHost,(this.authenticate=new n(o)).authenticate(function(e){e.drawingUrl=i._viewConfig.resourceHost+"/"+e.databagId+"/resource/drawing",t(e)})},getIndexJson:function(e,t){Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:e+"/index.json"+(this.offline&&".gz"||""),success:function(e){var i=JSON.parse(e);i&&t(i)}})},getManifest:function(e){var t=this,i=Glodon$1.Web.Lang.Utility.HttpRequest,n=t._viewConfig.resourceHost+"/"+t._databagId+"/manifest.json";i.ajax({url:""+n,success:function(t){var i=JSON.parse(t);i&&e(i)},failure:function(t){e(t)}})},enableViewport:function(e){this.getActiveDrawing().viewerDrawing.enableViewport(e)}}),e.ViewerDrawingSet=a}();var CLOUD$1=window.CLOUD||{};!function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{name:"defaultMap",domElement:null,width:240,height:240,viewer:null,axis:!1,host:hostConfig.resourceHost,onCameraChanged:null,inMoveOnAxisGrid:null}};e.MiniMapConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest")),i=function(e){var t=this,i=e;if(t._opt=i,!i.domElement)return console.log("domElement must not be empty."),!1;if(!i.viewer)return console.log("viewer is not defined."),!1;var n=i.viewer.getViewer();t._helper=new CLOUD$1.Extensions.MiniMapHelper(i.viewer.getViewer());var o=function(){t._helper.renderMiniMap()};n.addCallbacks("render",o),t.init()};i.prototype={init:function(){var e=this,i=e._opt,n={},o=[];e._helper;t.ajax({url:i.host+"/"+i.viewer._data.databagId+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,r=t.grids.length;o<r;o++){var a=t.grids[o];a.start.X=a.start.x,a.start.Y=a.start.y,a.start.Z=a.start.z,a.end.X=a.end.x,a.end.Y=a.end.y,a.end.Z=a.end.z,i.push(a)}n.Grids=i}}),t.ajax({async:!1,url:i.host+"/"+i.viewer._data.databagId+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),t.ajax({async:!1,url:i.host+"/"+i.viewer._data.databagId+"/resource/model/maps/output.json",dataType:"text",success:function(e){var t=JSON.parse(e);for(var n in t){var r=t[n];void 0==r.id&&(r.id=n),r.path=i.host+"/"+i.viewer._data.databagId+"/resource/model/maps/"+r.id+".png",r.name=n,o.push(r)}}}),e._floors=o,e.createMap(n,o)},createMap:function(e,t){var i,n=this._helper,o=this._opt,r={left:0,bottom:0,outling:"none",position:"relative"};n.createMiniMap(o.name,o.domElement,o.width,o.height,r,o.onCameraChanged,o.inMoveOnAxisGrid),e.Grids&&e.Levels&&n.setAxisGridData(o.name,e),t.length>0&&(n.setAllFloorPlaneData(o.name,t),n.setFloorPlaneId(o.name,t[0].name)),n.generateAxisGrid(o.name),n.generateFloorPlane(o.name,!1),n.showAxisGrid(o.name,o.axis),i=n.getMiniMap(o.name),i.setMapClickCallback(function(){})},getFloors:function(){return this._floors},showAxisGrid:function(){this._helper.showAxisGrid(this._opt.name,!0)},hideAxisGrid:function(){this._helper.showAxisGrid(this._opt.name,!1)},showFloorById:function(e){var t=this,i=t._opt.name;t._helper.setFloorPlaneData(i,e),t._helper.generateFloorPlane(i,!0)},resize:function(e,t){this._helper.resize(this._opt.name,e,t)},onClick:function(e,t){var i=this,n=i._opt,e=e||"default",o=i._helper.getMiniMap(n.name);o.setMapClickMode(e),o.setMapClickCallback(function(e){t&&"function"==typeof t&&t(e)})},toLocation:function(e,t){var i=this,n=i._opt;i._helper.getMiniMap(n.name).toLocation(e,t)},imageCoord2WordCoord:function(e,t){var i=this,n=i._opt;return i._helper.getMiniMap(n.name).imageCoord2WordCoord(_defineProperty({x:e},"x",t))}},e.MiniMap=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Map"),t=function(){return{id:"defaultMap",name:"defaultMap",domElement:null,viewer:null,width:240,height:240,isShowGrid:!1,navigationMode:"Default",resourceHost:hostConfig.resourceHost}};e.MapConfig=t}(),function(){var e=Object.freeze({ViewerCameraChanged:"ViewerCameraChanged",MouseClicked:"MouseClicked",MouseHoveredGrid:"MouseHoveredGrid",SelectionChanged:"SelectionChanged",SelectionMoved:"SelectionMoved",SelectionEditor:"SelectionEditor",FloorPlaneChanged:"FloorPlaneChanged",Zoom:"Zoom"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Map").MapEvents=e}(),function(){var e=Object.freeze({Default:"Default",Static:"Static"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Map").MapNavigationMode=e}(),function(){var e="Bimface.Plugins.Section.SectionPlane",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Map"),n=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=e;if(this.defaultFloorPlane="F01",t._opt=i,t.id=e.id,!i.domElement)return console.log("domElement must not be empty."),!1;if(!i.viewer)return console.log("viewer is not defined."),!1;var n=new Glodon$1.Web.Lang.EventManager;this.getEventManager=function(){return n},this.EventType={RECTPICK_MOUSE_MOVE:1001,RECTPICK_MOUSE_UP:1002,PICK_MOUSE_UP:2002,Floor_Plane_Changed:3e3,Floor_Plane_Changed_For_Panel:3001,Camera_Height_Changed:5e3,ZOOM_MOUSE_WHEEL:6e3,Minimap_Rect_Changed:8e3,Minimap_Rect_Destroyed:8001};var o=i.viewer.getViewer();t.viewerFloor=new ViewerFloor(o,i.domElement),t.viewerFloor.registerCameraHeightChanged(CLOUD$1.EVENTS.ON_CAMERA_HEIGHT_CHANGED),t._helper=this,t.renderCB=function(){t.viewerFloor.renderCameraNode()},o.addCallbacks("render",t.renderCB),t.init()});n.prototype={addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},init:function(){var i=this;t.send(e,"init"),this._opt.viewer.getDefaultModel().getMapInfo(function(e){i._floors=e.floors,i.createMap(e.axisGrid,e.floors)})},createMap:function(i,n){t.send(e,"createMap");var o=this,r=o.getEventManager(),a=Glodon$1.Bimface.Plugins.Map.MapEvents,s=o._opt;if((i.Grids||i.Levels)&&this.viewerFloor.setAxisGridData(i),n.length>0){this.viewerFloor.setPlanes(n);var l=n.getObjectByAttribute("name",this.defaultFloorPlane);0==l?this.showFloorById(n[0].id):this.showFloorById(l.id)}var u=this.EventType;this.viewerFloor.addEventListener(u.PICK_MOUSE_UP,function(e){r.fireEvent(a.MouseClicked,e.data)}),this.viewerFloor.setMapClickMode(s.navigationMode.toLocaleLowerCase()),this.viewerFloor.addEventListener(u.Minimap_Rect_Changed,function(e){r.fireEvent("MinimapRectChanged",e.rectInfo)}),this.viewerFloor.addEventListener(u.Minimap_Rect_Destroyed,function(e){r.fireEvent("MinimapRectDestroyed",e)}),this.viewerFloor.addEventListener(u.Camera_Height_Changed,function(e){o.viewerFloor.enableFloorPlaneChangedEvent(!1),o.showFloorById(e.id),o.viewerFloor.enableFloorPlaneChangedEvent(!0)}),this.viewerFloor.addEventListener(u.Floor_Plane_Changed_For_Panel,function(e){r.fireEvent("FloorPlaneChanged",e.name)}),this.viewerFloor.addEventListener(u.ZOOM_MOUSE_WHEEL,function(e){r.fireEvent(a.Zoom,e.data)}),this.viewerFloor.addEventListener(u.Floor_Plane_Changed,function(e){if(void 0!=e.elevation){"string"==typeof e.elevation&&(e.elevation=parseFloat(e.elevation));var t=s.viewer.getViewer(),i=t.camera,n=e.elevation,o=s.viewer.sceneToWorld(i.position.clone()),r=new THREE.Vector3(o.x,o.y,n+1750),a=s.viewer.worldToScene(r);t.cameraControl.flyToPointWithParallelEye(new THREE.Vector3(a.x,a.y,a.z))}})},setDefaultFloorPlane:function(e){for(var t=this._floors,i=0;i<t.length;i++)if(t[i].name==e){var n=(this.viewerFloor,this.getEventManager());n.fireEvent("FloorPlaneChanged",e);var o=t.getObjectByAttribute("name",e);return helpershowFloorById(o.id),!0}return!1},getFloorList:function(){return this._floors},getDefaultFloorPlane:function(){return this.defaultFloorPlane},getBoundingBox:function(){return this.viewerFloor.getBoundingBoxIsolate()},showFloorById:function(e){this.viewerFloor.setFloorPlaneId(e),this.viewerFloor.destroy(),this.viewerFloor.rebuildData(),this.viewerFloor.render()},resize:function(e,t,i){var n=this._opt.domElement;n.style.width=e+"px",n.style.height=t+"px",this.viewerFloor.resize(e,t,i),this.getEventManager().fireEvent("Resize",{width:e,height:t})},setPlaneChangedCallback:function(e){this.addEventListener("FloorPlaneChanged",function(t){e&&e(t)})},setMinimapResizeCallback:function(e){this.addEventListener("Resize",function(t){e&&e(t)})},setNavigationMode:function(e){var t=this._opt,i=this.viewerFloor;t.navigationMode=e,i.setMapClickMode(t.navigationMode.toLocaleLowerCase())},clear:function(){this.viewerFloor.clearRectPick()},clearZoomAndPan:function(){this.viewerFloor.clearZoomAndPan();var e=this.EventType;this.viewerFloor.getEventManager().dispatchEvent({type:e.ZOOM_MOUSE_WHEEL,data:{offsetX:0,offsetY:0,zoomFactor:1}})},getMapContainer:function(){return this.viewerFloor.getMapContainer()},getFloorPlaneName:function(){return this.viewerFloor.getFloorPlaneName()},getAxisGridBox2D:function(){return this.viewerFloor.getAxisGridBox2D()},exit:function(){var e=this;e._opt.viewer.getViewer().removeCallbacks("render",e.renderCB),e.clear()}},i.Map=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){function e(t,i){_classCallCheck(this,e),this.viewer=t.getViewer(),this.enumEventTypes={ON_COMPONENT_HOVER:1e3,ON_COMPONENT_CLICK:1001},this.initialize();var n=this;this.bimcube=new BimCube(i,BimfaceLanguage.name,function(){n.hookEvents(),n.bimcube.update(n.viewer.getActiveCameraInfo())})}return _createClass(e,[{key:"initialize",value:function(){this.enumViewMode={Home:0,Top:1,Bottom:2,Front:3,Back:4,Right:5,Left:6,SouthEast:7,SouthWest:8,NorthEast:9,NorthWest:10,BottomFront:11,BottomBack:12,BottomRight:13,BottomLeft:14,BottomSouthEast:15,BottomSouthWest:16,BottomNorthEast:17,BottomNorthWest:18,RoofFront:19,RoofBack:20,RoofRight:21,RoofLeft:22,RoofSouthEast:23,RoofSouthWest:24,RoofNorthEast:25,RoofNorthWest:26,TopTurnRight:27,TopTurnBack:28,TopTurnLeft:29,BottomTurnRight:30,BottomTurnBack:31,BottomTurnLeft:32,FrontTurnRight:33,FrontTurnTop:34,FrontTurnLeft:35,RightTurnBack:36,RightTurnTop:37,RightTurnFront:38,BackTurnRight:39,BackTurnTop:40,BackTurnLeft:41,LeftTurnFront:42,LeftTurnTop:43,LeftTurnBack:44}}},{key:"hookEvents",value:function(){var e=this.bimcube,t=this.viewer,i=this.enumViewMode,n=function(){t.render()};e.addEventListener(this.enumEventTypes.ON_COMPONENT_CLICK,function(e){var o=i[e.viewType];o&&t.setStandardView(o,null,n,n)}),t.addRenderCallback(function(){e.update(t.getActiveCameraInfo())})}},{key:"setVisible",value:function(e){!0===e?this.bimcube.show():this.bimcube.hide()}},{key:"getImpl",value:function(){return this.bimcube}},{key:"destroy",value:function(){this.viewer=null,this.enumEventTypes=null,this.enumViewMode=null,this.bimcube.destroy(),this.bimcube=null}}]),e}();e.ViewHouseNavi=t}(),function(){
var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{width:140,height:140,domElement:null,viewer:null}};e.ViewHouseConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Application.UI.Menu"),t=function(e){var t=this,i=e.viewer;this.viewer=i;var n=e.domElement,o=Glodon$1.Bimface.UI.Control.ControlEvent,r=Glodon$1.Bimface.Viewer.Viewer3DEvent,a=i.getDomElement(),s=new Glodon$1.Bimface.UI.Menu.MenuConfig;s.element=n,this.menu=new Glodon$1.Bimface.UI.Menu.Menu(s),this.menu.element.style.backgroundColor="#EBEFF1",this.menu.element.style.border="1px solid #D0D6D6";var l=this.menu,u=new Glodon$1.Bimface.UI.Menu.MenuItemConfig;u.id="home";var c=new Glodon$1.Bimface.UI.Menu.MenuItem(u);c.setText(BimfaceLanguage.bf_viewHouse_home),c.element.addClass("bf-menu-item1"),i.getEventManager().addEvent(r.ToolbarHomeClick,function(){t.switchHomeView()}),c.addEventListener(o.Click,function(){t.switchHomeView(),t.hide()}),this.switchHomeView=function(){var e=i.getCustomHomeview(),t=i.getDefaultHomeview(),n=e||t,o=n.name;"orth"==o&&d.setText(BimfaceLanguage.bf_viewHouse_perspective),"persp"==o&&d.setText(BimfaceLanguage.bf_viewHouse_orthographic),i.setCameraStatus(n,function(){0==i.getCameraAnimation()&&i.render()})};var h=new Glodon$1.Bimface.UI.Menu.MenuItemConfig;h.id="orthographic";var d=new Glodon$1.Bimface.UI.Menu.MenuItem(h);d.setText(BimfaceLanguage.bf_viewHouse_orthographic),d.element.addClass("bf-menu-item1"),d.addEventListener(o.Click,function(){t.hide(),d.element.textContent==BimfaceLanguage.bf_viewHouse_orthographic?(i.setCameraType("OrthographicCamera"),i.render(),d.setText(BimfaceLanguage.bf_viewHouse_perspective)):(i.setCameraType("PerspectiveCamera"),i.render(),d.setText(BimfaceLanguage.bf_viewHouse_orthographic))}),this.orthographic=d;var f=new Glodon$1.Bimface.UI.Menu.MenuItemConfig;f.id="setAsHome";var g=new Glodon$1.Bimface.UI.Menu.MenuItem(f);g.setText(BimfaceLanguage.bf_viewHouse_setAsHome),g.element.addClass("bf-menu-item1"),g.addEventListener(o.Click,function(){t.hide();var e=i.getCameraStatus();i.recordCustomHomeview(e)});var v=new Glodon$1.Bimface.UI.Menu.MenuItemConfig;v.id="resetHome";var m=new Glodon$1.Bimface.UI.Menu.MenuItem(v);m.setText(BimfaceLanguage.bf_viewHouse_resetHome),m.element.addClass("bf-menu-item1"),m.addEventListener(o.Click,function(){t.hide(),i.recordCustomHomeview(null)});var p=new Glodon$1.Bimface.UI.Menu.Spacer;p.element.style.backgroundColor="#D0D6D6";var y=new Glodon$1.Bimface.UI.Menu.Spacer;y.element.style.backgroundColor="#D0D6D6",this.menu.addControl(c),this.menu.addControl(p),this.menu.addControl(d),this.menu.addControl(y),this.menu.addControl(g),this.menu.addControl(m),this.hide=function(){this.menu.element.style.display="none"},this.show=function(){this.menu.element.style.display=""},this.isHide=function(){return"none"==this.menu.element.style.display},this.update=function(){var e=this.viewer.getCameraStatus(),t=e.name;"orth"==t&&this.orthographic.setText(BimfaceLanguage.bf_viewHouse_perspective),"persp"==t&&this.orthographic.setText(BimfaceLanguage.bf_viewHouse_orthographic)},this.destroy=function(){this.viewer=null,this.menu=null,this.orthographic=null},a.addEventListener("mousedown",function(e){l&&t.hide()})};e.ViewHouseMenu=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){var i=e,n=t.create("div","bf-house");n.style.width=i.width+"px",n.style.height=i.height+"px",i.domElement.appendChild(n),this._domElement=n,this._opt=i,this.viewer=i.viewer,this.init()});i.prototype={init:function(){var e=this;this.viewHouseNavi=new Glodon$1.Bimface.Plugins.ViewHouseNavi(this._opt.viewer,this._domElement);var i=t.createNS("svg","bf-home-svg");i.setAttribute("viewBox","0 0 20 20");var n=t.createNS("g","");n.setAttribute("fill","none"),n.setAttribute("fill-rule","evenodd");var o=t.createNS("polygon","");o.setAttribute("fill","#E3E9EC"),o.setAttribute("points","1.207 9.5 3.5 9.5 3.5 16.499 7.501 16.499 7.503 12.5 12.5 12.5 12.5 16.499 16.5 16.499 16.5 9.5 18.793 9.5 10 .707"),i.addEventListener("mouseover",function(){o.setAttribute("fill","#BAFFEC"),r.setAttribute("fill","#32D3A6")}),i.addEventListener("mouseout",function(){o.setAttribute("fill","#E3E9EC"),r.setAttribute("fill","#BCC0C2")}),i.addEventListener("mousedown",function(){e.viewHouseMenu.switchHomeView()});var r=t.createNS("path","");r.setAttribute("fill","#BCC0C2"),r.setAttribute("d","M10,0 L0,10 L3,10 L3,17 L8,17 L8.003,13.001 L12,13.001 L12,17 L17,17 L17,10 L20,10 L10,0 Z M10,1.414 L17.586,9 L17,9 L16,9 L16,10 L16,16 L13,16 L13,13.001 L13,12 L12,12 L8.003,12 L7.004,12 L7.003,12.999 L7.001,16 L4,16 L4,10 L4,9 L3,9 L2.414,9 L10,1.414 Z"),n.appendChild(o),n.appendChild(r),i.appendChild(n),e._domElement.appendChild(i),this.homeSvg=i;var a=t.createNS("svg","bf-menu-svg");a.setAttribute("viewBox","0 0 20 20"),a.style.position="absolute";var s=t.createNS("g","");s.setAttribute("fill","none"),s.setAttribute("fill-rule","evenodd"),s.setAttribute("transform","translate(3 6)");var l=t.createNS("polygon","");l.setAttribute("fill","#E3E9EC"),l.setAttribute("points","1.207 4.5 6.999 10.292 12.793 4.5");var u=t.createNS("path","");u.setAttribute("fill","#BCC0C2"),u.setAttribute("d","M0.0004,3.9998 L6.9994,10.9998 L13.9994,3.9998 L0.0004,3.9998 Z M2.4144,4.9998 L11.5864,4.9998 L6.9994,9.5858 L2.4144,4.9998 Z");var c=t.createNS("polygon","");c.setAttribute("fill","#E3E9EC"),c.setAttribute("points",".5 2.5 13.5 2.5 13.5 .5 .5 .5");var h=t.createNS("path","");h.setAttribute("fill","#BCC0C2"),h.setAttribute("d","M0,3 L14,3 L14,0 L0,0 L0,3 Z M1,2 L13,2 L13,1 L1,1 L1,2 Z"),a.addEventListener("mouseover",function(){l.setAttribute("fill","#BAFFEC"),u.setAttribute("fill","#32D3A6"),c.setAttribute("fill","#BAFFEC"),h.setAttribute("fill","#32D3A6")}),a.addEventListener("mouseout",function(){l.setAttribute("fill","#E3E9EC"),u.setAttribute("fill","#BCC0C2"),c.setAttribute("fill","#E3E9EC"),h.setAttribute("fill","#BCC0C2")}),s.appendChild(l),s.appendChild(u),s.appendChild(c),s.appendChild(h),a.appendChild(s),e._domElement.appendChild(a),this.menuSvg=a;var d=new Glodon$1.Bimface.Application.UI.Menu.ViewHouseMenu(this._opt);this.viewHouseMenu=d,d.hide(),a.addEventListener("click",function(t){var i=e.viewer.getDomElement();i.getBoundingClientRect();d.isHide()?(d.update(),d.show()):d.hide()})},enableViewHouse:function(e){this.viewHouseNavi.setVisible(e),this._domElement.style.display=!0===e?"block":"none"},getDomElement:function(){return this._domElement},destroy:function(){this.viewHouseNavi.destroy(),this.viewHouseNavi=null,this.viewHouseMenu.destroy(),this.viewHouseMenu=null,this._domElement.removeChild(this.menuSvg),this.menuSvg=null,this._domElement.removeChild(this.homeSvg),this.homeSvg=null,this._domElement=null,this.viewer=null,this._opt=null}},e.ViewHouse=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{background:null,domElement:null,viewer:null,style:{"stroke-width":3,"stroke-color":"#ff0000","stroke-opacity":1,"fill-color":"#ff0000","fill-opacity":0,"font-family":"Arial","font-size":16,"font-style":"italic","font-weight":"bold"}}};e.AnnotationConfig=t}(),function(){var e=Object.freeze({Arrow:"Arrow",Rectangle:"Rectangle",Circle:"Circle",Cross:"Cross",Cloud:"Cloud",Text:"Text"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins").AnnotationTypeOption=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){this._opt=e,this.init()});t.prototype={init:function(){var e,t=this,i=t._opt;if(i.viewer)e=new CLOUD$1.Extensions.AnnotationHelper3D(i.viewer.getViewer());else{if(!i.domElement)return alert("domElement must not be empty."),!1;e=new CLOUD$1.Extensions.AnnotationHelper2D,e.setDomContainer(i.domElement)}this._helper=e},begin:function(){var e=this._helper,t=this._opt;e.editAnnotationBegin(t.absBasePoint,t.screenBasePoint,t.zoomFactor)},end:function(){this._helper.editAnnotationEnd()},save:function(){return this._helper.getAnnotationInfoList()},load:function(e){var t=this._helper;this._opt;t.loadAnnotations(e)},createSnapshot:function(e,t){return this._helper.captureAnnotationsScreenSnapshot(e,t)},setType:function(e){var t={arrow:0,rectangle:1,circle:2,cross:3,cloud:4,text:5};this._helper.setAnnotationType(t[e.toLocaleLowerCase()])},setStyle:function(e){this._helper.setAnnotationStyle(e)},destroy:function(){this._helper.destroy()}},e.Annotation=t,e.Annotation.Annotation=e.Annotation,e.Annotation.AnnotationConfig=e.AnnotationConfig}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),t=function(){return{viewer:null,lineWidth:3,lineColor:new Glodon$1.Web.Graphics.Color(208,2,27,1),fillColor:new Glodon$1.Web.Graphics.Color(255,255,255,0),fontFamily:"Arial",fontSize:14,windowAdaption:!1}};e.AnnotationManagerConfig=t}(),function(){var e=Object.freeze({Arrow:"Arrow",Rectangle:"Rectangle",Circle:"Ellips",Ellips:"Ellips",Cross:"Cross",Cloud:"Cloud",CloudRect:"Cloud-rect",Text:"Text",Polyline:"Polyline"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation").AnnotationTypeOption=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){});t.prototype={init:function(){var e,t=this,i=t._opt;e=new CLOUD$1.Extensions.AnnotationHelper3D(i.viewer.getViewer(),i),this._helper=e},startDrawing:function(){var e=this._helper;this._opt;e.editAnnotationBegin(),this.isShowAnnotation=!0},getAnnotationList:function(){return this._helper.getAnnotationInfoList()},setAnnotationList:function(e){if(!e||0==e.length)return void this.clear();this._annotationList=e,this._helper.loadAnnotations(e),this.isShowAnnotation=!0},createSnapshot:function(e){var t=this;t._opt.viewer;t._helper.captureAnnotationsScreenSnapshot("",e)},setState:function(e){var t=this,i=t._opt.viewer;i.setState(e.state),i.render(),setTimeout(function(){t.setAnnotationList(e.annotationList)},1e3)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationViewer3dManager=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){var t=Glodon$1.Bimface.Viewer.Viewer2DEvent,i=e.viewer,n=this;i.addEventListener(t.ViewMoving,function(e){n.updateSvg()}),i.addEventListener(t.ViewZooming,function(e){n.updateSvg()})});t.prototype={init:function(){var e,t=this,i=t._opt;e=new CLOUD$1.Extensions.AnnotationHelper2D(i),e.setDomContainer(i.viewer.getDomElement()),this._helper=e},startDrawing:function(){var e=this._helper,t=this._opt;e.editAnnotationBegin();t.viewer.getZoomScale();e.editor.svg.addEventListener("mousewheel",function(e){e.preventDefault(),e.stopPropagation()}),this.isShowAnnotation=!0},getAnnotationList:function(){var e=this,t=this._helper.getAnnotationInfoList();if(t&&t.length>0)for(var i=e._opt.viewer,n=i.getZoomScale(),o=0,r=t.length;o<r;o++)t[o].worldPosition=e.getWorldPosition(t[o]),t[o].defaultSize={width:t[o].size.width/n,height:t[o].size.height/n};return t},setAnnotationList:function(e){if(!e||0==e.length)return void this.clear();for(var t=this._opt.viewer.getZoomScale(),i=0,n=e.length;i<n;i++)e[i].position=this.getSVGPosition(e[i],t),e[i].size.width=e[i].defaultSize.width*t,e[i].size.height=e[i].defaultSize.height*t;this._annotationList=e,this._helper.loadAnnotations(e),this.isShowAnnotation=!0},createSnapshot:function(e){var t=this;t._opt.viewer.createSnapshotAsync("",function(i){t._helper.captureAnnotationsScreenSnapshot(i,e)})},setState:function(e){var t=this;t._opt.viewer.setState(e.state),t.setAnnotationList(e.annotationList)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationViewer2dManager=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){this._viewer=e,this.drawingViewer=e.getViewer()});t.prototype={init:function(){var e,t=this,i=t._opt;e=this.drawingViewer.mouseEditorMgr,this.type="arrow",this.setLineWidth(i.lineWidth),this.setLineColor(i.lineColor),this.setFillColor(i.fillColor),this.setFontFamily(i.fontFamily),this.setFontSize(i.fontSize),this._helper=e},startDrawing:function(){var e,t=this._helper;this._opt;t.activeEditorByName("markup"),e=t.getEditor(),e.setMarkupType(this.type),this.annotationToolbar&&(this.setLineColor({red:208,green:2,blue:27,alpha:1}),this.setLineWidth(2)),this.editor=e,this.isShowAnnotation=!0},endDrawing:function(){this.drawingViewer.markupManager.setFillColor("transparent"),this.clear(),this._helper.activeEditorByName("pick"),this.drawingViewer.update(),this.isShowAnnotation=!1},getAnnotationList:function(){return this.drawingViewer.markupManager.markups},setAnnotationList:function(e){this.drawingViewer.markupManager.markups=e,this.drawingViewer.update()},clear:function(){this.drawingViewer.markupManager.clear(),this.drawingViewer.update()},createSnapshot:function(e){var t=this._viewer.getRootElement();e(this.drawingViewer.snapshot(t.style.background))},resize:function(){this._viewer.resize()},setAnnotationType:function(e){var t={arrow:"arrow",rectangle:"rectangle","cloud-rect":"cloud-rect",circle:"ellips",cross:"cross",cloud:"cloud",text:"text"};this.type=t[e.toLocaleLowerCase()],this.editor&&this.editor.setMarkupType(this.type)},setLineWidth:function(e){this.drawingViewer.markupManager.setLineWidth(e)},setLineColor:function(e){this.drawingViewer.markupManager.setColor("rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")")},setFillColor:function(e){this.drawingViewer.markupManager.setFillColor("rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")")},setFontFamily:function(e){this.drawingViewer.markupManager.setFontFamily(e)},setFontSize:function(e){this.drawingViewer.markupManager.setFontSize(e)},getCurrentState:function(){var e=this,t=e._opt.viewer,i=this.getAnnotationList();return{annotationList:this.stringifyAnnotationList(i),state:t.getCurrentState()}},stringifyAnnotationList:function(e){return this.drawingViewer.markupManager.toString(e)},jsonifyAnnotationList:function(e){return this.drawingViewer.markupManager.fromString(e)},setState:function(e){var t=this,i=t._opt.viewer;if("string"==typeof e.annotationList){var n=this.jsonifyAnnotationList(e.annotationList);this.setAnnotationList(n)}else this.setAnnotationList(e.annotationList);i.setState(e.state)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getWorldPosition:function(e){var t=this._opt.viewer,i={x:t.screenWidth/2,y:t.screenHeight/2},n={x:i.x+e.position.x,y:i.y-e.position.y};return t.clientToWorld(n)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationDrawingManager=t}(),function(){var e="Bimface.Plugins.Annotation.AnnotationManager",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),n=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=e.viewer;this._opt=e,this.isShowAnnotation=!1,this.historyQueue=[],Glodon$1.Bimface.Viewer.Viewer3D&&i instanceof Glodon$1.Bimface.Viewer.Viewer3D?this._helper=new MarkupViewer3D(i,i._opt.domElement):Glodon$1.Bimface.Viewer.Viewer2D&&i instanceof Glodon$1.Bimface.Viewer.Viewer2D?(this.isViewer2D=!0,this._helper=new MarkupViewer2D(i,i._opt.domElement.querySelector(".bf-image"))):this._helper=new MarkupDrawing(i,i._opt.domElement),this._helper.viewer.onSelectChange=function(e){t.onSelectChange(e)},this.init()});n.prototype={init:function(){var e=this,t=e._opt;t.lineWidth&&this.setLineWidth(t.lineWidth),t.lineColor&&this.setLineColor(t.lineColor),t.fillColor&&this.setFillColor(t.fillColor),t.fontFamily&&this.setFontFamily(t.fontFamily),t.fontSize&&this.setFontSize(t.fontSize)},exit:function(){this.endDrawing()},onSelectChange:function(e){},onClick:function(e){this._helper.viewer.onClick=e},getAnnotationList:function(){return this._helper.getAnnotationList()},setAnnotationList:function(e){e.length>0&&e[0].id&&(e=this._helper.transform(e)),this._helper.setAnnotationList(e),this._helper.update()},setState:function(e){this._helper.setState(e)},createSnapshot:function(e){this._helper.createSnapshot(e)},startDrawing:function(){this._helper.startDrawing();var e=document.querySelector(".bf-toolbar-select");e&&(e.style.display="none")},endDrawing:function(){t.send(e,"endDrawing"),this._helper.editAnnotationEnd(),this.isShowAnnotation=!1;var i=document.querySelector(".bf-toolbar-select");i&&(i.style.display="block")},clear:function(){t.send(e,"clear"),this._helper.clearAnnotations()},resize:function(){},setAnnotationType:function(i){t.send(e,"setAnnotationType"),this._helper.setAnnotationType(i.toLocaleLowerCase())},setLineWidth:function(i){t.send(e,"setLineWidth"),this._helper.setAnnotationStyle({"stroke-width":i})},setLineColor:function(i){t.send(e,"setLineColor"),this._helper.setAnnotationStyle({"stroke-color":""+i.getRGBA()})},setFillColor:function(i){t.send(e,"setFillColor"),this._helper.setAnnotationStyle({"fill-color":""+i.getRGBA()})},setFontFamily:function(i){t.send(e,"setFontFamily"),this._helper.setAnnotationStyle({"font-family":i})},setFontSize:function(i){t.send(e,"setFontSize"),this._helper.setAnnotationStyle({"font-size":i})},removeSelectedAnnotation:function(){this._helper.removeSelectedAnnotation()},showAnnotation:function(){this._helper.showAnnotation()},hideAnnotation:function(){this._helper.hideAnnotation()},setStyle:function(e){this._helper.setAnnotationStyle(e)},destroy:function(){this.endDrawing()},getCurrentState:function(){if(this.isViewer2D)var e=this._helper.getCurrentState();else{var t=this._opt.viewer.getViewer();this._opt.windowAdaption&&t.setCameraStateWithFrustum&&t.setCameraStateWithFrustum(!0);var e=this._helper.getCurrentState();t.setCameraStateWithFrustum&&t.setCameraStateWithFrustum(!1)}return e},getWorldPosition:function(e){var t=this._opt.viewer,i={x:t.screenWidth/2,y:t.screenHeight/2},n={x:i.x+e.position.x,y:i.y-e.position.y};return t.clientToWorld(n)},inherit:function(e){for(var t in e)this[t]=e[t]},stringifyAnnotationList:function(e){return this._helper.markupManager.toString(e)},jsonifyAnnotationList:function(e){return this._helper.markupManager.fromString(e)}},i.AnnotationManager=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),t=function(){};e.AnnotationToolbarConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),t=Object.freeze({Saved:"Saved",Cancelled:"Cancelled"});e.AnnotationToolbarEvent=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Annotation"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),Glodon$1.Bimface.Plugins.Annotation.AnnotationToolbarEvent),n=function(e){var n=this._eventManager=new Glodon$1.Web.Lang.EventManager,o=[],r=e.viewer,a=Glodon$1.Bimface.Viewer.ViewerDrawing&&r instanceof Glodon$1.Bimface.Viewer.ViewerDrawing;this.isDrawing=a;var s=t.create("div","bf-annotation bf-hide");this.domElement=s;var l=Glodon$1.Bimface.Plugins.Annotation.AnnotationTypeOption,u=new Glodon$1.Bimface.Plugins.Annotation.AnnotationManagerConfig,c=u.lineColor;u.viewer=r,u.windowAdaption=e.windowAdaption,u.annotationCallback=e.annotationCallback;var h=new Glodon$1.Bimface.UI.Toolbar.ToolbarConfig;h.element=s,h.className="bf-toolbar bf-toolbar-annotation";var d=this.annotationToolbar=new Glodon$1.Bimface.UI.Toolbar.Toolbar(h);this.annotationToolbar=d,o.push(d),a&&(u.annotationToolbar=d);var f=this._annotationManager=new Glodon$1.Bimface.Plugins.Annotation.AnnotationManager(u);r.getDomElement().appendChild(s),s.addEventListener("mousedown",function(e){e.stopPropagation()}),s.addEventListener("touchstart",function(e){e.stopPropagation()}),s.addEventListener("touchmove",function(e){e.stopPropagation()});var g=new Glodon$1.Bimface.UI.Toolbar.ToolbarConfig;g.element=s,g.className="bf-toolbar bf-toolbar-control";var v=new Glodon$1.Bimface.UI.Toolbar.Toolbar(g);o.push(v);var m=new Glodon$1.Bimface.UI.Button.ButtonConfig;m.className="bf-button gld-bf-narrow ",m.title="箭头",a&&(m.id="arrow"),m.groupName="Annotation";var p=new Glodon$1.Bimface.UI.Button.SingleButton(m);p.addEventListener("Click",function(){f.setAnnotationType(l.Arrow),X.show(),te.hide()}),d.addControl(p);var y=new Glodon$1.Bimface.UI.Button.ButtonConfig;y.className="bf-button gld-bf-n-cloud",y.title="云线框",y.groupName="Annotation";var w=new Glodon$1.Bimface.UI.Button.SingleButton(y);w.addEventListener("Click",function(){f.setAnnotationType(l.CloudRect),X.show(),te.hide()}),d.addControl(w);var b=new Glodon$1.Bimface.UI.Button.ButtonConfig;b.className="bf-button gld-bf-ncloud",b.title="云线",b.groupName="Annotation";var C=new Glodon$1.Bimface.UI.Button.SingleButton(b);C.addEventListener("Click",function(){f.setAnnotationType(l.Cloud),X.show(),te.hide()}),d.addControl(C);var x=new Glodon$1.Bimface.UI.Button.ButtonConfig;x.className="bf-button gld-bf-n-ployline",x.title="折线",x.groupName="Annotation";var E=new Glodon$1.Bimface.UI.Button.SingleButton(x);E.addEventListener("Click",function(){f.setAnnotationType(l.Polyline),X.show(),te.hide()}),d.addControl(E);var k=new Glodon$1.Bimface.UI.Button.ButtonConfig;k.className="bf-button gld-bf-nrectangle",k.title="矩形",k.groupName="Annotation";var P=new Glodon$1.Bimface.UI.Button.SingleButton(k);P.addEventListener("Click",function(){f.setAnnotationType(l.Rectangle),X.show(),te.hide()}),d.addControl(P);var _=new Glodon$1.Bimface.UI.Button.ButtonConfig;_.className="bf-button gld-bf-noval",_.title="椭圆",_.groupName="Annotation";var M=new Glodon$1.Bimface.UI.Button.SingleButton(_);M.addEventListener("Click",function(){f.setAnnotationType(l.Ellips),X.show(),te.hide()}),d.addControl(M);var I=new Glodon$1.Bimface.UI.Button.ButtonConfig;I.className="bf-button gld-bf-mark",I.title="X",I.groupName="Annotation";var S=new Glodon$1.Bimface.UI.Button.SingleButton(I);S.addEventListener("Click",function(){f.setAnnotationType(l.Cross),X.show(),te.hide()}),d.addControl(S);var B=new Glodon$1.Bimface.UI.Button.ButtonConfig;B.className="bf-button gld-bf-ntext",B.title="文字",B.groupName="Annotation";var D=new Glodon$1.Bimface.UI.Button.SingleButton(B);D.addEventListener("Click",function(){f.setAnnotationType(l.Text),X.hide(),te.show()}),d.addControl(D);var T=new Glodon$1.Bimface.UI.Button.ButtonConfig;T.className="bf-combobox bf-color",T.title="颜色",a&&(T.id="color");var A=new Glodon$1.Bimface.UI.Button.ComboBox(T),L=new Glodon$1.Bimface.UI.Button.ButtonConfig;L.className="bf-button bf-color",L.title="红",a&&(L.id="red");var O=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(L);O.color=new Glodon$1.Web.Graphics.Color(208,2,27,1);var G=t.create("div","bf-color-button");G.setCss({backgroundColor:"#"+O.color.getHEX()}),O.setHtml(G.outerHTML),A.addControl(O);var R=new Glodon$1.Bimface.UI.Button.ButtonConfig;R.className="bf-button bf-color",R.title="黄";var V=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(R);V.color=new Glodon$1.Web.Graphics.Color(245,166,35,1);var N=t.create("div","bf-color-button");N.setCss({backgroundColor:"#"+V.color.getHEX()}),V.setHtml(N.outerHTML),A.addControl(V);var U=new Glodon$1.Bimface.UI.Button.ButtonConfig;U.className="bf-button bf-color",U.title="蓝";var H=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(U);H.color=new Glodon$1.Web.Graphics.Color(74,144,226,1);var W=t.create("div","bf-color-button");W.setCss({backgroundColor:"#"+H.color.getHEX()}),H.setHtml(W.outerHTML),A.addControl(H);var $=new Glodon$1.Bimface.UI.Button.ButtonConfig;$.className="bf-button bf-color",$.title="绿";var z=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton($);z.color=new Glodon$1.Web.Graphics.Color(126,211,33,1);var j=t.create("div","bf-color-button");j.setCss({backgroundColor:"#"+z.color.getHEX()}),z.setHtml(j.outerHTML),A.addControl(z),d.addControl(A);var F=new Glodon$1.Bimface.UI.Button.ButtonConfig;F.className="bf-combobox",F.title="粗细",a&&(F.id="line");var X=new Glodon$1.Bimface.UI.Button.ComboBox(F),F=new Glodon$1.Bimface.UI.Button.ButtonConfig;F.className="bf-button bf-line",F.title="细",a&&(F.id="fine");var Y=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(F);Y.lineWidth=3;var Z=t.create("div","bf-line-button");Z.setCss({height:Y.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-Y.lineWidth)/2+"px 4px"}),Y.element.appendChild(Z),X.addControl(Y),F.title="中";var q=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(F);q.lineWidth=6;var J=t.create("div","bf-line-button");J.setCss({height:q.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-q.lineWidth)/2+"px 4px"}),q.element.appendChild(J),X.addControl(q),F.title="粗";var K=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(F);K.lineWidth=10;var Q=t.create("div","bf-line-button");Q.setCss({height:K.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-K.lineWidth)/2+"px 4px"}),K.element.appendChild(Q),X.addControl(K),A.addEventListener("Change",function(e){f.setLineColor(e.color),c=e.color;c.getHEX();Z.setCss({height:Y.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-Y.lineWidth)/2+"px 4px"}),J.setCss({height:q.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-q.lineWidth)/2+"px 4px"}),Q.setCss({height:K.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-K.lineWidth)/2+"px 4px"});var t=X.getCurrentControl();X.setSelectedControlById(t.getId())}),X.addEventListener("Change",function(e){f.setLineWidth(e.lineWidth)}),d.addControl(X);var ee=new Glodon$1.Bimface.UI.Button.ButtonConfig;ee.className="bf-combobox bf-font-button",ee.title="字号";var te=new Glodon$1.Bimface.UI.Button.ComboBox(ee),ie=new Glodon$1.Bimface.UI.Button.ButtonConfig;ie.className="bf-button bf-size",ie.title="14";var ne=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(ie);ne.fontSize=14,ne.setHtml("14"),te.addControl(ne),ie.title="18";var oe=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(ie);oe.fontSize=18,oe.setHtml("18"),te.addControl(oe),ie.title="24";var re=new Glodon$1.Bimface.UI.Button.ComboBoxOptionButton(ie);re.fontSize=24,re.setHtml("24"),te.addControl(re),te.addEventListener("Change",function(e){f.setFontSize(e.fontSize)}),te.hide(),d.addControl(te);var ae=new Glodon$1.Bimface.UI.Button.ButtonConfig;ae.className="bf-save",ae.title=BimfaceLanguage.bf_general_save;var se=new Glodon$1.Bimface.UI.Button.SingleButton(ae);se.setHtml(BimfaceLanguage.bf_general_save),se.addEventListener("Click",function(){a?n.fireEvent(i.Saved,{annotationList:f.getAnnotationList()}):n.fireEvent(i.Saved,{annotationList:f.getAnnotationList(),state:f.getCurrentState()}),f.endDrawing(),s.addClass("bf-hide")}),v.addControl(se);var le=new Glodon$1.Bimface.UI.Button.ButtonConfig;le.className="bf-cancel",le.title=BimfaceLanguage.bf_general_cancel;var ue=new Glodon$1.Bimface.UI.Button.SingleButton(le);ue.setHtml(BimfaceLanguage.bf_general_cancel),ue.addEventListener("Click",function(){f.endDrawing(),n.fireEvent(i.Cancelled),s.addClass("bf-hide")}),v.addControl(ue),this.getEventManager=function(){return n}};n.prototype={getEventManager:function(){return this._eventManager},addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},show:function(e,t){this.isDrawing||this._annotationManager.clear(),this._annotationManager.startDrawing(),this.domElement.removeClass("bf-hide")},getAnnotationManager:function(){return this._annotationManager},exit:function(){this.annotationToolbar.hide(),this.getAnnotationManager().exit()}},e.AnnotationToolbar=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{viewer:null}};e.TagConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=this._viewer=e.viewer.getViewer();if(this._opt=e,this._renderCallback=function(){t.resize()},e.minimap){this.mapHelper=e.minimap;var n=new CLOUD$1.View2dAdapter(this.mapHelper,i);this.mapHelper.setMinimapResizeCallback(function(e){t._tagHelper.updateGroupName(),t._tagHelper.updateDomContainer(),t._tagHelper.resize(e),t._tagHelper.updateByGroup()}),this.mapHelper.setPlaneChangedCallback(function(){t._tagHelper.updateGroupName(),t._tagHelper.updateByGroup()})}else{var n=new CLOUD$1.View3dAdapter(i);i.addCallbacks("render",this._renderCallback)}this._tagHelper=new CLOUD$1.Extensions.MarkerEditor(n),this._tagHelper.disableInteractions(!0),this.init()});t.prototype={init:function(){this._tagHelper.isInitialized()||this._tagHelper.init()},addTag:function(e,t){if(!e)return!1;var i=!1,n=this.getTags();e.userId=e.objectId,e.worldBoundingBox=e.boundingBox,e.worldPosition||(e.worldPosition={x:(e.worldBoundingBox.min.x+e.worldBoundingBox.max.x)/2,y:(e.worldBoundingBox.min.y+e.worldBoundingBox.max.y)/2,z:(e.worldBoundingBox.min.z+e.worldBoundingBox.max.z)/2});for(var o=0,r=n.length;o<r;o++){if(n[o].userId==e.userId)return i=!0,!1}e.floorList?this._tagHelper.setMarkerGroups(e.floorList):this._tagHelper.setMarkerGroups([]),this._tagHelper.updateGroupName(),i||this._tagHelper.createMarkerByIntersect(e,t.shape,t.image,t.size)},deleteTag:function(e,t){var i=this
;if(t)return this._tagHelper.removeMarkerInGroup(e,t),!1;for(var n=this.getTags(),o=0,r=n.length;o<r;o++){var a=n[o];if(a.userId==e)return i._tagHelper.deleteMarker(a),!1}},destroy:function(){this._viewer.removeCallbacks("render",this._renderCallback),this._tagHelper.markerClickCallback=null,this.unLoadTags(),this._tagHelper.clearMarkers(),this._tagHelper=null},loadTags:function(e){this._tagHelper.loadMarkers(e)},unLoadTags:function(){this._tagHelper.unloadMarkers()},getTags:function(){return this._tagHelper.getMarkerInfoList()},getTagById:function(e){return this._tagHelper.getMarker(e)},zoomToSelectedTag:function(){this._tagHelper.zoomToSelectedMarkers()},resize:function(){this._tagHelper.onResize()},onSelected:function(e){this._tagHelper.setMarkerClickCallback(e)}},e.Tag=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=function(){return{viewer:null,maxNum:20,affectedBySection:!0}};e.DrawableContainerConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=function(){return{id:null,objectId:null,modelId:null,tooltip:"",tooltipStyle:{},draggable:!1,worldPosition:new Glodon$1.Web.Geometry.Point3d(0,0,0),angle:0,layerId:void 0}};e.DrawableItemConfig=t}(),function(){var e="Bimface.Plugins.Drawable.DrawableItem",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),n=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Common.MouseButton,function(e){this.id=e.id||Glodon$1.Web.Lang.Utility.UUID.createUUID(),this.layerId=e.layerId,this.modelId=e.modelId,this.objectId=e.objectId,e.worldPosition?this.worldPosition=e.worldPosition:console.log("worldPosition must not be empty."),void 0!=e.viewerDrawingId&&(this.viewerDrawingId=e.viewerDrawingId),this.config=e,this.angle=e.angle,this.explosionOffset=new Vector3$1,this.explosionExtent=0});n.prototype={draw:function(e){},onClick:function(i){t.send(e,"onClick"),this._onclick=i},onRightClick:function(i){t.send(e,"onRightClick"),this._onrightclick=i},onEndDrag:function(i){t.send(e,"onEndDrag"),this._onenddrag=i},setTooltip:function(i){t.send(e,"setTooltip"),this.tipElement.querySelector("span").innerText=i},setTooltipStyle:function(i){t.send(e,"setTooltipStyle");for(var n in i)this.tipElement.style[n]=i[n]},getTooltip:function(){return this.tipElement.querySelector("span").innerText},getTooltipStyle:function(){return this.tipElement.style},getWorldPosition:function(){return this.worldPosition},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.worldPosition=i},getSize:function(){return{width:this.config.width,height:this.config.height}},hide:function(){t.send(e,"hide"),this._domElement.style.display="none",this.forceHide=!0},show:function(){t.send(e,"show"),this._domElement.style.display="",this.forceHide=!1},updateVisibility:function(){this.isHideByClustering||this.forceHide?this._domElement.style.display="none":this._domElement.style.display="block"},attachExplosionOffset:function(e,t){if(this.worldPosition){var i=this._config.objectId;if(i){var n={};n[i]=!0;var o=e.modelManager.getBoundingBoxByIds(n),r=this.assoiatedComponentBbox,a=o;if(r){var s=a.getCenter().clone();s.sub(r.getCenter().clone()),this.explosionOffset=s,this.explosionExtent>0&&0===t&&(this.worldPosition.x+=s.x,this.worldPosition.y+=s.y,this.worldPosition.z+=s.z,this.explosionExtent=0,this.explosionOffset=new Vector3$1,this.assoiatedComponentBbox=a.clone())}}else{var l=e.getScene().getOriginalBoundingBoxWorld().getCenter(),u=(new Box3).expandByPoint(this.worldPosition),c=CLOUD.Utils.computeExplodeTranslation(l,u,t);this.explosionOffset=c}}},setInitialExplosionInfo:function(e){if("Viewer3D"===e.getViewerType()||"ViewerGIS"===e.getViewerType()){var t=null;"Viewer3D"===e.getViewerType()?t=this.modelId?e.getModel(this.modelId):e.getDefaultModel():"ViewerGIS"===e.getViewerType()&&(t=e.getLayerManager().getLayer(this.layerId)),this.explosionExtent=null===t?t.getExplosionExtent():0;var i=this._config.objectId;if(i){var n=e.getViewer(),o={};o[i]=!0;var r=n.modelManager.getBoundingBoxByIds(o);r.isEmpty()?(this._config.objectId=null,console.log("Cannot find component with Id "+i)):this.assoiatedComponentBbox=r.clone()}}},clearExplosionOffset:function(){this.explosionOffset=new Vector3$1},getCurrentPosition:function(){return{x:this.worldPosition.x+this.explosionOffset.x,y:this.worldPosition.y+this.explosionOffset.y,z:this.worldPosition.z+this.explosionOffset.z}},getId:function(){return this.id}},i.DrawableItem=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=function(){this.rootDomElement=t.create("div","bf-drawable-context"),this.clientPosition=null};i.prototype.destroy=function(){this.rootDomElement.parentNode&&this.rootDomElement.parentNode.removeChild(this.rootDomElement)},e.DrawableContext=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=new Glodon$1.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:32,height:32,viewer:null,opacity:.75,src:null,offsetX:0,offsetY:0,modelId:void 0,objectId:void 0,layerId:void 0};return Object.assign({},t,e)};e.ImageConfig=i}(),function(){var e="Bimface.Plugins.Drawable.Image",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),n=Glodon$1.Bimface.Plugins.Drawable.DrawableItem,o=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),r=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),a=function(e){n.call(this,e);var t=this;this.viewer=e.viewer,this._isDragging=!1,this._isViewerGIS=Glodon$1.Bimface.Viewer.ViewerGIS&&this.viewer instanceof Glodon$1.Bimface.Viewer.ViewerGIS;var i=o.create("img","bf-drawable-image");i.draggable=!1,i.src=e.src,i.style.width=e.width+"px",i.style.height=e.height+"px",i.style.opacity=""+e.opacity,i.style.transform="rotate("+e.angle+"deg)",this._config=e,this._domElement=i,this.clientPosition={};var r,a=function(e){t._isDragging=!1;var i,n=t.viewer,o="Viewer3D"===n.getViewerType(),a={x:e.x-r.x+t.clientPosition.x,y:e.y-r.y+t.clientPosition.y};if(o){var s=n.pickByPoint(a);if(!s||!s.objectId)return void t.update();if(s.objectId){t._config.objectId=s.objectId;var l=n.getViewer().getComponentInfoByUserId(s.objectId);t.levelName=l&&l.userData&&l.userData.levelName,t.setInitialExplosionInfo(n),t.clearExplosionOffset(),t.needForceUpdate=!0}i=s.worldPosition}else if(t._isViewerGIS){var u=n.getDomElement().getBoundingClientRect(),c=n.getViewer().pickByPoint({x:a.x+u.left,y:a.y+u.top});if(!c||!c.meshId)return void t.update();c.meshId&&(t._config.objectId=c.meshId),t.worldPosition=c.worldPosition}else i=n.clientToWorld(a);i?(t.worldPosition=i,t.update(),t._onenddrag&&t._onenddrag(t)):t.update()},s=function(e){r=e},l=function(){t._isDragging=!0};e.draggable&&o.drag({element:i,cursor:"pointer",end:a,start:s,move:l}),i.addEventListener("mouseup",function(e){var i=e||window.event;"0"==i.button&&t._onclick&&(!t._isDragging||r.x==i.clientX&&r.y==i.clientY)&&t._onclick(t)}),i.addEventListener("mousedown",function(e){var i=e||window.event;i.stopPropagation(),"2"==i.button&&t._onrightclick?t._onrightclick(t):"1"==i.button&&t._onmiddleclick&&t._onmiddleclick(t)}),i.addEventListener("dblclick",function(e){var e=e||event;e.stopPropagation()})};r.Type.inheritPrototype(a,n);var s={draw:function(e){if(!this._isDragging){var t=this._domElement,i=this._config;this.clientPosition=e.clientPosition,t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",e.rootDomElement.appendChild(t)}},getWidth:function(){return this._config.width},setWidth:function(i){t.send(e,"setWidth");var n=this._config.width,o=this._domElement,r=(n-i)/2,a=parseInt(o.style.left);this._config.width=i,o.style.width=i+"px",o.style.left=a+r+"px"},getHeight:function(){return this._config.height},setHeight:function(i){t.send(e,"setHeight");var n=this._config.height,o=this._domElement,r=(n-i)/2,a=parseInt(o.style.top);this._config.height=i,o.style.height=i+"px",o.style.top=a+r+"px"},getOpacity:function(){return this._config.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._config.opacity=i,this._domElement.style.opacity=i},getSrc:function(){return this._config.src},setSrc:function(i){t.send(e,"setSrc"),this._config.src=i,this._domElement.src=i},getOffsetX:function(){return this._config.offsetX},setOffsetX:function(i){t.send(e,"setOffsetX");var n=this._config.offsetX,o=this._domElement,r=i-n,a=parseInt(o.style.left);this._config.offsetX=i,o.style.left=a+r+"px"},getOffsetY:function(){return this._config.offsetY},setOffsetY:function(i){t.send(e,"setOffsetY");var n=this._config.offsetY,o=this._domElement,r=i-n,a=parseInt(o.style.top);this._config.offsetY=i,o.style.top=a+r+"px"},getAngle:function(){return this.angle},setAngle:function(i){t.send(e,"setAngle"),this.angle=i,this._domElement.style.transform="rotate("+i+"deg)"}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(s,a),i.Image=a}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=new Glodon$1.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:0,height:0,opacity:.75,content:"",offsetX:0,offsetY:0,viewer:null,modelId:void 0,objectId:void 0,layerId:void 0};return Object.assign({},t,e)};e.CustomItemConfig=i}(),function(){var e="Bimface.Plugins.Drawable.CustomItem",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),o=Glodon$1.Bimface.Plugins.Drawable.DrawableItem,r=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),a=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility");n.IE11Store={};var s=function(e){o.call(this,e),this._isDragging=!1;var t=this,i=Glodon$1.Bimface.Viewer.ViewerDrawing&&e.viewer instanceof Glodon$1.Bimface.Viewer.ViewerDrawing,n=r.create("div","bf-drawable-text");n.style.width=e.width+"px",n.style.height=e.height+"px";var a=r.create("div","bf-drawable-contentwrap");n.appendChild(a),this._domElement=n,this.name="customItem",this._contentElement=a,this._config=e;var s;this.clientPosition={},this.setContent(e.content);var l=r.create("div","bf-tooltip");l.style.display="none",l.innerHTML='<div class="bf-tooltip-content"><div class="bf-tooltip-arrow"></div><div class="bf-tooltip-inner"><span>'+e.tooltip+"</span></div></div>",l.style.left=e.width+"px",l.style.top="-"+e.height+"px";var u=e.tipCSS;for(var c in u)l.style[c]=u[c];this.tipElement=l,n.appendChild(l);var h=function(e){t._isDragging=!1;var n,o=t.viewer,r=Glodon$1.Bimface.Viewer.Viewer3D&&o instanceof Glodon$1.Bimface.Viewer.Viewer3D,a=Glodon$1.Bimface.Viewer.ViewerGIS&&o instanceof Glodon$1.Bimface.Viewer.ViewerGIS,l={x:e.x-s.x+t.clientPosition.x,y:e.y-s.y+t.clientPosition.y};if(r){var u=o.getDomElement().getBoundingClientRect(),c=o.pickByPoint({x:l.x+u.left,y:l.y+u.top});if(!c||!c.objectId)return void t.update();if(c.objectId){t._config.objectId=c.objectId;var h=o.getViewer().getComponentInfoByUserId(c.objectId);t.levelName=h&&h.userData&&h.userData.levelName,t.setInitialExplosionInfo(o),t.clearExplosionOffset(),t.needForceUpdate=!0}n=c.worldPosition}else if(a){var d=o.getDomElement().getBoundingClientRect(),f=o.getViewer().pickByPoint({x:l.x+d.left,y:l.y+d.top});if(!f||!f.meshId)return void t.update();f.meshId&&(t._config.objectId=f.meshId),n=f.worldPosition}else if(i){var g=o.getViewer().toWorldPoint([l.x,l.y]);n={x:g[0],y:g[1]}}else n=o.clientToWorld(l);n?(t.worldPosition=n,t.update(),t._onenddrag&&t._onenddrag(t)):t.update()},d=function(e){s=e},f=function(){t._isDragging=!0};e.draggable&&r.drag({element:n,cursor:"pointer",end:h,start:d,move:f}),n.style.width=e.width+"px",n.style.height=e.height+"px",n.style.opacity=""+e.opacity,n.addEventListener("mouseover",function(e){t.tipElement&&t.tipElement.querySelector("span").innerText.length>0&&(t.tipElement.style.display="block")}),n.addEventListener("mouseout",function(e){t.tipElement&&(t.tipElement.style.display="none")}),n.addEventListener("keydown",function(e){e.stopPropagation()}),n.addEventListener("mouseup",function(e){var i=e||window.event;"0"==i.button&&t._onclick&&(!t._isDragging||s.x==i.clientX&&s.y==i.clientY)&&t._onclick(t)}),n.addEventListener("mousedown",function(e){var i=e||window.event;i.stopPropagation(),"2"==i.button&&t._onrightclick?t._onrightclick(t):"1"==i.button&&t._onmiddleclick&&t._onmiddleclick(t)}),n.addEventListener("dblclick",function(e){var e=e||event;e.stopPropagation()}),n.addEventListener("touchstart",function(e){(e||window.event).stopPropagation()}),n.addEventListener("touchmove",function(e){(e||window.event).stopPropagation()}),n.addEventListener("touchend",function(e){var i=e||window.event;i.stopPropagation(),t._onclick&&s.x==i.changedTouches[0].clientX&&s.y==i.changedTouches[0].clientY&&t._onclick(t)})};a.Type.inheritPrototype(s,o);var l={draw:function(e){if(!this._isDragging){var t=this._domElement,i=this._config;this.clientPosition=e.clientPosition,t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",""==t.innerHTML&&(this.dom&&this.domId?t.appendChild(n.IE11Store[this.domId].cloneNode(!0)):this.text&&(t.innerText=this.text)),e.rootDomElement.contains?e.rootDomElement.contains(t)||e.rootDomElement.appendChild(t):e.rootDomElement.appendChild(t)}},getWidth:function(){return this._config.width},setWidth:function(i){t.send(e,"setWidth");var n=this._config.width,o=this._domElement,r=(n-i)/2,a=parseInt(o.style.left);this._config.width=i,o.style.width=i+"px",o.style.left=a+r+"px"},getHeight:function(){return this._config.height},setHeight:function(i){t.send(e,"setHeight");var n=this._config.height,o=this._domElement,r=(n-i)/2,a=parseInt(o.style.top);this._config.height=i,o.style.height=i+"px",o.style.top=a+r+"px"},getOpacity:function(){return this._config.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._config.opacity=i,this._domElement.style.opacity=i},getContent:function(){return this._config.content||this.text},setContent:function(i){t.send(e,"setContent"),this._contentElement.innerHTML="",i instanceof HTMLElement?(i.draggable=!1,this._config.content=i,this._domElement.content=i,this.dom=i,this.domId||(this.domId=Glodon$1.Web.Lang.Utility.UUID.createUUID()),n.IE11Store[this.domId]=i.cloneNode(!0),this._contentElement.appendChild(i)):(this._contentElement.innerHTML=i,this.text=i,this._config.content="")},getOffsetX:function(){return this._config.offsetX},setOffsetX:function(i){t.send(e,"setOffsetX");var n=this._config.offsetX,o=this._domElement,r=i-n,a=parseInt(o.style.left);this._config.offsetX=i,o.style.left=a+r+"px"},getOffsetY:function(){return this._config.offsetY},setOffsetY:function(i){t.send(e,"setOffsetY");var n=this._config.offsetY,o=this._domElement,r=i-n,a=parseInt(o.style.top);this._config.offsetY=i,o.style.top=a+r+"px"}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(l,s),i.CustomItem=s}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=new Glodon$1.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e,i={text:null,viewer:null,containerCss:(e={boxSizing:"border-box",fontSize:"12px",lineHeight:1.5,borderWidth:"2px",borderStyle:"solid",padding:"5px",borderColor:"#1f93ff",backgroundColor:"#eeeeee"},_defineProperty(e,"padding","2px 8px"),_defineProperty(e,"opacity",.9),e),lineCss:{width:"1px",color:"#1f93ff"},pointCss:{radius:4,backgroundColor:"#1f93ff",borderColor:"#ffffff",borderStyle:"solid",borderWidth:"1px"},offset:{x:27,y:-47},height:26,width:140,modelId:void 0,objectId:void 0,layerId:void 0};return Object.assign({},t,i)};e.LeadLabelConfig=i}(),function(){var e="Bimface.Plugins.Drawable.LeadLabel",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),n=Glodon$1.Bimface.Plugins.Drawable.DrawableItem,o=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),r=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),a=function(e){n.call(this,e);var t=this,i=o.create("div","bf-drawable-lead-label"),r=o.create("div","bf-drawable-lead-label-textarea");i.appendChild(r);var a=o.createNS("line","bf-drawable-lead-line"),s=o.createNS("line","bf-drawable-lead-line"),l=o.createNS("circle","bf-drawable-lead-point"),u=o.createNS("g","bf-drawable-group"),c=e.viewer;this._isViewerGIS=Glodon$1.Bimface.Viewer.ViewerGIS&&c instanceof Glodon$1.Bimface.Viewer.ViewerGIS,t._text=e.text,this.name="LeadLabel",this.isAssociateComponentHide=!1,i.setCss(e.containerCss),r.innerText=t._text.replace(/\n/g," "),i.style.width=parseFloat(e.width)+"px",i.style.height=parseFloat(e.height)+"px";var h=Math.trunc((e.height-8)/18);r.style.webkitLineClamp=h||1,s.setAttribute("stroke-width",e.lineCss.width),s.style.stroke=e.lineCss.color,a.setAttribute("stroke-width",e.lineCss.width),a.style.stroke=e.lineCss.color,l.setAttribute("r",e.pointCss.radius),l.style.fill=e.pointCss.backgroundColor,l.setAttribute("stroke-width",e.pointCss.borderWidth),l.style.stroke=e.pointCss.borderColor,s.setAttribute("x1",0),s.setAttribute("y1",0-e.offset.y+18),s.setAttribute("x2",e.offset.x),s.setAttribute("y2",18),a.setAttribute("x1",e.offset.x),a.setAttribute("y1",18),a.setAttribute("x2",e.offset.x+23),a.setAttribute("y2",18),l.setAttribute("cx",0),l.setAttribute("cy",18-e.offset.y);var d;this._isDragging=!1;var f=function(e){d=e},g=function(i){t._isDragging=!0;var n={x:i.x-d.x+t.clientPosition.x,y:i.y-d.y+t.clientPosition.y};u.setAttribute("transform","translate("+n.x+","+(n.y+e.offset.y-18)+")")},v=function(e){t._isDragging=!1;var i=c instanceof Glodon$1.Bimface.Viewer.Viewer3D,n=c.getDomElement().getBoundingClientRect(),o={x:e.x-d.x+t.clientPosition.x+n.left,y:e.y-d.y+t.clientPosition.y+n.top};if(i){var r=c.pickByPoint(o);if(r){if(t.setWorldPosition(r.worldPosition),t.bindComponentById(r.objectId,r.modelId),r.objectId){t._config.objectId=r.objectId,t._config.modelId=r.modelId;var a=c.getViewer().getComponentInfoByUserId(r.objectId,r.modelId);t.levelName=a&&a.userData&&a.userData.levelName,t.needForceUpdate=!0}t.setInitialExplosionInfo(c),t.clearExplosionOffset()}c.render()}else if(t._isViewerGIS){var s=c.getDomElement().getBoundingClientRect(),l=c.getViewer().pickByPoint({x:o.x+s.left,y:o.y+s.top});if(!l||!l.meshId)return void t.update();l.meshId&&(t._config.objectId=l.meshId),t.worldPosition=l.worldPosition}else{var u=c.clientToWorld(o);u&&t.setWorldPosition(u),c.update()}t._dragEnd&&t._dragEnd()};e.draggable&&o.drag({element:i,cursor:"pointer",start:f,move:g,end:v}),i.addEventListener("mousedown",function(e){var e=e||event;e.stopPropagation()}),i.addEventListener("click",function(e){var e=e||event;e.stopPropagation(),t._click&&t._click(t)}),i.addEventListener("contextmenu",function(e){t._rightClick&&t._rightClick(t)}),i.addEventListener("dblclick",function(e){var e=e||event;e.stopPropagation(),t._doubleClick&&t._doubleClick(t)}),i.addEventListener("mouseenter",function(e){r.innerText=t._text;var n=i.offsetHeight;i.addClass("bf-drawable-show"),r.addClass("bf-drawable-show"),n>i.offsetHeight&&(i.removeClass("bf-drawable-show"),r.removeClass("bf-drawable-show"))}),i.addEventListener("mouseleave",function(e){r.innerText=t._text.replace(/\n/g," "),i.removeClass("bf-drawable-show"),r.removeClass("bf-drawable-show")}),u.appendChild(s),u.appendChild(a),u.appendChild(l),t._objectId=e.objectId,t._modelId=e.modelId,t._container=i,t._domTextArea=r,t._svgGroup=u,t._config=e,t._offset=e.offset};r.Type.inheritPrototype(a,n),a.prototype=Object.assign({},n.prototype,{draw:function(e,t){if(!this._isDragging){var i=this._container,n=this._svgGroup,r=this._offset,a=this._config.viewer,s=this._objectId,l=this._modelId;if(a&&s&&!this._isViewerGIS){var u=a.getModel(l).getComponentStatus(s);if("hidden"==u||"translucent"==u)return this.hide(),void(this.isAssociateComponentHide=!0);this.isAssociateComponentHide&&(this.show(),this.isAssociateComponentHide=!1)}this.clientPosition=e.clientPosition,i.style.left=e.clientPosition.x+r.x+23+"px",i.style.top=e.clientPosition.y+r.y-18+"px",n.setAttribute("transform","translate("+e.clientPosition.x+","+(e.clientPosition.y+r.y-18)+")"),e.domContainer||(e.domContainer=o.create("div","bf-drawable-container"),e.rootDomElement.appendChild(e.domContainer)),e.svgContainer||(e.svgContainer=o.createNS("svg","bf-drawable-svg"),e.rootDomElement.appendChild(e.svgContainer)),this.isShow("default"==t),e.rootDomElement.contains?e.domContainer.contains(i)||(e.domContainer.appendChild(i),e.svgContainer.appendChild(n)):(e.domContainer.appendChild(i),e.svgContainer.appendChild(n))}},setDisplayMode:function(e){this.show(),this.displayMode=e,this.isShow()},hide:function(){t.send(e,"hide"),this.forceHide=!0,this._container.style.display="none",this._svgGroup.style.display="none"},show:function(){t.send(e,"show"),this.forceHide=!1,this._container.style.display="",this._svgGroup.style.display=""},onClick:function(i){t.send(e,"onClick"),i&&(this._click=i)},onRightClick:function(i){t.send(e,"onRightClick"),i&&(this._rightClick=i)},onDoubleClick:function(e){e&&(this._doubleClick=e)},onEndDrag:function(i){t.send(e,"onEndDrag"),i&&(this._dragEnd=i)},getText:function(){return this._text},setText:function(i){t.send(e,"setText"),this._domTextArea.innerText=i,this._text=i},getOpacity:function(){return this._container.style.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._container.style.opacity=i},getHeight:function(){return parseFloat(this._container.style.height)},setHeight:function(i){t.send(e,"setHeight"),this._container.style.height=parseFloat(i)+"px";var n=Math.trunc((i-8)/18);this._domTextArea.style.webkitLineClamp=n||1},getWidth:function(){return parseFloat(this._container.style.width)},setWidth:function(i){t.send(e,"setWidth"),this._container.style.width=parseFloat(i)+"px"},getObjectId:function(){return this._objectId},associateComponentById:function(e,t){console.log("[BIMFACE WARN]: LeadLabel.associateComponentById() is obsolete, please use LeadLabel.bindComponentById() instead."),this.bindComponentById(e,t)},bindComponentById:function(e,t){var i=this._config.viewer.getViewer().getComponentInfoByUserId(e);if(!i)return void console.warn("invalid component id");this.levelName=i.userData&&i.userData.levelName,this._objectId=e,this._config.objectId=e,this._modelId=t},clearAssociation:function(){console.log("LeadLabel.clearAssociation() is obsolete, please use LeadLabel.unbind() instead."),this.unbind()},unbind:function(){this._objectId=null,this._modelId=null},isShow:function(e){var t=this._container,i=this._svgGroup;void 0!=this.displayMode&&(e=1!==this.displayMode),e?(t.removeClass("bf-drawable-mini"),i.removeClass("bf-drawable-mini-svg")):(t.addClass("bf-drawable-mini"),i.addClass("bf-drawable-mini-svg"))}}),i.LeadLabel=a}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=new Glodon$1.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={minimap:null,floorList:[],height:20,width:20,objectId:"",src:"",worldPosition:null,viewer:null};return Object.assign({},t,e)};e.MiniTagConfig=i}(),function(){var e="Bimface.Plugins.Drawable.MiniTag",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),n=Glodon$1.Bimface.Plugins.Drawable.DrawableItem,o=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility")),r=function e(t){n.call(this,t);var i=this,o=this._viewer=t.viewer.getViewer();if(this.miniTagConfig=t,this._config=t,i.worldPosition=t.worldPosition.clone(),this._renderCallback=function(){i.resize()},t.minimap){this.mapHelper=t.minimap;var r=new Glodon$1.Bimface.Marker.View2dAdapter(this.mapHelper,o);this.mapHelper.setMinimapResizeCallback(function(t){r.resize(t),e._tagHelper.updateGroupName(),e._tagHelper.updateDomContainer(),e._tagHelper.resize(t),e._tagHelper.updateByGroup()}),this.mapHelper.setPlaneChangedCallback(function(){e._tagHelper.updateGroupName(),e._tagHelper.updateByGroup()});var s={Floor_Plane_Changed_For_Panel:3001,ZOOM_MOUSE_WHEEL:6e3,PAN_MOUSE_MOVE:7e3};this.mapHelper.viewerFloor.addEventListener(s.ZOOM_MOUSE_WHEEL,function(e){var t=e.data;i.zoomAndPan(t.offsetX,t.offsetY,t.zoomFactor)}),this.mapHelper.viewerFloor.addEventListener(s.PAN_MOUSE_MOVE,function(e){var t=e.data;i.zoomAndPan(t.offsetX,t.offsetY,t.zoomFactor)}),this.mapHelper.viewerFloor.addEventListener(s.Floor_Plane_Changed_For_Panel,function(e){var t=i.mapHelper.viewerFloor,n=t.getPanOffset();i.zoomAndPan(n.x,n.y,t.vfData.zoomFactor)})}else{var r=new Glodon$1.Bimface.Marker.View3dAdapter(o);o.addCallbacks("render",this._renderCallback)}void 0==e._tagHelper&&(e._tagHelper=new MarkerEditor(r),e._tagHelper.disableInteractions(!0)),a()},a=function(){r._tagHelper.isInitialized()||r._tagHelper.init()},s=function(e,t){if(!e)return!1;var i=!1,n=r._tagHelper.getMarkerInfoList();e.userId=e.objectId;for(var o=0,a=n.length;o<a;o++){if(n[o].id==e.id)return i=!0,!1}e.floorList?r._tagHelper.setMarkerGroups(e.floorList):r._tagHelper.setMarkerGroups([]),r._tagHelper.updateGroupName(),i||r._tagHelper.createMarkerByIntersect(e,t.shape,t.image,t.size)},l=function(e){for(var t=r._tagHelper.getMarkerInfoList(),i=0,n=t.length;i<n;i++){var o=t[i];o.id==e&&r._tagHelper.deleteMarker(o)}};r.clear=function(){r._tagHelper&&r._tagHelper.clearMarkers()},o.Type.inheritPrototype(r,n),r.prototype=Object.assign({},n.prototype,{draw:function(){var e=this,t=this.miniTagConfig,i={id:this.id,objectId:t.objectId,worldPosition:t.worldPosition,floorList:t.floorList},n={shape:2,image:t.src,size:{width:t.width,height:t.height}};s(i,n);var o=e.mapHelper.viewerFloor,r=o.getPanOffset();e.zoomAndPan(r.x,r.y,o.vfData.zoomFactor)},show:function(){t.send(e,"show"),r._tagHelper.setVisible(this.id,!0)},hide:function(){t.send(e,"hide"),r._tagHelper.setVisible(this.id,!1)},getFloorList:function(){return this.miniTagConfig.floorList},setFloorList:function(i){t.send(e,"setFloorList"),this.miniTagConfig.floorList=i,l(this.id),this.draw()},getHeight:function(){return this.miniTagConfig.height},setHeight:function(i){t.send(e,"setHeight"),this.miniTagConfig.height=i,l(this.id),this.draw()},getId:function(){return this.id},getObjectId:function(){return this.miniTagConfig.objectId},setObjectId:function(i){t.send(e,"setObjectId");var n=this.miniTagConfig;l(this.id),n.objectId=i,this.draw()},getSrc:function(){return this.miniTagConfig.src},setSrc:function(i){t.send(e,"setSrc"),this.miniTagConfig.src=i,l(this.id),this.draw()},getWidth:function(){return this.miniTagConfig.width},setWidth:function(i){t.send(e,"setWidth"),this.miniTagConfig.width=i,l(this.id),this.draw()},getWorldPosition:function(){return this.miniTagConfig.worldPosition},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.miniTagConfig.worldPosition=i,l(this.id),this.draw()},onClick:function(i){t.send(e,"onClick"),r._tagHelper.setMarkerClickCallback(i)},onRightClick:function(i){t.send(e,"onRightClick"),r._tagHelper.setMarkerRightClickCallback(i)},onEndDrag:function(i){t.send(e,"onEndDrag")},zoomAndPan:function(e,t,i){r._tagHelper.zoomAndPanMarkerById(this.id,e,t,i)}}),i.MiniTag=r}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=new Glodon$1.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:52,height:57,content:"",src:null,offsetX:0,offsetY:0};return Object.assign({},t,e)};e.ClusterTagConfig=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),t=Glodon$1.Bimface.Plugins.Drawable.DrawableItem,i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),o=function(e){t.call(this,e),this.includedTags=[],this.clusterBbox=null,this.attachFilter=e.attachFilter;var n=i.create("div","bf-drawable-cluster");n.style.position="absolute",n.style.width=e.width+"px",n.style.height=e.height+"px",n.innerHTML=this.getClusterTagHtml();var o=i.create("div","bf-drawable-cluster-textarea");o.innerText=e.content,n.appendChild(o),this.clusterStyle=Glodon$1.Bimface.Plugins.Cluster.ClusterStyle.Success,this.forceHide=!1,this._config=e,this._domTextArea=o,this._container=n,this.hookEvents()};n.Type.inheritPrototype(o,t);var r={hookEvents:function(){var e=this._container,t=this;this.isMouseDown=!1,e.addEventListener("mouseup",function(e){t.isMouseDown=!1}),e.addEventListener("mousemove",function(e){t.isMouseDown||t.onHoverCallback&&t.onHoverCallback({id:t.id,position:t.worldPosition,includedTags:t.getIncluded(),boundingBox:t.clusterBbox})}),e.addEventListener("mousedown",function(e){(e||window.event).stopPropagation(),t.isMouseDown=!0,t.onClickCallback&&t.onClickCallback({id:t.id,position:t.worldPosition,includedTags:t.getIncluded(),boundingBox:t.clusterBbox})})},draw:function(e){var t=this._container,i=this._config;t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",e.rootDomElement.appendChild(t)},getClusterTagHtml:function(){var e='<defs><filter x="-23.9%" y="-21.4%" width="147.7%" height="142.9%" filterUnits="objectBoundingBox" id="filter-clustertag"><feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset><feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur> <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix> <feMerge><feMergeNode in="shadowMatrixOuter1"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter> </defs>';this.attachFilter||(e="");var t='<svg width="52px" height="57px" version="1.1" transform="translate(0,0)">'+e;return t+='<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="编组" filter="#filter-clustertag" transform="translate(4.000000, 3.000000)"> <path id="'+this.id+'" d="M43.7259252,22.0045824 C43.7259252,9.85175882 33.9373645,0.000288235294 21.8628598,0.000288235294 C9.78835514,0.000288235294 0.000205607477,9.85175882 0.000205607477,22.0045824 C0.000205607477,29.7679941 3.99803738,36.5872294 10.0313832,40.5039353 L10.0202804,40.5039353 L21.8628598,48.6045824 L33.7058505,40.5039353 L33.6947477,40.5039353 C39.7276822,36.5872294 43.7259252,29.7679941 43.7259252,22.0045824" id="Fill-1" fill="#32D3A6"></path><circle fill="#FFFFFF" cx="22" cy="22" r="16"></circle></g></g></svg>'},getText:function(){return this._domTextArea.innerText},setText:function(e){this._domTextArea.innerText=e},updateText:function(){var e=this.getIncluded().length;e<=99?this.setText(e.toString()):this.setText("99+")},show:function(){this._container.style.display="block",this.forceHide=!1},hide:function(){this._container.style.display="none",this.forceHide=!0},onClick:function(e){this.onClickCallback=e},onHover:function(e){this.onHoverCallback=e},include:function(e){this.includedTags.push(e)},isInclude:function(e){var t=!0,i=!1,n=void 0;try{
for(var o,r=this.includedTags[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){if(o.value.getId()===e)return!0}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!1},setBoundingBox:function(e){this.clusterBbox=e},getIncluded:function(){return this.includedTags},getContainer:function(){return this._container},hideIncludedTags:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.includedTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.isHideByClustering=!0}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}},showIncludedTags:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.includedTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.isHideByClustering=!1}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}},getCurrentPosition:function(){return{x:this.worldPosition.x,y:this.worldPosition.y,z:this.worldPosition.z}},setStyle:function(e){this.clusterStyle=e,document.getElementById(this.getId()).style.fill=e,this._domTextArea.style.color=e},getStyle:function(){return this.clusterStyle}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(r,o),e.ClusterTag=o}(),function(){var e="Bimface.Plugins.Drawable.DrawableContainer",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Drawable"),n=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Bimface.Plugins.Drawable.ClusterTag),o=function(){function i(e){var t=this;_classCallCheck(this,i);var n=this,o=e.viewer;if(o.drawableContainer)return o.drawableContainer;o.drawableContainer=this;var r=Glodon$1.Bimface.Viewer.ViewerDrawing&&o instanceof Glodon$1.Bimface.Viewer.ViewerDrawing,a=Glodon$1.Bimface.Viewer.Viewer3D&&o instanceof Glodon$1.Bimface.Viewer.Viewer3D,s=Glodon$1.Bimface.Viewer.ViewerDrawingSet&&o instanceof Glodon$1.Bimface.Viewer.ViewerDrawingSet,l=Glodon$1.Bimface.Viewer.ViewerGIS&&o instanceof Glodon$1.Bimface.Viewer.ViewerGIS,u=new Glodon$1.Web.Lang.EventManager,c=new Glodon$1.Bimface.Plugins.Drawable.DrawableContext;this.bIsEnableMinitagUpdate=!0,this.boxMap={},o.addEventListener("Rendered",function(e){n.bIsEnableMinitagUpdate=!1,n.update(e),n.bIsEnableMinitagUpdate=!0});var h=function(){var e=o.getViewer();e.registerEventListener(CLOUD.EVENTS.ON_EXPLOSION,function(i){for(var n=t.getAllItems(),o=0,r=n.length;o<r;o++)n[o]instanceof Glodon$1.Bimface.Plugins.Drawable.MiniTag||n[o].attachExplosionOffset(e,i.extent)})};if(r){o.getRootElement().appendChild(c.rootDomElement)}else if(s){var d=o.getActiveDrawing();d.viewerDrawing.getRootElement().appendChild(c.rootDomElement)}else l?(o.getDomElement().appendChild(c.rootDomElement),this.calculateViewerGISExplosionOffset=function(e){var i=o.getViewer(),r=e.modelId,a=e.floorInfos.length,s=i.getFloorExplosionExtent(r),l=i.getFloorExplosionDirection(r);if(0===s){var u=!0,c=!1,h=void 0;try{for(var d,f=n.getAllItems()[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){d.value.setInitialExplosionInfo(o)}}catch(e){c=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw h}}}for(var g=e.floorInfos,v=[],m=0;m<a;m++){var p=g[m],y=g[m+1],w=g[m-1];if(v.push({box:{min:w?p.boundingBox.min.z:-1/0,max:y?y.boundingBox.min.z:1/0},floorName:p.name,explodedOffset:p.explodedHeight-p.elevation}),v.length==a){t.boxMap[r]=v;break}}for(var b=o.getLayerManager(),C=t._items,x=0,E=C.length;x<E;x++){if(C[x].getWorldPosition()){var k=b.getLayer(C[x].layerId);if(k&&k.modelId&&k.modelId.toString()===r&&C[x].levelName){var P=v.getObjectByAttribute("floorName",C[x].levelName);P&&(C[x].explosionOffset={x:l.x*P.explodedOffset,y:l.y*P.explodedOffset,z:l.z*P.explodedOffset})}}}},o.addEventListener(Glodon$1.Bimface.Viewer.ViewerGISEvent.FloorExplosion,function(e){t.calculateViewerGISExplosionOffset(e)}),h()):(o.getDomElement().appendChild(c.rootDomElement),e.affectedBySection&&(o.addEventListener(Glodon$1.Bimface.Plugins.Section.SectionBoxEvent.SectionBoxUpdate,function(e){n.section=e,n.update()}),o.addEventListener(Glodon$1.Bimface.Plugins.Section.SectionPlaneEvent.SectionPlaneUpdate,function(e){n.section=e,n.update()})),this.calculateViewer3dExplosionOffset=function(e){var t=e.modelId,i=e.floorInfos.length,r=o.getDefaultModel().modelId.toString(),a=o.getModel(t).getFloorExplosionExtent(),s=o.getModel(t).getFloorExplosionDirection();if(0===a){var l=!0,u=!1,c=void 0;try{for(var h,d=n.getAllItems()[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){h.value.setInitialExplosionInfo(o)}}catch(e){u=!0,c=e}finally{try{!l&&d.return&&d.return()}finally{if(u)throw c}}}var f=[];n.floorInfos=e;if(i)for(var g=0;g<i;g++){var v=e.floorInfos[g],m=e.floorInfos[g+1],p=e.floorInfos[g-1];f.push({box:{min:p?v.boundingBox.min.z:-1/0,max:m?m.boundingBox.min.z:1/0},floorName:v.name,explodedOffset:v.explodedHeight-v.elevation}),f.length==i&&(!function(){for(var e=n._items,i=0,o=e.length;i<o;i++){var a=e[i].getWorldPosition();if(a)if(!0!==e[i]._isBindRoom)if(e[i].levelName){var l=f.getObjectByAttribute("floorName",e[i].levelName);l&&(e[i].explosionOffset={x:s.x*l.explodedOffset,y:s.y*l.explodedOffset,z:s.z*l.explodedOffset})}else if(t!==r)e[i].explosionOffset={x:e[i].explosionOffset.x,y:e[i].explosionOffset.y,z:e[i].explosionOffset.z};else{for(var u=!0,c=0;c<f.length;c++){var h=f[c];if(h.box.min<a.z&&h.box.max>a.z){e[i].explosionOffset={x:s.x*h.explodedOffset,y:s.y*h.explodedOffset,z:s.z*h.explodedOffset},e[i].levelName=h.floorName,u=!1;break}}u&&(e[i].explosionOffset={x:0,y:0,z:0})}else{var d=n._viewer.getViewer().modelManager.modelCollection.getById("ExtrudeBodyManager").getNode(e[i]._config.objectId),g=d.explodedHeight,v=d.explodedDirection;e[i].explosionOffset={x:v.x*g,y:v.y*g,z:v.z*g}}}}(),n.boxs=f)}},o.addEventListener(Glodon$1.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(e){t.calculateViewer3dExplosionOffset(e)}),h());n._items=[],n._viewer=o,n._context=c,n._isDrawingView=r,n._isDrawingViewSet=s,n._isViewer3D=a,n._isViewerGIS=l,n._areaData={},n.loadAreas=void 0,n.addItemCallback=[],n._maxNum=e.maxNum,n.getEventManager=function(){return u}}return _createClass(i,[{key:"addItem",value:function(i){t.send(e,"addItem");var n=this._items,o=this._viewer;if(i.viewer=o,i.update=this.update.bind(this),i.worldPosition){if(i instanceof Glodon$1.Bimface.Plugins.Drawable.MiniTag)n.push(i),this.update();else{var r=this.ifExploded(i);r&&("Viewer3D"===this._viewer.getViewerType()&&r.setInitialExplosionInfo(this._viewer),n.push(r),this.update())}}}},{key:"getLevelNameById",value:function(e,t){var i=this;if(!this._spatialRelation){var n=new Glodon$1.Bimface.Plugins.SpatialRelation.RoomConfig;n.viewer=this._viewer;var o=new Glodon$1.Bimface.Plugins.SpatialRelation.Room(n);this._spatialRelation=o}var r=this._spatialRelation.getBoundaryByRoomId(e);if(r){if(this._levelsInfo)return levelName=function(e,t){for(var i=e[0][2],n=0;n<t.length;n++)if(Math.abs(i-t[n].elevation)<5)return t[n].name;return!1}(r,this._levelsInfo),levelName;(this._isViewer3D?this._viewer.getDefaultModel():this._viewer).getMapInfo(function(e){i._levelsInfo=e.axisGrid.Levels,i.addItem(t)})}}},{key:"ifExploded",value:function(e){var t=this;if(this.floorInfos&&!this._levelsInfo){for(var i=this.floorInfos.floorInfos,n=[],o=0;o<i.length;o++){var r=i[o];n.push({name:r.name,elevation:r.elevation})}this._levelsInfo=n}var a=function(){if(t.floorInfos){var i=e.worldPosition;if(e.levelName){var n=t.boxs.getObjectByAttribute("floorName",e.levelName),o=e.viewer.getModel(t.floorInfos.modelId).getFloorExplosionDirection();if(n){var r={x:i.x-n.explodedOffset*o.x,y:i.y-n.explodedOffset*o.y,z:i.z-n.explodedOffset*o.y};e.explosionOffset={x:n.explodedOffset*o.x,y:n.explodedOffset*o.y,z:n.explodedOffset*o.z},e.worldPosition=r}}else for(var a=t.boxs,s=0;s<a.length;s++){var l=a[s],u=l.box.max+l.explodedOffset,c=l.box.min+l.explodedOffset;if(i.z<c){e.explosionOffset={x:0,y:0,z:i.z-l.box.min},e.worldPosition=Object.assign({},i,{z:l.box.min});break}if(i.z<u&&i.z>c){e.explosionOffset={x:0,y:0,z:l.explodedOffset},e.worldPosition=Object.assign({},i,{z:i.z-l.explodedOffset}),e.levelName=l.floorName;break}}}return e};if(e._config.objectId){var s=this._viewer.getViewer().getComponentInfoByUserId(e._config.objectId);if(s)return e.levelName=s.userData&&s.userData.levelName,a();if(t._isViewerGIS)return e;return t._viewer.getViewer().modelManager.modelCollection.getById("ExtrudeBodyManager").getNode(e._config.objectId)&&(e._isBindRoom=!0),e}return a()}},{key:"removeItemById",value:function(i){t.send(e,"removeItemById");var n=this._items,o=n.removeObjectByAttribute("id",i);o=o&&o[0];var r=o._domElement||o._container;o&&this._context.rootDomElement.contains(r)&&r.remove(),o._svgGroup&&this._context.svgContainer.contains(o._svgGroup)&&this._context.svgContainer.removeChild(o._svgGroup),this.update()}},{key:"getItemById",value:function(e){return this._items.getObjectByAttribute("id",e)}},{key:"getAllItems",value:function(){return this._items}},{key:"addItems",value:function(i){if(t.send(e,"addItems"),i.length)for(var n=0;n<i.length;n++)i[n].update=this.update.bind(this),i[n].viewer=this._viewer;if("Viewer3D"===this._viewer.getViewerType()||this._isViewerGIS){var o=!0,r=!1,a=void 0;try{for(var s,l=i[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value,c=this.ifExploded(u);c&&this._items.push(c),u.setInitialExplosionInfo(this._viewer)}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}}else{var h=!0,d=!1,f=void 0;try{for(var g,v=i[Symbol.iterator]();!(h=(g=v.next()).done);h=!0){var m=g.value;this._items.push(m)}}catch(e){d=!0,f=e}finally{try{!h&&v.return&&v.return()}finally{if(d)throw f}}}this.update()}},{key:"clear",value:function(){t.send(e,"clear"),this._items=[],this._context.rootDomElement.innerHTML="",this._context.domContainer=null,this._context.svgContainer=null,this.update()}},{key:"update",value:function(){var e=this._items,t=this._viewer,i=this._context,n=this._maxNum,o=document.body.getBoundingClientRect(),r=Glodon$1.Bimface.Plugins.Drawable.MiniTag;if(this.bIsEnableMinitagUpdate&&r.clear(),this._isDrawingView&&(t=t.getViewer()),this._isDrawingView)for(var a=0,s=e.length;a<s;a++){var l=e[a].getWorldPosition();if(l)if(e[a]instanceof Glodon$1.Bimface.Plugins.Drawable.ClusterTag){var u=t.toScreenPoint([l.x,l.y]);i.clientPosition={x:u[0],y:u[1]},e[a].draw(i)}else{var c=t.toScreenPoint([l.x,l.y]),h=e[a]._domElement.offsetWidth/2,d=e[a]._domElement.offsetHeight/2;if(e[a].isHideByClustering)e[a]._domElement.style.display="none";else{if(c[0]<-h||c[0]>o.width+h||c[1]<-d||c[1]>o.height+d){e[a]._domElement.style.display="none";continue}e[a]._domElement.style.display="block"}i.clientPosition={x:c[0],y:c[1]},e[a].updateVisibility(),e[a].draw(i)}}else if(this._isDrawingViewSet)for(var f=0,g=e.length;f<g;f++){var v=e[f].getWorldPosition(),m=t.getDrawingById(e[f].viewerDrawingId),c=m.viewerDrawing.worldToClient(v);if(i.clientPosition=c,e[f]instanceof Glodon$1.Bimface.Plugins.Drawable.ClusterTag){var p=t.toScreenPoint([v.x,v.y]);i.clientPosition={x:p[0],y:p[1]},e[f].draw(i)}else e[f].updateVisibility(),e[f].draw(i)}else if(this._isViewerGIS){for(var y=0,w=e.length;y<w;y++){var b=e[y],C=b.getCurrentPosition();b.clientPosition=t.worldToClient(C)}e.sort(function(e,t){return e.clientPosition.z>t.clientPosition.z?1:-1});for(var x=0;x<e.length;x++){var E="default";x>=n&&(E="mini"),i.clientPosition=e[x].clientPosition,e[x].draw(i,E)}}else{for(var k=0,P=e.length;k<P;k++){var _=e[k];_.needForceUpdate&&(_=this.ifExploded(_),_.needForceUpdate=!1);var M=_.getCurrentPosition();_.clientPosition=t.worldToClient(M);var I=_._container||_._domElement,S=_._svgGroup;if(_ instanceof Glodon$1.Bimface.Plugins.Drawable.MiniTag||t.isInViewFrustum(M)){if(this.section&&!this.section.isIncluded(M)||_.forceHide||_.isHideByClustering){I&&(I.style.display="none"),S&&(S.style.display="none");continue}I&&(I.style.display=""),S&&(S.style.display="")}else I&&(I.style.display="none"),S&&(S.style.display="none")}e.sort(function(e,t){return e.clientPosition.z>t.clientPosition.z?1:-1});for(var B=0;B<e.length;B++){var E="default";B>=n&&(E="mini"),i.clientPosition=e[B].clientPosition;var D=e[B]instanceof Glodon$1.Bimface.Plugins.Drawable.MiniTag;D&&0==this.bIsEnableMinitagUpdate||e[B].draw(i,E)}}}},{key:"exit",value:function(){t.send(e,"exit"),this.clear(),this._context.destroy()}},{key:"hideItemsById",value:function(i){t.send(e,"hideItemsById");var n=this;if(i&&i.length>0)for(var o=0;o<i.length;o++){var r=n.getItemById(i[o]);r&&r.hide()}}},{key:"hideAllItems",value:function(){t.send(e,"hideAllItems");var i=this,n=i._items;if(n&&n.length>0)for(var o=0;o<n.length;o++)n[o].hide()}},{key:"showItemsById",value:function(i){t.send(e,"showItemsById");var n=this;if(i&&i.length>0)for(var o=0;o<i.length;o++){var r=n.getItemById(i[o]);r&&r.show()}}},{key:"showAllItems",value:function(){t.send(e,"showAllItems");var i=this,n=i._items;if(n&&n.length>0)for(var o=0;o<n.length;o++)n[o].show()}},{key:"removeClusterTags",value:function(e){for(var t=this.getAllItems(),i=t.length-1;i>=0;){var o=t[i];if(o instanceof n&&o.clusterItemId===e){t.splice(i--,1);var r=o.getContainer();this._context.rootDomElement.contains(r)&&r.remove()}else i--}}},{key:"showItemsByLayerId",value:function(i){t.send(e,"showItemsByLayerId");for(var n=this.getAllItems(),o=n.length-1;o>=0;o--){var r=n[o];r.layerId==i&&r.show()}}},{key:"hideItemsByLayerId",value:function(i){t.send(e,"hideItemsByLayerId");for(var n=this.getAllItems(),o=n.length-1;o>=0;o--){var r=n[o];r.layerId==i&&r.hide()}}},{key:"removeItemsByLayerId",value:function(i){t.send(e,"removeItemsByLayerId");for(var n=this.getAllItems(),o=n.length-1;o>=0;){var r=n[o];if(r.layerId==i){var a=r._domElement||r._container;r&&this._context.rootDomElement.contains(a)&&a.remove(),r._svgGroup&&r._svgGroup.parentElement.removeChild(r._svgGroup),n.splice(o--,1)}else o--}}}]),i}();i.DrawableContainer=o}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Cluster"),t=function(){return{viewer:null,enableAnimation:!0}};e.ClusterContainerConfig=t}(),function(){var e="Bimface.Plugins.Cluster",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Cluster")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"ClusterContainer"),this.viewer=n.viewer,this.isViewer3D="Viewer3D"===n.viewer.getViewerType(),this.clusterItems=[],this._lastZoomFactorData=null,this.hookEvents(n.viewer)}return _createClass(i,[{key:"hookEvents",value:function(e){var t=e.getViewerType();"Viewer3D"===t?this.hookViewer3DEvents():"ViewerDrawing"===t?this.hookViewerDrawingEvents():this.hookViewerDrawingSetEvents()}},{key:"hookViewer3DEvents",value:function(){var e=this,t=this.viewer.getViewer(),i=[];i.push(CLOUD.EVENTS.ON_EDITOR_ZOOM),i.push(CLOUD.EVENTS.ON_EDITOR_PANING),i.push(CLOUD.EVENTS.ON_EDITOR_ROTATING),i.push(CLOUD.EVENTS.ON_EDITOR_WALKING),i.push(CLOUD.EVENTS.ON_CAMERA_ANIMATION_UPDATE);var n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;t.registerEventListener(l,function(){e.update()})}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}t.registerEventListener(CLOUD.EVENTS.ON_EXPLOSION,function(){e.update(!0)}),this.viewer.addEventListener(Glodon$1.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(){e.update(!0)})}},{key:"hookViewerDrawingEvents",value:function(){var e=this,t=Glodon$1.Bimface.Viewer.ViewerDrawingEvent;this.viewer.addEventListener(t.ZoomFactorChanged,function(t){var i=!0;i=null===e._lastZoomFactorData||t>=e._lastZoomFactorData,e.update(!1,i),e._lastZoomFactorData=t})}},{key:"hookViewerDrawingSetEvents",value:function(){var e=this,t=Glodon$1.Bimface.Viewer.ViewerDrawingSetEvent;this.viewer.addEventListener(t.ZoomFactorChanged,function(t){var i=!0;i=null===e._lastZoomFactorData||t>=e._lastZoomFactorData,e.update(!1,i),e._lastZoomFactorData=t})}},{key:"addCluster",value:function(e){this.clusterItems.push(e),e.setIsNeedMakingClusterTag(!0)}},{key:"addClusters",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;this.addCluster(a)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"getClusterById",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.clusterItems[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if(a.getId()===e)return a}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"getClusters",value:function(){return this.clusterItems}},{key:"removeClustersById",value:function(e){for(var t=this.clusterItems,i=t.length-1;i>=0;){var n=t[i];e.indexOf(n.id)>=0?(n.clearClusterTags(),t.splice(i--,1)):i--}}},{key:"clear",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.clusterItems[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.clearClusterTags()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.clusterItems=[]}},{key:"update",value:function(e,t){var i=!0,n=!1,o=void 0;try{for(var r,a=this.clusterItems[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;if(this.isViewer3D){if(0===s.calcClusterLevel()){s.clearClusterTags();continue}}(e||s.isNeedClustering())&&(void 0!=t?s.clustering(t):s.clustering()),s.updateClusterTags()}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}}]),i}();i.ClusterContainer=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Cluster"),t=function(){return{tags:[],distance:50,maxLevel:4,style:Glodon$1.Bimface.Plugins.Cluster.ClusterStyle.Success,minClusterSize:2,viewer:null}};e.ClusterItemConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Cluster"),t=Object.freeze({Danger:"#FF001F",Information:"#1A82FC",Success:"#32D3A6",Warning:"#FF9D0B"});e.ClusterStyle=t}();var ClusterItem3DImpl=function(){function e(t){_classCallCheck(this,e),this.viewer3d=t.viewer,this.currentLevel=0,this._maxLevel=t.maxLevel,this._minClusterSize=t.minClusterSize}return _createClass(e,[{key:"prepareTagPositions",value:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i].getCurrentPosition(),o=new Vector3$1(n.x,n.y,n.z);o.index=i,t.push(o)}return t}},{key:"calcSearchRange",value:function(e){return this.currentLevel=this.calcClusterLevel(e),this.getSearchRangeScalar(this.currentLevel,this.getMaxLevel())*this.getLength(e)[1]}},{key:"getSearchRangeScalar",value:function(e,t){return Math.pow(.5,t-e)}},{key:"calcClusterLevel",value:function(e){for(var t=this.getLength(e),i=this.getMaxLevel(),n=20*t[1]/t[2],o=t[0]*n/t[1],r=Math.exp(Math.log(40)/(i-1)),a=-1,s=i;s>=1;s--)if(o>=.5*Math.pow(r,s-1)){a=s;break}return-1===a&&(a=0),a}},{key:"getLength",value:function(e){var t=this.prepareTagPositions(e),i=this.viewer3d.getCameraStatus().position;i=new Vector3$1(i.x,i.y,i.z);var n=(new Box3).setFromPoints(t),o=n.getSize().length(),r=i.distanceTo(n.getCenter()),a=.995*this.getCameraMaxRange(),s=[];return s.push(r),s.push(o),s.push(a),s}},{key:"getCameraMaxRange",value:function(){var e=this.viewer3d.getViewer(),t=e.camera,i=e.getBoundingBoxWorld(),n=i.getSize().length(),o=.5*n/Math.tan(THREE.Math.degToRad(.5*t.fov));return this.viewer3d.maximalRangeofCamera*o}},{key:"setMaxLevel",value:function(e){this._maxLevel=e}},{key:"getMaxLevel",value:function(){return this._maxLevel}},{key:"getMinClusterSize",value:function(){return this._minClusterSize}},{key:"setMinClusterSize",value:function(e){this._minClusterSize=e}},{key:"isLevelChanged",value:function(e){return this.calcClusterLevel(e)!==this.currentLevel}},{key:"cullingByFrustum",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;this.viewer3d.isInViewFrustum(a.worldPosition)?a.show():a.hide()}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"getBoundingbox",value:function(e){return e.bbox}},{key:"getCenter",value:function(e){return e.center}},{key:"setDistance",value:function(){console.log("ClusterItem3D doesn't support setDistance.")}},{key:"getDistance",value:function(){console.log("ClusterItem3D doesn't support getDistance.")}}]),e}(),ClusterItemDrawingImpl=function(){function e(t){_classCallCheck(this,e),this.viewerDrawing=t.viewer,this.searchRange=t.distance,this._minClusterSize=t.minClusterSize}return _createClass(e,[{key:"prepareTagPositions",value:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i].getWorldPosition();n=this.viewerDrawing.worldToClient(n);var o=new Vector3$1(n.x,n.y,n.z);o.index=i,t.push(o)}return t}},{key:"calcSearchRange",value:function(e){return this.searchRange}},{key:"isLevelChanged",value:function(){return!0}},{key:"setDistance",value:function(e){this.searchRange=e}},{key:"getDistance",value:function(){return this.searchRange}},{key:"setMaxLevel",value:function(e){console.log("Drawing clustering has no maxlevel.")}},{key:"getMaxLevel",value:function(){console.log("Drawing clustering has no maxLevel.")}},{key:"getMinClusterSize",value:function(){return this._minClusterSize}},{key:"setMinClusterSize",value:function(e){this._minClusterSize=e}},{key:"cullingByFrustum",value:function(){}},{key:"getBoundingbox",value:function(e){return e}},{key:"getCenter",value:function(e){var t=e.center;return this.viewerDrawing.clientToWorld(t)}}]),e}();!function(){var e="Bimface.Plugins.Cluster",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Cluster")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"ClusterItem"),this.viewer=n.viewer,this.isViewer3D="Viewer3D"===n.viewer.getViewerType(),this.impl=this.isViewer3D?new ClusterItem3DImpl(n):new ClusterItemDrawingImpl(n),this.id=Glodon$1.Web.Lang.Utility.UUID.createUUID(),this.setTags(n.tags),this._isVisible=!0,this.clusterTags=[],this._mapTagIsExist={},this._mapClusterTags={},this.mapDrawableStyle={},this.mapClusterException={},this.onClusterChanged=null,this.clusterStyle=n.style,this._isNeedClustering=!0,this._isNeedMakingClusterTag=!0,this.meanShift=null,this._lastSearchRange=null}return _createClass(i,[{key:"getId",value:function(){return this.id}},{key:"getTags",value:function(){return this._tags}},{key:"addTags",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];i instanceof Glodon$1.Bimface.Plugins.Drawable.MiniTag||!0!==this._mapTagIsExist[i.id]&&(this._tags.push(i),this._mapTagIsExist[i.id]=!0)}this._isNeedClustering=!0}},{key:"getMinClusterSize",value:function(){return this.impl.getMinClusterSize()}},{key:"setMinClusterSize",value:function(e){"number"==typeof e&&e>0?(this.impl.setMinClusterSize(e),this._isNeedClustering=!0):console.log("Invalid param, please input valid param.")}},{key:"setTags",value:function(e){if(0!==e.length){if(this._tags){var t=!0,i=!1,n=void 0;try{for(var o,r=this._tags[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){o.value.isHideByClustering=!1}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}this._tags=[],this._mapTagIsExist={},this.addTags(e)}}},{key:"removeTagsByIds",value:function(e){for(var t=this._tags.length-1;t>=0;){var i=this._tags[t];e.indexOf(i.id)>=0?(this._tags.splice(t--,1),delete this._mapTagIsExist[i.id],i.isHideByClustering=!1):t--}this._isNeedClustering=!0}},{key:"setDistance",value:function(e){this.impl.setDistance(e)}},{key:"getDistance",value:function(){return this.impl.getDistance()}},{key:"getMaxLevel",value:function(){return this.impl.getMaxLevel()}},{key:"setMaxLevel",value:function(e){this.impl.setMaxLevel(e),this._isNeedClustering=!0}},{key:"onClick",value:function(e){this.onClickCallback=e;var t=!0,i=!1,n=void 0;try{for(var o,r=this.clusterTags[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){o.value.onClick(this.onClickCallback)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"onHover",value:function(e){this.onHoverCallback=e;var t=!0,i=!1,n=void 0;try{for(var o,r=this.clusterTags[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){o.value.onClick(this.onHoverCallback)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.clusterTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}for(var r=0;r<this._tags.length;r++)this._tags[r].isHideByClustering=!0;this._getContainer().update(),this._isVisible=!1}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.clusterTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this._isVisible=!0,this.clustering(),this.updateClusterTags()}},{key:"getClusterTagById",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.clusterTags[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if(a.isInclude(e))return a}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"getClusterTag",value:function(e){var t=this._mapClusterTags[e];return t||(console.log("Can't find a cluster tag whose id is "+e),null)}},{key:"onClusterChange",value:function(e){this.onClusterChanged=e}},{key:"getStyle",value:function(){return this.clusterStyle}},{key:"setStyle",value:function(e){this.clusterStyle=e;var t=!0,i=!1,n=void 0;try{for(var o,r=this.clusterTags[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){o.value.setStyle(e)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"getStyleById",value:function(e){var t=this.getClusterTag(e);return t&&t.getStyle()}},{key:"setStyleById",value:function(e,t){var i=this.getClusterTag(e);return i&&i.setStyle(t)}},{key:"setException",value:function(e,t){var i=this;[].concat(e).forEach(function(e){i.mapDrawableStyle[e]=t})}},{key:"removeException",value:function(e){var t=this;[].concat(e).forEach(function(e){delete t.mapDrawableStyle[e]})}},{key:"clearException",value:function(){var e=this,t=Object.keys(this.mapDrawableStyle),i=Glodon$1.Bimface.Plugins.Cluster.ClusterStyle.Success;t.forEach(function(t){e.mapDrawableStyle[t]=i})}},{key:"_updateMapException",value:function(){var e=Object.keys(this.mapDrawableStyle);this.mapClusterException={};var t=this.mapClusterException,i=!0,n=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,l=this.getClusterTagById(s);if(l){var u=l.getId(),c=this.mapDrawableStyle[s];t[u]||(t[u]={}),t[u][c]=!0}}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"_updateCurrentStyle",value:function(){this._updateMapException();var e=!0,t=!1,i=void 0;try{for(var n,o=this.clusterTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,a=r.getId(),s=this.mapClusterException;if(s[a]){var l=this._getStyleInOrder(s[a]);l&&this.setStyleById(a,l)}else this.setStyleById(a,this.clusterStyle)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"_getStyleInOrder",value:function(e){var t=Glodon$1.Bimface.Plugins.Cluster.ClusterStyle,i=[t.Danger,t.Warning,t.Information,t.Success],n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;if(e[l])return l}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}return t.Success}},{key:"clustering",value:function(e){if(!1!==this._isVisible){var t=this.getTags(),i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){r.value.isHideByClustering=!1}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}var s=this.impl.calcSearchRange(this.getTags()),l=this.impl.prepareTagPositions(this.getTags());null===this.meanShift?this.meanShift=new Glodon$1.Web.Algorithm.MeanShift(l,s):(this.meanShift.setSearchRange(s),this.meanShift.setPoints(l));var u=!0;null!=this._lastSearchRange&&(u=this._lastSearchRange>s),void 0!=e?this.meanShift.clustering(e,this.isViewer3D):this.meanShift.clustering(u,this.isViewer3D),this._lastSearchRange=s,this._isNeedClustering=!1,this._isNeedMakingClusterTag=!0}}},{key:"updateClusterTags",value:function(){if(!1!==this._isVisible)if(this.isNeedMakingClusterTag())this.makeClusterTags(),!1===this._isVisible&&this.hide(),this._isNeedMakingClusterTag=!1,this.onClusterChanged&&this.onClusterChanged();else if(this._isVisible)return this.impl.cullingByFrustum(this.clusterTags),this._getClusterContainer().update(),void this._updateCurrentStyle()}},{key:"makeClusterTags",value:function(){for(var e=this,t=0;t<this._tags.length;t++)this._tags[t].isHideByClustering=!1;this.clusterTags=[],this._mapClusterTags={};var n=!1,o=!0,r=!1,a=void 0;try{for(var s,l=this.meanShift.clusters[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value,c=this._getIndices(u);if(!(c.length<this.impl.getMinClusterSize())){var h=i.makeClusterTag(this.impl.getCenter(u),n);n=!0;var d=!0,f=!1,g=void 0;try{for(var v,m=c[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var p=v.value,y=this._tags[p];y.isHideByClustering=!0,h.include(y),h.setBoundingBox(this.impl.getBoundingbox(u))}}catch(e){f=!0,g=e}finally{try{!d&&m.return&&m.return()}finally{if(f)throw g}}h.clusterItemId=this.id,this.onClickCallback&&h.onClick(this.onClickCallback),this.onHoverCallback&&h.onHover(this.onHoverCallback),this.clusterTags.push(h),this._mapClusterTags[h.getId()]=h}}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}this.impl.cullingByFrustum(this.clusterTags),this._getClusterContainer().removeClusterTags(this.id),this._getClusterContainer().addItems(this.clusterTags),this._updateCurrentStyle(),this._getContainer().update(),setTimeout(function(){var t=!0,i=!1,n=void 0;try{for(var o,r=e.clusterTags[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)o.value.updateText()}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}},10)}},{key:"clearClusterTags",value:function(){for(var e=0;e<this._tags.length;e++)this._tags[e].isHideByClustering=!1;this._getClusterContainer().removeClusterTags(this.id),this._getContainer().update()}},{key:"calcClusterLevel",value:function(){return this.impl.calcClusterLevel(this.getTags())}},{key:"_getClusterContainer",value:function(){var e=this.viewer.drawableContainer;if(!e){var t=new Glodon$1.Bimface.Plugins.Drawable.DrawableContainerConfig;t.viewer=this.viewer,e=new Glodon$1.Bimface.Plugins.Drawable.DrawableContainer(t)}return e}},{key:"isNeedClustering",value:function(){return this._isNeedClustering||this.impl.isLevelChanged(this.getTags())}},{key:"isNeedMakingClusterTag",value:function(){return this._isNeedMakingClusterTag}},{key:"setIsNeedMakingClusterTag",value:function(e){this._isNeedMakingClusterTag=e}},{key:"_getContainer",value:function(){return this._tags[0]instanceof Glodon$1.Bimface.Plugins.Marker3D.Marker3D?this.viewer.marker3DContainer:this.viewer.drawableContainer}},{key:"_getIndices",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,a=e.points[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;t.push(s.index)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}return t}}]),i}();n.makeClusterTag=function(e,t){var i=new Glodon$1.Bimface.Plugins.Drawable.ClusterTagConfig;return i.worldPosition=e,i.attachFilter=!t,new Glodon$1.Bimface.Plugins.Drawable.ClusterTag(i)},i.ClusterItem=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=function(){return{viewer:null,
measureType:Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Distance,color:new Glodon$1.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon$1.Web.Graphics.Color(17,218,183,.2),width:3,radius:25,snapDistance:5,precision:{distance:3,elevation:3,area:3,angle:2,latLon:9},scale:1,units:null}};e.MeasureConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=Object.freeze({Measuring:"Measuring",Measured:"Measured",Reset:"Reset",MeasureSelected:"MeasureSelected",MeasureUnselected:"MeasureUnselected"});e.MeasureEvent=t}(),function(){var e=Object.freeze({Distance:"Distance",Area:"Area",Angle:"Angle",MinimumDistance:"MinimumDistance",Elevation:"Elevation",Position:"Position",PolylineDistance:"PolylineDistance",TriangleDistance:"TriangleDistance",SpatialArea:"SpatialArea",ProjectedArea:"ProjectedArea"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure").MeasureTypeOption=e}(),function(){var e=Object.freeze({None:"None",Kilometer:"Kilometer",Meter:"Meter",Centimeter:"Centimeter",Millimeter:"Millimeter"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure").LengthUnits=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=function(){return{id:null,color:new Glodon$1.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon$1.Web.Graphics.Color(17,218,183,.2),fillColor:new Glodon$1.Web.Graphics.Color(255,157,11,.2),objectColor:new Glodon$1.Web.Graphics.Color(17,218,183,.9),width:3,radius:25,viewer:null}};e.MeasureItemConfig=t}();var MeasureUtil=function e(){_classCallCheck(this,e)};MeasureUtil.xmlns="http://www.w3.org/2000/svg",MeasureUtil.makeCircle=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"circle");return t.style.fill=e.color,t.setAttribute("r",e.radius+""),t.setAttribute("stroke","#FFFFFF"),t.setAttribute("stroke-width",e.strokeWidth),t.setAttribute("transform","translate("+e.position.x+","+e.position.y+")"),t},MeasureUtil.makeConcentricCircle=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"g"),i=document.createElementNS(MeasureUtil.xmlns,"circle");i.style.fill=e.color,i.setAttribute("r",e.innerRadius+""),i.setAttribute("stroke","#FFFFFF"),i.setAttribute("stroke-width",e.innerStrokeWidth),i.setAttribute("transform","translate("+e.position.x+","+e.position.y+")");var n=i.cloneNode();return n.setAttribute("r",e.outerRadius+""),n.setAttribute("stroke-width",e.outerStrokeWidth||0),t.appendChild(n),t.appendChild(i),t},MeasureUtil.makeLine=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"line");return t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",e.lineWidth),t.setAttribute("x1",e.start.x+""),t.setAttribute("y1",e.start.y+""),t.setAttribute("x2",e.end.x+""),t.setAttribute("y2",e.end.y+""),t},MeasureUtil.makeDashLine=function(e){var t=MeasureUtil.makeLine(e);return t.setAttribute("stroke-dasharray",e.dashArray||"10 8"),t},MeasureUtil.makePath=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"path"),i=e.info;return t.setAttribute("d","M "+i.pointA.x+" "+i.pointA.y+" A "+e.arcRadius+" "+e.arcRadius+" 0 0 "+i.direction+" "+i.pointB.x+" "+i.pointB.y),t.setAttribute("fill","rgba(0,0,0,0)"),t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",e.lineWidth),t},MeasureUtil.makePolyline=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"polyline");return t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",e.width),t.style.fill=e.fillColor||"none",t.style.opacity=e.opacity||1,t.setAttribute("points",e.points),t},MeasureUtil.makePolygon=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"polygon");return t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",e.width),t.style.fill=e.fillColor||"none",t.setAttribute("points",e.points),t},MeasureUtil.calcPolylinePoints=function(e){for(var t="",i=0;i<e.length;i++)t+=e[i].x+","+e[i].y+" ";return t},MeasureUtil.makeRectangle=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"rect");return t.setAttribute("stroke-width",2),t.setAttribute("x",e.x),t.setAttribute("y",e.y),t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.setAttribute("rx",e.radius),t.style.fill=e.fillColor||"none",t.setAttribute("fill-opacity",e.fillOpacity||1),t.setAttribute("stroke",e.strokeColor||"none"),t},MeasureUtil.makeMarker=function(e){var t=document.createElementNS(this.xmlns,"marker");t.setAttribute("id",e.id),t.setAttribute("viewBox","0 0 10 10"),t.setAttribute("refX","5"),t.setAttribute("refY","5"),t.setAttribute("markerWidth",e.markerWidth||"6"),t.setAttribute("markerHeight",e.markerHeight||"6"),t.setAttribute("orient","auto-start-reverse");var i=document.createElementNS(this.xmlns,"path");i.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),i.style.fill=e.color,t.appendChild(i);var n=MeasureUtil.makeDefs();return n.appendChild(t),n},MeasureUtil.makeText=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"text");t.setAttribute("x",e.x),t.setAttribute("y",e.y),t.setAttribute("fill",e.color||"#000"),t.setAttribute("font-size",e.fontsize);var i=e.content?e.content.split("\n"):[""];if(i.length>1)for(var n=0;n<i.length;n++){var o=document.createElementNS(MeasureUtil.xmlns,"tspan");o.setAttribute("x",e.x),o.setAttribute("y",e.y+30*n),o.textContent=i[n],t.appendChild(o)}else t.textContent=i[0];return t},MeasureUtil.makeDefs=function(){return document.createElementNS(this.xmlns,"defs")},MeasureUtil.measureText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'14px "Microsoft YaHei',i=document.createElement("canvas"),n=i.getContext("2d");return n.font=t,n.measureText(e).width},MeasureUtil.distanceToSegment=function(e,t,i){var n=t.distanceToSquared(i);if(0==n)return e.distanceTo(t);var o=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;o=Math.max(0,Math.min(1,o));var r=new Vector2$1;return r.x=t.x+o*(i.x-t.x),r.y=t.y+o*(i.y-t.y),e.distanceTo(r)},MeasureUtil.isPointInPolygon=function(e,t){for(var i=0,n=t.length,o=0;o<n;o++){var r=t[o],a=t[(o+1)%n];if(r.y!=a.y&&!(e.y<Math.min(r.y,a.y)||e.y>=Math.max(r.y,a.y))){(e.y-r.y)*(a.x-r.x)/(a.y-r.y)+r.x>e.x&&i++}}return i%2==1},MeasureUtil.isPointInTriangle=function(e,t){var i=t.a,n=t.b,o=t.c,r=n.clone().sub(i),a=o.clone().sub(i),s=e.clone().sub(i),l=r.clone().cross(a),u=r.clone().cross(s);return l.dot(u)>=0},MeasureUtil.calcSpatialArea=function(e){var t=e.length;if(t<3)return 0;for(var i=0,n=new THREE.Triangle,o=2;o<t;o++){var r=n.clone().set(e[o-1],e[o],e[0]),a=r.area();if(o>2){var s=n.normal(),l=r.normal(),u=s.angleTo(l);if((Math.abs(u-3.1415)<2e-4||Math.abs(u)<2e-4)&&(n.containsPoint(e[o])||r.containsPoint(e[o-2]))){var c=n.area();a=Math.abs(a-c)-c}}i+=a,n.copy(r)}return i},MeasureUtil.calcProjectedArea=function(e){var t=[];return e.forEach(function(e){var i=e.clone();i.z=0,t.push(i)}),this.calcSpatialArea(t)};var MeasureNotation=function(){function e(t){_classCallCheck(this,e),this.type=t,this.observer=null}return _createClass(e,[{key:"initialize",value:function(){this.notationSelected=[],this.notationUnselected=[],this.notationSegmentRects=[]}},{key:"drawAnnotation",value:function(e,t){}},{key:"calcAnnotationStyle",value:function(e,t){}},{key:"select",value:function(){this.isInitialized()&&(this.notationUnselected.forEach(function(e){e.style.display="none"}),this.notationSelected.forEach(function(e){e.style.display="block"}))}},{key:"unselect",value:function(){this.isInitialized()&&(this.notationUnselected.forEach(function(e){e.style.display="block"}),this.notationSelected.forEach(function(e){e.style.display="none"}))}},{key:"dropShadow",value:function(e){this.isInitialized()&&this.notationUnselected.forEach(function(t){t.setAttribute("filter",e),t.setAttribute("filter",e)})}},{key:"isInitialized",value:function(){return!!this.notationUnselected&&!!this.notationSelected}},{key:"clear",value:function(){this.notationSelected=[],this.notationUnselected=[],this.notationSegmentRects=[]}},{key:"hitTest",value:function(e){if(!this.isInitialized())return!1;var t=this.hitTestEpsilon;return this.notationSegmentRects.some(function(i){return MeasureUtil.distanceToSegment(e,i.start,i.end)<=t})}}]),e}(),MeasureViewer3dNotation=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.defaultColor="#F99D0B",i.initialize(),i}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.annotationStyle={height:21,radius:4},this.hitTestEpsilon=this.annotationStyle.height/2}},{key:"drawAnnotation",value:function(e,t){var i=this.calcAnnotationStyle(t,e),n=MeasureUtil.makeRectangle({x:i.offsetRect.x,y:i.offsetRect.y,width:i.width,height:this.annotationStyle.height,radius:this.annotationStyle.radius,fillColor:this.defaultColor});this.notationUnselected.push(n);var o=MeasureUtil.makeRectangle({x:i.offsetRect.x-2,y:i.offsetRect.y-2,width:i.width+4,height:this.annotationStyle.height+4,radius:this.annotationStyle.radius,strokeColor:"#FFFFFF",fillColor:this.defaultColor});this.notationSelected.push(o);var r=new Vector2$1(i.offsetRect.x,i.offsetRect.y+this.annotationStyle.height/2),a=new Vector2$1(i.offsetRect.x+i.width,r.y);this.notationSegmentRects.push({start:r,end:a});var s=MeasureUtil.makeText({x:i.offsetText.x,y:i.offsetText.y,color:"#FFFFFF",fontsize:14,content:t});return this.svgGroup=[],this.svgGroup.push(n),this.svgGroup.push(o),this.svgGroup.push(s),this.unselect(),this.svgGroup}},{key:"calcAnnotationStyle",value:function(e,t){var i=0,n=new Vector2$1(t.x,t.y),o=new Vector2$1(t.x,t.y);return"Elevation"!==this.type&&(i=MeasureUtil.measureText(e),n.x-=i/2,n.y-=this.annotationStyle.height/2,o.x=n.x+5,o.y=n.y+19-3.5),"Elevation"==this.type&&(n.x-=12,n.y-=39,o.x=n.x+5,o.y=n.y+19-3.5,i=MeasureUtil.measureText(e)),i+=10,{offsetRect:n,offsetText:o,width:i}}}]),t}(MeasureNotation),MeasureViewerGISNotation=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.defaultColor="#20262F",i.initialize(),i}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.annotationStyle={height:this.calcAnnotationHeight(),radius:this.calcAnnotationRadius(),fillOpacity:.85},this.hitTestEpsilon=this.annotationStyle.height/2}},{key:"drawAnnotation",value:function(e,t,i,n){var o=this.calcAnnotationStyle(t,e,n),r=MeasureUtil.makeRectangle({x:o.offsetRect.x,y:o.offsetRect.y,width:o.width,height:this.annotationStyle.height,radius:this.annotationStyle.radius,fillColor:this.defaultColor,fillOpacity:this.annotationStyle.fillOpacity}),a=new Vector2$1(o.offsetRect.x,o.offsetRect.y+this.annotationStyle.height/2),s=new Vector2$1(o.offsetRect.x+o.width,a.y);this.notationSegmentRects.push({start:a,end:s});var l=MeasureUtil.makeText({x:o.offsetText.x,y:o.offsetText.y,color:"#FFFFFF",fontsize:14,content:t});this.notationSelected.push(l);var u=MeasureUtil.makeText({x:o.offsetText.x,y:o.offsetText.y,color:"#A4A8AE",fontsize:14,content:t});if(this.notationUnselected.push(u),this.svgGroup=[],this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Position){var c=MeasureUtil.makeRectangle({x:o.offsetArrow.x,y:o.offsetArrow.y,width:7,height:7,radius:0,fillColor:this.defaultColor,fillOpacity:this.annotationStyle.fillOpacity});c.setAttribute("transform","rotate(45 "+o.offsetArrow.x+" "+o.offsetArrow.y+")"),this.svgGroup.push(c)}return this.svgGroup.push(r),this.svgGroup.push(u),this.svgGroup.push(l),this.unselect(),this.svgGroup}},{key:"calcAnnotationStyle",value:function(e,t,i){var n=0,o=this.annotationStyle.height,r=new Vector2$1(t.x,t.y),a=new Vector2$1(t.x,t.y),s=new Vector2$1(t.x,t.y);if(this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Position){e.split("\n").forEach(function(e){var t=MeasureUtil.measureText(e);n=t>n?t:n}),n+=10,r.x-=n/2+5,r.y-=o+8+10,a.x=r.x+10,a.y=r.y+30-3.5}else n=MeasureUtil.measureText(e),!0===i?r.x+=15:r.x-=n/2,r.y-=this.annotationStyle.height/2,a.x=r.x+5,a.y=r.y+19-3.5;return s.y-=22.5,n+=10,{offsetRect:r,offsetText:a,offsetArrow:s,width:n}}},{key:"calcAnnotationHeight",value:function(){var e=21;return"Position"==this.type&&(e=100),e}},{key:"calcAnnotationRadius",value:function(){var e=4;return"Position"==this.type&&(e=0),e}}]),t}(MeasureNotation);!function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=new Glodon$1.Web.Graphics.Color(17,218,183,.2),n=function(e){this.id=e.id||Glodon$1.Web.Lang.Utility.UUID.createUUID(),this.nextMeasurePoint=null,this.measurePoints=[],this.maxPointsNum=2,this.measureResult=null,this.measureParams={precision:e.precision,scale:e.scale,unit:e.unit,defaultUnit:e.defaultUnit},this.measureItemConfig=e,this.viewer=e.viewer;var n=(e.color.getRGBA(),t.createNS("circle","bf-measure-handle"));n.setAttribute("stroke-width",0),n.setAttribute("r",e.width),n.setAttribute("fill",i.getRGB()),n.style.fill=i.getRGB();var o=t.createNS("line","bf-measure-line");o.style.strokeWidth=2,o.style.stroke=i.getRGB();var r=t.createNS("polygon","bf-measure-rect");r.setAttribute("fill",i.getRGBA()),r.setAttribute("stroke",i.getRGB()),r.setAttribute("stroke-width",1),this.hoverPoint=n,this.hoverLine=o,this.hoverPanel=r,this.hoverPanelSize={width:20,height:20},this.defaultColor="#F99D0B",this.lineWidth="3",this.radius=5,this.strokeWidth=2,this.measureType=e.measureType,this.notation="ViewerGIS"===this.viewer.getViewerType()?new MeasureViewerGISNotation(this.measureType):new MeasureViewer3dNotation(this.measureType),this.isReserverd=!1,this.hoverPositionUpdated=!1};n.prototype={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){},drawLine:function(e){if(0!==e.length){var t=MeasureUtil.makeLine({start:e[0],end:e[1],color:this.defaultColor,lineWidth:this.lineWidth});this._svg.appendChild(t)}},drawTerminalPoint:function(e){var t=MeasureUtil.makeCircle({position:e,radius:this.radius,strokeWidth:this.strokeWidth,color:this.defaultColor});t.setAttribute("filter",this.filterUrl),this._svg.appendChild(t)},drawNotation:function(e,t,i){if(0!==e.length){var n=this.notation.drawAnnotation({x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},t,this.id,i),o=!0,r=!1,a=void 0;try{for(var s,l=n[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value;this._svg.appendChild(u)}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}}},drawCaptureItem:function(e){var t=this.hoverPoint,i=this.hoverLine,n=this.hoverPanel,o=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":t.setAttribute("cx",e.hoverPosition.x),t.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(t);break;case"Line":i.setAttribute("x1",e.lineStartPoint.x),i.setAttribute("y1",e.lineStartPoint.y),i.setAttribute("x2",e.lineEndPoint.x),i.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(i);break;case"Panel":var r=e.clientPts,a=r[0].distanceTo(r[1]),s=r[0].distanceTo(r[3]),l=a/o.width,u=s/o.height;if(1!=l){var c=this.stretchOnDirection(r[0],r[1],o.width),h=this.stretchOnDirection(r[2],r[3],o.width);r=c.concat(h)}if(1!=u){var d=this.stretchOnDirection(r[0],r[3],o.height),f=this.stretchOnDirection(r[1],r[2],o.height);r=[d[0],f[0],f[1],d[1]]}for(var g="",v=0;v<r.length;v++)g+=r[v].x+",",g+=r[v].y+" ";n.setAttribute("points",g),e.svg.appendChild(n)}},reset:function(){if(this.measurePoints=[],this.nextMeasurePoint=null,this.measureResult=null,this._svg){for(var e=this._svg.childNodes,t=e.length,i=t-1;i>-1;i--)this._svg.removeChild(e[i]);this._svg.innerHTML=""}},addPoint:function(e){if(this.measurePoints.length==this.maxPointsNum)this.reset();else if(this.measurePoints.length>0){var t=this.measurePoints.length,i=this.measurePoints[t-1];if(e.x===i.x&&e.y===i.y&&e.z===i.z)return}this.measurePoints.push(e),this.setIsReserverd(!1)},redo:function(){this.measurePoints.length>0&&this.measurePoints.length<this.maxPointsNum?this.measurePoints.pop():this.measurePoints=[]},getPoints:function(){return this.measurePoints},calcLine:function(e,t){var i=[],n=this.viewer.getViewer(),o=this.viewer.getDomElement().getBoundingClientRect(),r=n.worldPointsToClient(e,t);if(r){var e=new Vector2(r.start.x-o.left,r.start.y-o.top),t=new Vector2(r.end.x-o.left,r.end.y-o.top);i.push(e,t)}return i},setMeasureParams:function(e){this.measureParams.precision=e.precision,this.measureParams.scale=e.scale,this.measureParams.unit=e.unit,this.measureParams.defaultUnit=e.defaultUnit},setIsReserverd:function(e){this.isReserverd=e},getIsReserverd:function(){return this.isReserverd}},e.MeasureItem=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=new Glodon$1.Web.Graphics.Color(17,218,183,.2),o=function(e){t.MeasureItem.call(this,e),this.maxPointsNum=2,this.measurePoints=[];var o=e.color.getRGBA(),r=i.createNS("circle","bf-measure-handle");r.setAttribute("stroke-width",0);var a=r.cloneNode();r.setAttribute("r",5),r.setAttribute("stroke","#FFFFFF"),r.setAttribute("stroke-width",2),r.setAttribute("fill",o),r.style.fill=o;var s=r.cloneNode();a.setAttribute("r",e.width),a.setAttribute("fill",n.getRGB()),a.style.fill=n.getRGB();var l=i.createNS("line","bf-measure-line"),u=l.cloneNode();u.style.strokeWidth=2;var c=u.cloneNode();u.setAttribute("stroke-dasharray","6,4");var h=u.cloneNode(),d=u.cloneNode();l.style.strokeWidth=e.width,l.style.stroke=e.color.getRGBA(),c.style.stroke=n.getRGB(),u.style.stroke="#CC021B",h.style.stroke="#7CCF21",d.style.stroke="#4A90E2",l.setAttribute("stroke-width",e.width);var f=i.createNS("polygon","bf-measure-rect");f.setAttribute("fill",n.getRGBA()),f.setAttribute("stroke",n.getRGB()),f.setAttribute("stroke-width",1),this.line=l,this.lineX=u,this.lineY=h,this.lineZ=d,this.hoverLine=c,this.startPoint=r,this.endPoint=s,this.hoverPoint=a,this.hoverPanel=f,this.hoverPanelSize={width:20,height:20}};e.Type.inheritPrototype(o,t.MeasureItem);var r={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.line,i=this.lineX,n=this.lineY,o=this.lineZ,r=this.hoverLine,a=this.startPoint,s=this.endPoint,l=this.hoverPoint,u=this.hoverPanel,c=this.hoverPanelSize;switch(this._svg=e.svg,e.hoverObjectType){case"Point":l.setAttribute("cx",e.hoverPosition.x),l.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(l);break;case"Line":r.setAttribute("x1",e.lineStartPoint.x),r.setAttribute("y1",e.lineStartPoint.y),r.setAttribute("x2",e.lineEndPoint.x),r.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(r);break;case"Panel":var h=e.clientPts,d=h[0].distanceTo(h[1]),f=h[0].distanceTo(h[3]),g=d/c.width,v=f/c.height;if(1!=g){var m=this.stretchOnDirection(h[0],h[1],c.width),p=this.stretchOnDirection(h[2],h[3],c.width);h=m.concat(p)}if(1!=v){var m=this.stretchOnDirection(h[0],h[3],c.height),p=this.stretchOnDirection(h[1],h[2],c.height);h=[m[0],p[0],p[1],m[1]]}for(var y="",w=0;w<h.length;w++)y+=h[w].x+",",y+=h[w].y+" ";u.setAttribute("points",y),e.svg.appendChild(u)}if(!this.getIsReserverd())switch(e.clientPoints.length){case 2:var b=e.auxLines[0],C=e.auxLines[1],x=e.auxLines[2];b&&(i.setAttribute("x1",b.start.x),i.setAttribute("y1",b.start.y),i.setAttribute("x2",b.end.x),i.setAttribute("y2",b.end.y),e.svg.appendChild(i)),C&&(n.setAttribute("x1",C.start.x),n.setAttribute("y1",C.start.y),n.setAttribute("x2",C.end.x),n.setAttribute("y2",C.end.y),e.svg.appendChild(n)),x&&(o.setAttribute("x1",x.start.x),o.setAttribute("y1",x.start.y),o.setAttribute("x2",x.end.x),o.setAttribute("y2",x.end.y),e.svg.appendChild(o)),a.setAttribute("cx",e.clientPoints[1].x),a.setAttribute("cy",e.clientPoints[1].y),s.setAttribute("cx",e.clientPoints[0].x),s.setAttribute("cy",e.clientPoints[0].y),t.setAttribute("x1",e.clientPoints[0].x),t.setAttribute("y1",e.clientPoints[0].y),t.setAttribute("x2",e.clientPoints[1].x),t.setAttribute("y2",e.clientPoints[1].y),e.svg.appendChild(a),e.svg.appendChild(s),e.svg.appendChild(t);break;case 1:a.setAttribute("cx",e.clientPoints[0].x),a.setAttribute("cy",e.clientPoints[0].y);this.getPoints().length!=this.maxPointsNum&&e.hoverPosition&&(t.setAttribute("x1",e.clientPoints[0].x),t.setAttribute("y1",e.clientPoints[0].y),t.setAttribute("x2",e.hoverPosition.x),t.setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(t)),e.svg.appendChild(a)}}};o.prototype=Object.assign(o.prototype,r),t.MeasureDistanceItem=o}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=(new Glodon$1.Web.Graphics.Color(17,218,183,.2),function(e){t.MeasureItem.call(this,e),this.maxPointsNum=3,this.radius=e.radius,this.measurePoints=[];var n=e.color.getRGBA(),o=i.createNS("circle","bf-measure-handle");o.setAttribute("stroke-width",0),o.setAttribute("r",5),o.setAttribute("stroke","#FFFFFF"),o.setAttribute("stroke-width",2),o.setAttribute("fill",n),o.style.fill=n;var r=o.cloneNode(),a=o.cloneNode(),s=i.createNS("path","bf-measure-angle");s.setAttribute("fill","rgba(0,0,0,0)"),s.setAttribute("stroke",n),s.setAttribute("stroke-width",e.width);var l=i.createNS("line","bf-measure-line");l.style.strokeWidth=e.width,l.style.stroke=n,l.setAttribute("stroke-width",e.width);var u=l.cloneNode(),c=i.create("span","bf-measure-number");c.style.backgroundColor=e.color.getRGBA(),this.points=[o,r,a],this.lines=[l,u],this.angleLine=s,this.text=c});e.Type.inheritPrototype(n,t.MeasureItem);var o={_getPoint:function(e,t,i,n){var e=new THREE.Vector2(e.x,e.y),t=new THREE.Vector2(t.x,t.y),i=new THREE.Vector2(i.x,i.y),o=1,r=e.sub(t),a=i.sub(t);if(r.length()<n||a.length()<n)return!1;r.setLength(n),a.setLength(n);var s=r.angle(),l=a.angle(),u=180*(l-s)/Math.PI;return u<0&&(u+=360),o=u<180?1:0,{pointA:t.clone().add(r),pointB:t.clone().add(a),flag:1,direction:o}},draw:function(e,t){var i=this.points;if(this._svg=e.svg,this.drawCaptureItem(e),!this.getIsReserverd()){for(var n=0,o=e.clientPoints.length;n<o;n++)e.clientPoints[n]&&(i[n].setAttribute("cx",e.clientPoints[n].x),i[n].setAttribute("cy",e.clientPoints[n].y),e.svg.appendChild(i[n]));"ViewerGIS"===this.viewer.viewerType?this.drawAngleWithResult(e,t):this.drawAngle(e)}},drawAngle:function(e){var t=this.lines,i=this.angleLine;switch(e.clientPoints.length){case 3:t[0].setAttribute("x1",e.clientPoints[0].x),t[0].setAttribute("y1",e.clientPoints[0].y),t[0].setAttribute("x2",e.clientPoints[1].x),t[0].setAttribute("y2",e.clientPoints[1].y),t[1].setAttribute("x1",e.clientPoints[1].x),t[1].setAttribute("y1",e.clientPoints[1].y),t[1].setAttribute("x2",e.clientPoints[2].x),t[1].setAttribute("y2",e.clientPoints[2].y);var n=this.radius,o=this._getPoint(e.clientPoints[0],e.clientPoints[1],e.clientPoints[2],n);o&&(i.setAttribute("d","M "+o.pointA.x+" "+o.pointA.y+" A "+n+" "+n+" 0 0 "+o.direction+" "+o.pointB.x+" "+o.pointB.y),e.svg.appendChild(i)),e.svg.appendChild(t[1]),e.svg.appendChild(t[0]);break;case 2:t[0].setAttribute("x1",e.clientPoints[0].x),t[0].setAttribute("y1",e.clientPoints[0].y),t[0].setAttribute("x2",e.clientPoints[1].x),t[0].setAttribute("y2",e.clientPoints[1].y),e.svg.appendChild(t[0]);var r=this.getPoints().length!=this.maxPointsNum;r&&e.hoverPosition&&(t[1].setAttribute("x1",e.clientPoints[1].x),t[1].setAttribute("y1",e.clientPoints[1].y),t[1].setAttribute("x2",e.hoverPosition.x),t[1].setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(t[1]));break;case 1:var r=this.getPoints().length!=this.maxPointsNum;r&&e.hoverPosition&&(t[0].setAttribute("x1",e.clientPoints[0].x),t[0].setAttribute("y1",e.clientPoints[0].y),t[0].setAttribute("x2",e.hoverPosition.x),t[0].setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(t[0]))}},drawAngleWithResult:function(e,t){var i=this.lines,n=this.angleLine;switch(this.measureResult=t.angle,e.clientPoints.length){case 2:i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.clientPoints[1].x),i[0].setAttribute("y2",e.clientPoints[1].y),i[1].setAttribute("x1",e.clientPoints[1].x),i[1].setAttribute("y1",e.clientPoints[1].y),i[1].setAttribute("x2",e.hoverPosition.x),i[1].setAttribute("y2",e.hoverPosition.y);var o=this.radius,r=this._getPoint(e.clientPoints[0],e.clientPoints[1],e.hoverPosition,o);r&&(n.setAttribute("d","M "+r.pointA.x+" "+r.pointA.y+" A "+o+" "+o+" 0 0 "+r.direction+" "+r.pointB.x+" "+r.pointB.y),e.svg.appendChild(n)),e.svg.appendChild(i[1]),e.svg.appendChild(i[0]),this.drawNotation(e,r);break;case 1:this.getPoints().length!=this.maxPointsNum&&e.hoverPosition&&(i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.hoverPosition.x),i[0].setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(i[0]))}},drawNotation:function(e,t){if(t){var i=new Vector2((t.pointA.x+t.pointB.x)/2,(t.pointA.y+t.pointB.y)/2),n=new Vector2(e.clientPoints[1].x,e.clientPoints[1].y),o=i.clone().sub(n).normalize().multiplyScalar(35);i=n.clone().add(o);var r=this.notation.drawAnnotation(i,this.getMeasureResult(),this.id),a=!0,s=!1,l=void 0;try{for(var u,c=r[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;e.svg.appendChild(h)}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}}},getMeasureResult:function(){var e=(this.measureParams.unit,this.measureResult.toString());return MeasureResultFormat.formatPrecision(e,this.measureParams.precision).split(",").join("")+"°"}};n.prototype=Object.assign(n.prototype,o),t.MeasureAngleItem=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=function(e){t.MeasureItem.call(this,e),this.maxPointsNum=2,this.measurePoints=[],this.opt=e,this.minDistanceLine=null,this.svgContainer=i.createNS("svg","bf-minDistanceMeasure-svg"),this.startPoint=i.createNS("circle","bf-minDistanceMeasure-handle"),this.endPoint=i.createNS("circle","bf-minDistanceMeasure-handle"),this.line=i.createNS("line","bf-minDistanceMeasure-line")};e.Type.inheritPrototype(n,t.MeasureItem);var o={draw:function(e){},setMinDistanceLine:function(e){this.minDistanceLine=e},clearMinDistanceLine:function(){var e=this.startPoint;e.parentNode&&this.svgContainer.removeChild(e);var t=this.endPoint;t.parentNode&&this.svgContainer.removeChild(t);var i=this.line;i.parentNode&&this.svgContainer.removeChild(i)},addPoint:function(e){var t=this.opt.viewer;this.opt.objectColor;this.measurePoints.length==this.maxPointsNum&&this.reset();var i=!1;this.measurePoints.some(function(t){return t.modelId===e.modelId&&t.userId===e.userId&&(i=!0),i}),i||(this.measurePoints.push(e),(e.modelId?t.getModel(e.modelId):t).addSelectedComponentsById([e.userId]),t.render())},reset:function(e){var t=this.opt.viewer;!1!==e&&this.measurePoints.forEach(function(e){(e.modelId?t.getModel(e.modelId):t).removeSelectedId([e.userId])}),this.measurePoints=[],this.clearMinDistanceLine(),this.minDistanceLine=null,t.render()},redo:function(){var e=this.opt.viewer;if(this.measurePoints.length>0&&this.measurePoints.length<this.maxPointsNum){var t=this.measurePoints.pop();(t.modelId?e.getModel(t.modelId):e).removeSelectedId([t.userId]),e.render()}else this.reset()}};n.prototype=Object.assign(n.prototype,o),t.MeasureMinimumDistanceItem=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=function(e){t.MeasureItem.call(this,e),this.viewer=e.viewer,this.maxPointsNum=1;var n=new Glodon$1.Web.Graphics.Color(17,218,183,.2),o=i.createNS("circle","bf-measure-handle");o.setAttribute("r",e.width),o.setAttribute("fill",n.getRGB()),o.style.fill=n.getRGB();var r=i.createNS("line","bf-measure-line");r.style.strokeWidth=2,r.style.stroke=n.getRGB();var a=i.createNS("polygon","bf-measure-rect");a.setAttribute("fill",n.getRGBA()),a.setAttribute("stroke",n.getRGB()),a.setAttribute("stroke-width",1),this.hoverLine=r,this.hoverPoint=o,this.hoverPanel=a,this.hoverPanelSize={width:20,height:20}};e.Type.inheritPrototype(n,t.MeasureItem);var o={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.hoverLine,i=this.hoverPoint,n=this.hoverPanel,o=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":i.setAttribute("cx",e.hoverPosition.x),i.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(i);break;case"Line":t.setAttribute("x1",e.lineStartPoint.x),t.setAttribute("y1",e.lineStartPoint.y),t.setAttribute("x2",e.lineEndPoint.x),t.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(t);break;case"Panel":var r=e.clientPts,a=r[0].distanceTo(r[1]),s=r[0].distanceTo(r[3]),l=a/o.width,u=s/o.height;if(1!=l){var c=this.stretchOnDirection(r[0],r[1],o.width),h=this.stretchOnDirection(r[2],r[3],o.width);r=c.concat(h)}if(1!=u){var c=this.stretchOnDirection(r[0],r[3],o.height),h=this.stretchOnDirection(r[1],r[2],o.height);r=[c[0],h[0],h[1],c[1]]}for(var d="",f=0;f<r.length;f++)d+=r[f].x+",",d+=r[f].y+" ";n.setAttribute("points",d),e.svg.appendChild(n)}}};n.prototype=Object.assign(n.prototype,o),t.MeasureElevationItem=n}();var MeasureDrawable=function(){function e(t,i,n){_classCallCheck(this,e),this.viewer=t,this.id=i,this.type=n,this.isShow=!0,this.xmlns="http://www.w3.org/2000/svg",this.defaultColor="#F99D0B",this.svgGroup=[],this.lineWidth="3",this.radius=5,this.strokeWidth=2,this.hitTestEpsilon=10,this.hitTestSegments=[],this.selectElements=[],this.unSelectElements=[],this.elementsOnTop=[],this.isSelected=!0,this.notation="ViewerGIS"===this.viewer.getViewerType()?new MeasureViewerGISNotation(n):new MeasureViewer3dNotation(n),this.measureParams={precision:0,scale:1,unit:"None"}}return _createClass(e,[{key:"getSvgGroup",value:function(){return this.svgGroup}},{key:"getId",value:function(){return this.id}},{key:"getType",value:function(){return this.type}},{key:"clear",value:function(){this.detach(),this.notation.clear(),this.svgGroup=[],this.hitTestSegments=[]}},{key:"detach",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.svgGroup[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,a=r.parentNode;a&&a.removeChild(r)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var s=!0,l=!1,u=void 0;try{for(var c,h=this.elementsOnTop[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value,a=d.parentNode;a&&a.removeChild(d)}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}}},{key:"attach",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.svgGroup[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;e.appendChild(a)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"calcLine",value:function(e,t){
var i=[],n=this.viewer.getViewer(),o=this.viewer.getDomElement().getBoundingClientRect(),r=n.worldPointsToClient(e,t);if(r){var e=new Vector2$1(r.start.x-o.left,r.start.y-o.top),t=new Vector2$1(r.end.x-o.left,r.end.y-o.top);i.push(e,t)}return i}},{key:"calcTerminalLines",value:function(e,t,i){if(0===e.length)return[];var n=[],o=e[0],r=e[1],a=o.clone().sub(r).normalize(),s=a.clone().multiplyScalar(i).add(o).rotateAround(o.clone(),t),l=a.clone().multiplyScalar(i).add(o).rotateAround(o.clone(),-t);n.push({start:s,end:l}),a=a.multiplyScalar(-1);var u=a.clone().multiplyScalar(i).add(r).rotateAround(r.clone(),t),c=a.clone().multiplyScalar(i).add(r).rotateAround(r.clone(),-t);return n.push({start:u,end:c}),n}},{key:"select",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.selectElements[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="none"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var r=!0,a=!1,s=void 0;try{for(var l,u=this.unSelectElements[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){l.value.style.display="block"}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}this.notation.select(),this.isSelected=!0}},{key:"unselect",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.selectElements[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="block"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var r=!0,a=!1,s=void 0;try{for(var l,u=this.unSelectElements[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){l.value.style.display="none"}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}this.notation.unselect(),this.isSelected=!1}},{key:"getIsSelected",value:function(){return this.isSelected}},{key:"actionWhenSelected",value:function(){}},{key:"actionWhenUnselected",value:function(){}},{key:"dropShadow",value:function(e){this.notation.dropShadow(e)}},{key:"setMeasureParams",value:function(e){this.measureParams.precision=e.precision,this.measureParams.scale=e.scale,this.measureParams.unit=e.unit,this.measureParams.defaultUnit=e.defaultUnit}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.svgGroup[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="block"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var r=!0,a=!1,s=void 0;try{for(var l,u=this.elementsOnTop[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){l.value.style.display="block"}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}this.isShow=!0}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.svgGroup[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="none"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var r=!0,a=!1,s=void 0;try{for(var l,u=this.elementsOnTop[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){l.value.style.display="none"}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}this.isShow=!1}},{key:"getNotation",value:function(){return this.notation}},{key:"hitTest",value:function(e){for(var t=this.hitTestEpsilon,i=0;i<this.hitTestSegments.length-1;i++){if(MeasureUtil.distanceToSegment(e,this.hitTestSegments[i],this.hitTestSegments[i+1])<=t)return!0}return!1}}]),e}(),Viewer3dDistance=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.worldPositions=i.points,o.measureResult=i.distance,o.selectElements=[],o.unSelectElements=[],o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit,defaultUnit:i.defaultUnit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.calcLine(this.worldPositions[0],this.worldPositions[1]);this.hitTestSegments=e;var t=this.calAuxLines(),i=this.calcTerminalLines(e,Math.PI/2,6.5);this.attachSingleLine(e),this.attachTerminalLines(i);var n=["#CC021B","#7CCF21","#4A90E2"];this.attachAuxLines(t,n),this.attachTerminalPoints([t[0].start,t[2].end]);var o={x:(this.worldPositions[0].x+this.worldPositions[1].x)/2,y:(this.worldPositions[0].y+this.worldPositions[1].y)/2,z:(this.worldPositions[0].z+this.worldPositions[1].z)/2},r=this.viewer.worldToClient(o);this.viewer.isInViewFrustum(o)&&(this.attachNotation([r,r]),this.notation.dropShadow(this.filterUrl),this.unselect())}},{key:"attachTerminalPoints",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=MeasureUtil.makeCircle({position:a,radius:this.radius,strokeWidth:this.strokeWidth,color:this.defaultColor});this.svgGroup.push(s),s.setAttribute("filter",this.filterUrl),this.unSelectElements.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"attachSingleLine",value:function(e){if(0!==e.length){var t=MeasureUtil.makeLine({start:e[0],end:e[1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(t)}}},{key:"attachTerminalLines",value:function(e){if(0!==e.length)for(var t=0;t<2;t++){var i=MeasureUtil.makeLine({start:e[t].start,end:e[t].end,color:this.defaultColor,lineWidth:2});this.selectElements.push(i),this.svgGroup.push(i)}}},{key:"attachAuxLines",value:function(e,t){var i=0,n=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u=MeasureUtil.makeLine({start:l.start,end:l.end,color:this.defaultColor,lineWidth:this.lineWidth});u.setAttribute("stroke-dasharray","6,4"),u.style.stroke=t[i++],this.unSelectElements.push(u),this.svgGroup.push(u)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}}},{key:"attachNotation",value:function(e){if(0!==e.length){var t=this.notation.drawAnnotation({x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},this.getMeasureResult(),this.id),i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;this.svgGroup.push(s)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}}},{key:"calAuxLines",value:function(){for(var e=this.worldPositions,t=this.viewer.getDomElement().getBoundingClientRect(),i={x:e[1].x,y:e[0].y,z:e[0].z},n={x:e[1].x,y:e[1].y,z:e[0].z},o=[],r=[e[0],i,n,e[1]],a=this.viewer.getViewer(),s=0;s<r.length-1;s++){var l=a.worldPointsToClient(r[s],r[s+1]);if(l)l.start.x-=t.left,l.start.y-=t.top,l.end.x-=t.left,l.end.y-=t.top;else{l={start:{x:-1,y:-1},end:{x:-1,y:-1}}}o.push(l)}return o}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat.formatDistance(t,this.measureParams);return i+=MeasureResultFormat.getPostFix(e,!1),i.split(",").join("")}}]),t}(MeasureDrawable),Viewer3dAngle=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.worldPositions=i.points,o.measureAngle=i.angle,o.setMeasureParams({precision:i.precision}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.getClientPoints();this.hitTestSegments=e;for(var t=0;t<e.length-1;t++){var i=MeasureUtil.makeLine({start:e[t],end:e[t+1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(i)}for(var n=0;n<e.length;n++){var o=MeasureUtil.makeCircle({position:e[n],radius:this.radius,strokeWidth:this.strokeWidth,color:this.defaultColor});this.unSelectElements.push(o),this.svgGroup.push(o),o.setAttribute("filter",this.filterUrl)}var r=this.getArcData(e[0],e[1],e[2]);if(!r)return void this.unselect();var a=MeasureUtil.makePath({color:this.defaultColor,lineWidth:this.lineWidth,arcRadius:25,info:r});this.svgGroup.push(a);var s=new Vector2((r.pointA.x+r.pointB.x)/2,(r.pointA.y+r.pointB.y)/2),l=new Vector2(e[1].x,e[1].y),u=s.clone().sub(l);if(0==u.x&&0==u.y){var c=0==l.clone().sub(r.pointA).y;c&&0==r.direction?u.y=35:c&&1==r.direction?u.y=-35:c||0!=r.direction?c||1!=r.direction||(u.x=35):u.x=-35}else u.normalize().multiplyScalar(35);s=l.clone().add(u);var h=this.notation.drawAnnotation(s,this.getMeasureResult(),this.id),d=!0,f=!1,g=void 0;try{for(var v,m=h[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var p=v.value;this.svgGroup.push(p)}}catch(e){f=!0,g=e}finally{try{!d&&m.return&&m.return()}finally{if(f)throw g}}this.notation.dropShadow(this.filterUrl),this.unselect()}},{key:"getClientPoints",value:function(){var e=[],t=this.calcLine(this.worldPositions[0],this.worldPositions[1]),i=this.calcLine(this.worldPositions[1],this.worldPositions[2]);return t.length>0&&e.push(t[0],t[1]),i.length>0&&(e.length>0?e.push(i[1]):e.push(i[0],i[1])),e}},{key:"getArcData",value:function(e,t,i){if(!e||!t||!i)return!1;var e=new Vector2(e.x,e.y),t=new Vector2(t.x,t.y),i=new Vector2(i.x,i.y),n=1,o=e.sub(t),r=i.sub(t);if(o.length()<25||r.length()<25)return!1;o.setLength(25),r.setLength(25);var a=o.angle(),s=r.angle(),l=180*(s-a)/Math.PI;return l<0&&(l+=360),n=l<180?1:0,{pointA:t.clone().add(o),pointB:t.clone().add(r),flag:1,direction:n}}},{key:"getMeasureResult",value:function(){var e=(this.measureParams.unit,this.measureAngle.toString());return MeasureResultFormat.formatPrecision(e,this.measureParams.precision).split(",").join("")+"°"}}]),t}(MeasureDrawable),Viewer3dElevation=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.elevationPoint=i.points[0],o.setMeasureParams({precision:i.precision,unit:i.unit,defaultUnit:i.defaultUnit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){if(this.viewer.isInViewFrustum(this.elevationPoint)){var e=new THREE.Vector3(this.elevationPoint.x,this.elevationPoint.y,this.elevationPoint.z);e=this.viewer.worldToClient(e);for(var t=[58,-12,-12,-12,0,0,12,-12],i="",n=0;n<t.length;n+=2)t[n]+=e.x,t[n+1]+=e.y,i+=t[n]+","+t[n+1]+" ";var o=MeasureUtil.makePolyline({color:this.defaultColor,width:2,points:i});this.svgGroup.push(o);var r=new THREE.Vector2(e.x,e.y),a=this.notation.drawAnnotation(r,this.getMeasureResult(),this.id),s=!0,l=!1,u=void 0;try{for(var c,h=a[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value;this.svgGroup.push(d)}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}this.notation.dropShadow(this.filterUrl),this.unselect()}}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.elevationPoint.z,i=t.toString(),n=MeasureResultFormat.formatDistance(i,this.measureParams);return n+=MeasureResultFormat.getPostFix(e,!1),n=n.split(",").join(""),0==n.split(" ")[0]&&(n="±"+n),n}},{key:"hitTest",value:function(e){var t=new THREE.Vector3(this.elevationPoint.x,this.elevationPoint.y,this.elevationPoint.z);t=this.viewer.worldToClient(t);var i=new THREE.Vector2(t.x-12,t.y-22),n=new THREE.Vector2(t.x+58,t.y-22);return MeasureUtil.distanceToSegment(e,i,n)<=22||this.notation.hitTest(e)}}]),t}(MeasureDrawable),Viewer3dMinDistanceLine=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.selectedComponentsId=i.points,o.worldPositions=[i.start,i.end],o.measureResult=i.distance,o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit,defaultUnit:i.defaultUnit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.calcLine(this.worldPositions[0],this.worldPositions[1]);this.hitTestSegments=e;for(var t=this.calcTerminalLines(e,Math.PI/3,8),i=0;i<t.length;i++){var n=[];n.push(t[i].start,e[i],t[i].end);var o=MeasureUtil.makePolyline({color:this.defaultColor,width:2,points:MeasureUtil.calcPolylinePoints(n)});this.svgGroup.push(o)}if(0===e.length)return void this.unselect();var r=MeasureUtil.makeLine({start:e[0],end:e[1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(r);var a={x:(this.worldPositions[0].x+this.worldPositions[1].x)/2,y:(this.worldPositions[0].y+this.worldPositions[1].y)/2,z:(this.worldPositions[0].z+this.worldPositions[1].z)/2},s=this.viewer.worldToClient(a);if(this.viewer.isInViewFrustum(a)){var l=this.notation.drawAnnotation({x:s.x,y:s.y},this.getMeasureResult(),this.id),u=!0,c=!1,h=void 0;try{for(var d,f=l[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var g=d.value;this.svgGroup.push(g)}}catch(e){c=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw h}}this.notation.dropShadow(this.filterUrl),this.unselect()}}},{key:"actionWhenSelected",value:function(){var e=this;this.selectedComponentsId.forEach(function(t){(t.modelId?e.viewer.getModel(t.modelId):e.viewer).addSelectedComponentsById([t.userId])}),this.viewer.render()}},{key:"actionWhenUnselected",value:function(){var e=this;this.selectedComponentsId.forEach(function(t){(t.modelId?e.viewer.getModel(t.modelId):e.viewer).removeSelectedId([t.userId])}),this.viewer.render()}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat.formatDistance(t,this.measureParams);return i+=MeasureResultFormat.getPostFix(e,!1),i.split(",").join("")}}]),t}(MeasureDrawable),MeasureResultFormat$1=function e(){_classCallCheck(this,e)};MeasureResultFormat$1.formatDistance=function(e,t){if(void 0==e)return null;var i=t.precision,n=t.scale||1,o=t.unit,r=t.defaultUnit,a=1;return"Centimeter"===o?a=10:"Meter"===o?a=1e3:"Kilometer"===o&&(a=1e6),"m"===r&&(n*=1e3),e*=n,e/=a,this.formatPrecision(e,i)},MeasureResultFormat$1.formatArea=function(e,t){var i=t.precision,n=t.scale,o=t.unit,r=t.defaultUnit,a=1;return"Centimeter"===o?a=100:"Meter"===o?a=1e6:"Kilometer"===o&&(a=1e13),"m"===r&&(n*=1e3),e*=Math.pow(n,2),e/=a,this.formatPrecision(e,i)},MeasureResultFormat$1.getPostFix=function(e,t){if("None"===e)return"";var i={None:"",Kilometer:"km",Meter:"m",Centimeter:"cm",Millimeter:"mm"},n=i[e];return t?n+="²":n=" "+n,n},MeasureResultFormat$1.toLocaleString=function(e){var t=e.toString(),i=/\d{1,3}(?=((\d{3})+(\.\d+)?)$)/g;return t=t.replace(i,"$&,")},MeasureResultFormat$1.formatPrecision=function(e,t){if(e=parseInt(Math.round(e*Math.pow(10,t)))/Math.pow(10,t),0!=t){var i=e.toFixed(t).split(".");e=i[0]+"."+i[1]}else e=this.toLocaleString(e);return e};var MeasureArea=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.worldPositions=i.points,o.measureResult=i.area,o.boundaryPoints=[],o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=new Box2,t=this.worldPositions,i="";this.boundaryPoints=[];for(var n=0;n<=t.length;n++){var o=this.worldToClient(t[n%t.length]),r=MeasureUtil.makeCircle({position:o,radius:this.radius,strokeWidth:this.strokeWidth,color:this.defaultColor});this.svgGroup.push(r),r.setAttribute("filter",this.filterUrl),this.unSelectElements.push(r),this.boundaryPoints.push(o),e.expandByPoint(new Vector2(o.x,o.y)),i+=o.x+","+o.y+" "}var a=MeasureUtil.makePolyline({color:this.defaultColor,fillColor:this.defaultColor,width:2,points:i});a.setAttribute("fill-opacity",.2),this.svgGroup.insert(0,a);var s=e.getCenter(),l=this.notation.drawAnnotation(s,this.getMeasureResult()),u=!0,c=!1,h=void 0;try{for(var d,f=l[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var g=d.value;this.svgGroup.push(g)}}catch(e){c=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw h}}this.notation.dropShadow(this.filterUrl),this.unselect(),!this.isShow&&this.hide()}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat$1.formatArea(t,this.measureParams);return i+=MeasureResultFormat$1.getPostFix(e,!0),i.split(",").join("")}},{key:"worldToClient",value:function(e){var t=[],i=this.viewer.getViewer();return t=e.isActiveLayoutElement?i.toScreenPoint(e.point):i.toViewportScreenPoint(e.point),{x:t[0],y:t[1]}}},{key:"setViewId",value:function(e){this.viewId=e}},{key:"getViewId",value:function(){return this.viewId}},{key:"hitTest",value:function(e){var t=this.boundaryPoints;return MeasureUtil.isPointInPolygon(e,t)}}]),t}(MeasureDrawable),DrawingDistance=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return o.filterUrl=i.filterUrl,o.startPoint=new Vector2(i.start[0],i.start[1]),o.endPoint=new Vector2(i.end[0],i.end[1]),o.measureResult=i.distance,o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit}),o.isOnLayoutMeasure=i.isOnLayout,o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.calAuxLines(),t=[];t.push(e[0].start,e[1].end),this.hitTestSegments=t;var i=this.calcTerminalLines(t,Math.PI/2,6.5);this.attachSingleLine(t),this.attachTerminalLines(i);var n=["#7CCF21","#CC021B"];this.attachAuxLines(e,n),this.attachTerminalPoints(t),this.attachNotation(t),this.notation.dropShadow(this.filterUrl),this.unselect(),!this.isShow&&this.hide()}},{key:"attachNotation",value:function(e){if(0!==e.length){var t=this.notation.drawAnnotation({x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},this.getMeasureResult(),this.id),i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;this.svgGroup.push(s)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}}},{key:"calAuxLines",value:function(){var e=[],t=this.startPoint.clone(),i=this.endPoint.clone(),n={x:i.x,y:t.y};e.push(t,n,i);for(var o=[],r=0;r<e.length-1;r++){var a=this.worldToClient(e[r]),s=this.worldToClient(e[r+1]);o.push({start:new Vector2(a.x,a.y),end:new Vector2(s.x,s.y)})}return o}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat$1.formatDistance(t,this.measureParams);return i+=MeasureResultFormat$1.getPostFix(e,!1),i.split(",").join("")}},{key:"worldToClient",value:function(e){if(this.isOnLayoutMeasure){var t=this.viewer.getViewer().toViewportScreenPoint([e.x,e.y]);return{x:t[0],y:t[1]}}return this.viewer.worldToClient(e)}},{key:"setViewId",value:function(e){this.viewId=e}},{key:"getViewId",value:function(){return this.viewId}}]),t}(Viewer3dDistance),DrawingAngle=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return o.isOnLayoutMeasure=i.isOnLayout,o}return _inherits(t,e),_createClass(t,[{key:"getClientPoints",value:function(){for(var e=[],t=0;t<this.worldPositions.length;t++){var i=new Vector2$1(this.worldPositions[t][0],this.worldPositions[t][1]),n=this.worldToClient(i);e.push(new Vector2$1(n.x,n.y))}return e}},{key:"worldToClient",value:function(e){if(this.isOnLayoutMeasure){var t=this.viewer.getViewer().toViewportScreenPoint([e.x,e.y]);return{x:t[0],y:t[1]}}return this.viewer.worldToClient(e)}},{key:"setViewId",value:function(e){this.viewId=e}},{key:"getViewId",value:function(){return this.viewId}}]),t}(Viewer3dAngle),ViewerGISPolylineDistance=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.worldPositions=i.points,o.measureResult={distance:i.distance,totalDistance:i.totalDistance},o.selectElements=[],o.unSelectElements=[],o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit,defaultUnit:i.defaultUnit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.worldPositions.length;if(!(e<2)){for(var t=1;t<e;t++){var i=this.calcLine(this.worldPositions[t],this.worldPositions[t-1]);0!==i.length&&(1===t&&this.hitTestSegments.push(i[0]),this.hitTestSegments.push(i[1]),this.attachSelectedTerminalPoints(i[0]),this.attachLines(i),this.attachSelectedTerminalPoints(i[1]),this.attachUnselectedTerminalPoints(i[0]),this.attachUnselectedTerminalPoints(i[1]))}this.attachNotations(),this.unselect()}}},{key:"attachSelectedTerminalPoints",value:function(e){var t=MeasureUtil.makeCircle({position:e,radius:this.radius,strokeWidth:0,color:this.defaultColor});this.svgGroup.push(t),t.setAttribute("filter",this.filterUrl),this.selectElements.push(t)}},{key:"attachLines",value:function(e){var t=MeasureUtil.makeLine({start:e[0],end:e[1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(t)}},{key:"attachUnselectedTerminalPoints",value:function(e){var t=MeasureUtil.makeCircle({position:e,radius:this.radius,strokeWidth:this.strokeWidth,color:this.defaultColor});this.svgGroup.push(t),t.setAttribute("filter",this.filterUrl),this.unSelectElements.push(t)}},{key:"attachNotations",value:function(){for(var e=this.worldPositions.length,t=this.getMeasureResult(),i=1;i<e;i++){var n={x:(this.worldPositions[i].x+this.worldPositions[i-1].x)/2,y:(this.worldPositions[i].y+this.worldPositions[i-1].y)/2,z:(this.worldPositions[i].z+this.worldPositions[i-1].z)/2},o=this.viewer.worldToClient(n);this.viewer.isInViewFrustum(n)&&this.attachNotation([o,o],t.distance[i-1])}var r={x:this.worldPositions[e-1].x,y:this.worldPositions[e-1].y,z:this.worldPositions[e-1].z},a=this.viewer.worldToClient(r);this.viewer.isInViewFrustum(r)&&this.attachNotation([a,a],"总长度："+t.totalDistance,!0),this.notation.dropShadow(this.filterUrl)}},{key:"attachNotation",value:function(e,t,i){if(0!==e.length){var n=this.notation.drawAnnotation({x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},t,this.id,i),o=!0,r=!1,a=void 0;try{for(var s,l=n[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value;this.svgGroup.push(u)}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}}}},{key:"getMeasureResult",value:function(){var e=this,t=this.measureParams.unit,i=this.measureResult,n=i.distance,o=(i.totalDistance,[]),r=0;return n.forEach(function(i){r+=i;var n=i.toString();n=MeasureResultFormat.formatDistance(n,e.measureParams),n+=MeasureResultFormat.getPostFix(t,!1),o.push(n)}),r=r.toString(),r=MeasureResultFormat.formatDistance(r,this.measureParams),r+=MeasureResultFormat.getPostFix(t,!1),{distance:o,totalDistance:r}}}]),t}(MeasureDrawable),ViewerGISPosition=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.positionPoint=i.points[0],o.measureResult={alt:i.altitude,lonLat:i.lonLat},o.innerRadius=3,o.innerStrokeWidth=2,o.outerRadius=7,o.outerStrokeWidth=1,o.selectElements=[],o.unSelectElements=[],o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit,defaultUnit:i.defaultUnit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){if(this.viewer.isInViewFrustum(this.positionPoint)){var e=new THREE.Vector3(this.positionPoint.x,this.positionPoint.y,this.positionPoint.z);e=this.viewer.worldToClient(e),this.attachSelectedCircle(e),this.attachUnselectedCircle(e);var t=new THREE.Vector2(e.x,e.y),i=this.notation.drawAnnotation(t,this.getMeasureResult(),this.id),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;this.svgGroup.push(l)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}this.notation.dropShadow(this.filterUrl),this.unselect()}}},{key:"attachSelectedCircle",value:function(e){var t=MeasureUtil.makeConcentricCircle({innerRadius:this.innerRadius,innerStrokeWidth:this.innerStrokeWidth,outerRadius:this.outerRadius,color:this.defaultColor,position:e});this.selectElements.push(t),this.svgGroup.push(t)}},{key:"attachUnselectedCircle",value:function(e){var t=MeasureUtil.makeConcentricCircle({innerRadius:this.innerRadius,innerStrokeWidth:this.innerStrokeWidth,outerRadius:this.outerRadius,outerStrokeWidth:this.outerStrokeWidth,color:this.defaultColor,position:e});this.unSelectElements.push(t),this.svgGroup.push(t)}},{key:"hitTest",value:function(e){var t=new THREE.Vector3(this.positionPoint.x,this.positionPoint.y,this.positionPoint.z);t=this.viewer.worldToClient(t);var i=new THREE.Vector2(t.x-12,t.y-22),n=new THREE.Vector2(t.x+58,t.y-22);return MeasureUtil.distanceToSegment(e,i,n)<=22||this.notation.hitTest(e)}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult,i=t.alt,n=t.lonLat,o=this.measureParams.precision,r=o.elevation,a=o.latLon,s={defaultUnit:this.measureParams.defaultUnit,precision:r,scale:this.measureParams.scale,unit:this.measureParams.unit},l=MeasureResultFormat.formatPrecision(n.latitude.toString(),a),u=MeasureResultFormat.formatPrecision(n.longitude.toString(),a),c=MeasureResultFormat.formatDistance(i.toString(),s);return c+=MeasureResultFormat.getPostFix(e,!1),"经度："+u+" ° \n纬度："+l+" ° \n高程："+c}}]),t}(MeasureDrawable),ViewerGISTriangleDistance=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.filterUrl=i.filterUrl,o.worldPositions=i.points,o.measureResult={distance:i.distance,horizontalDistance:i.horizontalDistance,verticalDistance:i.verticalDistance},o.selectElements=[],o.unSelectElements=[],o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit,defaultUnit:i.defaultUnit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){if(!(this.worldPositions.length<2)){var e=this.getMeasureResult();if(this.attachSegmentByTerminalPoints(this.worldPositions,e.distance),this.worldPositions[0].z!=this.worldPositions[1].z){var t=this.worldPositions[0].z<this.worldPositions[1].z?this.worldPositions[0]:this.worldPositions[1],i=this.worldPositions[0].z<this.worldPositions[1].z?this.worldPositions[1]:this.worldPositions[0],n=this.calcTrianglePoint(this.worldPositions);this.attachSegmentByTerminalPoints([t,n],e.verticalDistance),this.attachSegmentByTerminalPoints([i,n],e.horizontalDistance)}else this.attachSegmentByTerminalPoints([this.worldPositions[0],this.worldPositions[0]],e.horizontalDistance);this.notation.dropShadow(this.filterUrl),this.unselect()}}},{key:"calcTrianglePoint",value:function(e){if(e.length<2)return null;var t=new THREE.Vector3;return e[0].z<e[1].z?t.set(e[0].x,e[0].y,e[1].z):e[0].z>e[1].z&&t.set(e[1].x,e[1].y,e[0].z),t}},{key:"attachSegmentByTerminalPoints",value:function(e,t){var i=e[0],n=e[1],o=this.calcLine(i,n);this.hitTestSegments=this.hitTestSegments.concat(o),this.attachLine(o),this.attachSelectedTerminalPoints(o),this.attachUnselectedTerminalPoints(o);var r={x:(i.x+n.x)/2,y:(i.y+n.y)/2,z:(i.z+n.z)/2},a=this.viewer.worldToClient(r);this.viewer.isInViewFrustum(r)&&this.attachNotation([a,a],t)}},{key:"attachSelectedTerminalPoints",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=MeasureUtil.makeCircle({position:a,radius:this.radius,strokeWidth:0,color:this.defaultColor});this.svgGroup.push(s),s.setAttribute("filter",this.filterUrl),this.selectElements.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"attachLine",value:function(e){if(0!==e.length){var t=MeasureUtil.makeLine({start:e[0],end:e[1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(t)}}},{key:"attachUnselectedTerminalPoints",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=MeasureUtil.makeCircle({position:a,radius:this.radius,strokeWidth:this.strokeWidth,color:this.defaultColor});this.svgGroup.push(s),s.setAttribute("filter",this.filterUrl),this.unSelectElements.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"attachNotation",value:function(e,t){if(0!==e.length){var i=this.notation.drawAnnotation({x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},t,this.id),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;this.svgGroup.push(l)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}}}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult,i=t.distance,n=t.horizontalDistance,o=t.verticalDistance;return i=i.toString(),i=MeasureResultFormat.formatDistance(i,this.measureParams),i+=MeasureResultFormat.getPostFix(e,!1),n=n.toString(),n=MeasureResultFormat.formatDistance(n,this.measureParams),n+=MeasureResultFormat.getPostFix(e,!1),o=o.toString(),o=MeasureResultFormat.formatDistance(o,this.measureParams),o+=MeasureResultFormat.getPostFix(e,!1),{distance:i,horizontalDistance:n,verticalDistance:o}}}]),t}(MeasureDrawable),ViewerGISSpatialArea=function(e){function t(e,i,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i.type));return o.fillColor=new Glodon.Web.Graphics.Color(255,157,11,.2),o.filterUrl=i.filterUrl,o.worldPositions=i.points,o.measureResult=i.area,o.selectElements=[],o.unSelectElements=[],o.setMeasureParams({precision:i.precision,scale:i.scale,unit:i.unit,defaultUnit:i.defaultUnit}),o}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.worldPositions,t=e.length;if(!(t<3)&&this.areaFrontOfCamera(e)){this.attachArea(e);for(var i=0;i<t;i++){var n=this.viewer.worldToClient(e[i]);n=new Vector2(n.x,n.y),this.hitTestSegments.push(n),this.attachSelectedTerminalPoints(n),this.attachUnselectedTerminalPoints(n),i==t-1&&this.attachNotation(n,this.getNotationTitle()+"："+this.getMeasureResult())}this.unselect()}}},{key:"attachSelectedTerminalPoints",value:function(e){var t=MeasureUtil.makeCircle({position:e,radius:this.radius,strokeWidth:0,color:this.defaultColor});this.svgGroup.push(t),t.setAttribute("filter",this.filterUrl),this.selectElements.push(t)}},{key:"attachArea",value:function(e){var t=this,i="";e.forEach(function(e){var n=t.viewer.worldToClient(e);i+=n.x+","+n.y+" "});var n=MeasureUtil.makePolygon({points:i,width:this.lineWidth,color:this.defaultColor,fillColor:this.fillColor.getRGBA()});this.svgGroup.push(n)}},{key:"attachUnselectedTerminalPoints",value:function(e){var t=MeasureUtil.makeCircle({position:e,radius:this.radius,strokeWidth:this.strokeWidth,color:this.defaultColor});this.svgGroup.push(t),t.setAttribute("filter",this.filterUrl),this.unSelectElements.push(t)}},{key:"attachNotation",value:function(e,t){var i=this.notation.drawAnnotation({x:e.x,y:e.y},t,this.id,!0),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;this.svgGroup.push(l)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}}},{key:"getNotationTitle",value:function(){return BimfaceLanguage.bf_tip_measure_spatial_area}},{key:"areaFrontOfCamera",value:function(e){var t=this.viewer,i=t.getViewer(),n=new THREE.Plane(t.sceneToWorld(i.camera.getWorldDirection()).normalize());n.constant=-n.distanceToPoint(t.sceneToWorld(i.camera.position));for(var o=0;o<e.length;o++)if(n.distanceToPoint(e[o])<0)return!1;return!0}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString();return t=MeasureResultFormat.formatArea(t,this.measureParams),t+=MeasureResultFormat.getPostFix(e,!0)}}]),t}(MeasureDrawable),ViewerGISProjectedArea=function(e){function t(e,i,n){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n))}return _inherits(t,e),_createClass(t,[{key:"getNotationTitle",value:function(){return BimfaceLanguage.bf_tip_measure_projected_area}}]),t}(ViewerGISSpatialArea),MeasureItemFactory=function(){function e(t){_classCallCheck(this,e),this.viewer=t}return _createClass(e,[{key:"make",value:function(e,t,i){
var n=null,o="ViewerDrawing"===this.viewer.getViewerType();switch(e){case"Distance":n=o?new DrawingDistance(this.viewer,t,i):new Viewer3dDistance(this.viewer,t,i);break;case"Angle":n=o?new DrawingAngle(this.viewer,t,i):new Viewer3dAngle(this.viewer,t,i);break;case"MinimumDistance":n=new Viewer3dMinDistanceLine(this.viewer,t,i);break;case"Elevation":n=new Viewer3dElevation(this.viewer,t,i);break;case"Area":n=new MeasureArea(this.viewer,t,i);break;case"PolylineDistance":n=new ViewerGISPolylineDistance(this.viewer,t,i);break;case"Position":n=new ViewerGISPosition(this.viewer,t,i);break;case"TriangleDistance":n=new ViewerGISTriangleDistance(this.viewer,t,i);break;case"SpatialArea":n=new ViewerGISSpatialArea(this.viewer,t,i);break;case"ProjectedArea":n=new ViewerGISProjectedArea(this.viewer,t,i)}return n.initialize(),n}}]),e}(),SelectionControl=function(){function e(t,i){_classCallCheck(this,e),this.domContainer=t,this.measureItems=i,this.selectedItem=null,this.selectionChanged=null,this.hoverChanged=null,this.isEnableSelection=!0,this.mousedownHitItem=null,this.offset=t.getBoundingClientRect(),Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop()&&this.hookEvents()}return _createClass(e,[{key:"hookEvents",value:function(){var e=this;this.domContainer.addEventListener("mousemove",function(t){if(e.isEnableSelection){var i=new Vector2$1(t.clientX,t.clientY);i.x-=e.offset.left,i.y-=e.offset.top;var n=e.hitTest(i);e.hoverChanged(n),n?(e.domContainer.style.cursor="default",t.preventDefault(),t.stopPropagation()):e.domContainer.style.cursor=""}},!1),this.domContainer.addEventListener("mousedown",function(t){if(e.mousedownHitItem=null,e.isEnableSelection){var i=new Vector2$1(t.clientX,t.clientY);i.x-=e.offset.left,i.y-=e.offset.top;var n=e.hitTest(i);e.mousedownHitItem=n,n&&(n.getIsSelected()?(e.selectionChanged(null),e.setSelectedItem(null),n.unselect()):(e.selectionChanged(n),e.setSelectedItem(n),n.select()),t.preventDefault(),t.stopPropagation())}},!1),this.domContainer.addEventListener("mouseup",function(t){e.mousedownHitItem&&(t.preventDefault(),t.stopPropagation())},!1),this.domContainer.addEventListener("dblclick",function(){event.preventDefault(),event.stopPropagation()},!1)}},{key:"hitTest",value:function(e){for(var t=this.measureItems.length-1;t>=0;t--){var i=this.measureItems[t];if(i.getNotation().hitTest(e))return i}for(var t=this.measureItems.length-1;t>=0;t--){var n=this.measureItems[t];if(n.hitTest(e))return n}return null}},{key:"setSelectedItem",value:function(e){this.selectedItem&&(this.selectedItem.actionWhenUnselected(),this.selectedItem.unselect()),this.selectedItem=e,e&&e.actionWhenSelected()}},{key:"getSelectedItem",value:function(){return this.selectedItem}},{key:"hasSelected",value:function(){return null!==this.selectedItem}},{key:"setIsEnableSelection",value:function(e){this.isEnableSelection=e}}]),e}(),DropShadow=function(){function e(t){_classCallCheck(this,e),this.filterId=t.filterId,this.filterUnits=t.filterUnits,this.stdDeviation=t.stdDeviation,this.feOffset1=t.feOffset1,this.feOffset2=t.feOffset2,this.shadowOpacity=t.opacity,this.initialize()}return _createClass(e,[{key:"initialize",value:function(){var e=document.createElementNS(this.xmlns,"defs"),t=document.createElementNS(this.xmlns,"filter");t.setAttribute("id",this.filterId),t.setAttribute("filterUnits",this.filterUnits);var i=document.createElementNS(this.xmlns,"feGaussianBlur");i.setAttribute("in","SourceAlpha"),i.setAttribute("stdDeviation",this.stdDeviation),t.appendChild(i);var n=document.createElementNS(this.xmlns,"feOffset");n.setAttribute("dx",this.feOffset1.dx),n.setAttribute("dy",this.feOffset1.dy),n.setAttribute("result","offsetblur");var o=document.createElementNS(this.xmlns,"feOffset");o.setAttribute("dx",this.feOffset2.dx),o.setAttribute("dy",this.feOffset2.dy),o.setAttribute("result","offsetblur"),t.appendChild(n),t.appendChild(o);var r=document.createElementNS(this.xmlns,"feComponentTransfer"),a=document.createElementNS(this.xmlns,"feFuncA");a.setAttribute("type","linear"),a.setAttribute("slope",this.shadowOpacity),r.appendChild(a),t.appendChild(r);var s=document.createElementNS(this.xmlns,"feMerge"),l=document.createElementNS(this.xmlns,"feMergeNode"),u=document.createElementNS(this.xmlns,"feMergeNode");u.setAttribute("in","SourceGraphic");var c=document.createElementNS(this.xmlns,"feMergeNode");c.setAttribute("in","SourceGraphic"),s.appendChild(l),s.appendChild(u),s.appendChild(c),t.appendChild(s),e.appendChild(t),this.dropShadowDefs=e}},{key:"attach",value:function(e){this.dropShadowDefs||this.initialize(),e.appendChild(this.dropShadowDefs);var t=e.innerHTML;e.removeChild(this.dropShadowDefs),e.innerHTML=t}},{key:"getFilterUrl",value:function(){return"url(#"+this.filterId+")"}}]),e}(),MeasureItemManager=function(){function e(t,i,n){_classCallCheck(this,e),this.domContainer=t,this.viewer=i,this.measure=n,this.viewId=0,this.itemList=[],this.mapMeasureInfo={},this.initShadowManager(),this.drawableFactory=new MeasureItemFactory(i,n),this.hookViewer3DEvents()}return _createClass(e,[{key:"hookViewer3DEvents",value:function(){var e=this;this.selectionControl=new SelectionControl(this.domContainer,this.itemList),this.selectionControl.selectionChanged=function(t){if(t){var i=e.mapMeasureInfo[t.getId()];if(i.type=t.getType(),e.eventListener.fireEvent("MeasureSelected",i),e.bringToFront(t),e.itemClickCallback){var n=e.mapMeasureInfo[t.getId()];e.itemClickCallback(n)}}else e.eventListener.fireEvent("MeasureUnselected",{})},this.selectionControl.hoverChanged=function(t){t?(e.measure.disableMeasureCursor(),e.measure.setIsEnableSnap(!1)):t&&!e.measure.isMeasureOpen()||(e.measure.enableMeasureCursor(),e.measure.setIsEnableSnap(!0))},this.viewer.addEventListener("Rendered",function(){e.update()}),document.addEventListener("keyup",function(t){if(46===t.keyCode){var i=e.selectionControl.getSelectedItem();i&&(e.eventListener.fireEvent("MeasureSelected",{type:i.getType(),isDataEmpty:!0}),e.removeItemById(i.getId()),e.selectionControl.setSelectedItem(null))}}),this.viewer.addEventListener("ButtonOnToolbarClicked",function(t){if("LeftSubToolbar"===t.id&&(e.selectionControl.setSelectedItem(null),e.showExclusiveByViewId(t.viewId),e.viewId=t.viewId),"Measure"===t.id){var i=e.selectionControl.getSelectedItem();if(t.isChecked){if(e.showAll(),i){var n=e.mapMeasureInfo[i.getId()];n.type=i.getType(),i&&i.actionWhenSelected(),e.eventListener.fireEvent("MeasureSelected",n)}}else e.hideAll(),i&&i.actionWhenUnselected()}})}},{key:"addItem",value:function(e){var t=e.type,i=e.id;if(!this.mapMeasureInfo[i]){this.mapMeasureInfo[i]=e,e.filterUrl=this.dropShadowManager.getFilterUrl(),e=Object.assign(e,this.measure.getMeasureParams());var n=this.drawableFactory.make(t,e,i,this.measure);"ViewerDrawing"===this.viewer.getViewerType()&&n.setViewId(this.viewId),n.attach(this.domContainer),n.select(),this.selectionControl.setSelectedItem(n),this.itemList.push(n)}}},{key:"removeItemById",value:function(e){this.mapMeasureInfo[e]&&delete this.mapMeasureInfo[e];for(var t=0;t<this.itemList.length;t++)if(this.itemList[t].getId()===e){this.itemList[t].clear(),this.itemList.splice(t,1);break}}},{key:"update",value:function(){this.clear();var e=!0,t=!1,i=void 0;try{for(var n,o=this.itemList[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;r.initialize(),r.attach(this.domContainer),r.dropShadow(this.dropShadowManager.getFilterUrl())}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.selectionControl.hasSelected()&&this.selectionControl.getSelectedItem().select()}},{key:"clear",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.itemList[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){o.value.clear()}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}e&&(this.itemList.length=0,this.selectionControl.setSelectedItem(null),this.eventListener.fireEvent("MeasureUnselected",{}),this.mapMeasureInfo={})}},{key:"unselctedAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.itemList[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.unselect()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.selectionControl.selectedItem=null}},{key:"hideAll",value:function(){this.domContainer.style.display="none"}},{key:"showAll",value:function(){this.domContainer.style.display="block",this.update()}},{key:"onClick",value:function(e){e&&(this.itemClickCallback=e)}},{key:"save",value:function(){var e=[],t=Object.keys(this.mapMeasureInfo),i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;e.push(this.mapMeasureInfo[s])}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}return e}},{key:"load",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addItem(i)}this.unselctedAll()}},{key:"setEventListener",value:function(e){var t=this;this.eventListener=e,this.eventListener.addEvent("Measuring",function(){t.selectionControl.setSelectedItem(null),t.setIsEnableSelection(!1)}),this.eventListener.addEvent("Measured",function(){t.setIsEnableSelection(!0)}),this.eventListener.addEvent("Reset",function(){t.setIsEnableSelection(!0)}),this.eventListener.addEvent("MeasureParamsUpdated",function(){t.measure.measureItem&&t.measure.measureItem.setMeasureParams(t.measure.getMeasureParams());var e=!0,i=!1,n=void 0;try{for(var o,r=t.itemList[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var a=o.value,s=t.measure.getMeasureParams(a.type);a.setMeasureParams(s);a.id;t.mapMeasureInfo[a.id].precision=s.precision,t.mapMeasureInfo[a.id].scale=s.scale,t.mapMeasureInfo[a.id].unit=s.unit}}catch(e){i=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(i)throw n}}if(t.update(),t.selectionControl.hasSelected()){var l=t.selectionControl.getSelectedItem(),u=t.mapMeasureInfo[l.getId()];u.type=l.getType(),t.eventListener.fireEvent("MeasureSelected",u)}})}},{key:"bringToFront",value:function(e){for(var t=0;t<this.itemList.length;t++)if(this.itemList[t].getId()===e.getId()){this.itemList.splice(t,1);break}e.detach(),this.itemList.push(e),e.attach(this.domContainer)}},{key:"initShadowManager",value:function(){this.dropShadowManager=new DropShadow({filterId:"dropShadow",filterUnits:"userSpaceOnUse",stdDeviation:"2",feOffset1:{dx:5,dy:5},feOffset2:{dx:-5,dy:-5},opacity:"0.3"}),this.dropShadowManager.attach(this.domContainer)}},{key:"getSelectedItem",value:function(){return this.selectionControl.getSelectedItem()}},{key:"showExclusiveByViewId",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.itemList[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;a.getViewId()===e?a.show():a.hide()}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"setIsEnableSelection",value:function(e){this.selectionControl.setIsEnableSelection(e)}}]),e}();!function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=null,n=[],o=null,r=null,a=function(e){var i=e.viewer,n=this,o=new Glodon$1.Web.Lang.EventManager,r=t.create("div","bf-measure-conext");n.isOpen=!1,i.addEventListener("Rendered",function(){n.isOpen&&n.update()}),this.context={rootDomElement:r},this._opt=e,this.getEventManager=function(){return o},this.isEnableSnap=!0;var a=i.getViewer();a.registerEventListener(CLOUD$1.EVENTS.ON_MEASURE_PICK,function(e){n.isOpen&&n.measureByPoint(e)}),a.registerEventListener(CLOUD$1.EVENTS.ON_MEASURE_RESET,function(e){n.isOpen&&(n.measureItem.reset(),n.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset))})};a.prototype={init:function(){var e=this,i=e.context,n=e._opt.viewer;n.getDomElement().appendChild(i.rootDomElement),n.getModels().forEach(function(e){e.setSelectedComponentsById()});var o=t.createNS("svg","bf-measure-svg"),r=t.createNS("svg","bf-measure-svg"),a=t.create("div","bf-measure-text");i.rootDomElement.innerHTML="",i.rootDomElement.appendChild(o),i.rootDomElement.appendChild(r),this.drawableManager=new MeasureItemManager(r,n,this),this.drawableManager.setEventListener(this.getEventManager()),this.switchOn(),i.svg=o,i.text=a,n.render()},enableMeasureCursor:function(){this._opt.viewer.getDomElement().style.cursor="url("+Cursor.measure+"),auto"},disableMeasureCursor:function(){this._opt.viewer.getDomElement().style.cursor=""},activeByMeasureType:function(){Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop()||this.drawableManager.clear(!0),this.enableMeasureCursor();var e=this._opt.viewer,t=e.getViewer();t.editorManager.enableTool(t,CLOUD$1.EditToolMode.PICK_BY_MEASURE);var i,n=new Glodon$1.Bimface.Plugins.Measure.MeasureItemConfig;switch(n=Object.assign(n,this._opt),this.type){case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Distance:i=new Glodon$1.Bimface.Plugins.Measure.MeasureDistanceItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Angle:i=new Glodon$1.Bimface.Plugins.Measure.MeasureAngleItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance:n.cloudViewer=t,i=new Glodon$1.Bimface.Plugins.Measure.MeasureMinimumDistanceItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Elevation:i=new Glodon$1.Bimface.Plugins.Measure.MeasureElevationItem(n)}this.measureItem=i},switchOn:function(){this.isOpen||(this.activeByMeasureType(),this.isOpen=!0,this.drawableManager.setIsEnableSelection(!0))},switchOff:function(){if(this.isOpen){var e=this,t=e._opt.viewer,i=t.getViewer();this.disableMeasureCursor(),i.editorManager.disableTool(CLOUD$1.EditToolMode.PICK_BY_MEASURE),e.reset(),e.measureItem=null,this.isOpen=!1,this.drawableManager.setIsEnableSelection(!1)}},measureByPoint:function(e){var t=this,a=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop(),s=t.measureItem;if(e)if(i=e.pickPoint?e.pickPoint:null,e.pickPlane?(o="Panel",r=e.normal):e.pickLine?(o="Line",n=e.pickLine):o=e.pickPoint?"Point":null,e.pick&&e.pickPoint){var l=this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Elevation,u=this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance;l?(s.redo(),s.addPoint(e.pickPoint),s.draw(this.context)):u&&e.userId?s.addPoint({userId:e.userId,modelId:e.modelId}):(s.addPoint(e.pickPoint),t.update());var c=s.getPoints();c.length==s.maxPointsNum?(a||this.drawableManager.clear(!0),this.drawableManager.addItem(this.getInfo()),a||this.drawableManager.unselctedAll(),this.measureItem.setIsReserverd(!0),t.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measured,t.getInfo()),s.reset(!1)):(a||this.drawableManager.clear(!0),t.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measuring,t.getInfo()))}else this.isEnableSnap&&t.update()},measureMinimum:function(){},reset:function(){this.isOpen&&(this.measureItem.reset(),this.context.svg.innerHTML="",this.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset))},setIsEnableSnap:function(e){e||(this.context.svg.innerHTML=""),this.isEnableSnap=e},update:function(){var e=this.measureItem,t=this.context,a=this._opt.viewer,s=a.getDomElement(),l=s.getBoundingClientRect(),u=a.getViewer(),c=e.getPoints(),h=[],d=[];if(this.context.svg.innerHTML="",i?(t.hoverPosition=a.worldToClient(i),t.hoverPositionDS=u.getScene().worldToDrawing(i),0!=c.length&&(h=c.concat([i]))):(t.hoverPosition=null,0!=c.length&&(h=c.concat(c[c.length-1]))),t.hoverObjectType=o,"Line"==o&&2==n.length){t.lineStartPoint=a.worldToClient(n[0]),t.lineEndPoint=a.worldToClient(n[1]);var f=new THREE.Vector2(t.lineStartPoint.x,t.lineStartPoint.y),g=new THREE.Vector2(t.lineEndPoint.x,t.lineEndPoint.y),v=new THREE.Box2;v.min.set(s.clientLeft,s.clientTop),v.max.set(v.min.x+s.clientWidth,v.min.y+s.clientHeight);var m=!v.containsPoint(f),p=!v.containsPoint(g),y={start:f,end:g},w=CLOUD$1.CameraUtil.lineIntersectWithRect(y,v);if(m&&p)2==w.length&&(t.lineStartPoint=w[0],t.lineEndPoint=w[1]);else if(m||p)for(var b=new THREE.Vector2(t.hoverPosition.x,t.hoverPosition.y),C=m?g.clone():f.clone(),x=C.clone().sub(b).normalize(),E=0;E<w.length;E++){var k=C.clone().sub(w[E]).normalize();if(k.dot(x)>0){t.lineStartPoint=C,t.lineEndPoint=w[E];break}}}if("Panel"==t.hoverObjectType){t.normal=u.getScene().worldToDrawing(r),t.normal.normalize();var P=u.cameraControl,_=new THREE.Plane;_.setFromNormalAndCoplanarPoint(t.normal,t.hoverPositionDS);var M=new THREE.Vector2(t.hoverPosition.x-10,t.hoverPosition.y-10),I=new THREE.Vector2(t.hoverPosition.x+10,t.hoverPosition.y-10),S=t.hoverPositionDS,B=P.getRaycaster(M.x,M.y),f=B.ray.intersectPlane(_);B=P.getRaycaster(I.x,I.y);var g=B.ray.intersectPlane(_);if(null==f||null==g)return;var D=new THREE.Vector3(1,0,0),T=new THREE.Vector3(0,1,0),A=new THREE.Vector3(0,0,1),L=Math.abs(t.normal.clone().dot(D))<=.0025,O=Math.abs(t.normal.clone().dot(A))<=.0025;if(L&&O)var G=D.clone(),R=A.clone();else var V=T.clone(),G=V.cross(t.normal).normalize(),R=t.normal.clone().cross(G).normalize();var N=f.distanceTo(g)/2,U=G.clone().multiplyScalar(N),H=R.clone().multiplyScalar(N),W=S.clone().sub(U).add(H),$=S.clone().add(U).add(H),z=S.clone().sub(U).sub(H),j=S.clone().add(U).sub(H),F=[];F.push(W,$,j,z);for(var X=[],Y=P.getContainerDimensions(),Z=0;Z<F.length;Z++){var q=CLOUD$1.CameraUtil.drawingToCanvas(P.camera,F[Z],Y.width,Y.height);X.push(new THREE.Vector3(q.x,q.y,0))}t.clientPts=X}for(var E=0;E<h.length-1;E++){var J=u.worldPointsToClient(h[E],h[E+1]);if(J){var K={x:J.start.x-l.left,y:J.start.y-l.top};d.push(K)}}if(this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Distance&&c.length==e.maxPointsNum){for(var Q={x:c[1].x,y:c[0].y,z:c[0].z},ee={x:c[1].x,y:c[1].y,z:c[0].z},te=[],ie=[c[0],Q,ee,c[1]],Z=0;Z<ie.length-1;Z++){var J=u.worldPointsToClient(ie[Z],ie[Z+1]);J&&(J.start.x-=l.left,J.start.y-=l.top,J.end.x-=l.left,J.end.y-=l.top),te.push(J)}t.auxLines=te}t.clientPoints=d,e.draw(t)},getInfo:function(){var e={},t=this.measureItem,i=this._opt.viewer,n=t.getPoints();if(e.type=this.type,e.id=Glodon$1.Web.Lang.Utility.UUID.createUUID(),this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance){if(2==n.length){var o=i.getMinimumComponentDistanceById("["+n[0].modelId+"]"+n[0].userId,"["+n[1].modelId+"]"+n[1].userId);e.distance=o.minDistance,e.start=o.start,e.end=o.end}e.points=n}else if(e.points=n,e.type=this.type,this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Distance)n&&2==n.length&&(e.distanceX=Math.abs(n[1].x-n[0].x),e.distanceY=Math.abs(n[1].y-n[0].y),e.distanceZ=Math.abs(n[1].z-n[0].z),e.distance=Math.sqrt(Math.pow(e.distanceX,2)+Math.pow(e.distanceY,2)+Math.pow(e.distanceZ,2)));else if(3==n.length){var r=new THREE.Vector3(n[0].x-n[1].x,n[0].y-n[1].y,n[0].z-n[1].z),a=new THREE.Vector3(n[2].x-n[1].x,n[2].y-n[1].y,n[2].z-n[1].z),s=r.angleTo(a);e.angle=180*s/Math.PI}return e},redo:function(){this.measureItem.redo(),this.update(),this.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measuring,this.getInfo())},exit:function(){this.switchOff()},isMeasureOpen:function(){return this.isOpen},getDefaultUnit:function(){return this._opt.viewer._defaultUnit}},e.MeasureViewer3D=a}(),function(){var e="Bimface.Plugins.Measure.MeasureDrawing",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),o=function(e){var t=this,i=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop();this.isOpen=!1;var o=e.viewer,r=o.getViewer();this.viewer=o,this.viewerDrawing=r,this.domElement=o.getDomElement();var a=new Glodon$1.Web.Lang.EventManager,s=this;this.getEventManager=function(){return a},o.setSnapDistance(e.snapDistance);var l=n.createNS("svg","bf-measure-svg");l.style.position="absolute",l.style.left=0,l.style.top=0,l.style.width="100%",l.style.height="100%",r.dom.appendChild(l),this.drawableManager=new MeasureItemManager(l,o,this),this.drawableManager.setEventListener(a),o.addEventListener("Measured",function(e){if(e){i||t.drawableManager.clear(!0),e.id=Glodon$1.Web.Lang.Utility.UUID.createUUID(),t.drawableManager.addItem(e),i||t.drawableManager.unselctedAll();var n=e.type,o=e.type,r=e.id,a=e.points,l={type:o,id:r,points:a};l[n.toLowerCase()]=e[n.toLowerCase()],l.type=n,s.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measured,l)}}),o.addEventListener("Measuring",function(e){i||t.drawableManager.clear(!0),e.id=Glodon$1.Web.Lang.Utility.UUID.createUUID(),s.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measuring,e)}),o.addEventListener("Reset",function(){t.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset)})};o.prototype={init:function(i){t.send(e,"init");var n=this;i&&(n._callback=i),this.switchOn()},activeByMeasureType:function(){Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop()||this.drawableManager.clear(!0),this.viewerDrawing.mouseEditorMgr.activeEditorByName(this.type+"Measure")},switchOn:function(){t.send(e,"switchOn"),this.isOpen||(this.isOpen=!0,this.enableMeasureCursor(),this.activeByMeasureType(),this.drawableManager.setIsEnableSelection(!0))},enableMeasureCursor:function(){this.domElement.firstElementChild.style.cursor="url("+Cursor.measure+"),auto"},disableMeasureCursor:function(){this.domElement.firstElementChild.style.cursor=""},switchOff:function(){t.send(e,"switchOff"),this.isOpen&&(this.isOpen=!1,this.disableMeasureCursor(),this.measureItem=null,this.viewerDrawing.mouseEditorMgr.activeEditorByName("pick"),this.drawableManager.setIsEnableSelection(!1))},reset:function(){t.send(e,"reset");var i=this.viewerDrawing.mouseEditorMgr.getEditor();i.reset&&i.reset(),this.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset),this.viewerDrawing.update()},update:function(){t.send(e,"update")},exit:function(){t.send(e,"exit"),this.switchOff()},isMeasureOpen:function(){return this.isOpen},setIsEnableSnap:function(e){var t=this.viewerDrawing.mouseEditorMgr.getEditor();t.setIsEnableSnap&&t.setIsEnableSnap(e)},getDefaultUnit:function(){return null}},i.MeasureDrawing=o}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),new Glodon$1.Web.Graphics.Color(17,218,183,.2),function(e){t.MeasureItem.call(this,e),this.measureEnd=!1,this.maxPointsNum=1/0,this.minPointsNum=2});e.Type.inheritPrototype(i,t.MeasureItem);var n={reset:function(){if(this.measurePoints=[],this.measureEnd=!1,this.maxPointsNum=1/0,this._svg){for(var e=this._svg.childNodes,t=e.length,i=t-1;i>-1;i--)this._svg.removeChild(e[i]);this._svg.innerHTML=""}},addPoint:function(e){if(this.hoverPositionUpdated=!1,!0===this.measureEnd&&this.measurePoints.length!=this.maxPointsNum)return void(this.maxPointsNum=this.measurePoints.length);if(this.measurePoints.length==this.maxPointsNum)this.reset();else if(this.measurePoints.length>0){var t=this.measurePoints.length,i=this.measurePoints[t-1];if(e.x===i.x&&e.y===i.y&&e.z===i.z)return}this.measurePoints.push(e),this.setIsReserverd(!1)},draw:function(e,t){if(this.measureResult=t,this._svg=e.svg,this.drawCaptureItem(e),!this.getIsReserverd())switch(e.clientPoints.length){case 0:break;case 1:this.getMeasureResult();this.drawTerminalPoint(e.clientPoints[0]),e.hoverPosition&&this.drawLine([e.clientPoints[0],e.hoverPosition]),this.drawNotations();break;default:for(var i=1;i<e.clientPoints.length;i++)this.drawTerminalPoint(e.clientPoints[i-1]),this.drawLine([e.clientPoints[i-1],e.clientPoints[i]]),this.drawTerminalPoint(e.clientPoints[i]),e.hoverPosition&&i==e.clientPoints.length-1&&this.drawLine([e.clientPoints[i],e.hoverPosition]);this.drawNotations()}},drawNotations:function(){var e=[].concat(_toConsumableArray(this.measurePoints));this.hoverPositionUpdated&&this.nextMeasurePoint&&e.push(this.nextMeasurePoint);for(var t=e.length,i=this.getMeasureResult(),n=1;n<t;n++){var o={x:(e[n].x+e[n-1].x)/2,y:(e[n].y+e[n-1].y)/2,z:(e[n].z+e[n-1].z)/2},r=this.viewer.worldToClient(o);this.viewer.isInViewFrustum(o)&&this.drawNotation([r,r],i.distance[n-1])}var a={x:e[t-1].x,y:e[t-1].y,z:e[t-1].z},s=this.viewer.worldToClient(a);this.viewer.isInViewFrustum(a)&&this.drawNotation([s,s],"总长度："+i.totalDistance,!0),this.notation.dropShadow(this.filterUrl)},getMeasureResult:function(){var e=this,t=this.measureParams.unit,i=this.measureResult,n=i.distance,o=(i.totalDistance,[]),r=0;return n.forEach(function(i){r+=i;var n=i.toString();n=MeasureResultFormat.formatDistance(n,e.measureParams),n+=MeasureResultFormat.getPostFix(t,!1),o.push(n)}),r=r.toString(),r=MeasureResultFormat.formatDistance(r,this.measureParams),r+=MeasureResultFormat.getPostFix(t,!1),{distance:o,totalDistance:r}}};i.prototype=Object.assign(i.prototype,n),t.MeasurePolylineDistanceItem=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=function(e){t.MeasureItem.call(this,e),this.viewer=e.viewer,this.maxPointsNum=1;var n=new Glodon$1.Web.Graphics.Color(17,218,183,.2),o=i.createNS("circle","bf-measure-handle");o.setAttribute("r",e.width),o.setAttribute("fill",n.getRGB()),o.style.fill=n.getRGB();var r=i.createNS("line","bf-measure-line");r.style.strokeWidth=2,r.style.stroke=n.getRGB();var a=i.createNS("polygon","bf-measure-rect");a.setAttribute("fill",n.getRGBA()),a.setAttribute("stroke",n.getRGB()),a.setAttribute("stroke-width",1),this.hoverLine=r,this.hoverPoint=o,this.hoverPanel=a,this.hoverPanelSize={width:20,height:20}};e.Type.inheritPrototype(n,t.MeasureItem);var o={draw:function(e){this.drawCaptureItem(e)}};n.prototype=Object.assign(n.prototype,o),t.MeasurePositionItem=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),new Glodon$1.Web.Graphics.Color(17,218,183,.2),function(e){t.MeasureItem.call(this,e)});e.Type.inheritPrototype(i,t.MeasureItem);var n={draw:function(e,t){var i=this.measurePoints,n=this.nextMeasurePoint;if(this._svg=e.svg,this.measureResult={distance:t.distance,horizontalDistance:t.horizontalDistance,verticalDistance:t.verticalDistance},this.drawCaptureItem(e),!this.getIsReserverd()&&0!=i.length){var o=i.concat([n]),r=this.getMeasureResult(),a=this.calcLine(o[0],o[1]);if(this.drawTerminalPoint(a[0]),this.drawBorderlineByPoints(o,r.distance),o[0].z!=o[1].z){var s=o[0].z<o[1].z?o[0]:o[1],l=o[0].z<o[1].z?o[1]:o[0],u=this.calcTrianglePoint(o);this.drawBorderlineByPoints([s,u],r.verticalDistance),this.drawBorderlineByPoints([l,u],r.horizontalDistance)}else this.drawBorderlineByPoints([o[0],o[0]],r.horizontalDistance)}},calcTrianglePoint:function(e){if(e.length<2)return null;var t=new THREE.Vector3;return e[0].z<e[1].z?t.set(e[0].x,e[0].y,e[1].z):e[0].z>e[1].z&&t.set(e[1].x,e[1].y,e[0].z),t},drawBorderlineByPoints:function(e,t){var i=e[0],n=e[1],o=this.calcLine(i,n);this.drawLine(o);var r={x:(i.x+n.x)/2,y:(i.y+n.y)/2,z:(i.z+n.z)/2},a=this.viewer.worldToClient(r);this.viewer.isInViewFrustum(r)&&this.drawNotation([a,a],t)},drawNotation:function(e,t){if(0!==e.length){var i=this.notation.drawAnnotation({x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},t,this.id),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;this._svg.appendChild(l)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}}},getMeasureResult:function(){var e=this.measureParams.unit,t=this.measureResult,i=t.distance,n=t.horizontalDistance,o=t.verticalDistance;return i=i.toString(),i=MeasureResultFormat.formatDistance(i,this.measureParams),i+=MeasureResultFormat.getPostFix(e,!1),n=n.toString(),n=MeasureResultFormat.formatDistance(n,this.measureParams),n+=MeasureResultFormat.getPostFix(e,!1),o=o.toString(),o=MeasureResultFormat.formatDistance(o,this.measureParams),o+=MeasureResultFormat.getPostFix(e,!1),{distance:i,horizontalDistance:n,verticalDistance:o}}};i.prototype=Object.assign(i.prototype,n),t.MeasureTriangleDistanceItem=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),new Glodon$1.Web.Graphics.Color(17,218,183,.2),function(e){t.MeasureItem.call(this,e),this.measureEnd=!1,this.minPointsNum=3,this.maxPointsNum=1/0});e.Type.inheritPrototype(i,t.MeasureItem);var n={addPoint:function(e){if(!0===this.measureEnd&&this.measurePoints.length!=this.maxPointsNum)return void(this.maxPointsNum=this.measurePoints.length);if(this.measurePoints.length==this.maxPointsNum)this.measureEnd=!1,this.maxPointsNum=1/0,this.measurePoints=[],this.reset();else if(this.measurePoints.length>0){var t=this.measurePoints.length,i=this.measurePoints[t-1];if(e.x===i.x&&e.y===i.y&&e.z===i.z)return}this.measurePoints.push(e),this.setIsReserverd(!1)},reset:function(){if(this.measurePoints=[],this.measureEnd=!1,this.maxPointsNum=1/0,this._svg){for(var e=this._svg.childNodes,t=e.length,i=t-1;i>-1;i--)this._svg.removeChild(e[i]);this._svg.innerHTML=""}},draw:function(e,t){if(this.measureResult=t.area,this._svg=e.svg,this.drawCaptureItem(e),!this.getIsReserverd())switch(e.clientPoints.length){case 0:break;case 1:if(e.hoverPosition){var i=MeasureUtil.makeLine({start:e.clientPoints[0],end:e.hoverPosition,color:this.measureItemConfig.color.getRGBA(),lineWidth:this.measureItemConfig.width});e.svg.appendChild(i)}var n=MeasureUtil.makeCircle({strokeWidth:2,color:this.measureItemConfig.color.getRGBA(),radius:5,position:e.clientPoints[0]});n.setAttribute("filter",this.filterUrl),e.svg.appendChild(n);break;default:this.drawArea(e.clientPoints,e.hoverPosition),this.drawNotation(e.hoverPosition,this.getNotationTitle()+"："+this.getMeasureResult())}},drawArea:function(e,t){var i=this,n=t?e.concat(t):e,o="";n.forEach(function(e){o+=e.x+","+e.y+" "});var r=MeasureUtil.makePolygon({points:o,width:this.measureItemConfig.width,color:this.measureItemConfig.color.getRGBA(),fillColor:this.measureItemConfig.fillColor.getRGBA()});this._svg.appendChild(r),e.forEach(function(e){var t=MeasureUtil.makeCircle({strokeWidth:2,color:i.measureItemConfig.color.getRGBA(),radius:5,position:e});t.setAttribute("filter",i.filterUrl),i._svg.appendChild(t)})},drawNotation:function(e,t){var i=this.notation.drawAnnotation({x:e.x,y:e.y},t,this.id,!0),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;this._svg.appendChild(l)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}},getNotationTitle:function(){return BimfaceLanguage.bf_tip_measure_spatial_area},getMeasureResult:function(){var e=this.measureParams.unit,t=this.measureResult.toString();return t=MeasureResultFormat.formatArea(t,this.measureParams),t+=MeasureResultFormat.getPostFix(e,!0)}};i.prototype=Object.assign(i.prototype,n),t.MeasureSpatialAreaItem=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),new Glodon$1.Web.Graphics.Color(17,218,183,.2),function(e){t.MeasureSpatialAreaItem.call(this,e)});e.Type.inheritPrototype(i,t.MeasureSpatialAreaItem);var n={
getNotationTitle:function(){return BimfaceLanguage.bf_tip_measure_projected_area}};i.prototype=Object.assign(i.prototype,n),t.MeasureProjectedAreaItem=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=null,n=[],o=null,r=null,a=function(e){this.viewer3D=e.viewer;var i=this,n=new Glodon$1.Web.Lang.EventManager,o=t.create("div","bf-measure-conext");i.isOpen=!1,this.context={rootDomElement:o},this._opt=e,this.type=e.measureType,this.getEventManager=function(){return n},this.isEnableSnap=!0};a.prototype={init:function(){var e=this,i=e.context,n=e._opt.viewer;n.getDomElement().appendChild(i.rootDomElement);var o=t.createNS("svg","bf-measure-svg"),r=t.createNS("svg","bf-measure-svg"),a=t.create("div","bf-measure-text");i.rootDomElement.innerHTML="",i.rootDomElement.appendChild(o),i.rootDomElement.appendChild(r),this.drawableManager=new MeasureItemManager(r,n,this),this.drawableManager.setEventListener(this.getEventManager()),this._hookEvents(),this.switchOn(),i.svg=o,i.text=a,n.render()},_onViewerRender:function(){this.isOpen&&this.update()},_onCloudViewerMeasuring:function(e){this.isOpen&&(this.measureItem.hoverPositionUpdated=!0,this.measureByPoint(e))},_onCloudViewerMeasureReset:function(e){if(this.isOpen){var t=this.measureItem;this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.PolylineDistance||this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.SpatialArea||this.type==Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.ProjectedArea?t.getPoints().length<t.minPointsNum?(t.reset(),this.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset)):t.getPoints().length!=t.maxPointsNum&&(t.measureEnd=!0,this.measureByPoint(e)):(t.reset(),this.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset))}},_hookEvents:function(){var e=this.viewer3D,t=e.getViewer();this._onRenderBinded=this._onViewerRender.bind(this),this._onMeasuringBinded=this._onCloudViewerMeasuring.bind(this),this._onMeasureResetBinded=this._onCloudViewerMeasureReset.bind(this),e.addEventListener(Glodon$1.Bimface.Viewer.Viewer3DEvent.Rendered,this._onRenderBinded),t.registerEventListener(CLOUD$1.EVENTS.ON_MEASURE_PICK,this._onMeasuringBinded),t.registerEventListener(CLOUD$1.EVENTS.ON_MEASURE_RESET,this._onMeasureResetBinded)},_unhookEvents:function(){var e=this.viewer3D,t=e.getViewer();e.removeEventListener(Glodon$1.Bimface.Viewer.Viewer3DEvent.Rendered,this._onRenderBinded),t.unregisterEventListener(CLOUD$1.EVENTS.ON_MEASURE_PICK,this._onMeasuringBinded),t.unregisterEventListener(CLOUD$1.EVENTS.ON_MEASURE_RESET,this._onMeasureResetBinded)},enableMeasureCursor:function(){this._opt.viewer.getDomElement().style.cursor="url("+Cursor.measure+"),auto"},disableMeasureCursor:function(){this._opt.viewer.getDomElement().style.cursor=""},activeByMeasureType:function(){Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop()||this.drawableManager.clear(!0),this.enableMeasureCursor();var e=this._opt.viewer,t=e.getViewer();t.editorManager.enableTool(t,CLOUD$1.EditToolMode.PICK_BY_MEASURE);var i=void 0,n=new Glodon$1.Bimface.Plugins.Measure.MeasureItemConfig;switch(n=Object.assign(n,this._opt,this.getMeasureParams()),this.type){case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Angle:i=new Glodon$1.Bimface.Plugins.Measure.MeasureAngleItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.PolylineDistance:i=new Glodon$1.Bimface.Plugins.Measure.MeasurePolylineDistanceItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Position:i=new Glodon$1.Bimface.Plugins.Measure.MeasurePositionItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.TriangleDistance:i=new Glodon$1.Bimface.Plugins.Measure.MeasureTriangleDistanceItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.SpatialArea:i=new Glodon$1.Bimface.Plugins.Measure.MeasureSpatialAreaItem(n);break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.ProjectedArea:i=new Glodon$1.Bimface.Plugins.Measure.MeasureProjectedAreaItem(n)}this.measureItem=i},switchOn:function(){this.isOpen||(this.activeByMeasureType(),this.isOpen=!0,this.drawableManager.setIsEnableSelection(!0))},switchOff:function(){if(this.isOpen){var e=this,t=e._opt.viewer,i=t.getViewer();this.disableMeasureCursor(),i.editorManager.disableTool(CLOUD$1.EditToolMode.PICK_BY_MEASURE),e.reset(),e.measureItem=null,this.isOpen=!1,this.drawableManager.setIsEnableSelection(!1)}},measureByPoint:function(e){var t=this,a=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop(),s=t.measureItem;if(e)if(i=e.pickPoint?e.pickPoint:null,e.pickPlane?(o="Panel",r=e.normal):e.pickLine?(o="Line",n=e.pickLine):o=e.pickPoint?"Point":null,e.pick&&e.pickPoint){s.addPoint(e.pickPoint);var l=s.getPoints();l.length==s.maxPointsNum?(a||this.drawableManager.clear(!0),this.drawableManager.addItem(this.getInfo(!0)),a||this.drawableManager.unselctedAll(),this.measureItem.setIsReserverd(!0),t.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measured,t.getInfo(!0)),s.reset()):(a||this.drawableManager.clear(!0),t.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measuring,t.getInfo())),t.update()}else this.isEnableSnap&&t.update()},reset:function(){this.isOpen&&(this.measureItem.reset(),this.context.svg.innerHTML="",this.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Reset))},setIsEnableSnap:function(e){e||(this.context.svg.innerHTML=""),this.isEnableSnap=e},update:function(){var e=this.measureItem,t=this.context,a=this._opt.viewer,s=a.getDomElement(),l=s.getBoundingClientRect(),u=a.getViewer(),c=e.getPoints(),h=[],d=[];if(this.context.svg.innerHTML="",i?(t.hoverPosition=a.worldToClient(i),t.hoverPositionDS=u.getScene().worldToDrawing(i),e.nextMeasurePoint=i):t.hoverPosition=e.nextMeasurePoint?a.worldToClient(e.nextMeasurePoint):null,0!=c.length&&(h=c.concat([e.nextMeasurePoint])),t.hoverObjectType=o,"Line"==o&&2==n.length){t.lineStartPoint=a.worldToClient(n[0]),t.lineEndPoint=a.worldToClient(n[1]);var f=new THREE.Vector2(t.lineStartPoint.x,t.lineStartPoint.y),g=new THREE.Vector2(t.lineEndPoint.x,t.lineEndPoint.y),v=new THREE.Box2;v.min.set(s.clientLeft,s.clientTop),v.max.set(v.min.x+s.clientWidth,v.min.y+s.clientHeight);var m=!v.containsPoint(f),p=!v.containsPoint(g),y={start:f,end:g},w=CLOUD$1.CameraUtil.lineIntersectWithRect(y,v);if(m&&p)2==w.length&&(t.lineStartPoint=w[0],t.lineEndPoint=w[1]);else if(m||p)for(var b=new THREE.Vector2(t.hoverPosition.x,t.hoverPosition.y),C=m?g.clone():f.clone(),x=C.clone().sub(b).normalize(),E=0;E<w.length;E++){var k=C.clone().sub(w[E]).normalize();if(k.dot(x)>0){t.lineStartPoint=C,t.lineEndPoint=w[E];break}}}if("Panel"==t.hoverObjectType){t.normal=u.getScene().worldToDrawing(r),t.normal.normalize();var P=u.cameraControl,_=new THREE.Plane;_.setFromNormalAndCoplanarPoint(t.normal,t.hoverPositionDS);var M=new THREE.Vector2(t.hoverPosition.x-10,t.hoverPosition.y-10),I=new THREE.Vector2(t.hoverPosition.x+10,t.hoverPosition.y-10),S=t.hoverPositionDS,B=P.getRaycaster(M.x,M.y),f=B.ray.intersectPlane(_);B=P.getRaycaster(I.x,I.y);var g=B.ray.intersectPlane(_);if(null==f||null==g)return;var D=new THREE.Vector3(1,0,0),T=new THREE.Vector3(0,1,0),A=new THREE.Vector3(0,0,1),L=Math.abs(t.normal.clone().dot(D))<=.0025,O=Math.abs(t.normal.clone().dot(A))<=.0025;if(L&&O)var G=D.clone(),R=A.clone();else var V=T.clone(),G=V.cross(t.normal).normalize(),R=t.normal.clone().cross(G).normalize();var N=f.distanceTo(g)/2,U=G.clone().multiplyScalar(N),H=R.clone().multiplyScalar(N),W=S.clone().sub(U).add(H),$=S.clone().add(U).add(H),z=S.clone().sub(U).sub(H),j=S.clone().add(U).sub(H),F=[];F.push(W,$,j,z);for(var X=[],Y=P.getContainerDimensions(),Z=0;Z<F.length;Z++){var q=CLOUD$1.CameraUtil.drawingToCanvas(P.camera,F[Z],Y.width,Y.height);X.push(new THREE.Vector3(q.x,q.y,0))}t.clientPts=X}for(var E=0;E<h.length-1;E++){var J=u.worldPointsToClient(h[E],h[E+1]);if(J){var K={x:J.start.x-l.left,y:J.start.y-l.top};d.push(K)}}t.clientPoints=d;var Q=this.getInfo(!0,h);e.draw(t,Q)},getInfo:function(e,t){var i={},n=this.measureItem,o=this._opt.viewer,t=t||n.getPoints();switch(i.type=this.type,i.id=Glodon$1.Web.Lang.Utility.UUID.createUUID(),i.points=t,this.type){case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Angle:if(3==t.length){var r=new THREE.Vector3(t[0].x-t[1].x,t[0].y-t[1].y,t[0].z-t[1].z),a=new THREE.Vector3(t[2].x-t[1].x,t[2].y-t[1].y,t[2].z-t[1].z),s=r.angleTo(a);i.angle=180*s/Math.PI}break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Position:if(1==t.length){i.coordinateSystem="GCJ-02";var l=o.worldToLatLon(t[0]);i.lonLat={longitude:l.lon,latitude:l.lat},i.altitude=t[0].z}break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.PolylineDistance:if(t&&t.length>=2){var u=t.length;i.distance=[],i.totalDistance=0;for(var c=1;c<u;c++){var h=t[c].distanceTo(t[c-1]);i.distance.push(h),i.totalDistance+=h}}break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.TriangleDistance:if(2==t.length){i.distance=i.points[0].distanceTo(i.points[1]);var d=t[0].clone(),f=0,g=0;t[0].z<t[1].z?(d.set(t[0].x,t[0].y,t[1].z),f=d.distanceTo(t[1]),g=d.distanceTo(t[0])):t[0].z>t[1].z&&(d.set(t[1].x,t[1].y,t[0].z),f=d.distanceTo(t[0]),g=d.distanceTo(t[1])),Object.assign(i,{horizontalDistance:f,verticalDistance:g})}break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.SpatialArea:if(t.length>=3&&e){var v=MeasureUtil.calcSpatialArea(t);Object.assign(i,{area:v})}break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.ProjectedArea:if(t.length>=3&&e){var m=MeasureUtil.calcProjectedArea(t);Object.assign(i,{area:m})}}return i},redo:function(){this.measureItem.redo(),this.update(),this.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureEvent.Measuring,this.getInfo())},exit:function(){this.switchOff(),this._unhookEvents()},isMeasureOpen:function(){return this.isOpen},getDefaultUnit:function(){return"m"}},e.MeasureViewerGIS=a}(),function(){var e=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=function(e){var n=e.viewer;if(n){var o=new Glodon$1.Web.Lang.EventManager,r=i.create("div","bf-measure-conext");this.context={rootDomElement:r},this.id="Measure",this._opt=e,this.type=e.measureType,this.getEventManager=function(){return o},"Viewer3D"===n.getViewerType()?(t.MeasureViewer3D.call(this,e),this.inherit(Glodon$1.Bimface.Plugins.Measure.MeasureViewer3D.prototype)):"ViewerGIS"===n.getViewerType()?(t.MeasureViewerGIS.call(this,e),this.inherit(Glodon$1.Bimface.Plugins.Measure.MeasureViewerGIS.prototype)):(t.MeasureDrawing.call(this,e),this.inherit(Glodon$1.Bimface.Plugins.Measure.MeasureDrawing.prototype)),this._setDefaultUnits(e),this._setDefaultPrecisions(e),this.init()}};n.prototype={inherit:function(e){for(var t in e)this[t]=e[t]},addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},_setDefaultUnits:function(e){var t=e.viewer.getViewerType();if(void 0==e.lengthUnits||null!=e.units){var i=this.getDefaultUnit();"m"===i?e.lengthUnits=Glodon$1.Bimface.Common.Units.LengthUnits.Meter:"mm"===i&&(e.lengthUnits=Glodon$1.Bimface.Common.Units.LengthUnits.Millimeter);var n=e.units&&e.units.distance||e.lengthUnits||Glodon$1.Bimface.Common.Units.LengthUnits.Millimeter,o=e.units&&e.units.distance||e.lengthUnits||Glodon$1.Bimface.Common.Units.LengthUnits.None,r=e.units&&e.units.elevation||Glodon$1.Bimface.Common.Units.LengthUnits.Meter,a=e.units&&e.units.area||Glodon$1.Bimface.Common.Units.LengthUnits.Meter,s=e.units&&e.units.area||Glodon$1.Bimface.Common.Units.LengthUnits.None;switch(t){case"Viewer3D":e.units={distance:n,elevation:r};break;case"ViewerGIS":e.units={distance:n,elevation:r,area:a};break;case"ViewerDrawing":e.units={distance:o,area:s}}}else switch(t){case"Viewer3D":e.units={distance:e.lengthUnits,elevation:e.lengthUnits};break;case"ViewerGIS":e.units={distance:e.lengthUnits,elevation:e.lengthUnits,area:e.lengthUnits};break;case"ViewerDrawing":e.units={distance:e.lengthUnits,area:e.lengthUnits}}},_setDefaultPrecisions:function(e){if("number"==typeof e.precision)e.obsoletePrecision=e.precision,e.precision={distance:e.obsoletePrecision,elevation:e.obsoletePrecision,area:e.obsoletePrecision,angle:e.obsoletePrecision,latLon:e.obsoletePrecision};else{var t=e.precision,i=t.distance,n=void 0===i?3:i,o=t.elevation,r=void 0===o?3:o,a=t.area,s=void 0===a?3:a,l=t.angle,u=void 0===l?2:l,c=t.latLon,h=void 0===c?9:c;e.precision={distance:n,elevation:r,area:s,angle:u,latLon:h}}},getMeasureType:function(){return this.type},setMeasureType:function(t){e.send("Bimface.Plugins.Measure.Measure","setMeasureType"),this.type=t,this.reset(),this.activeByMeasureType(),this.getEventManager().fireEvent("typeChange",t)},setPrecision:function(e){"number"==typeof e||"string"==typeof e?(this._opt.obsoletePrecision=e,this._opt.precision={distance:e,elevation:e,area:e,angle:e,latLon:e}):this._opt.precision=Object.assign(this._opt.precision,e),this.getEventManager().fireEvent("MeasureParamsUpdated")},getPrecision:function(){return void 0!==this._opt.obsoletePrecision?this._opt.obsoletePrecision:this._opt.precision},setScale:function(e){this._opt.scale=e,this.getEventManager().fireEvent("MeasureParamsUpdated")},getScale:function(){return this._opt.scale},setLengthUnits:function(e){this._opt.lengthUnits=e;for(var t in this._opt.units)this._opt.units[t]=e;this.getEventManager().fireEvent("MeasureParamsUpdated")},getLengthUnits:function(){return this._opt.lengthUnits},setUnits:function(e){this._opt.units=Object.assign(this._opt.units,e),this.getEventManager().fireEvent("MeasureParamsUpdated")},getUnits:function(){return this._opt.units},getAllItems:function(){return this.drawableManager.save()},setItems:function(e){this.clear(),this.drawableManager.load(e)},clear:function(){this.drawableManager.clear(!0)},hideAllItems:function(){this.drawableManager.hideAll()},showAllItems:function(){this.drawableManager.showAll()},onClick:function(e){this.drawableManager.onClick(e)},removeSelectedItem:function(){this.drawableManager.unselctedAll()},getSelectedItem:function(){return this.drawableManager.getSelectedItem()},getMeasureParams:function(e){var t={scale:this.getScale(),defaultUnit:this.getDefaultUnit()};switch(e||this.type){case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Angle:t=Object.assign(t,{precision:this._opt.precision.angle,unit:"°"});break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Elevation:t=Object.assign(t,{precision:this._opt.precision.elevation,unit:this.getUnits().elevation});break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Area:case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.SpatialArea:case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.ProjectedArea:t=Object.assign(t,{precision:this._opt.precision.area,unit:this.getUnits().area});break;case Glodon$1.Bimface.Plugins.Measure.MeasureTypeOption.Position:t=Object.assign(t,{precision:{elevation:this._opt.precision.elevation,latLon:this._opt.precision.latLon},unit:this.getUnits().elevation});break;default:t=Object.assign(t,{precision:this._opt.precision.distance,unit:this.getUnits().distance})}return t}},t.Measure=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=function(){return{viewer:null,targetsHintColor:new Glodon$1.Web.Graphics.Color(245,127,35,.6)}};e.MeasureRayConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=function(){return{id:null,color:new Glodon$1.Web.Graphics.Color(245,127,35,1),width:2,startPoint:new Glodon$1.Web.Geometry.Point3d(0,0,0),endPoint:new Glodon$1.Web.Geometry.Point3d(0,0,0),startObjectId:null,endObjectId:null}};e.MeasureRayItemConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=function(e){this.id=e.id||Glodon$1.Web.Lang.Utility.UUID.createUUID();this.startPoint=e.startPoint,this.endPoint=e.endPoint;this.startComponentId=e.startComponentId,this.endComponentId=e.endComponentId;var i=t.createNS("defs","bf-defs");i.innerHTML='\n      <marker id="end" markerWidth="6" markerHeight="6" refx="5" refy="3" orient="auto" markerUnits="strokeWidth">\n        <path d="M0,0 L0,6 L6,3 z" fill="'+e.color.getRGBA()+'" />\n      </marker>';var n=t.create("i","bf-measure-handle");n.style.width=12*e.width+"px",n.style.height=12*e.width+"px",n.style.backgroundColor=e.color.getRGBA(),n.style.lineHeight=12*e.width+"px";var o=t.createNS("line","bf-measure-line");o.style.stroke=e.color.getRGBA(),o.setAttribute("stroke-width",e.width);var r=t.create("span","bf-measure-number");r.style.backgroundColor=e.color.getRGBA(),this.domElement=i,this.line=o,this.circle=n,this.text=r};i.prototype={draw:function(e){var t=this.domElement,i=this.line,n=this.circle,o=this.text,r=Math.abs(e.endPoint.x-e.startPoint.x),a=Math.abs(e.endPoint.y-e.startPoint.y),s=Math.abs(e.endPoint.z-e.startPoint.z),l=Math.sqrt(Math.pow(r,2)+Math.pow(a,2)+Math.pow(s,2));i.setAttribute("x1",e.startPoint.x),i.setAttribute("y1",e.startPoint.y),i.setAttribute("x2",e.endPoint.x),i.setAttribute("y2",e.endPoint.y),n.style.left=e.startPoint.x+"px",n.style.top=e.startPoint.y+"px",e.isMove&&(n.style.border="2px solid #fff"),l<15?i.removeAttribute("marker-end"):i.setAttribute("marker-end","url(#end)"),o.innerText=e.distance,e.svg.appendChild(t),e.svg.appendChild(i),e.text.appendChild(n),0==e.distance?n.innerText="0":(o.style.left=(e.startPoint.x+e.endPoint.x)/2+"px",o.style.top=(e.startPoint.y+e.endPoint.y)/2+"px",o.style.transform="translate(-50%, 0)",o.style.marginTop="2px",e.text.appendChild(o))}},e.MeasureRayItem=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=Object.freeze({Measured:"Measured",Clear:"Clear"});e.MeasureRayEvent=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Measure"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=function(e){var i=e.viewer;if(i){if(!(i instanceof Glodon$1.Bimface.Viewer.Viewer3D))return void console.log("Viewer2D is not supported.");var n=this,o=new Glodon$1.Web.Lang.EventManager,r=t.create("div","bf-measure-conext");i.addEventListener("Rendered",function(){n.measureItem&&n.update()}),this.context={rootDomElement:r},this._opt=e,this._enableMove=!1,this._events={mousedown:function(){this._startTime=(new Date).getTime()},mouseup:function(e){if(0==e.button||1==e.button)if(n._enableMove)n._enableMove=!1,n.measureByPoint(e);else{var t=this._startTime,i=(new Date).getTime();i-t<300&&n.measureByPoint(e)}},mousemove:function(e){n._enableMove&&(e.stopPropagation(),n.measureByPoint(e))}},this.getEventManager=function(){return o}}};i.prototype={addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},switchOn:function(e){var i=this.context,n=this;n._opt.viewer.getDomElement().appendChild(i.rootDomElement),e&&(n._callback=e),n._opt.viewer.getModels().forEach(function(e){e.setSelectedComponentsById()});var o=t.createNS("svg","bf-measure-svg"),r=t.create("div","bf-measure-text");i.rootDomElement.appendChild(o),i.rootDomElement.appendChild(r),i.svg=o,i.text=r,i.rootDomElement.addEventListener("mousedown",n._events.mousedown),i.rootDomElement.addEventListener("mouseup",n._events.mouseup),i.rootDomElement.addEventListener("mousemove",n._events.mousemove)},switchOff:function(){var e=this.context.rootDomElement,t=this,i=t._opt.viewer;t.measureItem&&(i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]),i.render()),e.removeEventListener("mousedown",t._events.mousedown),e.removeEventListener("mouseup",t._events.mouseup),e.removeEventListener("mousemove",t._events.mousemove),e.innerHTML="",e.remove(),t.measureItem=null},reset:function(){this.clear()},clear:function(){var e=this.context,t=this,i=t._opt.viewer;t.measureItem&&(i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]),i.render()),e.svg.innerHTML="",e.text.innerHTML="",t.measureItem=null,t.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureRayEvent.Clear,data)},measureByPoint:function(e){var t=this,i=t._opt.viewer,n=i.getViewer(),o=n.pickByPointWithNormal(e);if(o){t.measureItem&&i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]);var r=(Glodon$1.Bimface.Viewer.Viewer3DEvent,t._getContextData(o)),a=new Glodon$1.Bimface.Plugins.Measure.MeasureRayItemConfig;a.startComponentId=r.startComponentId,a.endComponentId=r.endComponentId,a.startPoint=r.startPoint,a.endPoint=r.endPoint;var s=new Glodon$1.Bimface.Plugins.Measure.MeasureRayItem(a);s.circle.addEventListener("mousedown",function(e){2!=e.button&&(t._enableMove=!0)}),t.context.distance=r.distance,i.overrideComponentsColorById([r.startComponentId,r.endComponentId],t._opt.targetsHintColor),setTimeout(function(){t.update(),i.render()},100),t.measureItem=s,t.getEventManager().fireEvent(Glodon$1.Bimface.Plugins.Measure.MeasureRayEvent.Measured,r)}},update:function(){var e=this.measureItem,t=this.context,i=this._opt.viewer;t.svg.innerHTML="",t.text.innerHTML="",t.isMove=this._enableMove;var n=i.worldToClient(e.startPoint),o=i.worldToClient(e.endPoint);n&&o&&(t.startPoint=new Glodon$1.Web.Geometry.Point3d(n.x,n.y,n.z),t.endPoint=new Glodon$1.Web.Geometry.Point3d(o.x,o.y,o.z),e.draw(t))},exit:function(){this.switchOff()},_getContextData:function(e){var t,i,n={};return t=i=e[0],e.length>1&&(i=e[1]),n.startComponentId=t.userId,n.startPoint=t.worldPosition,n.endComponentId=i.userId,n.endPoint=i.worldPosition,n.distanceX=Math.round(Math.abs(n.endPoint.x-n.startPoint.x)),n.distanceY=Math.round(Math.abs(n.endPoint.y-n.startPoint.y)),n.distanceZ=Math.round(Math.abs(n.endPoint.z-n.startPoint.z)),n.distance=Math.round(Math.sqrt(Math.pow(n.distanceX,2)+Math.pow(n.distanceY,2)+Math.pow(n.distanceZ,2))),n}},e.MeasureRay=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Marker3D"),t=function(){return{viewer:null,type:null,layerId:null}};e.Marker3DContainerConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Marker3D"),t=function(){return{id:null,objectId:null,size:30,tooltip:"",tooltipStyle:{color:"#333",fontSize:"14px",borderWidth:"1px",borderColor:"#666",borderStyle:"solid",backgroundColor:"#fff"},src:null,worldPosition:new Glodon$1.Web.Geometry.Point3d(0,0,0),modelId:void 0,layerId:void 0}};e.Marker3DConfig=t}(),function(){var e="Bimface.Plugins.Marker3D.Marker3D",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Marker3D"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),o=function(e){var t=this;this.id=e.id||Glodon$1.Web.Lang.Utility.UUID.createUUID(),this.layerId=e.layerId,this.modelId=e.modelId,this.objectId=e.objectId,this.size=e.size,this.iconUrl=e.src,this.position=e.worldPosition,this.originalPosition=new THREE.Vector3(this.position.x,this.position.y,this.position.z),this.explosionOffset=new THREE.Vector3,this.tooltip=e.tooltip,this.tooltipElement=n.create("div","bf-tooltip"),this.tooltipElement.innerHTML=e.tooltip,this.tooltipElement.setCss(e.tooltipStyle),this.isHideByClustering=!1,this._tooltipCallback=function(e,i,n){var o=t.tooltipElement;n.appendChild(o);var r=o.offsetWidth,a=o.offsetHeight;o.style.left=i.x-r/2+"px",o.style.top=i.y-a-t.size+"px",t._hoverCallback&&t._hoverCallback(e)},this._config=e};o.prototype={getId:function(){return this.id},getWorldPosition:function(){return this.position},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.originalPosition=this.position=i,this.update()},getSize:function(){return this.size},setSize:function(i){t.send(e,"setSize"),this.size=i,this.update()},getSrc:function(){return this.iconUrl},setSrc:function(i){t.send(e,"setSrc"),this.iconUrl=i,this.update()},getTooltip:function(){return this.tooltip},setTooltip:function(i){t.send(e,"setTooltip"),this.tooltip=i,this.tooltipElement.innerHTML=i},onClick:function(i){t.send(e,"onClick"),i&&(this._clickCallback=i)},onHover:function(i){t.send(e,"onHover"),i&&(this._hoverCallback=i)},onDoubleClick:function(i){t.send(e,"onDoubleClick"),i&&(this._doubleClickCallback=i)},onRightClick:function(i){t.send(e,"onRightClick"),i&&(this._rightClickCallback=i)},update:function(){t.send(e,"update"),this.container&&this.container.update()},isHideByClustering:function(){return this.isHideByClustering},hideByClustering:function(e){this.isHideByClustering=!!e},attachExplosionOffset:function(e,t){if(this.getWorldPosition()){var i=this._config.objectId;if(i){var n={};n[i]=!0;var o=e.modelManager.getBoundingBoxByIds(n),r=this.assoiatedComponentBbox,a=o;if(r){var s=a.getCenter().clone();s.sub(r.getCenter().clone()),this.explosionOffset=s,this.explosionExtent>0&&0===t&&(this.originalPosition.x+=this.explosionDirection*s.x,this.originalPosition.y+=this.explosionDirection*s.y,this.originalPosition.z+=this.explosionDirection*s.z,this.explosionExtent=0,this.explosionOffset=new Vector3,this.assoiatedComponentBbox=a.clone())}}else{var l=e.getScene().getOriginalBoundingBoxWorld().getCenter(),u=(new THREE.Box3).expandByPoint(this.getWorldPosition()),c=CLOUD.Utils.computeExplodeTranslation(l,u,t);this.explosionOffset=c}}},updatePosition:function(){this.position.x=this.originalPosition.x+this.explosionOffset.x,this.position.y=this.originalPosition.y+this.explosionOffset.y,this.position.z=this.originalPosition.z+this.explosionOffset.z},getOriginalPosition:function(){return this.originalPosition},setInitialExplosionInfo:function(e){if("Viewer3D"===e.getViewerType()||"ViewerGIS"===e.getViewerType()){var t=null;"Viewer3D"===e.getViewerType()?t=this.modelId?e.getModel(this.modelId):e.getDefaultModel():"ViewerGIS"===e.getViewerType()&&(t=e.getLayerManager().getLayer(this.layerId)),this.explosionExtent=null===t?t.getExplosionExtent():0;var i=this._config.objectId;if(i){var n=e.getViewer(),o={};o[i]=!0;var r=n.modelManager.getBoundingBoxByIds(o);r.isEmpty()?(this._config.objectId=null,console.log("Cannot find component with Id "+i)):this.assoiatedComponentBbox=r.clone()}}},getCurrentPosition:function(){return this.position}},i.Marker3D=o}(),function(){var e="Bimface.Plugins.Marker3D.Marker3DContainer",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Marker3D"),n=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),function(){function i(e){var t=this;_classCallCheck(this,i);var n=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop();if(!e.viewer)return void console.log("viewer must not be empty.");var o=e.viewer instanceof Glodon$1.Bimface.Viewer.Viewer3D,r=Glodon$1.Bimface.Viewer.ViewerGIS&&e.viewer instanceof Glodon$1.Bimface.Viewer.ViewerGIS,a=e.viewer.getDomElement(),s=e.viewer.getViewer();if(!o&&!r)return void console.log("Viewer2D is not supported.");if("ViewerGIS"===e.viewer.getViewerType()&&"ShpPoint"===e.type)this._helper=new CLOUD$1.ShpPointMarker(s,e.layerId);else{if(e.viewer.marker3DContainer)return e.viewer.marker3DContainer;e.viewer.marker3DContainer=this,this._helper=new CLOUD$1.Marker3D(s,!0)}var l=this;this._viewer=e.viewer,this._items=[],this._areaData={},this.loadAreas=void 0,this.getLevelCallback=[],this.boxMap={},this._pick=function(e){if(!e.doubleClick&&2!==e.event.button){var i=e.intersectInfo;if(i&&i.objectType===CLOUD$1.PICKABLETYPE.Marker3d){var n=t.getItemById(i.selectedObjectId);n._clickCallback&&n._clickCallback(n)}}},this._doublePick=function(e){if(e.doubleClick){var i=e.intersectInfo;if(i&&i.objectType===CLOUD$1.PICKABLETYPE.Marker3d){var n=t.getItemById(i.selectedObjectId);n._doubleClickCallback&&n._doubleClickCallback(n)}}},this._rightPick=function(e){if(2==e.event.button){var i=e.intersectInfo;if(i&&i.objectType===CLOUD$1.PICKABLETYPE.Marker3d){var n=t.getItemById(i.selectedObjectId);n._rightClickCallback&&n._rightClickCallback(n)}}},this._hover=function(e){var i=t;i.tooltipElement&&a.contains(i.tooltipElement)&&(a.removeChild(i.tooltipElement),i.tooltipElement=null);var n=e.intersectInfo;if(n&&n.objectType===CLOUD$1.PICKABLETYPE.Marker3d){var o=i.getItemById(n.selectedObjectId);i.tooltipElement=o.tooltipElement,o._tooltipCallback&&""!=i.tooltipElement.innerHTML&&o._tooltipCallback(o,e.canvasPos,a)}},s.registerEventListener(CLOUD$1.EVENTS.ON_CLICK_MARKER3D_PICK,l._pick),s.registerEventListener(CLOUD$1.EVENTS.ON_CLICK_MARKER3D_PICK,l._rightPick),s.registerEventListener(CLOUD$1.EVENTS.ON_CLICK_MARKER3D_PICK,l._doublePick),n&&s.registerEventListener(CLOUD$1.EVENTS.ON_HOVER_PICK,l._hover),o?(this.calculateViewer3dExplosionOffset=function(t){var i=t.modelId,n=t.floorInfos.length,o=e.viewer.getDefaultModel().modelId.toString(),r=e.viewer.getModel(i).getFloorExplosionExtent(),a=e.viewer.getModel(i).getFloorExplosionDirection();if(0===r){var s=!0,u=!1,c=void 0;try{for(var h,d=l.getAllItems()[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){h.value.setInitialExplosionInfo(e.viewer)}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}}var f=[];l.floorInfos=t;if(n)for(var g=0;g<n;g++){var v=t.floorInfos[g],m=t.floorInfos[g+1],p=t.floorInfos[g-1];f.push({box:{min:p?v.boundingBox.min.z:-1/0,max:m?m.boundingBox.min.z:1/0},floorName:v.name,explodedOffset:v.explodedHeight-v.elevation}),f.length==n&&(!function(){for(var e=l._items,t=0,n=e.length;t<n;t++){var r=e[t].getWorldPosition();if(r)if(!0!==e[t]._isBindRoom)if(e[t].levelName){var s=f.getObjectByAttribute("floorName",e[t].levelName);s&&(e[t].explosionOffset={x:a.x*s.explodedOffset,y:a.y*s.explodedOffset,z:a.z*s.explodedOffset})}else if(i!==o)e[t].explosionOffset={x:e[t].explosionOffset.x,y:e[t].explosionOffset.y,z:e[t].explosionOffset.z};else{for(var u=!0,c=0;c<f.length;c++){var h=f[c];if(h.box.min<r.z&&h.box.max>r.z){e[t].explosionOffset={x:a.x*h.explodedOffset,y:a.y*h.explodedOffset,z:a.z*h.explodedOffset},e[t].levelName=h.floorName,u=!1;break}}u&&(e[t].explosionOffset={x:0,y:0,z:0})}else{var d=l._viewer.getViewer().modelManager.modelCollection.getById("ExtrudeBodyManager").getNode(e[t]._config.objectId),g=d.explodedHeight,v=d.explodedDirection;e[t].explosionOffset={x:v.x*g,y:v.y*g,z:v.z*g}}}}(),l.boxs=f)}l.update()},e.viewer.addEventListener(Glodon$1.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(e){t.calculateViewer3dExplosionOffset(e)})):r&&(this.calculateViewerGISExplosionOffset=function(i){var n=e.viewer,o=n.getViewer(),r=i.modelId,a=i.floorInfos.length,s=o.getFloorExplosionExtent(r),u=o.getFloorExplosionDirection(r);if(0===s){var c=!0,h=!1,d=void 0;try{for(var f,g=l.getAllItems()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){f.value.setInitialExplosionInfo(n)}}catch(e){h=!0,d=e}finally{try{!c&&g.return&&g.return()}finally{if(h)throw d}}}for(var v=i.floorInfos,m=[],p=0;p<a;p++){var y=v[p],w=v[p+1],b=v[p-1];if(m.push({box:{min:b?y.boundingBox.min.z:-1/0,max:w?w.boundingBox.min.z:1/0},floorName:y.name,explodedOffset:y.explodedHeight-y.elevation}),m.length==a){t.boxMap[r]=m;break}}for(var C=n.getLayerManager(),x=t._items,E=0,k=x.length;E<k;E++){if(x[E].getWorldPosition()){var P=C.getLayer(x[E].layerId);if(P&&P.modelId&&P.modelId.toString()===r&&x[E].levelName){var _=m.getObjectByAttribute("floorName",x[E].levelName)
;_&&(x[E].explosionOffset={x:u.x*_.explodedOffset,y:u.y*_.explodedOffset,z:u.z*_.explodedOffset})}}}t.update()},e.viewer.addEventListener(Glodon$1.Bimface.Viewer.ViewerGISEvent.FloorExplosion,function(e){t.calculateViewerGISExplosionOffset(e)}));var u=e.viewer.getViewer();u.registerEventListener(CLOUD$1.EVENTS.ON_EXPLOSION,function(e){var i=t.getAllItems(),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){a.value.attachExplosionOffset(u,e.extent)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}t.update()})}return _createClass(i,[{key:"addItem",value:function(i){t.send(e,"addItem"),i.container=this;var n=this.ifExploded(i);n&&(n.setInitialExplosionInfo(this._viewer),this._items.push(n),this.update())}},{key:"getLevelNameById",value:function(e,t){var i=this;if(!this._spatialRelation){var n=new Glodon$1.Bimface.Plugins.SpatialRelation.RoomConfig;n.viewer=this._viewer;var o=new Glodon$1.Bimface.Plugins.SpatialRelation.Room(n);this._spatialRelation=o}var r=this._spatialRelation.getBoundaryByRoomId(e);if(r){if(this._levelsInfo)return levelName=function(e,t){for(var i=e[0][2],n=0;n<t.length;n++)if(Math.abs(i-t[n].elevation)<5)return t[n].name;return!1}(r,this._levelsInfo),levelName;this._viewer.getDefaultModel().getMapInfo(function(e){i._levelsInfo=e.axisGrid.Levels,i.addItem(t)})}}},{key:"ifExploded",value:function(e){var t=this;if(this.floorInfos&&!this._levelsInfo){for(var i=this.floorInfos.floorInfos,n=[],o=0;o<i.length;o++){var r=i[o];n.push({name:r.name,elevation:r.elevation})}this._levelsInfo=n}var a=function(){if(t.floorInfos){var i=e.getOriginalPosition();if(e.levelName){var n=t.boxs.getObjectByAttribute("floorName",e.levelName);n&&(e.explosionOffset={x:0,y:0,z:n.explodedOffset},i.z-=n.explodedOffset)}else for(var o=t.boxs,r=0;r<o.length;r++){var a=o[r];if(0!=a.explodedOffset){var s={x:worldPosition.x,y:worldPosition.y,z:worldPosition.z-a.explodedOffset};if(a.box.containsPoint(s)){e.explosionOffset={x:0,y:0,z:a.explodedOffset},i.z-=a.explodedOffset;break}}}}return e};if(e._config.objectId){var s=this._viewer.getViewer().getComponentInfoByUserId(e._config.objectId);if(s)return e.levelName=s.userData&&s.userData.levelName,a();return this._viewer.getViewer().modelManager.modelCollection.getById("ExtrudeBodyManager").getNode(e._config.objectId)&&(e._isBindRoom=!0),e}return a()}},{key:"addItems",value:function(i){t.send(e,"addItems");var n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u=this.ifExploded(l);u&&this._items.push(u),l.setInitialExplosionInfo(this._viewer)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}this.update()}},{key:"removeItemById",value:function(i){t.send(e,"removeItemById"),this._items.removeObjectByAttribute("id",i),this.update()}},{key:"getItemById",value:function(e){return this._items.getObjectByAttribute("id",e)}},{key:"getAllItems",value:function(){return[].concat(_toConsumableArray(this._items))}},{key:"clear",value:function(){t.send(e,"clear"),this._items=[],this.update()}},{key:"update",value:function(){this._helper.clear();for(var e=this._items.slice(),t=0,i=e.length;t<i;t++){e[t].getWorldPosition()&&e[t].updatePosition()}for(var n=[],o=0,r=e.length;o<r;o++)!1===e[o].isHideByClustering&&n.push(e[o]);this._helper.add(n),this._helper.update(),this._viewer.render()}},{key:"exit",value:function(){t.send(e,"exit");var i=this._viewer.getViewer(),n=Glodon$1.Web.Lang.Utility.ClientHelper.getIsDesktop();i.unregisterEventListener(CLOUD$1.EVENTS.ON_CLICK_PICK,this._pick),n&&i.unregisterEventListener(CLOUD$1.EVENTS.ON_HOVER_PICK,this._hover),this.clear()}},{key:"hideItemsById",value:function(i){t.send(e,"hideItemsById"),this._helper.hideByIds(i),this._viewer.render()}},{key:"hideAllItems",value:function(){t.send(e,"hideAllItems"),this._helper.hide(),this._viewer.render()}},{key:"showItemsById",value:function(i){t.send(e,"showItemsById"),this._helper.showByIds(i),this._viewer.render()}},{key:"showAllItems",value:function(){t.send(e,"showAllItems"),this._helper.show(),this._viewer.render()}}]),i}());i.Marker3DContainer=n}(),function(){var e=Object.freeze({Forward:"Forward",Reverse:"Reverse"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section").SectionBoxDirection=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),t=function(){return{viewer:null,direction:Glodon$1.Bimface.Plugins.Section.SectionBoxDirection.Forward}};e.SectionBoxConfig=t}(),function(){var e=Object.freeze({SectionBoxUpdate:"SectionBoxUpdate",SectionBoxChanged:"SectionBoxChanged"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section").SectionBoxEvent=e}(),function(){var e,t,i="Bimface.Plugins.Section.SectionBox",n=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),o=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),r=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),function(i){var n=this,r=i.viewer;return r?r instanceof Glodon$1.Bimface.Viewer.Viewer3D?(r._sectionPlane&&(r._sectionPlane.hidePlane(),r._sectionPlane.exit()),e&&r==t?(e.id=i.id,e.reset(),e):(e=this,t=r,r._sectionBox?(r._sectionBox.showBox(),r._sectionBox):(r._sectionBox=this,this.sectionBoxEvent=o.SectionBoxEvent,this.eventManager=r.getEventManager(),n.id=i.id,n._opt=i,n._viewer=r,n.boxState=!0,n._boxDirection=i.direction,void n.init()))):void console.log("Viewer2D is not supported."):void console.log("domElement must not be empty.")});r.prototype={hookEvens:function(){var e=this._viewer.getViewer(),t=this._viewer.getDomElement();e.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,function(e){e.onClipBox?t.style.cursor="url("+Cursor.section+"),auto":t.removeAttribute("style")});var i=this;e.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_MOUSE_MOVE,function(e){i.eventManager.fireEvent(i.sectionBoxEvent.SectionBoxChanged)})},init:function(){n.send(i,"init");var e=this._opt.viewer.getViewer(),t=this;e.editorManager.enableTool(e,CLOUD$1.EditToolMode.CLIP_BY_BOX),this._sectionBox=new CLOUD$1.ClipPlaneService(e),CLOUD$1.ClipPlaneManager.getInstance(e.getScene()).observer=function(){t.eventManager.fireEvent(t.sectionBoxEvent.SectionBoxUpdate,t)},this._sectionBox.reset(),this._sectionBox.toggle(!0,!0),this._sectionBox.setVisible(!0),"Reverse"===t._boxDirection?this._sectionBox.changeDirection(!0):this._sectionBox.changeDirection(!1),this.hookEvens()},addEventListener:function(e,t){this.eventManager.addEvent(e,t)},removeEventListener:function(e,t){this.eventManager.removeEvent(e,t)},setBox:function(e){n.send(i,"setBox"),this._sectionBox.getEditor().calculateOffsetByBox(e.min,e.max)},getBox:function(){},hideBox:function(){n.send(i,"hideBox"),this._sectionBox&&this._sectionBox.setVisible(!1),this._viewer.render()},showBox:function(){n.send(i,"showBox"),this._sectionBox&&this._sectionBox.setVisible(!0),this._viewer.render()},setProgress:function(e,t){var i=this,n={x:["Left","Right"],y:["Back","Front"],z:["Bottom","Top"]};t&&(i._sectionBox.setProcess(n[e][0],t[0]/100),2==t.length&&i._sectionBox.setProcess(n[e][1],1-t[1]/100))},getProgress:function(e){var t=this,i=[],n={x:["Left","Right"],y:["Back","Front"],z:["Bottom","Top"]};return i.push(100*t._sectionBox.getProcess(n[e][0])),i.push(100-100*t._sectionBox.getProcess(n[e][1])),i},reset:function(){n.send(i,"reset"),this._sectionBox.toggle(!0,!0),this._sectionBox.reset("Rotate"),this.showBox()},fitToModel:function(){n.send(i,"fitToModel");var e=this._sectionBox.recalculate().clone();e.isEmpty()&&e.expandByPoint(new THREE.Vector3),this.setBox(e),this._sectionBox.getEditor()._isVisible()&&this.showBox(),this.eventManager.fireEvent(this.sectionBoxEvent.SectionBoxChanged)},isIncluded:function(e){var t=this._opt.viewer,i=t.getViewer().getScene(),n=CLOUD$1.ClipPlaneManager.getInstance(i),o=n.getClipBoundingBox(),r=t.worldToScene(e);return o.containsPoint(r)},exit:function(){n.send(i,"exit");var t=this._opt.viewer.getViewer(),o=this._viewer.getDomElement();this.reset(),t.editorManager.disableTool(CLOUD$1.EditToolMode.CLIP_BY_BOX),o.removeAttribute("style"),this._sectionBox=null,this._opt.viewer._sectionBox=null,e=null,this.eventManager.fireEvent(this.sectionBoxEvent.SectionBoxUpdate,null),t.unregisterEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,function(e){e.onClipBox?o.style.cursor="url("+Cursor.section+"),auto":o.removeAttribute("style")})},lockBox:function(e){this._opt.viewer.getViewer().editorManager.getToolByName("clipByBox").lockBoxFaces(e)},unlockBox:function(){this._opt.viewer.getViewer().editorManager.getToolByName("clipByBox").unlockBox()},getState:function(){var e=this._opt.viewer,t=this._sectionBox.saveState(),i=t.boundingBox;return i.min=e.sceneToWorld(i.min),i.max=e.sceneToWorld(i.max),t},setState:function(e){this._sectionBox.loadState(e)},restore:function(){var e=this._sectionBox.getEditor()._isVisible();this._sectionBox.toggle(!0,e),this._sectionBox.reset("Rotate")},getSectionBox:function(){n.send(i,"getSectionBox");var e=this._opt.viewer,t=this._sectionBox.saveState().boundingBox;return t.min=e.sceneToWorld(t.min),t.max=e.sceneToWorld(t.max),t},setSectionBox:function(e){n.send(i,"setSectionBox");var t=this._opt.viewer,o=t.getViewer().getScene(),r=CLOUD$1.ClipPlaneManager.getInstance(o),a=t.worldToScene(e.min),s=t.worldToScene(e.max);r.setSectionBox(a,s)},update:function(){this._sectionBox.update()},setObjectsById:function(e){this._opt.viewer.getModels().forEach(function(t){t.localClippingComponentsById(e)}),this._sectionBox.update(),this._opt.viewer.render()},setObjectsByObjectData:function(e){this._opt.viewer.getModels().forEach(function(t){t.localClippingComponentsByObjectData(e)}),this._sectionBox.update(),this._opt.viewer.render()},restoreObjects:function(){this._opt.viewer.getModels().forEach(function(e){e.clearLocalClipping()}),this._sectionBox.update(),this._opt.viewer.render()},changeClipDirection:function(e){this._opt.viewer.getViewer().editorManager.getToolByName("clipByBox").changeDirection(e)}},o.SectionBox=r}(),function(){var e=Object.freeze({Forward:"Forward",Reverse:"Reverse"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section").SectionPlaneDirection=e}(),function(){var e=Object.freeze({X:"X",Y:"Y",Z:"Z"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section").SectionPlanePlane=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),t=function(){return{viewer:null,progress:50,plane:Glodon$1.Bimface.Plugins.Section.SectionPlanePlane.X,direction:Glodon$1.Bimface.Plugins.Section.SectionPlaneDirection.Forward}};e.SectionPlaneConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(){function e(t,i){_classCallCheck(this,e),this.coordinateSystem=t,this.viewer=i,this.container=this.viewer.domElement,this.mapDrawables={},this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.xmlns="http://www.w3.org/2000/svg";var e=document.createElement("div");e.style.left="0px",e.style.top="0px",e.style.width=this.container.offsetWidth+"px",e.style.height=this.container.offsetHeight+"px",e.style.position="absolute",e.style.zIndex=5,this.group=document.createElementNS(this.xmlns,"svg"),this.group.setAttribute("width",this.container.offsetWidth+""),this.group.setAttribute("height",this.container.offsetHeight+""),e.appendChild(this.group),this.container.appendChild(e)}},{key:"makeCircle",value:function(e,t){var i=this.mapDrawables;void 0==i[e]&&(i[e]=document.createElementNS(this.xmlns,"circle"),this.group.appendChild(i[e]));var n=i[e];n.style.fill=t.color||"#FF0000",n.setAttribute("r",t.radius+""),n.setAttribute("transform","translate("+t.center.x+","+t.center.y+")")}},{key:"show",value:function(e,t){var i=this.getDrawable(e);i&&(i.style.display=t?"block":"none")}},{key:"fill",value:function(e,t){this.getDrawable(e).style.fill=t?"block":"none"}},{key:"makeLine",value:function(e,t){var i=this.mapDrawables;void 0==i[e]&&(i[e]=document.createElementNS(this.xmlns,"line"),this.group.appendChild(i[e]));var n=i[e];n.setAttribute("stroke",t.color||"#000000"),n.setAttribute("stroke-width",t.width||3),n.setAttribute("x1",t.start.x+""),n.setAttribute("y1",t.start.y+""),n.setAttribute("x2",t.end.x+""),n.setAttribute("y2",t.end.y+"")}},{key:"makeDashLine",value:function(e,t){this.makeLine(e,t),this.mapDrawables[e].setAttribute("stroke-dasharray",t.dashArray)}},{key:"makePolyline",value:function(e,t){var i=null,n=this.mapDrawables;void 0==n[e]&&(n[e]=document.createElementNS(this.xmlns,"polyline"),this.group.appendChild(n[e])),i=n[e],i.setAttribute("stroke",t.color||"#A9A9A9"),i.setAttribute("stroke-width",t.width||3),i.style.fill="none",i.setAttribute("points",t.points)}},{key:"makeDefs",value:function(e){var t=this.mapDrawables;void 0==t[e]&&(t[e]=document.createElementNS(this.xmlns,"defs"),void 0==t.marker&&(t.marker=this.makeMarker(),t[e].appendChild(t.marker)),this.group.appendChild(t[e]))}},{key:"makeMarker",value:function(){var e=document.createElementNS(this.xmlns,"marker");e.setAttribute("id","arrow"),e.setAttribute("viewBox","0 0 10 10"),e.setAttribute("refX","5"),e.setAttribute("refY","5"),e.setAttribute("markerWidth","6"),e.setAttribute("markerHeight","6"),e.setAttribute("orient","auto-start-reverse");var t=document.createElementNS(this.xmlns,"path");return t.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t.style.fill="#11DAB7",this.mapDrawables.arrow=t,e.appendChild(t),e}},{key:"getDrawable",value:function(e){return this.mapDrawables[e]}},{key:"attach",value:function(){this.getDrawable("axisZ").setAttribute("marker-end","url(#arrow)")}},{key:"setColor",value:function(e,t){this.getDrawable(e).setAttribute("stroke",t)}},{key:"fill",value:function(e,t){this.getDrawable(e).style.fill=t}},{key:"hideAll",value:function(e){var t=1==e?"none":"block";this.group.parentNode.style.display=t}},{key:"destroy",value:function(){for(var e=this.group.children,t=0;t<e.length;t++)this.group.removeChild(e[t]);var i=this.group.parentNode;i&&i.removeChild(this.group)}}]),e}());e.CoordinateDrawer=t}(),function(){var e=Object.freeze({SectionPlaneUpdate:"SectionPlaneUpdate",SectionPlaneChanged:"SectionPlaneChanged"});Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section").SectionPlaneEvent=e}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(){function e(t,i){_classCallCheck(this,e),this.coordinateSystem=t,this.viewer=t.viewer.getViewer(),this.drawingImpl=i,this.viewportOffset=this.viewer.domElement.getBoundingClientRect(),this.cameraControl=this.viewer.cameraControl,this.fillClipPlane=CLOUD$1.FillClipPlaneManager.getInstance(this.viewer.getScene()),this.initialize(),this.eventManager=t.viewer.getEventManager()}return _createClass(e,[{key:"initialize",value:function(){this.arrowMouseDown=!1,this.circleXMouseDown=!1,this.circleYMouseDown=!1,this.firstClickDown=!0,this.firstRotate=!0,this.lineOut=!0,this.arrowOut=!0,this.translateStartPt=new THREE.Vector2,this.translateEndPt=new THREE.Vector2,this.rotateAngleA=0,this.rotateAngleB=0,this.config=this.coordinateSystem.config,this.sectionPlaneEvent=Glodon$1.Bimface.Plugins.Section.SectionPlaneEvent}},{key:"registerArrowEvents",value:function(){var e=this.drawingImpl.getDrawable("axisZ"),t=this,i=this.config.colors;e.onmouseover=function(){1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&(t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.drawingImpl.setColor("tipArcX",i.default),t.drawingImpl.fill("cubeX",i.default),t.drawingImpl.setColor("tipArcY",i.default),t.drawingImpl.fill("cubeY",i.default),t.lineOut=!1)},e.onmouseout=function(){1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&0==t.arrowMouseDown&&1==t.arrowOut&&(t.drawingImpl.setColor("axisZ",i.arrow),t.drawingImpl.fill("arrow",i.arrow),t.drawingImpl.setColor("tipArcX",i.tipArcX),t.drawingImpl.fill("cubeX",i.cubeX),t.drawingImpl.setColor("tipArcY",i.tipArcY),t.drawingImpl.fill("cubeY",i.cubeY),t.lineOut=!0)},e.onmousedown=function(e){t.arrowMouseDown=!0,t.lineOut=!1;var i=t.config.colors;t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.coordinateSystem.colorUpdate=!1,t.translateStartPt.set(e.clientX,e.clientY)};var n=this.drawingImpl.getDrawable("arrow");n.onmouseover=function(){if(1!=t.circleXMouseDown&&1!=t.circleYMouseDown){t.arrowOut=!1;var e=t.config.colors;t.drawingImpl.fill("arrow",e.highLight),t.drawingImpl.setColor("axisZ",e.highLight),t.drawingImpl.setColor("tipArcX",e.default),t.drawingImpl.fill("cubeX",e.default),t.drawingImpl.setColor("tipArcY",e.default),t.drawingImpl.fill("cubeY",e.default)}},n.onmouseout=function(){if(1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&0==t.arrowMouseDown&&1==t.lineOut){t.arrowOut=!0;var e=t.config.colors;t.drawingImpl.setColor("axisZ",e.arrow),t.drawingImpl.fill("arrow",e.arrow),t.drawingImpl.setColor("tipArcX",e.tipArcX),t.drawingImpl.fill("cubeX",e.cubeX),t.drawingImpl.setColor("tipArcY",e.tipArcY),t.drawingImpl.fill("cubeY",e.cubeY)}},n.onmousedown=function(e){t.arrowMouseDown=!0,t.arrowOut=!1;var i=t.config.colors;t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.translateStartPt.set(e.clientX,e.clientY)},document.onmousemove=function(e){if(1==t.arrowMouseDown){t.fillClipPlane.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1;if(!(e.clientX==t.translateStartPt.x&&e.clientY==t.translateStartPt.y)){var i=t.fillClipPlane.renderClipPlane,n=i.normal.clone();n.w=i.constant;var o=t.cameraControl.movePlane(n,e,t.translateStartPt,!1,t.fillClipPlane.position.clone());null!=o&&t.fillClipPlane.offset(o),t.translateStartPt.set(e.clientX,e.clientY),t.cameraControl.update(!0)}t.coordinateSystem.update();var r=t.config.colors;t.drawingImpl.setColor("axisZ",r.highLight),t.drawingImpl.fill("arrow",r.highLight),t.drawingImpl.setColor("tipArcX",r.default),t.drawingImpl.fill("cubeX",r.default),t.drawingImpl.setColor("tipArcY",r.default),t.drawingImpl.fill("cubeY",r.default),e.preventDefault(),e.stopPropagation(),t.fireSectionPlaneChangedEvent()}},document.onmouseup=function(){if(0!=t.arrowMouseDown){t.arrowMouseDown=!1,t.coordinateSystem.colorUpdate=!0;var e=t.config.colors;t.drawingImpl.setColor("axisZ",e.arrow),t.drawingImpl.fill("arrow",e.arrow),t.drawingImpl.setColor("tipArcX",e.tipArcX),t.drawingImpl.fill("cubeX",e.cubeX),t.drawingImpl.setColor("tipArcY",e.tipArcY),t.drawingImpl.fill("cubeY",e.cubeY),t.fillClipPlane.calculateClippingIds(),CLOUD$1.GlobalData.ClippingCaps=!0,t.viewer.render()}}}},{key:"registerCircleXEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcX");i.onmousedown=function(){e.circleXMouseDown=!0,e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.enableCircleXMovement()},i.onmouseout=function(){0==e.circleXMouseDown&&(e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow),e.drawingImpl.setColor("tipArcY",t.tipArcY),e.drawingImpl.fill("cubeY",t.cubeY),e.coordinateSystem.circleToArc("tipArcX"))},document.addEventListener("mouseup",function(){1==e.circleXMouseDown&&(e.fillClipPlane.calculateClippingIds(),CLOUD$1.GlobalData.ClippingCaps=!0,e.viewer.render()),e.circleXMouseDown=!1,e.circleXMouseDown=!1,e.firstClickDown=!0,e.firstRotate=!1,e.lastRotateX=0,e.lastRotateY=0,e.drawingImpl.show("tipArcY",!0),e.drawingImpl.show("axisY",!0),e.drawingImpl.show("axisZ",!0),e.drawingImpl.show("cubeY",!0),e.coordinateSystem.update(),e.drawingImpl.show("dashLineX",!1),e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow)})}},{key:"registerCircleYEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcY");i.onmousedown=function(){e.circleYMouseDown=!0,e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.enableCircleYMovement()},i.onmouseout=function(){0==e.circleYMouseDown&&(e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow),e.coordinateSystem.circleToArc("tipArcY"),e.drawingImpl.setColor("tipArcX",t.tipArcX),e.drawingImpl.fill("cubeX",t.cubeX))},document.addEventListener("mouseup",function(){1==e.circleYMouseDown&&(e.fillClipPlane.calculateClippingIds(),CLOUD$1.GlobalData.ClippingCaps=!0,e.viewer.render()),e.circleYMouseDown=!1,e.drawingImpl.show("tipArcX",!0),e.drawingImpl.show("cubeX",!0),e.coordinateSystem.update(),e.drawingImpl.show("dashLineY",!1),e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow)})}},{key:"enableCircleXMovement",value:function(){var e=this,t=this.config.colors;document.addEventListener("mousemove",function(i){if(1==e.circleXMouseDown){e.drawingImpl.show("dashLineX",!0),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.fillClipPlane.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1;var n=e.fillClipPlane.normalIndex,o=e.viewportOffset,r=new THREE.Vector2(i.clientX-o.left,i.clientY-o.top),a=e.calcRotateAngleIndex(r,e.coordinateSystem.discretePointsX);1==e.firstClickDown&&(e.lastIndex=a);var s=2*(a-e.lastIndex);n>3?s=-s:"Reverse"==e.coordinateSystem.planeDirection&&(s=-s),e.drawingImpl.show("tipArcY",!1),e.coordinateSystem.updateAxisZ();var l=e.fillClipPlane.renderClipPlane.normal.clone(),u=e.coordinateSystem.getCoordinateAxis(),c=e.config.styles;e.coordinateSystem.drawClipPlaneCircle("tipArcZ",u.start.clone(),c.auxCircleRadius,e.coordinateSystem.dirX,l);var h=e.coordinateSystem.drawingToCanvas(u.start.clone()),d=e.coordinateSystem.drawingToCanvas(u.endY.clone());e.coordinateSystem.drawAxisY(h,d,t.highLight),e.coordinateSystem.drawCubeX("cubeX",d,c.cubeRadius),e.drawingImpl.show("cubeY",!1);var f="x";n<2&&(f="y"),e.fillClipPlane.rotateAngleOffset(s,f),e.coordinateSystem.backwardCoordinate(),1==e.firstClickDown?e.firstClickDown=!1:e.lastIndex=a,e.translateStartPt.set(i.clientX,i.clientY),e.viewer.render(),i.preventDefault(),i.stopPropagation(),e.fireSectionPlaneChangedEvent()}})}},{key:"enableCircleYMovement",value:function(){var e=this,t=this.config.colors;document.addEventListener("mousemove",function(i){if(1==e.circleYMouseDown){e.drawingImpl.show("dashLineY",!0),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.fillClipPlane.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1;var n=e.fillClipPlane.normalIndex,o=e.viewportOffset,r=new THREE.Vector2(i.clientX-o.left,i.clientY-o.top),a=e.calcRotateAngleIndex(r,e.coordinateSystem.discretePointsY);1==e.firstClickDown&&(e.lastIndex=a);var s=2*(a-e.lastIndex);n>3&&(s=-s,"Reverse"==e.coordinateSystem.planeDirection&&(s=-s)),e.drawingImpl.show("tipArcX",!1),e.coordinateSystem.updateAxisZ();var l=e.fillClipPlane.renderClipPlane.normal.clone(),u=e.coordinateSystem.getCoordinateAxis(),c=e.config.styles;e.coordinateSystem.drawClipPlaneCircle("tipArcZ",u.start.clone(),c.auxCircleRadius,e.coordinateSystem.dirX.clone(),l.clone());var h=e.coordinateSystem.drawingToCanvas(u.start.clone()),d=e.coordinateSystem.drawingToCanvas(u.endX.clone());e.coordinateSystem.drawAxisX(h,d,t.highLight),e.coordinateSystem.drawCubeY("cubeY",d,c.cubeRadius),e.drawingImpl.show("cubeX",!1);var f="z";n>3&&(f="y"),e.fillClipPlane.rotateAngleOffset(s,f),e.coordinateSystem.backwardCoordinate(),1==e.firstClickDown?e.firstClickDown=!1:e.lastIndex=a,e.translateStartPt.set(i.clientX,i.clientY),e.viewer.render(),i.preventDefault(),i.stopPropagation(),e.fireSectionPlaneChangedEvent()}})}},{key:"registerTipArcXEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcX");i.onmouseover=function(){0==e.circleYMouseDown&&(e.coordinateSystem.arcToCircle("tipArcX"),e.drawingImpl.setColor("tipArcY",t.default),e.drawingImpl.fill("cubeY",t.default),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.registerCircleXEvents())},i.onmouseout=function(){0==e.circleXMouseDown&&e.coordinateSystem.circleToArc("tipArcX")}}},{key:"registerTipArcYEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcY");i.onmouseover=function(){0==e.circleXMouseDown&&(e.coordinateSystem.arcToCircle("tipArcY"),e.drawingImpl.setColor("tipArcX",t.default),e.drawingImpl.fill("cubeX",t.default),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.registerCircleYEvents())},i.onmouseout=function(){0==e.circleYMouseDown&&e.coordinateSystem.circleToArc("tipArcY")}}},{key:"calcRotateAngleIndex",value:function(e,t){for(var i=this.coordinateSystem.cOrigin,n=this.createLine(e,i),o=-1,r=Number.POSITIVE_INFINITY,a=0;a<90;a++){var s=t[a].clone(),l=this.disPointToLine(s,n);l<r&&(r=l,o=a)}var u=90+o;return t[o].clone().distanceTo(e)<t[u].clone().distanceTo(e)?o:u}},{key:"createLine",value:function(e,t){var i={};if(e.x==t.x)i.A=1,i.B=0,i.C=-e.x;else{var n=(t.y-e.y)/(t.x-e.x),o=t.y-n*t.x;i.A=n,i.B=-1,i.C=o}return i}},{key:"disPointToLine",value:function(e,t){return Math.abs(t.A*e.x+t.B*e.y+t.C)/Math.sqrt(t.A*t.A+t.B*t.B)}},{key:"fireSectionPlaneChangedEvent",value:function(){var e=this.coordinateSystem.viewer._sectionPlane;this.eventManager.fireEvent(this.sectionPlaneEvent.SectionPlaneChanged,e.getSectionPlane())}}]),e}());e.CoordinateAction=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),t=function(){return{colors:{tipArcX:"#0000FF",cubeX:"#0000FF",tipArcY:"#FF0000",cubeY:"#FF0000",highLight:"#FFFF00",tipLine:"#11DAB7",arrow:"#11DAB7",default:"#A9A9A9"},styles:{dashArray:"10 8",originRadius:5,auxCircleRadius:100,tipLineLength:500,cubeRadius:5,axisXWidth:2,axisYWidth:2,axisZWidth:3,axisXLength:100,axisYLength:100,axisZLength:165,segments:180,tipArcLeftCounts:15,tipArcRightCounts:60}}};e.CoordinateSystemConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),t=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(){function e(t){_classCallCheck(this,e),this.viewer=t;var i=this.viewer.getViewer();this.cameraControl=i.cameraControl,this.fillClipPlane=CLOUD$1.FillClipPlaneManager.getInstance(i.getScene()),this.container=i.domElement,this.config=new Glodon$1.Bimface.Plugins.Section.CoordinateSystemConfig,this.drawingImpl=new Glodon$1.Bimface.Plugins.Section.CoordinateDrawer(this,i),this.coordinateAction=new Glodon$1.Bimface.Plugins.Section.CoordinateAction(this,this.drawingImpl),this.updateBinded=this.update.bind(this),this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.enable=!0,this.boundingBox=new THREE.Box2,this.bRegisterArrowEvent=!1,this.bRegisterAuxCircleEvent=!1,this.mapDrawableName={ORIGIN:"origin",AXISX:"axisX",AXISY:"axisY",CUBEX:"cubeX",CUBEY:"cubeY",AXISZ:"axisZ",ARROW:"arrow",DASHLINE:"dashLine",TIPARC_X:"tipArcX",TIPARC_Y:"tipArcY",TIPARC_Z:"tipArcZ",DASHLINE_X:"dashLineX",DASHLINE_Y:"dashLineY"}}},{key:"setDirection",value:function(e){this.planeDirection=e}},{key:"saveTransform",value:function(e){this.savedCamera=e.clone()}},{key:"drawingToCanvas",value:function(e,t){var i=this.getCoordinateAxis(),n=i.start.clone(),o=this.cameraControl.camera,r=new THREE.Vector3,a=this.viewer.getViewer();if(void 0==this.cameraToCenter){var s=a.getCamera(),l=a.getScene().getOriginalBoundingBoxWorld().clone();l.applyMatrix4(a.getScene().geometryGroup.matrix),o.setStandardView(CLOUD$1.EnumStandardView.ISO,l),o.zoomToBBox(l),n=this.getCoordinateAxis().start.clone(),this.cameraToCenter=n.clone().sub(o.position.clone()).length();var u=a.getScene().getMatrixGlobal(),c=CLOUD$1.CameraUtil.parseCameraInfo(s),h=CLOUD$1.Camera.worldToDrawing(c,u),d=new THREE.Vector3;d.subVectors(h.target,h.position),o.LookAt(h.target,d,h.up),this.cameraControl.update(!0,!0)}else{var d=n.clone().sub(o.position.clone()).normalize(),f=o.position.clone().sub(n.clone()).length();r=d.multiplyScalar(this.cameraToCenter-f)}var g=this.container.offsetWidth,v=this.container.offsetHeight;!1!==t&&o.isPerspective&&e.add(r);var m=CLOUD$1.CameraUtil.drawingToCanvas(o,e,g,v);return new THREE.Vector2(m.x,m.y)}},{key:"getCoordinateAxis",value:function(){var e=this.fillClipPlane.renderClipPlane,t=e.normal.clone(),i=this.fillClipPlane.getCoordinate(),n=i.axisY.clone(),o=t.clone().cross(n.clone());this.fillClipPlane.normalIndex>3&&(o=i.axisX.clone(),n=o.clone().cross(t.clone()));var r=this.config.styles,a=this.fillClipPlane.position.clone(),s=a.clone().add(o.clone().multiplyScalar(r.axisXLength)),l=a.clone().add(n.clone().multiplyScalar(r.axisYLength)),u=a.clone().add(t.clone().multiplyScalar(r.axisZLength));return this.dirX=o,this.dirY=n,{start:a,endX:s,endY:l,endZ:u}}},{key:"drawOrigin",value:function(e,t){var i=this.mapDrawableName,n={center:e,radius:t,color:this.config.colors.default};this.drawingImpl.makeCircle(i.ORIGIN,n)}},{key:"drawAxisX",value:function(e,t,i){var n=this.mapDrawableName,o=this.config,r={start:e,end:t,width:o.styles.axisXWidth,color:i||this.config.colors.default};this.drawingImpl.makeLine(n.AXISX,r)}},{key:"drawAxisY",value:function(e,t,i){var n=this.mapDrawableName,o=this.config,r={start:e,end:t,width:o.styles.axisYWidth,color:i||o.colors.default};this.drawingImpl.makeLine(n.AXISY,r)}},{key:"drawAxisZ",value:function(e,t){var i=this.mapDrawableName,n=this.config,o={start:e,end:t,width:n.styles.axisZWidth,color:n.colors.arrow};this.drawingImpl.makeLine(i.AXISZ,o),this.drawingImpl.attach(),0==this.bRegisterArrowEvent&&(this.coordinateAction.registerArrowEvents(),this.bRegisterArrowEvent)}},{key:"updateAxisZ",value:function(){var e=this.getCoordinateAxis(),t=this.drawingToCanvas(e.start.clone()),i=this.drawingToCanvas(e.endZ.clone()),n=this.mapDrawableName,o={start:t,end:i,color:this.config.colors.default};this.drawingImpl.makeLine(n.AXISZ,o)}},{key:"drawArrow",value:function(e,t){var i=this.mapDrawableName,n={start:e,end:t};this.drawingImpl.makeLine(i.AXISZ,n),this.drawingImpl.attach(),this.drawingImpl.setColor(i.AXISZ,this.config.colors.default),0==this.bRegisterArrowEvent&&(this.coordinateAction.registerArrowEvents(),this.bRegisterArrowEvent)}},{key:"drawClipPlaneCircle",value:function(e,t,i,n,o){for(var r={center:t.clone(),radius:i,normal:n.clone(),rotateAxis:o.clone()},a=this.config.styles,s=a.segments,l=this.discreteCircle(r,s),u="",c=0;c<s;c++)u+=l[c].x+","+l[c].y,u+=" ";u+=l[0].x+","+l[0].y,u+=" ";var h={points:u,color:this.config.colors.default,width:2};this.drawingImpl.makePolyline(e,h)}},{key:"drawTipArc",value:function(e,t,i,n,o){var r={center:t.clone(),radius:i,normal:n.clone(),rotateAxis:o.clone()},a=this.config.styles,s=a.tipArcRightCounts,l=a.tipArcLeftCounts,u=a.segments,c=this.discreteCircle(r,u);e==this.mapDrawableName.TIPARC_X?(this.discretePointsX=c,s=a.tipArcLeftCounts,l=a.tipArcRightCounts):this.discretePointsY=c;for(var h="",d=u-s-1;d<u;d++)h+=c[d].x+","+c[d].y,h+=" ";for(var f=0;f<=l;f++)h+=c[f].x+","+c[f].y,h+=" ";var g={points:h,color:this.config.colors.tipArcX};e==this.mapDrawableName.TIPARC_X?(this.drawingImpl.makePolyline(e,g),this.coordinateAction.registerTipArcXEvents()):e==this.mapDrawableName.TIPARC_Y&&(g.color=this.config.colors.tipArcY,this.drawingImpl.makePolyline(e,g),this.coordinateAction.registerTipArcYEvents())}},{key:"drawTipLine",value:function(e,t,i){
var n=this.drawingToCanvas(t.clone(),!1),o=this.drawingToCanvas(i.clone(),!1),r=this.config,a={start:n,end:o,color:r.colors.tipLine,dashArray:r.styles.dashArray};this.drawingImpl.makeDashLine(e,a),this.drawingImpl.show(e,!1)}},{key:"drawCubeX",value:function(e,t,i){var n={center:t,radius:i,color:this.config.colors.cubeX};this.drawingImpl.makeCircle(e,n)}},{key:"drawCubeY",value:function(e,t,i,n){var o={center:t,radius:i,color:n||this.config.colors.cubeY};this.drawingImpl.makeCircle(e,o)}},{key:"discreteCircle",value:function(e,t){for(var i=e.center.clone(),n=e.radius,o=e.rotateAxis.clone(),r=e.normal.clone(),a=[],s=0;s<t;s++){r.applyAxisAngle(o,2*Math.PI/t);var l=i.clone().add(r.clone().multiplyScalar(n)),u=this.drawingToCanvas(l.clone());a.push(u)}return a}},{key:"arcToCircle",value:function(e){var t="",i=this.discretePointsX;e==this.mapDrawableName.TIPARC_Y&&(i=this.discretePointsY);for(var n=0,o=i.length;n<o;n++)t+=i[n].x+","+i[n].y,t+=" ";t+=i[0].x+","+i[0].y,t+=" ";var r={points:t,color:this.config.colors.highLight};this.drawingImpl.makePolyline(e,r)}},{key:"circleToArc",value:function(e){var t=this.config.styles,i=t.tipArcLeftCounts,n=t.tipArcRightCounts,o=t.segments,r=this.discretePointsX,a={color:this.config.colors.tipArcX};e==this.mapDrawableName.TIPARC_Y&&(r=this.discretePointsY,a.color=this.config.colors.tipArcY,i=t.tipArcRightCounts,n=t.tipArcLeftCounts);for(var s="",l=o-i-1;l<o;l++)s+=r[l].x+","+r[l].y,s+=" ";for(var u=0;u<=n;u++)s+=r[u].x+","+r[u].y,s+=" ";a.points=s,this.drawingImpl.makePolyline(e,a)}},{key:"update",value:function(e){if(1==e||1!=this.bIsCoordinateHided){var t=this.getCoordinateAxis(),i=this.drawingToCanvas(t.start.clone()),n=this.drawingToCanvas(t.endX.clone()),o=this.drawingToCanvas(t.endY.clone()),r=this.drawingToCanvas(t.endZ.clone());void 0==this.createRefs&&(this.drawingImpl.makeDefs("refs"),this.createRefs=!0),this.cOrigin=i.clone(),this.drawAxisZ(i,r),this.drawAxisX(i,n),this.drawAxisY(i,o);var a=this.config.styles,s=this.mapDrawableName,l=this.fillClipPlane.renderClipPlane.normal.clone();this.drawClipPlaneCircle(s.TIPARC_Z,t.start.clone(),a.auxCircleRadius,this.dirX,l),this.drawTipArc(s.TIPARC_X,t.start.clone(),a.auxCircleRadius,l,this.dirX),this.drawTipArc(s.TIPARC_Y,t.start.clone(),a.auxCircleRadius,l,this.dirY);var u=this.fillClipPlane.getSideLength()/2,c=t.start.clone().add(this.dirX.clone().multiplyScalar(u)),h=t.start.clone().sub(this.dirX.clone().multiplyScalar(u));this.drawTipLine(s.DASHLINE_X,c,h);var d=t.start.clone().add(this.dirY.clone().multiplyScalar(u)),f=t.start.clone().sub(this.dirY.clone().multiplyScalar(u));this.drawTipLine(s.DASHLINE_Y,d,f),this.drawOrigin(i,a.originRadius);var g=this.discretePointsX[44].clone();this.drawCubeX(s.CUBEX,g,a.cubeRadius);var v=this.discretePointsY[134].clone();this.drawCubeY(s.CUBEY,v,a.cubeRadius),this.updateBbox()}}},{key:"hide",value:function(e){this.drawingImpl.hideAll(e),this.bIsCoordinateHided=e}},{key:"destroy",value:function(){this.drawingImpl.destroy()}},{key:"updateBbox",value:function(){this.boundingBox.makeEmpty();for(var e=0;e<this.discretePointsX.length;e++){var t=this.discretePointsX[e].clone();this.boundingBox.expandByPoint(t)}for(e=0;e<this.discretePointsY.length;e++){var t=this.discretePointsY[e].clone();this.boundingBox.expandByPoint(t)}var i=this.getCoordinateAxis(),n=this.drawingToCanvas(i.start.clone()),o=this.drawingToCanvas(i.endZ.clone());this.boundingBox.expandByPoint(n),this.boundingBox.expandByPoint(o),this.boundingBox.expandByScalar(5)}},{key:"insideBoundingBox",value:function(e){return this.boundingBox.containsPoint(e.clone())}},{key:"backwardCoordinate",value:function(){var e=this.cameraControl.camera.position,t=this.cameraControl.camera.target,i=t.clone().sub(e.clone()).normalize(),n=this.fillClipPlane.renderClipPlane.normal.clone();i.angleTo(n);Math.PI}}]),e}());e.CoordinateSystem=t}(),function(){var e="Bimface.Plugins.Section.SectionPlane",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Section"),n=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility")),o={Forward:0,Reverse:1},r={X:0,Y:2,Z:4},a=function(e){var t=this,i=e.viewer;return i?i instanceof Glodon$1.Bimface.Viewer.Viewer3D||i instanceof Glodon$1.Bimface.Viewer.ViewerGIS?(i._sectionBox&&(i._sectionBox.hideBox(),!1!==e.exitSectionBox&&i._sectionBox.exit()),i._sectionPlane?(i._sectionPlane.showPlane(),i._sectionPlane):(i._sectionPlane=this,t.id=e.id,t._opt=e,t.mode=e.mode,t._plane=e.plane,t._direction=e.direction,t._progress=-1,this.onFloorExplosionBinded=this.onFloorExplosion.bind(this),this.onClipMouseHoverBinded=this.onClipMouseHover.bind(this),this.onClipMouseMoveBinded=this.onClipMouseMove.bind(this),t.init(),void t.setPlane(e.plane))):void console.log("viewer should be Viewer3D or ViewerGIS."):void console.log("domElement must not be empty.")};a.prototype={init:function(){t.send(e,"init"),this.enableCoordinate=!0;var i=this._opt.viewer,n=i.getViewer(),o=this;this.coordinateSystem=new Glodon$1.Bimface.Plugins.Section.CoordinateSystem(i),this.coordinateSystem.setDirection(this._direction),CLOUD$1.GlobalData.ClippingCaps=!0,n.editorManager.enableTool(n,CLOUD$1.EditToolMode.CLIP_FILL),this._sectionTool=CLOUD$1.FillClipPlaneManager.getInstance(n.getScene()),this._sectionTool.observer=function(){var e=Glodon$1.Bimface.Plugins.Section.SectionPlaneEvent;i.getEventManager().fireEvent(e.SectionPlaneUpdate,o)},this._sectionTool.enable(!0,!0),this.hookEvens()},hookEvens:function(){var e=this.coordinateSystem,t=this._opt.viewer.getViewer(),i=n.throttle;t.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,this.onClipMouseHoverBinded),t.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_MOUSE_MOVE,this.onClipMouseMoveBinded),t.registerEventListener(CLOUD$1.EVENTS.ON_EDITOR_ZOOM,i(e.updateBinded,50)),t.registerEventListener(CLOUD$1.EVENTS.ON_CAMERA_ANIMATION_UPDATE,i(e.updateBinded,50)),t.registerEventListener(CLOUD$1.EVENTS.ON_EDITOR_END,function(){e.update(!0)}),this._opt.viewer.addEventListener(Glodon$1.Bimface.Viewer.Viewer3DEvent.FloorExplosion,this.onFloorExplosionBinded)},onFloorExplosion:function(){this.resetSectionTool(),this._opt.viewer.render()},onClipMouseHover:function(e){var t=this.coordinateSystem,i=this._opt.viewer.getDomElement();if(0!=this.enableCoordinate)if(e.onClipPlane)t.hide(!1),t.update();else{i.style.cursor="";var n=new THREE.Vector2(e.event.clientX,e.event.clientY);t.insideBoundingBox(n)?t.hide(!1):t.hide(!0)}},onClipMouseMove:function(){this.coordinateSystem.update()},exit:function(){var e=this._opt.viewer.getViewer(),t=CLOUD$1.FillClipPlaneManager.getInstance(e.getScene());e.editorManager.disableTool(CLOUD$1.EditToolMode.CLIP_FILL),t.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1,t.enable(!1,!1),this.coordinateSystem.destroy(),e.getScene().removeObjectGroup(t),e.getScene().fillClipPlane=null,e.modelManager.resetClippingCapsStatus();var i=Glodon$1.Bimface.Plugins.Section.SectionPlaneEvent;this._opt.viewer.getEventManager().fireEvent(i.SectionPlaneUpdate,null),this._sectionTool=null,this._opt.viewer._sectionPlane=null,e.unregisterEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,this.onClipMouseHoverBinded),e.unregisterEventListener(CLOUD$1.EVENTS.ON_CLIP_MOUSE_MOVE,this.onClipMouseMoveBinded),this._opt.viewer.removeEventListener(Glodon$1.Bimface.Viewer.Viewer3DEvent.FloorExplosion,this.onFloorExplosionBinded)},setProgress:function(i){t.send(e,"setProgress");var n=1-i/50;this._progress=i,this._sectionTool.setProcess(n),this._sectionTool.clearCapsWireframe(),this._sectionTool.calculateClippingIds()},getProgress:function(){return 50*(1-this._sectionTool.getProcess())},setPlane:function(i){t.send(e,"setPlane");var n=o[this._direction]+r[i];this._plane=i,this._sectionTool.changeNormal(n),this.setProgress(this._opt.progress)},getPlane:function(){return this._plane},setDirection:function(i){t.send(e,"setDirection");var n=o[i]+r[this._plane];this._direction=i,this._sectionTool.changeNormal(n),this.setProgress(this._opt.progress)},getDirection:function(){return this._direction},setRotateAngle:function(e,t){this._sectionTool.setRotateAngle(e,t)},getRotateAngle:function(){return this._sectionTool.getRotateAngle()},hidePlane:function(){t.send(e,"hidePlane"),this._sectionTool&&(this._sectionTool.visible=!1),this.enableCoordinate=!1,this.coordinateSystem.hide(!0)},showPlane:function(){t.send(e,"showPlane"),this._sectionTool&&(this._sectionTool.visible=!0),this.enableCoordinate=!0},rotateByAxis:function(i,n){if(t.send(e,"rotateByAxis"),"YAxis"!==i&&"ZAxis"!==i)return void console.log("Rotate axis must be YAxis or ZAxis.");var a="",s=0,l=o[this.getDirection()]+r[this._plane];0==l||1==l?(s="YAxis"===i?-n:n,a="YAxis"===i?"y":"z"):2==l||3==l?(s="YAxis"===i?-n:n,a="YAxis"===i?"x":"z"):4!=l&&5!=l||(s="YAxis"===i?n:-n,a="YAxis"===i?"x":"y"),s="Reverse"===this._direction?n:s,this._sectionTool&&(this._sectionTool.rotateAngleOffset(s,a),this._sectionTool.clearCapsWireframe(),this._sectionTool.calculateClippingIds())},reset:function(){t.send(e,"reset");var i=this;i.setPlane(i._opt.plane),i.setDirection(i._opt.direction),i.setProgress(i._opt.progress)},getState:function(){return this._sectionTool.store()},isIncluded:function(e){var t=this._opt.viewer,i=t.getViewer().getScene(),n=CLOUD$1.FillClipPlaneManager.getInstance(i),o=n.renderClipPlane.normal.clone().normalize(),r=n.position,a=t.worldToScene(e),s=new THREE.Vector3;return s.subVectors(a,r).normalize(),o.angleTo(s)>Math.PI/2},setPositionByPlane:function(e,t,n){var o=this._opt.viewer;e=o.worldToScene(e),t=o.worldToScene(t);var r=new THREE.Vector3(e.x,e.y,e.z),a=new THREE.Vector3(t.x,t.y,t.z),s=r.clone().add(a.clone().multiplyScalar(n));this._opt.plane=i.SectionPlanePlane.X,this._opt.direction=i.SectionPlaneDirection.Forward,this.reset(),this._sectionTool.update();var l=new THREE.Vector3(1,0,0),u=new THREE.Vector3(0,1,0),c=1,h=a.clone().projectOnPlane(u);if(0!=h.length){h.normalize(),c=l.clone().cross(h).y>0?1:-1;var d=l.clone().angleTo(h);this.rotateByAxis("ZAxis",d*THREE.Math.RAD2DEG*c)}var f=h.clone().angleTo(a.clone());c=a.y<0?1:-1,this.rotateByAxis("YAxis",f*THREE.Math.RAD2DEG*c),this._sectionTool.position.copy(s),this._sectionTool.center.copy(s),this._sectionTool.update(),this._sectionTool.clearCapsWireframe()},setState:function(i){t.send(e,"setState"),this._sectionTool.restore(i)},restoreRotation:function(){this._sectionTool.restoreRotation()},getSectionPlane:function(){var e=this._opt.viewer,t=this._sectionTool.position.clone(),i=this._sectionTool.renderClipPlane.normal.clone();return t=e.sceneToWorld(t),i=e.sceneToWorld(i),i=new THREE.Vector3(i.x,i.y,i.z),i.normalize(),{position:t,normal:i}},setSectionPlane:function(e){var t=this._opt.viewer;this.reset();var i=t.worldToScene(e.position),n=t.worldToScene(e.normal);n=new THREE.Vector3(n.x,n.y,n.z),n.normalize();var o=new THREE.Vector3(1,0,0),r=new THREE.Quaternion;r.setFromUnitVectors(o,n);var a=new THREE.Euler;a.setFromQuaternion(r),a.x=0,r.setFromEuler(a),r.x=-r.x;var s=this._sectionTool.uniforms.vClipPlane.value[0].clone(),l=new THREE.Vector3(s.x,s.y,s.z);l.normalize();var u=new THREE.Vector3(i.x,i.y,i.z),c=u.sub(this._sectionTool.center);this._sectionTool.planeOffset=c.x/l.x,this._sectionTool.quaternion.copy(r),this._sectionTool.position.copy(i),this._sectionTool.update()},resetSectionTool:function(){var e=this._opt.viewer,t=e.getViewer().getScene(),i=t.getBoundingBox();this._sectionTool.resize(i.getSize().multiplyScalar(t.expandScalar)),this._sectionTool.center.copy(i.getCenter()),this._sectionTool.position.copy(i.getCenter()),this._sectionTool.update(),this._sectionTool.clearCapsWireframe(),this._sectionTool.calculateClippingIds()},setObjectsById:function(e){this._opt.viewer.getModels().forEach(function(t){t.localClippingComponentsById(e)}),this._sectionTool.update(),this._opt.viewer.render()},setObjectsByObjectData:function(e){this._opt.viewer.getModels().forEach(function(t){t.localClippingComponentsByObjectData(e)}),this._sectionTool.update(),this._opt.viewer.render()},restoreObjects:function(){this._opt.viewer.getModels().forEach(function(e){e.clearLocalClipping()}),this._sectionTool.update(),this._opt.viewer.render()},setBorder:function(e,t,i){var n=20,o=20;this._opt.viewer instanceof Glodon$1.Bimface.Viewer.Viewer3D?(n=this._opt.viewer.getViewer().worldToDrawing({x:e,y:0,z:0}).x,o=this._opt.viewer.getViewer().worldToDrawing({x:t,y:0,z:0}).x):this._opt.viewer instanceof Glodon$1.Bimface.Viewer.ViewerGIS&&(n=e||n,o=t||o),n=Math.max(1,n),o=Math.max(1,o),this._sectionTool.setBorder(n,o,i)},drawComponentContours:function(){var e=this,t=this._opt.viewer.getViewer(),i=t.getScene().getOrCreateObjectGroup(CLOUD$1.ObjectGroupType.CAPSWIREFRAME,{globalSpace:!0}),n=this._sectionTool.capsIntersectContour;for(var o in n)!function(t){var o=n[t],r=e._opt.viewer.getModel(t).getModelTransformation(),a=(new THREE.Matrix4).fromArray(r);for(var s in o){o[s].map(function(e){e.map(function(e){var t=new THREE.Geometry;t.vertices=e;var n=new THREE.Line(t,new THREE.LineBasicMaterial({color:16711680,depthTest:!1}));n.matrixAutoUpdate=!1,n.matrix.copy(a),i.add(n),n.updateMatrixWorld(!0)})})}}(o)},getComponentContours:function(e,t){if(!this._sectionTool)return void console.warn("The SectionPlane is unavailable");var i=this._opt.viewer,n=e;if(i instanceof Glodon$1.Bimface.Viewer.ViewerGIS){var o=i.getLayerManager().getLayer(e);if(!o)return void console.warn("Parameter layerId is invalid.");n=o.modelId}var r=i.getModel(n);if(!r)return void console.warn("Parameter modelId is invalid.");var a=r.getComponentContours(t);if(i instanceof Glodon$1.Bimface.Viewer.ViewerGIS)for(var s=a.length,l=0;l<s;++l)delete a[l].modelId,a[l].layerId=e;return a}},i.SectionPlane=a}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Walkthrough"),t=function(){return{viewer:null,time:10,stopCallback:null}};e.WalkthroughConfig=t}(),function(){var e="Bimface.Plugins.Walkthrough",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Walkthrough"),n=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.HttpRequest"),function(){function i(e){_classCallCheck(this,i);var t=e.viewer,n=t.getViewer();return t?"Viewer3D"!==t.getViewerType()&&"ViewerGIS"!==t.getViewerType()?void console.log("ViewerType is not supported."):(this._viewer=t,this.bPause=!1,this.cameraStatus=null,this._walkthrough=new CLOUD$1.Walkthrough,this._player=new CLOUD$1.WalkthroughPlayer(n),this._player.setWalkthrough(this._walkthrough),e.stopCallback&&this._player.addStopPlayCallback(e.stopCallback),void this.setWalkthroughTime(e.time)):void console.log("viewer must not be empty.")}return _createClass(i,[{key:"addKeyFrame",value:function(i){t.send(e,"addKeyFrame");var n=this._viewer,o=n.getViewer().camera,r={id:Glodon$1.Web.Lang.Utility.UUID.createUUID(),position:o.position.clone(),target:o.target.clone(),name:i};this._walkthrough.addKeyFrame(r);var a=Object.assign({},r);return a.position=n.sceneToWorld(r.position),a.target=n.sceneToWorld(r.target),a.coordinateSystem="world",a}},{key:"setKeyFrameCallback",value:function(i){t.send(e,"setKeyFrameCallback"),this._player.setKeyFrameCallback(i)}},{key:"removeKeyFrame",value:function(i){t.send(e,"removeKeyFrame"),this._walkthrough.removeKeyFrame(i)}},{key:"clearKeyFrames",value:function(){t.send(e,"clearKeyFrames"),this._walkthrough.clearFrames()}},{key:"setKeyFrames",value:function(i){var n=this;t.send(e,"setKeyFrames"),"string"==typeof i&&(i=JSON.parse(i));var o=[];i.forEach(function(e){var t=Object.assign({},e);"world"===t.coordinateSystem&&(t.position=n._viewer.worldToScene(e.position),t.target=n._viewer.worldToScene(e.target)),o.push(t)}),this._walkthrough.setKeyFrameList(o)}},{key:"getKeyFrames",value:function(){var e=this,t=this._walkthrough.getKeyFrames(),i=[];return t.forEach(function(t){var n=Object.assign({},t);n.position=e._viewer.sceneToWorld(t.position),n.target=e._viewer.sceneToWorld(t.target),n.coordinateSystem="world",i.push(n)}),i}},{key:"setWalkthroughTime",value:function(i){t.send(e,"setWalkthroughTime"),this._walkthrough.setWalkthroughTime(i)}},{key:"play",value:function(i){t.send(e,"play");var n=this._viewer.getViewer(),o=this._player,r=this.cameraStatus,a=n.cameraControl.camera;if(a.up.set(0,1,0),a.realUp.set(0,1,0),i&&o.startFrom(i),o.stop(!1),!0===this.bPause){var a=n.getCamera();r&&function(e){var e=JSON.parse(e),t=e.position,i=e.target,n={position:new THREE.Vector3(t.x,t.y,t.z),target:new THREE.Vector3(i.x,i.y,i.z)},o=r,a=n.position.clone().sub(o.position),s=n.target.clone().sub(o.target);return a.length()>0||s.length()>0}(a)&&(this._player.camera.position.copy(this._viewer.worldToScene(r.position)),this._player.camera.target.copy(this._viewer.worldToScene(r.target)))}o.play(),this.bPause=!1}},{key:"pause",value:function(){t.send(e,"pause"),this.bPause=!0,this.cameraStatus=this._viewer.getCameraStatus(),this._player.pause()}},{key:"stop",value:function(){t.send(e,"stop"),this._player.stop(!0),this._stopCallback&&this._stopCallback(),this.bPause=!1}},{key:"stopCallback",value:function(i){t.send(e,"stopCallback"),i&&(this._stopCallback=i,this._player.addStopPlayCallback(i))}}]),i}());i.Walkthrough=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Segment"),t=function(){return{viewer:null}};e.SegmentConfig=t}(),function(){Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Segment").IsolateOption=Object.freeze({Hidden:"Hidden",Translucent:"Translucent",PartlyTranslucent:"PartlyTranslucent"})}(),function(){var e="Bimface.Plugins.Segment",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Segment"),n=function(){function i(e){_classCallCheck(this,i),this._viewer=e.viewer,this._segmentInfoMap=null,this._segmentInfoArray=null,this._segmentIdArray=null,this._elementIdMap={},this._loading=!1,this._segmentInfoAcquired=!1,this._segmentIdMapFromComponentId={},this._traversedSegmentIdMap={}}return _createClass(i,[{key:"destroy",value:function(){this._viewer=null,this._segmentInfoMap=null,this._segmentInfoArray=null,this._segmentIdArray=null,this._elementIdMap=null,this._segmentIdMapFromComponentId=null,this._traversedSegmentIdMap=null}},{key:"_hasSegmentInfo",value:function(e){return!(!this._segmentInfoMap||!this._segmentInfoMap[e])}},{key:"_getSegmentInfoById",value:function(e){return this._segmentInfoMap?this._segmentInfoMap[e]:null}},{key:"_removeDuplication",value:function(e){for(var t={},i=0,n=e.length;i<n;i++)this._hasSegmentInfo(e[i])&&!t[e[i]]&&(t[e[i]]=!0);return Object.keys(t)}},{key:"_getSegmentElementIdsByIdx",value:function(e,t,i){var n=this,o=this._viewer,r=e[t];if(n._elementIdMap[r])return void(i&&i());o.getSegmentElementIds(r,function(e){e.data&&(n._elementIdMap[r]=e.data,n.segmentFileInfoMap[r].elementIds=n._elementIdMap[r]),i&&i()},function(){i&&i()})}},{key:"_getSegmentElementIds",value:function(e,t){function i(e,r){var a=r;return function(){o._getSegmentElementIdsByIdx(e,a,function(){a<n-1?requestAnimationFrame(i(e,a+1)):t&&t()})}}e||(e=this._segmentIdArray);var n=e.length,o=this;n>0?requestAnimationFrame(i(e,0)):t&&t()}},{key:"_getSegmentMetadataByIdx",value:function(e,t,i){var n=this._viewer,o=e[t],r=this.segmentFilePathMap[o].metadata,a=this.segmentFilePathMap[o].databag;n.getSegmentManager().getSegmentMetadata(a,r,function(){i&&i()},function(){i&&i()})}},{key:"_getSegmentMetadata",value:function(e){function t(i,r){var a=r;return function(){o._getSegmentMetadataByIdx(i,a,function(){a<n-1?requestAnimationFrame(t(i,a+1)):e&&e()})}}var i=Object.keys(this.segmentFilePathMap),n=i.length,o=this;n>0?requestAnimationFrame(t(i,0)):e&&e()}},{key:"_loadMetadata",value:function(e){for(var t=this._viewer,i=this._segmentIdArray,n=this.segmentFilePathMap={},o=this.segmentFileInfoMap={},r=0,a=i.length;r<a;r++){var s=i[r],l=this._getSegmentInfoById(s),u=l.partialElementFiles,c=[];if(u)for(var h=0,d=u.length;h<d;h++){var f=u[h].databagId;if(f){var g=null;n[f]?g=n[f]:(g={databag:t.getDatabagResource(f),metadata:t.getPartialElementsMetadataFile(f),fileId:u[h].fileId},n[f]=g),c.push(g)}}o[s]={id:s,paths:c}}this._getSegmentMetadata(e)}},{key:"_loadSegments",value:function(e,t){if(!(e=e||this._segmentIdArray))return void(t&&t());for(var i=this._viewer,n=this._removeDuplication(e),o=[],r=0,a=n.length;r<a;r++){var s=this.segmentFileInfoMap[n[r]];s&&o.push(s)}if(0===o.length)return void(t&&t());i.getSegmentManager().loadSegments(o,function(){t&&t()})}},{key:"getSegmentInfo",value:function(i){function n(e,t){if(e.subGroups)for(var i=e.subGroups,o=0,r=i.length;o<r;o++)n(i[o],t);else if(e.segments)for(var a=0,s=e.segments.length;a<s;a++){var l=e.segments[a];t[l.id]=l}}if(t.send(e,"getSegmentInfo"),this._loading)return null;if(this._segmentInfoAcquired)return i&&i(this._segmentInfoArray),this._segmentInfoArray;var o=this;return this._loading=!0,this._viewer.getSegmentTree(function(e){for(var t=e.data,r=o._segmentInfoMap={},a=0,s=t.length;a<s;a++)n(t[a],r);o._segmentIdArray=Object.keys(o._segmentInfoMap),o._segmentInfoArray=[];for(var l=o._segmentInfoArray.length=o._segmentIdArray.length,u=0;u<l;u++)o._segmentInfoArray[u]=o._segmentInfoMap[o._segmentIdArray[u]];o._loadMetadata(function(){o._loading=!1,o._segmentInfoAcquired=!0,i&&i(o._segmentInfoArray)})},function(e){console.error("request segment data error!")}),null}},{key:"loadSegments",value:function(i,n){t.send(e,"loadSegments");var o=this;this._segmentInfoAcquired?o._getSegmentElementIds(i,function(){o._loadSegments(i,n)}):this.getSegmentInfo(function(e){o._getSegmentElementIds(i,function(){o._loadSegments(i,n)})})}},{key:"unloadSegments",value:function(i){t.send(e,"unloadSegments"),(i=i||this._segmentIdArray)&&(this._viewer.getSegmentManager().unloadSegments(this._removeDuplication(i)),this._viewer.render())}},{key:"hideComponentsBySegment",value:function(i){t.send(e,"hideComponentsBySegment"),this._viewer.getSegmentManager().hideComponentsBySegment(this._removeDuplication(i)),this._viewer.render()}},{key:"showComponentsBySegment",value:function(i){t.send(e,"showComponentsBySegment"),this._viewer.getSegmentManager().showComponentsBySegment(this._removeDuplication(i)),this._viewer.render()}},{key:"isolateComponentsBySegment",value:function(i,n){t.send(e,"isolateComponentsBySegment");var o=void 0,r=Glodon$1.Bimface.Plugins.Segment.IsolateOption;switch(n){case r.Hidden:o=this._viewer.getSegmentManager().getSegmentIsolateOption().HIDDEN;break;case r.Translucent:o=this._viewer.getSegmentManager().getSegmentIsolateOption().TRANSLUCENT;break;case r.PartlyTranslucent:o=this._viewer.getSegmentManager().getSegmentIsolateOption().PARTLYTRANSLUCENT}void 0!==o&&(this._viewer.getSegmentManager().isolateComponentsBySegment(this._removeDuplication(i),o),this._viewer.render())}},{key:"disable",value:function(){this._viewer.getSegmentManager().disable(),this._viewer.render()}},{key:"enable",value:function(){this._viewer.getSegmentManager().enable(),this._viewer.render()}},{key:"getSegementIds",value:function(e){if(!this._segmentInfoAcquired)return console.error("Call the function getSegmentInfo() first!"),null;var t=this._segmentIdMapFromComponentId;if(t[e])return t[e];for(var i=Object.keys(this._elementIdMap),n=0,o=i.length;n<o;n++){var r=i[n];if(!this._traversedSegmentIdMap[r]){this._traversedSegmentIdMap[r]=!0;for(var a=this._elementIdMap[r],s=0,l=a.length;s<l;s++){var u=a[s];t[u]||(t[u]=[]),t[u].push(r)}}}var c=this._viewer.getSegmentManager().getSegmentIdsByPartialElementId(e);return c&&(t[e]=c),t[e]}}]),i}();i.Segment=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.AxisGrid"),i=function(){function t(e){_classCallCheck(this,t),this.svgContainer=e,this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line"),i=t.cloneNode();i.style.strokeWidth=1,i.style.stroke="#ffffff",i.style.opacity=.5,this.svgContainer.appendChild(i),this.lineLeft=i;var n=t.cloneNode();n.style.strokeWidth=1,n.style.stroke="#ffffff",n.style.opacity=.5,this.svgContainer.appendChild(n),this.lineRight=n}},{key:"updateBorderLeft",value:function(e,t){var i=new THREE.Vector2(e.x,e.y),n=new THREE.Vector2(t.x,t.y);e.y==t.y?(i.y-=2,n.y-=2):(i.x-=2,n.x-=2),this.moveLineTo(this.lineLeft,i,n)}},{key:"updateBorderRight",value:function(e,t){var i=new THREE.Vector2(e.x,e.y),n=new THREE.Vector2(t.x,t.y);e.y==t.y?(i.y+=2,n.y+=2):(i.x+=2,n.x+=2),this.moveLineTo(this.lineRight,i,n)}},{key:"hide",value:function(){this.lineLeft.style.display="none",this.lineRight.style.display="none",this.visibility=!1}},{key:"show",value:function(){this.lineLeft.style.display="block",this.lineRight.style.display="block",this.visibility=!0}},{key:"update",value:function(e,t){0!=this.visibility&&(this.updateBorderLeft(e,t),this.updateBorderRight(e,t))}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}}]),t}();t.HighlightBorderLines=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.AxisGrid"),i=function(){function t(e,i){_classCallCheck(this,t),this.svgContainer=e,this.viewer=i,this.borderline=new Glodon$1.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line");t.style.strokeWidth=2,t.style.stroke="#32D5A7",this.svgContainer.appendChild(t),this.line=t}},{key:"hide",value:function(){this.line.style.display="none",this.borderline.hide(),this.visibility=!1}},{key:"show",value:function(){this.line.style.display="block",this.borderline.show(),this.visibility=!0}},{key:"setLine",value:function(e){this.highlightLine=e}},{key:"setHeight",value:function(e){this.axisgridHeight=e}},{key:"update",value:function(){if(0!=this.visibility){var e=this.highlightLine,t=new THREE.Vector3(e[0],e[1],this.axisgridHeight),i=new THREE.Vector3(e[3],e[4],this.axisgridHeight),n=this.worldPointsToClient(t,i);n&&(this.moveLineTo(this.line,n.start,n.end),this.borderline.update(n.start,n.end))}}},{key:"worldPointsToClient",value:function(e,t){var i=this.viewer.getDomElement(),n=i.getBoundingClientRect(),o=this.viewer.getViewer(),r=o.worldPointsToClient(e,t);return r&&(r.start.x-=n.left,r.start.y-=n.top,r.end.x-=n.left,r.end.y-=n.top),r}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}}]),t}();t.HighlightLine=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.AxisGrid"),i=function(){function t(e,i){_classCallCheck(this,t),this.svgContainer=e,this.viewer=i,this.horizBorderline=new Glodon$1.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.verticalBorderline=new Glodon$1.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line"),i=t.cloneNode();i.style.strokeWidth=2,i.style.stroke="#32D5A7",this.svgContainer.appendChild(i),this.svgHorizLine=i;var n=t.cloneNode();n.style.strokeWidth=2,n.style.stroke="#32D5A7",this.svgContainer.appendChild(n),this.svgVerticalLine=n;var o=e.createNS("circle","bf-axisgrid-point");o.setAttribute("r",3),o.setAttribute("fill","#32D5A7"),this.svgContainer.appendChild(o),this.hoverPoint=o,this.hide()}},{key:"setLine",value:function(e,t){this.horizLine=e,this.verticalLine=t}},{key:"setPoint",value:function(e){this.intersectPoint=e}},{key:"setHeight",value:function(e){this.axisgridHeight=e}},{key:"update",value:function(){if(0!=this.visibility){var e=this.horizLine,t=this.verticalLine,i=this.viewer.worldToClient(this.intersectPoint),n=new THREE.Vector3(e[0],e[1],this.axisgridHeight),o=new THREE.Vector3(e[3],e[4],this.axisgridHeight),r=new THREE.Vector3(t[0],t[1],this.axisgridHeight),a=new THREE.Vector3(t[3],t[4],this.axisgridHeight),s=this.worldPointsToClient(n,o);s&&(this.moveLineTo(this.svgHorizLine,s.start,s.end),this.horizBorderline.update(s.start,s.end));var l=this.worldPointsToClient(r,a);l&&(this.moveLineTo(this.svgVerticalLine,l.start,l.end),this.verticalBorderline.update(l.start,l.end)),this.movePointTo(this.hoverPoint,i.x,i.y)}}},{key:"worldPointsToClient",value:function(e,t){var i=this.viewer.getDomElement(),n=i.getBoundingClientRect(),o=this.viewer.getViewer(),r=o.worldPointsToClient(e,t);return r&&(r.start.x-=n.left,r.start.y-=n.top,r.end.x-=n.left,r.end.y-=n.top),r}},{key:"hide",value:function(){this.svgHorizLine.style.display="none",this.svgVerticalLine.style.display="none",this.hoverPoint.style.display="none",this.horizBorderline.hide(),this.verticalBorderline.hide(),this.visibility=!1}},{key:"show",value:function(){this.svgHorizLine.style.display="block",this.svgVerticalLine.style.display="block",this.hoverPoint.style.display="block",this.horizBorderline.show(),this.verticalBorderline.show(),this.visibility=!0}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}},{key:"movePointTo",value:function(e,t,i){e.setAttribute("cx",t),e.setAttribute("cy",i)}}]),t}();t.HighlightIntersectLines=i}(),function(){var e="Bimface.Plugins.AxisGrid",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.AxisGrid"),o=function(){function n(o){_classCallCheck(this,n),t.send(e,"AxisGridManager"),this.snapMinDistance=5,this.viewer=o.viewer,this.registerEvent(),this.domContainer=i.create("div","bf-axisgrid-conext"),this.domContainer.style.position="absolute",this.domContainer.style.left=0,this.domContainer.style.top=0,this.domContainer.style.width="100%",this.domContainer.style.height="100%",this.svgContainer=i.createNS("svg","bf-axisgrid-svg"),this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.domContainer.appendChild(this.svgContainer),this.viewer.getDomElement().appendChild(this.domContainer);var r=Glodon$1.Bimface.Plugins.AxisGrid;this.highlightLine=new r.HighlightLine(this.svgContainer,this.viewer),this.highlightIntersectLines=new r.HighlightIntersectLines(this.svgContainer,this.viewer)}return _createClass(n,[{key:"registerEvent",value:function(){function e(e){var a=!0,s=e.point,l=e.height,u=e.snapLines,c=e.nearestPoint,h=u.intersectLines,d=u.gridLine,f=i.viewer.worldToClient(s),g=i.viewer.worldToClient(c.toGridLine),v=i.viewer.worldToClient(c.toIntersection),m=i.distance(f,g),p=i.distance(f,v),y=null;if(p<=i.snapMinDistance&&void 0!==h){i.highlightIntersectLines.show(),i.highlightLine.hide();var w=h[0],b=h[1];y=w.name+"-"+b.name,i.highlightIntersectLines.setHeight(l),i.highlightIntersectLines.setLine(w,b),i.highlightIntersectLines.setPoint(c.toIntersection),i.highlightIntersectLines.update()}else m<=i.snapMinDistance?(y=d.name,i.highlightLine.show(),i.highlightIntersectLines.hide(),i.highlightLine.setHeight(l),i.highlightLine.setLine(d),i.highlightLine.update(l)):(o=null,i.highlightLine.hide(),i.highlightIntersectLines.hide(),a=!1)
;return o!=y&&(p<=i.snapMinDistance||m<=i.snapMinDistance)&&(n.fireEvent(t.Hover,{objectType:r.axisGrids,objectId:y,worldPosition:s}),o=y),a}var t=Glodon$1.Bimface.Viewer.Viewer3DEvent,i=this,n=this.viewer.getEventManager(),o=null,r={component:"Component",room:"Room",axisGrids:"AxisGrids"};this.viewer.addEventListener(t.AxisGridHover,function(t){var i=!0,n=!1,o=void 0;try{for(var r,a=t.snaps[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){if(e(r.value))break}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}),this.viewer.addEventListener(t.Rendered,function(){var t=t||window.event,n=i.viewer.getViewer(),o=n.getScene();if(!o.axisGridEnableHover)return i.highlightLine.hide(),void i.highlightIntersectLines.hide();i.viewer.getModels().forEach(function(r){var a=r.modelId,s=CLOUD.AxisGridManager.getInstance(o,a);if(t&&"mousewheel"==t.type){var l=o.getMatrixGlobal(),u=new THREE.Vector2(t.clientX,t.clientY),c=n.cameraControl.getRaycaster(u.x,u.y),h=s.getIntersectPoints(c,l),d=s.snapOnFloors(h);if(d&&0==d.length)return i.highlightLine.hide(),void i.highlightIntersectLines.hide();var f=!0,g=!1,v=void 0;try{for(var m,p=d[Symbol.iterator]();!(f=(m=p.next()).done);f=!0){if(e(m.value))break}}catch(e){g=!0,v=e}finally{try{!f&&p.return&&p.return()}finally{if(g)throw v}}}}),i.highlightLine.update(),i.highlightIntersectLines.update()})}},{key:"distance",value:function(e,t){var i=e.x-t.x,n=e.y-t.y,o=e.z-t.z;return Math.sqrt(i*i+n*n+o*o)}}]),n}();n.AxisGridManager=o}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.AxisGrid"),t=function(){return{viewer:null}};e.AxisGridManagerConfig=t}(),function(){var e=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),t=function(){function e(t,i,n){_classCallCheck(this,e),this.viewer3D=t,this.worldPosition=!0===n?null:i,this.clientPosition=!0===n?i:null,this.svgElement=null,this.xmlns="http://www.w3.org/2000/svg",this.glodonColor="#11DAB7",this.gridHighlightColor="#FF7F00",this.observer=function(){},this.uuid=-1,this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.worldPosition?this.clientPosition=this.viewer3D.worldToClient(this.worldPosition):this.worldPosition=this.viewer3D.clientToWorld(this.clientPosition);var e=document.createElementNS(this.xmlns,"circle");e.setAttribute("r",3),e.setAttribute("style","stroke: "+this.glodonColor+"; stroke-width: 1; fill: #ffffff"),e.setAttribute("transform","translate("+this.clientPosition.x+","+this.clientPosition.y+")"),this.svgElement=e}},{key:"setObserver",value:function(e){this.observer=e}},{key:"hightlight",value:function(){this.svgElement.style.stroke=this.gridHighlightColor}},{key:"cancelHightlight",value:function(){this.svgElement.style.stroke=this.glodonColor}},{key:"distanceTo",value:function(e){var t=e.x-this.clientPosition.x,i=e.y-this.clientPosition.y;return Math.sqrt(t*t+i*i)}},{key:"detach",value:function(){this.svgElement.parentNode.removeChild(this.svgElement)}},{key:"update",value:function(e){1==e?this.worldPosition=this.viewer3D.clientToWorld(this.clientPosition):this.clientPosition=this.viewer3D.worldToClient(this.worldPosition),this.svgElement.setAttribute("transform","translate("+this.clientPosition.x+","+this.clientPosition.y+")")}},{key:"isEqualWith",value:function(e){return e.uuid==this.uuid}},{key:"getWorldPosition",value:function(){var e=this.worldPosition;return[e.x,e.y,e.z]}},{key:"getClientPosition",value:function(){return new THREE.Vector2(this.clientPosition.x,this.clientPosition.y)}},{key:"setClientPosition",value:function(e){this.clientPosition.x=e.x,this.clientPosition.y=e.y}},{key:"getSvgElement",value:function(){return this.svgElement}}]),e}();e.EditPoint=t}(),function(){var e=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.svgElement=null,this.xmlns="http://www.w3.org/2000/svg",this.gridHighlightColor="#FF7F00",this.editPoints=t,this.initialize(),this.hide()}return _createClass(e,[{key:"initialize",value:function(){var e=this.editPoints[0],t=this.editPoints[1],i=document.createElementNS(this.xmlns,"line");i.setAttribute("stroke",this.gridHighlightColor),i.setAttribute("stroke-width",3),i.setAttribute("x1",e.getClientPosition().x+""),i.setAttribute("y1",e.getClientPosition().y+""),i.setAttribute("x2",t.getClientPosition().x+""),i.setAttribute("y2",t.getClientPosition().y+""),this.svgElement=i}},{key:"show",value:function(){this.update(),this.svgElement.style.display="block"}},{key:"hide",value:function(){this.svgElement.style.display="none"}},{key:"update",value:function(){var e=this.editPoints[0],t=this.editPoints[1];this.svgElement.setAttribute("x1",e.getClientPosition().x+""),this.svgElement.setAttribute("y1",e.getClientPosition().y+""),this.svgElement.setAttribute("x2",t.getClientPosition().x+""),this.svgElement.setAttribute("y2",t.getClientPosition().y+"")}},{key:"detach",value:function(){this.svgElement.parentNode.removeChild(this.svgElement)}},{key:"startWithNull",value:function(){return null==this.editPoints[0]}},{key:"endWith",value:function(e){return this.editPoints[1].isEqualWith(e)}},{key:"distanceTo",value:function(e){var t=e.x-this.clientPosition.x,i=e.y-this.clientPosition.y;return Math.sqrt(t*t+i*i)}},{key:"getSvgElement",value:function(){return this.svgElement}}]),e}();e.EditEdge=t}(),function(){var e=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.editPoints=t,this.polyline=null,this.xmlns="http://www.w3.org/2000/svg",this.glodonColor="#11DAB7",this.boundaryHighlightColor="#FF7F00",this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.setObserver();var e=this.formatPolyline(this.editPoints),t=document.createElementNS(this.xmlns,"polyline");t.setAttribute("stroke",this.glodonColor),t.setAttribute("stroke-width",2),t.style.fill=this.glodonColor,t.style.fillOpacity="0.4",t.setAttribute("points",e),this.polyline=t}},{key:"setObserver",value:function(){this.updateBinded=this.update.bind(this);var e=!0,t=!1,i=void 0;try{for(var n,o=this.editPoints[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setObserver(this.updateBinded)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"formatPolyline",value:function(e){var t="",i=!0,n=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,l=s.getClientPosition();t+=l.x+","+l.y,t+=" "}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}var u=e[0].getClientPosition();return t+=u.x+","+u.y,t+=" "}},{key:"update",value:function(){var e=this.formatPolyline(this.editPoints);this.polyline.setAttribute("points",e)}},{key:"rebuild",value:function(e){this.editPoints=e,this.initialize()}},{key:"getSvgElement",value:function(){return this.polyline}}]),e}();e.Boundary=t}();var RoomEditingUtil=function e(){_classCallCheck(this,e)};RoomEditingUtil.distanceToSegment=function(e,t,i){var n=this.nearestPointOnSegment(e,t,i);return e.distanceTo(n)},RoomEditingUtil.nearestPointOnSegment=function(e,t,i){var n=t.distanceToSquared(i);if(0==n)return e.distanceTo(t);var o=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;o=Math.max(0,Math.min(1,o));var r=new THREE.Vector2;return r.x=t.x+o*(i.x-t.x),r.y=t.y+o*(i.y-t.y),r};var Drawable=function(){function e(t){_classCallCheck(this,e),this.drawables=[],this.drawableStyle=t,this.style={},this.id="",this.hitTestEpsilon=10,this.highlightColor="#FFF227",this.grayColor="#BBBBBB"}return _createClass(e,[{key:"attach",value:function(t){this.drawables.forEach(function(i){if(i instanceof e){var n=!0,o=!1,r=void 0;try{for(var a,s=i.getDrawables()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;t.appendChild(l)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}}else t.appendChild(i)})}},{key:"detach",value:function(){var t=!0,i=!1,n=void 0;try{for(var o,r=this.drawables[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if(a instanceof e){var s=!0,l=!1,u=void 0;try{for(var c,h=a.getDrawables()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value,f=d.parentNode;f&&f.removeChild(d)}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}}else{var f=a.parentNode;f&&f.removeChild(a),this.drawables=[]}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"hitTest",value:function(e){}},{key:"setDefault",value:function(){}},{key:"select",value:function(e){}},{key:"setGray",value:function(){}},{key:"magnify",value:function(){}},{key:"resetSize",value:function(){}},{key:"hide",value:function(){}},{key:"show",value:function(){}},{key:"isArrow",value:function(){return!1}},{key:"getId",value:function(){return this.id}},{key:"getDrawables",value:function(){return this.drawables}},{key:"toVector2",value:function(e){return new THREE.Vector2(e.x,e.y)}},{key:"toVector3",value:function(e){return new THREE.Vector3(e.x,e.y,e.z)}}]),e}(),Arrow=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.id=e.id,i.color=e.color,i.length=e.length||130,i.markerWidth=e.markerWidth||4,i.markerHeight=e.markerHeight||4,i.lineWidth=e.lineWidth||4,i.start=null,i.target=null,i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){this.drawables=[];var i=MeasureUtil.makeMarker({id:this.id,color:this.color,markerWidth:this.markerWidth,markerHeight:this.markerHeight});this.drawables.push(i);var n={color:this.color,lineWidth:this.lineWidth+"px",start:e,end:t};this.start=e,this.target=t;var o=MeasureUtil.makeLine(n);o.setAttribute("marker-end","url(#"+this.id+")"),this.drawables.push(o)}},{key:"setDefault",value:function(){this.drawables[1].style.stroke=this.color,document.getElementById(this.id).children[0].style.fill=this.color}},{key:"setGray",value:function(){this.drawables[1].style.stroke=this.grayColor,document.getElementById(this.id).children[0].style.fill=this.grayColor}},{key:"select",value:function(){this.drawables[1].style.stroke=this.highlightColor,document.getElementById(this.id).children[0].style.fill=this.highlightColor}},{key:"hitTest",value:function(e){var t=this.hitTestEpsilon,i=new THREE.Vector3(e.x,e.y,0),n=new THREE.Line3(new THREE.Vector3(this.start.x,this.start.y,0),new THREE.Vector3(this.target.x,this.target.y,0)),o=new THREE.Vector3;return n.closestPointToPoint(i,!0,o),o.distanceTo(i)<=t?this:null}},{key:"hide",value:function(){document.getElementById(this.id).children[0].style.display="none",this.drawables[1].style.display="none"}},{key:"show",value:function(){this.drawables[1].style.display="block",document.getElementById(this.id).children[0].style.display="block"}},{key:"getDirection",value:function(){var e=this.target.clone().sub(this.start).normalize();return new THREE.Vector3(e.x,e.y,0)}},{key:"magnify",value:function(){var e=document.getElementById(this.id);e.setAttribute("markerWidth",6),e.setAttribute("markerHeight",6)}},{key:"resetSize",value:function(){var e=document.getElementById(this.id);e.setAttribute("markerWidth",4),e.setAttribute("markerHeight",4)}},{key:"isArrow",value:function(){return!0}}]),t}(Drawable),EditHeight=function(){function e(){_classCallCheck(this,e),this.glodonColor="#32D3A6",this.highlightColor="#F99D0B",this.hitTestEpsilon=5,this.drawables=[],this.upSegment=[],this.downSegment=[]}return _createClass(e,[{key:"update",value:function(e){var t=this;this.drawables=[],this.upSegment=[],this.downSegment=[],this.points=e;for(var i=0;i<e.length;i++){var n=MeasureUtil.makeLine({start:e[i],end:e[(i+1)%4],lineWidth:"2px",color:this.glodonColor});this.drawables.push(n)}var o={},r=[].concat(_toConsumableArray(e),[e[0]]);o.points=MeasureUtil.calcPolylinePoints(r),o.width="1px",o.color="rgba(0,0,0,0)",o.fillColor="rgba(50, 211, 166, 0.1)";var a=MeasureUtil.makePolyline(o);this.drawables.push(a),this.upSegment.push(this.drawables[3]),this.downSegment.push(this.drawables[1]);var s=new THREE.Vector2((e[0].x+e[3].x)/2,(e[0].y+e[3].y)/2),l=new THREE.Vector2((e[1].x+e[2].x)/2,(e[1].y+e[2].y)/2),u=[s,l],c=10,h=0,d=["1","2","3","4"],f=!0,g=!1,v=void 0;try{for(var m,p=u[Symbol.iterator]();!(f=(m=p.next()).done);f=!0){var y=m.value,w=new Arrow({id:d[h++],color:this.glodonColor,length:8,lineWidth:3,markerWidth:4,markerHeight:4});w.update(y,y.clone().add(new THREE.Vector2(0,c))),c*=-1,w.getDrawables().forEach(function(e){t.drawables.push(e),h<=2&&t.upSegment.push(e),h>2&&t.downSegment.push(e)}),w.id=d[h++],w.update(y,y.clone().add(new THREE.Vector2(0,c))),c*=-1,w.getDrawables().forEach(function(e){t.drawables.push(e),h<=2&&t.upSegment.push(e),h>2&&t.downSegment.push(e)})}}catch(e){g=!0,v=e}finally{try{!f&&p.return&&p.return()}finally{if(g)throw v}}}},{key:"hitTest",value:function(e){var t=new THREE.Vector2(e.x,e.y),i=this.points[0],n=this.points[3],o=this.points[1],r=this.points[2],a=[];a.push(new THREE.Vector2(i.x,i.y)),a.push(new THREE.Vector2(n.x,n.y));var s=[];s.push(new THREE.Vector2(o.x,o.y)),s.push(new THREE.Vector2(r.x,r.y));var l=RoomEditingUtil.distanceToSegment(t,a[0],a[1]);return l<=this.hitTestEpsilon?"up-segment":(l=RoomEditingUtil.distanceToSegment(t,s[0],s[1]),l<=this.hitTestEpsilon?"down-segment":null)}},{key:"detach",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,a=r.parentNode;a&&a.removeChild(r),this.drawables=[]}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"getDrawables",value:function(){return this.drawables}},{key:"highlight",value:function(e){for(var t="up-segment"==e?this.upSegment:this.downSegment,i=[0,2,4],n=0;n<i.length;n++){t[i[n]].style.stroke=this.highlightColor}var o="up-segment"==e?["1","2"]:["3","4"],r=!0,a=!1,s=void 0;try{for(var l,u=o[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;document.getElementById(c).children[0].style.fill=this.highlightColor}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}}},{key:"cancelHighlight",value:function(){for(var e=[0,2,4],t=0;t<e.length;t++){var i=e[t];this.upSegment[i].style.stroke=this.glodonColor,this.downSegment[i].style.stroke=this.glodonColor}for(var n=["1","2","3","4"],o=0;o<n.length;o++){var r=n[o];document.getElementById(r).children[0].style.fill=this.glodonColor}}}]),e}();!function(){var e="Bimface.Plugins.RoomEditing",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),n=function(){function n(i,o){_classCallCheck(this,n),t.send(e,"RoomData"),this.viewer=i,this.roomBoundary=o,this.editHeight=null,this.editPoints=[],this.editEdges=[],this.boundary=null,this.editPointUuid=0,this.onEditPointDeletion=null,this.onEditPointAddition=null,this.isEditHeightEnabled=!1,this.roomHeightOffset={from:0,to:0}}return _createClass(n,[{key:"build",value:function(){if(this.isEditHeightEnabled)!this.editHeight&&this.makeHeight();else{this.makeEditPoints(),this.makeEditEdges(),this.makeBoundary();var e=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer}),t=e.getRoomBoundingBoxById(this.editRoomId);this.roomHeightOffset.from=t.min.z,this.roomHeightOffset.to=t.max.z}}},{key:"makeHeight",value:function(){this.editHeight=new EditHeight;var e=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer}),t=e.getRoomBoundingBoxById(this.editRoomId);this.roomHeightOffset.from=t.min.z,this.roomHeightOffset.to=t.max.z}},{key:"makeEditPoints",value:function(){for(var e=0;e<this.roomBoundary.length-1;e++){var t=this.roomBoundary[e],n=new THREE.Vector3(t[0],t[1]),o=new i.EditPoint(this.viewer,n);o.uuid=this.editPointUuid++,this.editPoints.push(o)}}},{key:"deleteEditPoint",value:function(e){for(var t=0;t<this.editPoints.length;t++){var i=this.editPoints[t];if(i.isEqualWith(e)){i.detach(),this.editPoints.splice(t,1),this.onEditPointDeletion(i);break}}}},{key:"addEditPoint",value:function(e,t){var n=e.editPoints[0],o=e.editPoints[1];e.detach();var r=this.editEdges.findIndex(function(e){return e.endWith(o)});this.editEdges.splice(r,1);var a=this.editPoints.findIndex(function(e){return e.isEqualWith(n)}),s=new THREE.Vector2(t.x,t.y),l=new i.EditPoint(this.viewer,s,!0);l.uuid=this.editPointUuid++,this.editPoints.splice(a+1,0,l);var u=new i.EditEdge([n,l]);this.editEdges.splice(r,0,u);var c=new i.EditEdge([l,o]);this.editEdges.splice(r+1,0,c),this.onEditPointAddition()}},{key:"getEditPointCounts",value:function(){return this.editPoints.length}},{key:"makeEditEdges",value:function(){for(var e=0;e<this.editPoints.length;e++){var t=[];t.push(this.editPoints[e]);var n=e==this.editPoints.length-1?0:e+1;t.push(this.editPoints[n]);var o=new i.EditEdge(t);this.editEdges.push(o)}}},{key:"mergeEditEdges",value:function(e,t){t=void 0==t?2:t;var n=this.editEdges[e],o=this.editEdges[(e+t-1)%this.editEdges.length],r=[];r.push(n.editPoints[0]),r.push(o.editPoints[1]);var a=new i.EditEdge(r);this.editEdges.splice(e,0,a),this.editEdges.splice(e+1,t)}},{key:"makeBoundary",value:function(){var e=this.editPoints;this.boundary=new i.Boundary(e)}},{key:"getEditPoints",value:function(){return this.editPoints}},{key:"getEditEdges",value:function(){return this.editEdges}},{key:"getBoundary",value:function(){return this.boundary}},{key:"getEditHeight",value:function(){return this.editHeight}},{key:"setEditRoomId",value:function(e){this.editRoomId=e}},{key:"getRoomSectionPoints",value:function(){var e=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer}),t=e.getRoomBoundingBoxById(this.editRoomId),i=t.min,n=t.max,o=[],r=(i.y+n.y)/2;o.push(new THREE.Vector3(i.x,r,this.roomHeightOffset.to)),o.push(new THREE.Vector3(i.x,r,this.roomHeightOffset.from)),o.push(new THREE.Vector3(n.x,r,this.roomHeightOffset.from)),o.push(new THREE.Vector3(n.x,r,this.roomHeightOffset.to));var a=[],s=!0,l=!1,u=void 0;try{for(var c,h=o[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=c.value;a.push(this.viewer.worldToClient(d))}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}return this.roomHeightOnCanvas=a[1].y-a[0].y,a}},{key:"updateRoomHeightOffset",value:function(e,t){var i=this.roomHeightOnCanvas,n=this.roomHeightOffset.to-this.roomHeightOffset.from,o=n/i,r=100;"m"===this.viewer._defaultUnit&&(r/=1e3),"up-segment"===e?(this.roomHeightOffset.to-=t.y*o,this.roomHeightOffset.to<this.roomHeightOffset.from+r&&(this.roomHeightOffset.to=this.roomHeightOffset.from+r)):(this.roomHeightOffset.from-=t.y*o,this.roomHeightOffset.from>this.roomHeightOffset.to-r&&(this.roomHeightOffset.from=this.roomHeightOffset.to-r))}},{key:"getRoomHeightOffset",value:function(){return[this.roomHeightOffset.from,this.roomHeightOffset.to]}}]),n}();i.RoomData=n}(),function(){var e="Bimface.Plugins.RoomEditing",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),n=function(){function i(n,o){_classCallCheck(this,i),t.send(e,"RoomView"),this.roomData=n,this.svgContainer=o,this.eventManager=null;var r=this;this.roomData.onEditPointDeletion=function(e){r.detachDrawables(),r.updateBoundary(),r.updateEditEdges(e),r.attachDrawables()},this.roomData.onEditPointAddition=function(){r.detachDrawables(),r.updateBoundary(),r.attachDrawables()}}return _createClass(i,[{key:"setEventManager",value:function(e){this.eventManager=e}},{key:"getEventManager",value:function(){return this.eventManager}},{key:"getData",value:function(){return this.roomData}},{key:"attachDrawables",value:function(){if(this.roomData.isEditHeightEnabled){var e=this.roomData.getEditHeight().getDrawables(),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;this.svgContainer.appendChild(a)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}else{var s=this.roomData.getBoundary().getSvgElement();this.svgContainer.appendChild(s);var l=!0,u=!1,c=void 0;try{for(var h,d=this.roomData.getEditEdges()[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=h.value;this.svgContainer.appendChild(f.getSvgElement())}}catch(e){u=!0,c=e}finally{try{!l&&d.return&&d.return()}finally{if(u)throw c}}var g=!0,v=!1,m=void 0;try{for(var p,y=this.roomData.getEditPoints()[Symbol.iterator]();!(g=(p=y.next()).done);g=!0){var w=p.value;this.svgContainer.appendChild(w.getSvgElement())}}catch(e){v=!0,m=e}finally{try{!g&&y.return&&y.return()}finally{if(v)throw m}}}}},{key:"detachDrawables",value:function(){for(var e=this.svgContainer.children;e.length>0;){var t=e[0];this.svgContainer.removeChild(t)}}},{key:"update",value:function(){if(this.roomData.isEditHeightEnabled){return this.roomData.getEditHeight().update(this.roomData.getRoomSectionPoints()),this.detachDrawables(),void this.attachDrawables()}var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditPoints()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.update()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var r=!0,a=!1,s=void 0;try{for(var l,u=this.roomData.getEditEdges()[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){l.value.update()}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}this.roomData.getBoundary().update()}},{key:"updateBoundary",value:function(){var e=this.roomData.getBoundary();e.setObserver(),e.update()}},{key:"updateEditEdges",value:function(e){var t=this.roomData.getEditEdges(),i=t.findIndex(function(t){return t.endWith(e)});this.roomData.mergeEditEdges(i,2)}},{key:"addCloudViewerEvents",value:function(e){this.updateBinded=this.update.bind(this),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"removeCloudViewerEvents",value:function(e){e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}}]),i}();i.RoomView=n}(),function(){var e=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.roomView=t,this.roomData=t.getData(),this.snapEditPoint=null}return _createClass(e,[{key:"begin",value:function(e){var t=new THREE.Vector3(e.x,e.y),i=this.snaping(t);this.snapEditPoint=i}},{key:"onEditing",value:function(e){var t=new THREE.Vector3(e.x,e.y);if(null==this.snapEditPoint){var i=this.snaping(t);return void(i?i.hightlight():this.cancelHightlight())}this.snapEditPoint.setClientPosition(t),this.snapEditPoint.update(!0),this.snapEditPoint.observer()}},{key:"end",value:function(e){this.snapEditPoint=null}},{key:"snaping",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.roomData.getEditPoints()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if(a.distanceTo(e)<=5)return a}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"cancelHightlight",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditPoints()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.cancelHightlight()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),e}();e.PickEditor=t}(),function(){var e=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.roomView=t,this.roomData=t.getData(),this.snapEditEdge=null,this.beginPoint=new THREE.Vector2,this.eventManager=this.roomView.getEventManager()}return _createClass(e,[{key:"begin",value:function(e){this.beginPoint.set(e.x,e.y),this.snapEditEdge=this.snaping(this.beginPoint)}},{key:"onEditing",value:function(e){var t=new THREE.Vector2(e.x,e.y);if(null==this.snapEditEdge){var i=this.snaping(t);i?(this.hideAllEdges(),i.show(),this.eventManager.fireEvent("RoomEditorAddEnter")):(this.hideAllEdges(),this.eventManager.fireEvent("RoomEditorAddExit"))}else this.eventManager.fireEvent("RoomEditorAddExit")}},{key:"end",value:function(e){if(null!=this.snapEditEdge){var t=new THREE.Vector2(e.x,e.y);if(!1===t.equals(this.beginPoint))return void(this.snapEditEdge=null);var i=this.snapEditEdge.editPoints[0].getClientPosition(),n=this.snapEditEdge.editPoints[1].getClientPosition();this.roomData.addEditPoint(this.snapEditEdge,RoomEditingUtil.nearestPointOnSegment(t,i,n)),this.snapEditEdge=null}}},{key:"hideAllEdges",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditEdges()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"snaping",value:function(e){var t=null,i=Number.MAX_SAFE_INTEGER,n=!0,o=!1,r=void 0;try{for(var a,s=this.roomData.getEditEdges()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u=l.editPoints[0].getClientPosition(),c=l.editPoints[1].getClientPosition(),h=RoomEditingUtil.distanceToSegment(e,u,c);h<i&&(i=h,t=l)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}return i<=5?t:null}}]),e}();e.AdditionEditor=t}(),function(){var e=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.roomView=t,this.roomData=t.getData(),this.snapEditPoint=null,this.beginPoint=new THREE.Vector2,this.eventManager=this.roomView.getEventManager()}return _createClass(e,[{key:"begin",value:function(e){this.beginPoint.set(e.x,e.y),this.snapEditPoint=this.snaping(this.beginPoint)}},{key:"onEditing",value:function(e){var t=new THREE.Vector3(e.x,e.y);if(null==this.snapEditPoint){var i=this.snaping(t);i?(i.hightlight(),this.eventManager.fireEvent("RoomEditorDeleteEnter")):(this.cancelHightlight(),this.eventManager.fireEvent("RoomEditorDeleteExit"))}else this.eventManager.fireEvent("RoomEditorDeleteExit")}},{key:"end",value:function(e){if(null!=this.snapEditPoint){if(!1===new THREE.Vector2(e.x,e.y).equals(this.beginPoint))return void(this.snapEditPoint=null);if(this.roomData.getEditPointCounts()<=3)return this.eventManager.fireEvent("DeletionError"),void(this.snapEditPoint=null);this.roomData.deleteEditPoint(this.snapEditPoint),this.snapEditPoint=null}}},{key:"snaping",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.roomData.getEditPoints()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if(a.distanceTo(e)<=5)return a}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"cancelHightlight",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditPoints()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.cancelHightlight()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),e}();e.DeletionEditor=t}();var HeightAdjustmentEditor=function(){function e(t){_classCallCheck(this,e),this.roomView=t,this.roomData=t.getData(),this.snapSegmentId=null,this.lastPoint=new THREE.Vector2,this.beginPoint=new THREE.Vector2}return _createClass(e,[{key:"begin",value:function(e){this.beginPoint.set(e.x,e.y),this.snapSegmentId=this.snaping(this.beginPoint),this.lastPoint.set(e.x,e.y)}},{key:"onEditing",value:function(e){var t=new THREE.Vector2(e.x,e.y),i=this.roomData.getEditHeight();if(null==this.snapSegmentId){var n=this.snaping(t);n?i.highlight(n):i.cancelHighlight()}else{var o=t.clone().sub(this.lastPoint);this.roomData.updateRoomHeightOffset(this.snapSegmentId,o),this.roomView.update(),i.highlight(this.snapSegmentId),this.lastPoint.set(t.x,t.y)}}},{key:"end",value:function(e){if(null!=this.snapSegmentId){if(!1===new THREE.Vector2(e.x,e.y).equals(this.beginPoint))return void(this.snapSegmentId=null);this.snapSegmentId=null}}},{key:"snaping",value:function(e){return this.roomData.getEditHeight().hitTest(e)}},{key:"cancelHightlight",value:function(){this.roomData.getEditHeight().cancelHightlight()}}]),e}();!function(){var e="Bimface.Plugins.RoomEditing",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing"),o=function(){function o(i){_classCallCheck(this,o),t.send(e,"RoomEditor"),this.bIsOnEditing=!1,this.viewer=i.viewer,this.lastAnimationState=null,this.restoreCameraStatus=null,this.roomInfo=this.viewer.mapCustomizedRoom[i.roomId],this.roomId=i.roomId,this.restoreStates={camera:null,sectionPlane:null},this.mapUIVisibility={"bf-tree-toolbar":"none","bf-modelTree-panel":"none","bf-toolbar-bottom":"none","bf-property-panel":"none","bf-measurement-panel":"none","bf-sectionPlane-panel":"none","bf-pickSectionPlane-panel":"none","bf-sectionBox-panel":"none","bf-settings-panel":"none","bf-basicInfo-panel":"none","bf-map-panel":"none"},this.initialize()}return _createClass(o,[{key:"initialize",value:function(){this.domContainer=i.create("div","bf-RoomEditor-conext"),this.domContainer.style.position="absolute",this.domContainer.style.left=0,this.domContainer.style.top=0,this.domContainer.style.width="100%",this.domContainer.style.height="100%",this.svgContainer=i.createNS("svg","bf-RoomEditor-svg"),this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.domContainer.appendChild(this.svgContainer),this.viewer.getDomElement().appendChild(this.domContainer),this.addDomEventListeners(),this.offset=this.viewer.getDomElement().getBoundingClientRect();var e=this.viewer.getEventManager(),t=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer,hasInitialized:!0}),o=t.getBoundaryByRoomId(this.roomId);this.roomData=new n.RoomData(this.viewer,o),this.roomData.setEditRoomId(this.roomId),this.roomView=new n.RoomView(this.roomData,this.svgContainer),this.roomView.setEventManager(e),this.activeEditor=new n.PickEditor(this.roomView)}},{key:"onEnter",value:function(){var e=this.viewer.getViewer();this.bIsOnEditing=!0,this.restoreCameraStatus=this.viewer.getCameraStatus(),this.lastAnimationState=this.viewer.getCameraAnimation(),this.recordUIVisibility(),this.viewHouseVisibility=this.viewer._getViewHouseVisibility(),this.viewHouseVisibility&&this.viewer.hideViewHouse(),this.viewer._enableCursor(!1),e.getFilter().deactivateAll(),this.viewer._enableSelectionChanged(!1),this.viewer.setCameraAnimation(!1),this.viewer.setCameraType("OrthographicCamera"),this.viewer.setView(Glodon$1.Bimface.Viewer.ViewOption.Top),this.viewer.zoomToSelectedComponents(2.5),this.viewer.enableOrbit(!1),this.viewer.hideRoomsById([this.roomId]),this.roomData.build(),this.roomView.attachDrawables(),this.roomView.addCloudViewerEvents(e),this.viewer.render()}},{key:"recordUIVisibility",value:function(){var e=Object.keys(this.mapUIVisibility),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=document.getElementsByClassName(a);s.length>0&&(this.mapUIVisibility[a]=s[0].style.display)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"save",
value:function(){var e=this.roomInfo.boundary.offsetZ,t=this.roomInfo.offset,i=[],n=!0,o=!1,r=void 0;try{for(var a,s=this.roomData.getEditPoints()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u=l.getWorldPosition();u[2]=e,i.push(u)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}return{boundary:this.viewer.createBoundary(i),height:t[1]-t[0],id:this.roomId}}},{key:"checkIntersect",value:function(){var e=new THREE.Vector3,t=new THREE.Vector3(10,10),i=[];i.push(e,new THREE.Vector3(10,0),t,new THREE.Vector3(0,10));var n=new Glodon$1.Bimface.Plugins.Geometry.PlaneBufferGeometry(i),o=[],r=!0,a=!1,s=void 0;try{for(var l,u=this.roomData.getEditPoints()[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value,h=c.getWorldPosition(),d=new THREE.Vector2(h[0],h[1]);o.push(d)}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}return n._checkIntersect(o)}},{key:"onExit",value:function(e){var t=this.viewer.getViewer();if(this.roomView.removeCloudViewerEvents(t),this.removeDomEventListeners(),this.roomView.detachDrawables(),this.bIsOnEditing=!1,this.viewHouseVisibility&&this.viewer.showViewHouse(),this.viewer._enableCursor(!0),this.viewer.setCameraAnimation(this.lastAnimationState),t.getFilter().activateAll(),this.viewer._enableSelectionChanged(!0),this.viewer.enableOrbit(!0),!0!==e){var i=this.save(),n=this.roomInfo.faceColor,o=this.roomInfo.frameColor;this.viewer.createRoom(i.boundary,i.height,i.id,n,o);var r=this.roomData.getRoomHeightOffset(),a=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer});a.setBottomHeightByRoomId(this.roomId,r[0]),a.setTopHeightByRoomId(this.roomId,r[1])}else this.viewer.showRoomsById([this.roomId]);this.viewer.setCameraType("PerspectiveCamera");var s=this.viewer._sectionPlane;if(s){s.setPlane("Z"),s.setDirection("Forward");var l=this.roomData.getRoomHeightOffset(),u=this.viewer.getViewer().getBoundingBoxWorld(),c=this.viewer.getViewer().getScene().getExpandScalar(),h=(new THREE.Box3).setFromCenterAndSize(u.getCenter(),u.getSize().multiplyScalar(c)),d=h.min.z,f=h.max.z,g=10;"m"===this.viewer._defaultUnit&&(g/=1e3);var v=this._calcSectionPlaneProgress(d,f,l[1]+g);s.setProgress(v)}this.isInHeightEditor=!1;var m=this;this.viewer.setCameraStatus(this.restoreCameraStatus,function(){m.viewer.render()})}},{key:"makeSectionPlane",value:function(){var e=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer}),t=e.getRoomBoundingBoxById(this.roomId),i=(t.min.y+t.max.y)/2,n=this.viewer.getViewer().getBoundingBoxWorld(),o=this._calcSectionPlaneProgress(n.min.y,n.max.y,i),r=this.viewer._sectionPlane;r&&(r.setPlane("Y"),r.setDirection("Reverse"),r.setProgress(o))}},{key:"_calcSectionPlaneProgress",value:function(e,t,i){return 100-(i-e)/(t-e)*100}},{key:"destroySectionPlane",value:function(){this.sectionPlane.exit(),this.sectionPlane=null}},{key:"getIsOnEditing",value:function(){return this.bIsOnEditing}},{key:"setBimfaceUIVisibility",value:function(e){var t=Object.keys(this.mapUIVisibility),i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,l=document.getElementsByClassName(s);0!=l.length&&(l[0].style.display=0==e?"none":this.mapUIVisibility[s])}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"addDomEventListeners",value:function(){this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.onWindowResizeBinded=this.onWindowResize.bind(this);var e=this.svgContainer;e.addEventListener("mousemove",this.onMouseMoveBinded,!1),e.addEventListener("mousedown",this.onMouseDownBinded,!1),document.addEventListener("mouseup",this.onMouseUpBinded,!1),e.addEventListener("dblclick",this.onMouseDoubleClickBinded,!1),window.addEventListener("resize",this.onWindowResizeBinded,!1)}},{key:"removeDomEventListeners",value:function(){var e=this.svgContainer;e.removeEventListener("mousemove",this.onMouseMoveBinded),e.removeEventListener("mousedown",this.onMouseDownBinded),document.removeEventListener("mouseup",this.onMouseUpBinded),e.removeEventListener("dblclick",this.onMouseDoubleClickBinded),window.removeEventListener("resize",this.onWindowResizeBinded)}},{key:"destroySvgContainer",value:function(){this.roomView.detachDrawables(),this.domContainer.removeChild(this.svgContainer),this.svgContainer=null,this.viewer.getDomElement().removeChild(this.domContainer),this.domContainer=null}},{key:"activateEditor",value:function(e){switch(e){case"Pick":this.roomData.isEditHeightEnabled=!1,this.activeEditor=new n.PickEditor(this.roomView),this._activateFromHeightEditor();break;case"Add":this.roomData.isEditHeightEnabled=!1,this.activeEditor=new n.AdditionEditor(this.roomView),this._activateFromHeightEditor();break;case"Delete":this.roomData.isEditHeightEnabled=!1,this.activeEditor=new n.DeletionEditor(this.roomView),this._activateFromHeightEditor();break;case"Height":this.roomData.isEditHeightEnabled=!0,this._activateHeightEditor(),this.activeEditor=new HeightAdjustmentEditor(this.roomView)}}},{key:"_activateFromHeightEditor",value:function(){var e=this;if(this.isInHeightEditor){var t=this.viewer.getCameraAnimation();this.viewer.setCameraAnimation(!1),this.viewer.setCameraStatus(this.restoreCameraStatus2,function(){var i=e.viewer._sectionPlane;i&&(i.setPlane("Z"),i.setDirection("Forward"),i.setProgress(e.restoreSectionPlaneProgress)),e.roomView.detachDrawables(),e.roomView.attachDrawables(),e.viewer.render(),e.viewer.setCameraAnimation(t),e.roomView.update()}),this.isInHeightEditor=!1}}},{key:"_activateHeightEditor",value:function(){var e=this;this.isInHeightEditor=!0,this.restoreCameraStatus2=this.viewer.getCameraStatus(),this.viewer._sectionPlane&&(this.restoreSectionPlaneProgress=this.viewer._sectionPlane.getProgress()),this.makeSectionPlane();var t=this.viewer,i=this.roomView,n=this.viewer.getCameraAnimation();this.viewer.setCameraAnimation(!1),t.setView(Glodon$1.Bimface.Viewer.ViewOption.South,function(){var o=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:t}),r=o.getRoomBoundingBoxById(e.roomId);t.zoomToBoundingBox(r,function(){}),t.setCameraType("OrthographicCamera"),i.getData().build(),i.update(),e.viewer.setCameraAnimation(n)})}},{key:"activateByRoomId",value:function(e){this.isInHeightEditor=!1,this.roomId=e,this.roomInfo=this.viewer.mapCustomizedRoom[e];var t=new Glodon$1.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer,hasInitialized:!0}),i=t.getBoundaryByRoomId(e);this.roomData=new n.RoomData(this.viewer,i),this.roomData.setEditRoomId(e),this.roomView=new n.RoomView(this.roomData,this.svgContainer),this.roomView.setEventManager(this.viewer.getEventManager()),this.viewer.enableOrbit(!1),this.viewer._enableCursor(!1),this.activateEditor("Pick"),this.addDomEventListeners()}},{key:"onMouseDown",value:function(e){if(e.button===THREE.MOUSE.LEFT){var t={x:e.clientX-this.offset.left,y:e.clientY-this.offset.top};this.activeEditor.begin(t)}}},{key:"onMouseMove",value:function(e){var t={x:e.clientX-this.offset.left,y:e.clientY-this.offset.top};this.activeEditor.onEditing(t)}},{key:"onMouseUp",value:function(e){if(e.button===THREE.MOUSE.LEFT){var t={x:e.clientX-this.offset.left,y:e.clientY-this.offset.top};this.activeEditor.end(t),e.preventDefault(),e.stopPropagation()}}},{key:"onMouseDoubleClick",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"onWindowResize",value:function(){this.roomView.update()}}]),o}();n.RoomEditor=o}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RoomEditing"),t=function(){return{viewer:null,roomId:null}};e.RoomEidtorConfig=t}(),function(){var e="Bimface.Plugins.RevitHelpers",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RevitHelpers")),n=function(){function n(i){_classCallCheck(this,n),t.send(e,"DrawingHelper"),this.viewer3D=i.viewer,this.databagId=i.viewer._data.databagId,this.dataViews=null,this.integrateDataViews={},this.drawingViews=[],this.drawingIds=[],this.drawingList=[],this.integrateDrawingList={},this._config=i,this.mapDrawingVisibility={},this.mapDrawingObject={},this.supportViewTypeMap={FloorPlan:!0,Elevation:!0,Section:!0};var o=i.viewer.getViewer().getScene();this.customPlaneManager=CLOUD.CustomPlaneManager.getInstance(o),this.initialize()}return _createClass(n,[{key:"initialize",value:function(){var e=this;"integrateModel"==this.viewer3D._data.modelType&&null!=this.viewer3D._data.integrateDrawings?e._config.viewer.getLinksJson(function(t){t&&e.formatLinksData(t)}):"singleModel"==this.viewer3D._data.modelType&&this.getViews(function(t){for(var n=JSON.parse(t).viewList,o=0;o<n.length;o++){var r=n[o];if(r.preview.path&&e.supportViewTypeMap[r.viewType]){e.drawingIds.push(r.id);var a=i.DrawingView.toObject(r.viewPoint);a.origin.z+=r.elevation,e.drawingList.push({id:r.id,name:r.name,viewPort:a}),e.drawingViews.push(r)}}})}},{key:"createDrawingView",value:function(){return new i.DrawingView(this.viewer3D,this.drawingViews)}},{key:"formatLinksData",value:function(e){for(var t={},i=function(e,i,n,o){var r=new THREE.Matrix4;return e&&r.set.apply(r,JSON.parse(e)),r.transpose(),o&&r.premultiply(o),t[i]?t[i]instanceof Array?t[i].push(r):t[i]=[r,t[i]]:t[i]=r,r},n=0;n<e.length;n++){var o=e[n],r=void 0,a=o.linkTransform,s=o.fileId,l=o.name,u=o.links;r=a.indexOf("]")>0?i(a,s,l):new THREE.Matrix4,u.length>0&&function e(n,o){for(var r=0;r<n.length;r++){var a=n[r],s=void 0,l=a.linkTransform,u=a.fileId,c=a.name,h=a.links;l.indexOf("]")>0?s=i(l,u,c,o):t[u]?t[u]instanceof Array?t[u].push(o):t[u]=[o,t[u]]:t[u]=o,h.length>0&&e(h,s)}}(u,r)}this.transforms=t}},{key:"getViews",value:function(e){if(this.dataViews)return void(e&&e(this.dataViews));var t=this;this.viewer3D.getDefaultModel()._getMetaDataManager().dataManager.getViews(function(i){t.dataViews=i,e&&e(i.data)})}},{key:"getViewsById",value:function(e,t){if(this.integrateDrawingList[e])return void(t&&t(this.integrateDrawingList[e]));var n=this;this.viewer3D.getDefaultModel()._getMetaDataManager().dataManager.getViewsById(e,function(o){if(!o.data)return t&&t([]);n.integrateDataViews[e]=o,n.integrateDataViews.resourceHost=o.resourceHost;for(var r=JSON.parse(o.data).viewList,a=[],s=0;s<r.length;s++){var l=r[s];if(l.preview.path&&n.supportViewTypeMap[l.viewType]){n.drawingIds.push(l.id);var u=i.DrawingView.toObject(l.viewPoint);u.origin.z+=l.elevation;var c={id:l.id,name:l.name,viewPort:u};a.push(c),n.drawingViews.push(l)}}n.drawingList=n.drawingList.concat(a),n.integrateDrawingList[e]=a,t&&t(a)})}},{key:"isInclude",value:function(e){return this.drawingIds.indexOf(e)>=0}},{key:"getDrawingList",value:function(e,t){if(!e)return this.drawingList;this.getViewsById(e,function(e){t&&t(e)})}},{key:"addDrawingsById",value:function(e,t,i){for(var n=this,o=0,r=0;r<e.length;r++){var a=e[r];if(this.isInclude(a)){this.mapDrawingObject.hasOwnProperty(a)&&(this.removeDrawingsById([a]),console.warn("Duplicate id."));var s=this.createDrawingView();s.activeViewById(a);var l=this.drawingIds.indexOf(a),u=this.drawingViews[l],c=(this.dataViews||this.integrateDataViews).resourceHost+"/"+n.databagId+"/"+u.preview.path;if(null==u.preview.path)return void console.warn("No thumbnail in databag.");if(++o,u.id.indexOf(".")>0){var h=u.id.split(".")[0];if(this.transforms&&this.transforms[h])if(this.transforms[h].slice)for(var d=0,f=this.transforms[h];d<f.length;d++){var g=this.createDrawingView();g.activeViewById(a),g.setLinkFileTranslation(f[d]);var v=g.getOutline3D();this.addPlane(v,t,c,e,o,a,i,d+1==f.length,g)}else{s.setLinkFileTranslation(this.transforms[h]);var m=s.getOutline3D();this.addPlane(m,t,c,e,o,a,i,!0,s)}else{var p=s.getOutline3D();this.addPlane(p,t,c,e,o,a,i,!0,s)}}else{var y=s.getOutline3D();this.addPlane(y,t,c,e,o,a,function(){n.viewer3D.render(),i&&i()},!0,s)}}}}},{key:"addPlane",value:function(e,t,i,n,o,r,a,s,l){var u=this;this.customPlaneManager.addPlane(e.min,e.max,i,function(e){u.mapDrawingObject[r]||(u.mapDrawingObject[r]=[]),"number"!=typeof t&&(t=0),l.update(e,t),l=null,u.mapDrawingObject[r].push(e),s&&o==n.length&&a&&a()})}},{key:"clearDrawings",value:function(){var e=this.drawingIds;this.removeDrawingsById(e)}},{key:"hideAllDrawings",value:function(){var e=this.drawingIds;this.hideDrawingsById(e)}},{key:"hideDrawingsById",value:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i];this.isInclude(n)&&this.mapDrawingObject[n]&&function(){var e=t;t.mapDrawingObject[n].forEach(function(t){e.customPlaneManager.hidePlane(t)})}()}this.viewer3D.render()}},{key:"removeDrawingsById",value:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i];this.isInclude(n)&&this.mapDrawingObject[n]&&function(){var e=t;t.mapDrawingObject[n].forEach(function(t){e.customPlaneManager.removePlane(t)}),delete t.mapDrawingObject[n]}()}this.viewer3D.render()}},{key:"setDrawingsOpacityById",value:function(e,t){for(var i=this,n=0;n<e.length;n++){var o=e[n];this.isInclude(o)&&this.mapDrawingObject[o]&&function(){var e=i;i.mapDrawingObject[o].forEach(function(i){e.customPlaneManager.setPlaneOpacity(i,t)})}()}this.viewer3D.render()}},{key:"showAllDrawings",value:function(){var e=this.drawingIds;this.showDrawingsById(e)}},{key:"showDrawingsById",value:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i];this.isInclude(n)&&this.mapDrawingObject[n]&&function(){var e=t;t.mapDrawingObject[n].forEach(function(t){e.customPlaneManager.showPlane(t)})}()}this.viewer3D.render()}}]),n}();i.DrawingHelper=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RevitHelpers"),t=function(){return{viewer:null}};e.DrawingHelperConfig=t}();var Editor=function(){function e(t,i,n,o){_classCallCheck(this,e),this.viewer3D=t,this.objectType=i,this.name="Editor",this._eventManager=n,"ExternalObject"===i&&(this.externalObjectManager=new Glodon.Bimface.Plugins.ExternalObject.ExternalObjectManager(t))}return _createClass(e,[{key:"begin",value:function(e){var t=this.getCanvasPosition(new THREE.Vector2(e.clientX,e.clientY));this.mouseDownPoint=t.clone(),this.hitItem=this.hitTest(t),this.hitItem&&"Model"===this.objectType&&this._fireModelEvent("ModelTransformStart")}},{key:"onEditing",value:function(e){}},{key:"end",value:function(e){this.hitItem&&"Model"===this.objectType&&this._fireModelEvent("ModelTransformEnd")}},{key:"hitTest",value:function(e){var t=[].concat(_toConsumableArray(this.dataDrawables.getAllDrawables())).reverse(),i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,l=s.hitTest(e);if(l)return l}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}return null}},{key:"getCanvasPosition",value:function(e){var t=this.viewer3D.getDomElement().getBoundingClientRect(),i=new THREE.Vector3(e.x,e.y);return i.x-=t.left,i.y-=t.top,i}},{key:"setEditedObjectId",value:function(e){this.editedObjectId=e}},{key:"getEditedObjectId",value:function(){return this.editedObjectId}},{key:"setDrawables",value:function(e){this.dataDrawables=e}},{key:"getDrawables",value:function(){return this.dataDrawables}},{key:"getBoundingBoxWorld",value:function(){return"ExternalObject"===this.objectType?this.viewer3D.getExternalComponentManager().getBoundingBoxById(this.editedObjectId):this.viewer3D.getViewer().getModelManager().getModel(this.editedObjectId).getBoundingBoxWorld()}},{key:"_fireModelEvent",value:function(e){var t=this.viewer3D.getModel(this.editedObjectId),i=this._eventManager,n={modelId:this.editedObjectId,transformation:t.getModelTransformation()};i.fireEvent(e,n)}},{key:"updateController",value:function(e){}}]),e}(),TranslateEditor=function(e){function t(e,i,n,o){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o));return r.dataDrawables=null,r.isMouseDown=!1,r.mouseDownPoint=null,r.hitItem=null,r.lastHoveredItem=null,r.name="Translation",r.translationController=o,r}return _inherits(t,e),_createClass(t,[{key:"begin",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this,e),this.hitItem&&(e.preventDefault(),e.stopPropagation())}},{key:"onEditing",value:function(e){var t=this.getCanvasPosition(new THREE.Vector2(e.clientX,e.clientY)),i=this.viewer3D.getViewer(),n=this.getBoundingBoxWorld(),o=n.getCenter();if(this.hitItem){var r=this.dataDrawables.getRotationMatrix(),a=this.viewer3D.sceneToWorld(i.camera.position.clone()),s=t.clone().sub(this.mouseDownPoint),l=this.viewer3D.worldToClient(o),u=this.viewer3D.getDomElement().getBoundingClientRect(),c=u.x,h=u.y,d=l.x+s.x+c,f=l.y+s.y+h,g=i.cameraControl.getRaycaster(d,f),v=this.viewer3D.sceneToWorld(g.ray.direction).normalize();if(this.hitItem.isArrow()){if(0==s.length())return;var m=void 0;switch(this.hitItem.id){case"arrowX":if(!this.translationController.X)return;m=new THREE.Vector3(1,0,0).applyMatrix4(r).normalize();break;case"arrowY":if(!this.translationController.Y)return;m=new THREE.Vector3(0,-1,0).applyMatrix4(r).normalize();break;case"arrowZ":if(!this.translationController.Z)return;m=new THREE.Vector3(0,0,1).applyMatrix4(r).normalize()}var p=new THREE.Ray(o.clone(),m),y=new THREE.Vector3,w=void 0,b=v.clone().cross(v.clone().cross(m));w=new THREE.Plane(b);var C=-w.distanceToPoint(a);w.set(b,C),p.intersectsPlane(w)||p.set(p.origin.clone(),m.clone().negate()),p.intersectPlane(w,y);var x=y.clone().sub(o);this.setObjectTranslation(x)}else{if(0==s.length())return;var E=void 0;switch(this.hitItem.id){case"xy":E=new THREE.Vector3(0,0,-1);break;case"xz":E=new THREE.Vector3(0,1,0);break;case"yz":E=new THREE.Vector3(-1,0,0)}E.applyMatrix4(r).normalize();var k=new THREE.Plane(E),P=-k.distanceToPoint(o);k.set(E,P);var _=new THREE.Ray(a,v),M=new THREE.Vector3;if(_.intersectsPlane(k)){_.intersectPlane(k,M);var I=M.clone().sub(o);this.setObjectTranslation(I)}}this.dataDrawables.update(),this.dataDrawables.setGray(),this.hitItem.select(),this.hitItem.magnify(),this.dataDrawables.hideAll(),this.hitItem.show(),this.mouseDownPoint.copy(t),e.preventDefault(),e.stopPropagation()}else{var S=this.hitTest(t);S?this.checkTranslateEN(S)&&(this.dataDrawables.setGray(),S.magnify(),S.select(),this.lastHoveredItem=S):(this.dataDrawables.setDefault(),this.lastHoveredItem&&this.lastHoveredItem.resetSize(),this.lastHoveredItem=null)}}},{key:"end",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"end",this).call(this,e),this.hitItem&&(e.preventDefault(),e.stopPropagation(),this.dataDrawables.showAll(),this.hitItem=null)}},{key:"setEditedObjectId",value:function(e){this.editedObjectId=e}},{key:"setObjectTranslation",value:function(e){var t=this.objectType;if("ExternalObject"===t)this.externalObjectManager.translate(this.editedObjectId,e);else if("Model"===t){var i=this.viewer3D.getModel(this.editedObjectId);i.setModelTranslation(e),this._fireModelEvent("ModelTransforming")}}},{key:"updateController",value:function(e){void 0!=e.X&&(this.translationController.X=e.X),void 0!=e.Y&&(this.translationController.Y=e.Y),void 0!=e.Z&&(this.translationController.Z=e.Z)}},{key:"checkTranslateEN",value:function(e){var t=!0,i=e.id;return e.isArrow()?("arrowY"!==i||this.translationController.Y||(t=!1),"arrowZ"!==i||this.translationController.Z||(t=!1),"arrowX"!==i||this.translationController.X||(t=!1)):("xz"!==i||this.translationController.X&&this.translationController.Z||(t=!1),"xy"!==i||this.translationController.X&&this.translationController.Y||(t=!1),"yz"!==i||this.translationController.Y&&this.translationController.Z||(t=!1)),t}}]),t}(Editor),ObjectEditorUtil=function e(){_classCallCheck(this,e)};ObjectEditorUtil.discreteCircle=function(e){for(var t=e.center.clone(),i=t.clone().distanceTo(e.arcStartPt),n=e.normal.clone(),o=e.arcStartPt.clone().sub(t).normalize(),r=[],a=e.rotateAngle/(Math.PI/180),s=0;s<a;s++){o.applyAxisAngle(n,Math.PI/180);var l=t.clone().add(o.clone().multiplyScalar(i));r.push(l)}return e.rotateAngle==2*Math.PI&&r.push(r[0]),r},ObjectEditorUtil.drawingToCanvas=function(e,t){var i=this.getCoordinateAxis(),n=i.start.clone(),o=this.cameraControl.camera,r=new THREE.Vector3;if(void 0==this.cameraToCenter){var a=this.viewer.getCamera(),s=this.viewer.getScene().getBoundingBox();o.setStandardView(CLOUD.EnumStandardView.ISO,s),o.zoomToBBox(s),n=this.getCoordinateAxis().start.clone(),this.cameraToCenter=n.clone().sub(o.position.clone()).length();var l=this.viewer.getScene().getMatrixGlobal(),u=CLOUD.CameraUtil.parseCameraInfo(a),c=CLOUD.Camera.worldToDrawing(u,l),h=new THREE.Vector3;h.subVectors(c.target,c.position),o.LookAt(c.target,h,c.up),this.cameraControl.update(!0,!0)}else{var d=n.clone().sub(o.position.clone()).normalize(),f=o.position.clone().sub(n.clone()).length();r=d.multiplyScalar(this.cameraToCenter-f)}var g=this.container.offsetWidth,v=this.container.offsetHeight;!1!==t&&o.isPerspective&&e.add(r);var m=CLOUD.CameraUtil.drawingToCanvas(o,e,g,v);return new THREE.Vector2(m.x,m.y)},ObjectEditorUtil.minDistanceToPoints=function(e,t,i){for(var n=-1,o=Number.POSITIVE_INFINITY,r=0;r<i;r++){var a=function(e,t){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}(e,t[r]);a<o&&(o=a,n=r)}return n},ObjectEditorUtil.computeSegmentsIntersect=function(e,t,i,n){var o=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x),r=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);if(o*r>0)return!1;var a=(i.x-e.x)*(n.y-e.y)-(i.y-e.y)*(n.x-e.x);if(a*((i.x-t.x)*(n.y-t.y)-(i.y-t.y)*(n.x-t.x))>0)return!1;var s=a/(r-o),l=s*(t.x-e.x),u=s*(t.y-e.y);return{x:e.x+l,y:e.y+u}};var RotateEditor=function(e){function t(e,i,n,o){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o));return r.dataDrawables=null,r.isMouseDown=!1,r.mouseDownPoint=null,r.hitItem=null,r.rotateAngle=0,r.lastHoveredItem=null,r.name="Rotation",r.rotationController=o,r}return _inherits(t,e),_createClass(t,[{key:"begin",value:function(e){if(_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this,e),this.hitItem){var i=this.getCanvasPosition(new THREE.Vector2(e.clientX,e.clientY)),n=this.hitItem.getId(),o=this.dataDrawables.quarterRings.getFullRingPts(n);this.lastHitIndex=ObjectEditorUtil.minDistanceToPoints(i,o,90),this.firstHitIndex=this.lastHitIndex,e.preventDefault(),e.stopPropagation()}}},{key:"onEditing",value:function(e){var t=this.getCanvasPosition(new THREE.Vector2(e.clientX,e.clientY));if(this.hitItem){var i=this.hitItem.getId();if(!this.checkRotationEN(i))return;this.dataDrawables.isOnQuarterRing&&this.dataDrawables.toFullRing(i),this.dataDrawables.hideAll(),this.hitItem.show();var n=this.dataDrawables.quarterRings.getFullRingPts(i),o=ObjectEditorUtil.minDistanceToPoints(t,n,360),r=(o-this.lastHitIndex)*(Math.PI/180);if(this.rotateAngle+=r/(Math.PI/180),0===r)return;this.dataDrawables.updateRotationTips(i,this.firstHitIndex,o,this.rotateAngle),this.lastHitIndex=o,this.setRotation(r),this.dataDrawables.updateBoundingBox(),this.viewer3D.render(),this.mouseDownPoint.copy(t),e.preventDefault(),e.stopPropagation()}else{var a=this.hitTest(t);a?this.checkRotationEN(a.getId())&&(this.dataDrawables.setGray(),a.magnify(),a.select(),this.lastHoveredItem=a):(this.dataDrawables.setRotationEN(),this.lastHoveredItem&&this.lastHoveredItem.resetSize(),this.lastHoveredItem=null)}}},{key:"end",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"end",this).call(this,e),this.hitItem&&(e.preventDefault(),e.stopPropagation(),this.dataDrawables.isOnQuarterRing||(this.dataDrawables.fromFullRing(this.hitItem.getId()),this.dataDrawables.removeRotationTips()),this.rotateAngle=0,this.dataDrawables.showAll(),this.hitItem=null)}},{key:"setEditedObjectId",value:function(e){this.editedObjectId=e}},{key:"setRotation",value:function(e){var t=this.objectType,i=this.hitItem.getId(),n=this.dataDrawables.getEditObjectCenter();if("ExternalObject"===t){if("xy"===i){if(!this.rotationController.Z)return;this.externalObjectManager.setRotationZ(this.editedObjectId,n,e)}if("xz"===i){if(!this.rotationController.Y)return;this.externalObjectManager.setRotationY(this.editedObjectId,n,-e)}if("yz"===i){if(!this.rotationController.X)return;this.externalObjectManager.setRotationX(this.editedObjectId,n,e)}}else if("Model"==t){var o=this.viewer3D.getModel(this.editedObjectId);if("xy"===i){if(!this.rotationController.Z)return;o.setModelRotationZ(n,e)}if("xz"===i){if(!this.rotationController.Y)return;o.setModelRotationY(n,-e)}if("yz"===i){if(!this.rotationController.X)return;o.setModelRotationX(n,e)}this._fireModelEvent("ModelTransforming")}}},{key:"updateController",value:function(e){void 0!=e.X&&(this.rotationController.X=e.X),void 0!=e.Y&&(this.rotationController.Y=e.Y),void 0!=e.Z&&(this.rotationController.Z=e.Z)}},{key:"checkRotationEN",value:function(e){var t=!0;return"xz"!==e||this.rotationController.Y||(t=!1),"xy"!==e||this.rotationController.Z||(t=!1),"yz"!==e||this.rotationController.X||(t=!1),t}}]),t}(Editor),ScaleEditor=function(e){function t(e,i,n,o){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o));return r.dataDrawables=null,r.isMouseDown=!1,r.mouseDownPoint=null,r.hitItem=null,r.lastHoveredItem=null,r.name="Scaling",r.scaleController=o,r.windowHight=r.viewer3D.getDomElement().getBoundingClientRect().height,r}return _inherits(t,e),_createClass(t,[{key:"begin",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this,e),this.hitItem&&(e.preventDefault(),e.stopPropagation())}},{key:"onEditing",value:function(e){var t=this.getCanvasPosition(new THREE.Vector2(e.clientX,e.clientY));if(this.hitItem){var i=t.clone().sub(this.mouseDownPoint);if(0==i.length())return;var n=i.clone().projectOnVector(this.hitItem.getDirection()),o=i.clone().angleTo(this.hitItem.getDirection()),r=o<=Math.PI/2?1:-1,a=n.length();if(!this.checkScalerEnable(this.hitItem.id))return;var s=this.dataDrawables.getDirection(this.hitItem.id),l=1+r*(a/this.windowHight);s.multiplyScalar(l),0===s.x&&(s.x=1),0===s.y&&(s.y=1),0===s.z&&(s.z=1);var u=this.dataDrawables.getOppositeSideCenter(this.hitItem.id);this.setObjectScale(u,s),this.dataDrawables.update(this.hitItem.id),this.dataDrawables.hideAll(),this.hitItem.show(),this.hitItem.magnify(),this.mouseDownPoint.copy(t),e.preventDefault(),e.stopPropagation()}else{var c=this.hitTest(t);c?this.checkScalerEnable(c.id)&&(this.dataDrawables.update(c.id),this.dataDrawables.setGray(),c.magnify(),c.select(),this.lastHoveredItem=c):(this.dataDrawables.setDefault(),this.lastHoveredItem&&this.lastHoveredItem.resetSize(),this.dataDrawables.updateHighlightBBoxFace(),this.lastHoveredItem=null)}}},{key:"end",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"end",this).call(this,e),this.hitItem&&(e.preventDefault(),e.stopPropagation(),this.dataDrawables.showAll(),this.hitItem=null)}},{key:"setObjectScale",value:function(e,t){var i=this.objectType;"ExternalObject"===i?this.externalObjectManager.scaleOnBasePoint(this.getEditedObjectId(),e,t):"Model"===i&&(this.viewer3D.getModel(this.getEditedObjectId()).setModelScale(e,t),this._fireModelEvent("ModelTransforming"))}},{key:"updateController",value:function(e){void 0!=e.X&&(this.scaleController.X=e.X),void 0!=e.Y&&(this.scaleController.Y=e.Y),void 0!=e.Z&&(this.scaleController.Z=e.Z),void 0!=e.Uniform&&(this.scaleController.Uniform=e.Uniform)}},{key:"checkScalerEnable",value:function(e){var t=!0;switch(e){case"CoordOrigin":this.scaleController.Uniform||(t=!1);break;case"x+":case"x-":this.scaleController.X||(t=!1);break;case"y+":case"y-":this.scaleController.Y||(t=!1);break;case"z+":case"z-":this.scaleController.Z||(t=!1)}return t}}]),t}(Editor),FaceArray=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=e,i.colors=["#FF2905","#1922FB","#32D3A6"],i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){if(this.drawables.length>0){var t=0,i=!0,n=!1,o=void 0;try{for(var r,a=this.drawables[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){r.value.update(e.slice(5*t,5*(t+1))),t++}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}else for(var s=["xy","xz","yz"],l=0;l<3;l++){var u=new Face({id:s[l]});u.update(e.slice(5*l,5*(l+1))),this.drawables.push(u)}}},{key:"hitTest",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.drawables[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=new THREE.Vector2(e.x,e.y),l=a.hitTest(s);if(l)return l}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),t}(Drawable),Face=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.id=e.id,i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){this.drawables=[];var t=this.makePolyline(e);this.drawables.push(t)}},{key:"makePolyline",value:function(e){var t=this,i={};return i.points=MeasureUtil.calcPolylinePoints(e),i.width="3px",i.fillColor="#F99D0B",i.color="#F99D0B",this.position=new THREE.Vector2,e.forEach(function(e){t.position.x+=e.x,t.position.y+=e.y}),this.position.multiplyScalar(.2),MeasureUtil.makePolyline(i)}},{key:"hitTest",value:function(e){return new THREE.Vector2(e.x,e.y).clone().distanceTo(this.position)<=this.hitTestEpsilon?this:null}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;r.style.fill=this.grayColor,r.style.stroke=this.grayColor}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;r.style.fill="#F99D0B",r.style.stroke="#F99D0B"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"select",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;r.style.fill=this.highlightColor,r.style.stroke=this.highlightColor}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"getDirection",value:function(){var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,-1,0),i=new THREE.Vector3(0,0,1),n=new THREE.Vector3;return"xy"==this.id?n.addVectors(e,t).normalize():"xz"==this.id?n.addVectors(e,i).normalize():"yz"==this.id&&n.addVectors(t,i).normalize(),n}},{key:"getLocalCoordAxis",value:function(){var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,-1,0),i=new THREE.Vector3(0,0,1),n=[]
;return"xy"==this.id?n.push(e,t):"xz"==this.id?n.push(e,i):"yz"==this.id&&n.push(t,i),n}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="none"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="block"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),t}(Drawable),Dashline=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=e,i.start=null,i.target=null,i.isEffectedByOthers=!!e.isEffectedByOthers,i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){this.drawables=[];var i={color:this.config.color,lineWidth:"1px",start:e,end:t},n=MeasureUtil.makeDashLine(i);this.drawables.push(n)}},{key:"setGray",value:function(){if(this.isEffectedByOthers){this.drawables[0].setAttribute("stroke",this.grayColor)}}},{key:"setDefault",value:function(){if(this.isEffectedByOthers){this.drawables[0].setAttribute("stroke",this.config.color)}}},{key:"hide",value:function(){if(this.isEffectedByOthers){this.drawables[0].style.display="none"}}},{key:"show",value:function(){if(this.isEffectedByOthers){this.drawables[0].style.display="block"}}}]),t}(Drawable),DashlineArray=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=e||{},i.colors=e.colors,i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){if(this.drawables.length>0){var i=0,n=!0,o=!1,r=void 0;try{for(var a,s=this.drawables[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u=this.toVector2(e),c=this.toVector2(t[i]);l.update(u,c),i++}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}}else for(var h=0;h<t.length;h++){var d=new Dashline({color:this.colors[Math.floor(h)],isEffectedByOthers:this.config.isEffectedByOthers}),f=this.toVector2(e),g=this.toVector2(t[h]);d.update(f,g),this.drawables.push(d)}}},{key:"hitTest",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.drawables[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=new THREE.Vector2(e.x,e.y),l=a.hitTest(s);if(l)return l}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),t}(Drawable),CoordinateAxis=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.coordinateOrigin=new THREE.Vector3,e.style.length=130,e.style.axisX={},e.style.axisX.color="#FF2905",e.style.axisY={},e.style.axisY.color="#1922FB",e.style.axisZ={},e.style.axisZ.color="#32D3A6",e.axisColors=["#FF2905","#1922FB","#32D3A6"],e.markerIds=["arrowX","arrowY","arrowZ"],e.arrowTargets=[],e}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){this.arrowTargets=[];var i=new THREE.Vector2(e.x,e.y);if(this.drawables.length>0){var n=0,o=!0,r=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value,c=new THREE.Vector2(u.x,u.y);this.drawables[n++].update(i,c)}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}}else{var h=0,d=!0,f=!1,g=void 0;try{for(var v,m=t[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var p=v.value,y=new THREE.Vector2(p.x,p.y),w=new Arrow({id:this.markerIds[h],color:this.axisColors[h++]});w.update(i,y),this.drawables.push(w)}}catch(e){f=!0,g=e}finally{try{!d&&m.return&&m.return()}finally{if(f)throw g}}}}},{key:"getDefaultStyle",value:function(){return{lineWidth:"4px",color:"#FF2905"}}},{key:"hitTest",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.drawables[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=new THREE.Vector2(e.x,e.y),l=a.hitTest(s);if(l)return l}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"select",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.select()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"getOrigin",value:function(){return this.coordinateOrigin}},{key:"setOrigin",value:function(e){this.coordinateOrigin.set(e.x,e.y,e.z)}}]),t}(Drawable),BoundingBox=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.domContainer=e,i.style.color="#11DAB7",i.style.border="1px",i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){var i=this;this.drawables=[];var n=function(n,o){t.indexOf(n)<0&&t.indexOf(o)<0&&i.makePolyline([e[n],e[o]])};n(0,1),n(1,5),n(5,4),n(4,0),n(0,3),n(1,2),n(5,6),n(4,7),n(3,2),n(2,6),n(6,7),n(7,3)}},{key:"getDrawables",value:function(){return this.drawables}},{key:"makePolyline",value:function(e){var t=this,i=this.getDefaultStyle(),n=this.domContainer.width.baseVal.value,o=this.domContainer.height.baseVal.value,r=[],a=void 0,s=void 0,l=function(e,t){var i={x:0,y:0},r={x:0,y:o},a={x:n,y:o},s={x:n,y:0},l=[],u=function(i,n){var o=ObjectEditorUtil.computeSegmentsIntersect(e,t,i,n);o&&l.push(o)};return u(i,r),u(r,a),u(a,s),u(s,i),l},u=function(e){return e.x>=0&&e.x<=n&&e.y>=0&&e.y<=o},c=function(){if(r.length>0){if(a){var n=r[r.length-1];u(n);var o=l(n,a);1===o.length&&r.push(o[0])}i.points=MeasureUtil.calcPolylinePoints(r),t.drawables.push(MeasureUtil.makePolyline(i))}if(r=[],s<e.length-1){var c=l(a,e[s+1]);1===c.length?r.push(c[0]):2===c.length&&(i.points=MeasureUtil.calcPolylinePoints(c),t.drawables.push(MeasureUtil.makePolyline(i)))}a=void 0};for(s=0;s<e.length;s++){var h=e[s];u(h)?r.push(h):(a=h,c())}r.length>0&&c()}},{key:"getDefaultStyle",value:function(){return{color:"#11DAB7",width:"1px"}}}]),t}(Drawable),DataDrawables=function(){function e(t,i,n,o,r){_classCallCheck(this,e),this.viewer3D=t,this.domContainer=i,this.objectId=n,this.objectType=o,this.controller=r,this.updateFactor(),this.initialize()}return _createClass(e,[{key:"initialize",value:function(){}},{key:"updateFactor",value:function(){var e=this.getBoundingBoxWorld(),t=e.getCenter(),i=this.viewer3D.getViewer().camera,n=this.viewer3D.sceneToWorld(i.position),o=t.clone().sub(new THREE.Vector3(n.x,n.y,n.z)).length(),r=2*Math.tan(i.fov*Math.PI/360)*o,a=this.viewer3D.getDomElement().offsetHeight;this.factor=r/a}},{key:"updateBoundingBox",value:function(){var e=this.viewer3D.getViewer(),t=[],i=this.getBoundaryPoints(),n=[],o=new THREE.Plane(this.viewer3D.sceneToWorld(e.camera.getWorldDirection()).normalize()),r=o.distanceToPoint(this.viewer3D.sceneToWorld(e.camera.position));o.constant=-r;var a=function(e){t.push(e),o.distanceToPoint(e)<0&&n.push(t.length-1)};i.forEach(a);var s=[],l=!0,u=!1,c=void 0;try{for(var h,d=t[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=h.value;s.push(this.viewer3D.worldToClient(f))}}catch(e){u=!0,c=e}finally{try{!l&&d.return&&d.return()}finally{if(u)throw c}}this.boundingBox||(this.boundingBox=new BoundingBox(this.domContainer),this.drawables.push(this.boundingBox)),this.boundingBox.detach(),this.boundingBox.update(s,n),this.boundingBox.attach(this.domContainer)}},{key:"getBoundaryPoints",value:function(){return"ExternalObject"===this.objectType?this.viewer3D.getExternalComponentManager().getBoundaryPoints(this.objectId):this.viewer3D.getViewer().getModelManager().getModel(this.objectId).getBoundaryPoints()}},{key:"getBoundingBoxWorld",value:function(){return"ExternalObject"===this.objectType?this.viewer3D.getExternalComponentManager().getBoundingBoxById(this.objectId):this.viewer3D.getViewer().getModelManager().getModel(this.objectId).getBoundingBoxWorld()}},{key:"getTransformMatrix",value:function(){if("ExternalObject"===this.objectType){var e=this.viewer3D.getExternalComponentManager().getTransform(this.objectId);return(new THREE.Matrix4).compose(e.position,e.rotate,e.scale)}return this.viewer3D.getViewer().getModelManager().getModel(this.objectId).getTransformMatrix().clone()}},{key:"getRotationMatrix",value:function(){var e=new THREE.Matrix4,t=this.getTransformMatrix();return e.extractRotation(t),e}}]),e}(),TranslateDrawables=function(e){function t(e,i,n,o,r){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,r))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.drawables=[],this.updateBoundingBox(),this.updateCoordinateAxis(),this.updateFaces(),this.addCloudViewerEvents()}},{key:"updateFaces",value:function(){var e=this.getBoundingBoxWorld(),t=e.getCenter(),i=this.getRotationMatrix(),n=20*this.factor,o=new THREE.Vector3(n,0,0).applyMatrix4(i),r=new THREE.Vector3(0,-n,0).applyMatrix4(i),a=new THREE.Vector3(0,0,n).applyMatrix4(i),s=[];n*=.3;var l=t.clone().add(new THREE.Vector3(n,-n,0).applyMatrix4(i));s.push(l),s.push(l.clone().add(o)),s.push(l.clone().add(o).add(r)),s.push(l.clone().add(r)),s.push(l);var u=t.clone().add(new THREE.Vector3(n,0,n).applyMatrix4(i));s.push(u),s.push(u.clone().add(o)),s.push(u.clone().add(o).add(a)),s.push(u.clone().add(a)),s.push(u);var c=t.clone().add(new THREE.Vector3(0,-n,n).applyMatrix4(i));s.push(c),s.push(c.clone().add(r)),s.push(c.clone().add(r).add(a)),s.push(c.clone().add(a)),s.push(c);var h=[],d=!0,f=!1,g=void 0;try{for(var v,m=s[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var p=v.value;h.push(this.viewer3D.worldToClient(p))}}catch(e){f=!0,g=e}finally{try{!d&&m.return&&m.return()}finally{if(f)throw g}}this.faceArray||(this.faceArray=new FaceArray,this.drawables.push(this.faceArray)),this.faceArray.detach(),this.faceArray.update(h),this.faceArray.attach(this.domContainer),this.setTranslateEN()}},{key:"updateCoordinateAxis",value:function(){var e=this.getBoundingBoxWorld(),t=this.getRotationMatrix(),i=[];i.push(new THREE.Vector3(1,0,0).applyMatrix4(t)),i.push(new THREE.Vector3(0,-1,0).applyMatrix4(t)),i.push(new THREE.Vector3(0,0,1).applyMatrix4(t));var n=this.viewer3D.worldToClient(e.getCenter());this.coordinateAxis||(this.coordinateAxis=new CoordinateAxis,this.drawables.push(this.coordinateAxis)),this.coordinateAxis.setOrigin(n);var o=[],r=!0,a=!1,s=void 0;try{for(var l,u=i[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value,h=c.clone().multiplyScalar(130*this.factor).add(e.getCenter()),d=this.viewer3D.worldToClient(h);o.push(d)}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}this.dashlineArray||(this.dashlineArray=new DashlineArray({length:116,colors:["#FF2905","#1922FB","#32D3A6"]}),this.drawables.push(this.dashlineArray)),this.dashlineArray.detach(),this.dashlineArray.update(n,o),this.dashlineArray.attach(this.domContainer),this.coordinateAxis.detach(),this.coordinateAxis.update(n,o),this.coordinateAxis.attach(this.domContainer),this.setTranslateEN()}},{key:"getDirection",value:function(e){return"arrowX"===e?new THREE.Vector3(1,0,0):"arrowY"===e?new THREE.Vector3(0,-1,0):new THREE.Vector3(0,0,1)}},{key:"attach",value:function(){this.boundingBox.attach(this.domContainer)}},{key:"addCloudViewerEvents",value:function(){var e=this.viewer3D.getViewer();this.updateBinded=this.update.bind(this),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ROTATING,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"removeCloudViewerEvents",value:function(){var e=this.viewer3D.getViewer();e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ROTATING,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"update",value:function(){document.getElementsByClassName("bf-ObjectEditor-svg")[0].setAttribute("transform","translate(0,0)"),this.updateFactor(),this.updateBoundingBox(),this.updateCoordinateAxis(),this.updateFaces()}},{key:"getAllDrawables",value:function(){return this.drawables}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"select",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.getAllDrawables()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){if(o.value.select(e))return}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"hideAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"showAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"dispose",value:function(){this.domContainer.innerHTML="",this.boundingBox=null,this.CoordinateAxis=null,this.removeCloudViewerEvents()}},{key:"updateController",value:function(e){void 0!=e.X&&(this.controller.X=e.X),void 0!=e.Y&&(this.controller.Y=e.Y),void 0!=e.Z&&(this.controller.Z=e.Z)}},{key:"setTranslateEN",value:function(){!this.faceArray||this.faceArray.drawables.length<=0||(this.controller.Y?(this.coordinateAxis.drawables[1].show(),this.dashlineArray.drawables[1].hide()):(this.coordinateAxis.drawables[1].hide(),this.dashlineArray.drawables[1].show(),this.faceArray.drawables[0].hide(),this.faceArray.drawables[2].hide()),this.controller.Z?(this.coordinateAxis.drawables[2].show(),this.dashlineArray.drawables[2].hide()):(this.coordinateAxis.drawables[2].hide(),this.dashlineArray.drawables[2].show(),this.faceArray.drawables[2].hide(),this.faceArray.drawables[1].hide()),this.controller.X?(this.coordinateAxis.drawables[0].show(),this.dashlineArray.drawables[0].hide()):(this.coordinateAxis.drawables[0].hide(),this.dashlineArray.drawables[0].show(),this.faceArray.drawables[1].hide(),this.faceArray.drawables[0].hide()),this.controller.X&&this.controller.Y&&this.faceArray.drawables[0].show(),this.controller.X&&this.controller.Z&&this.faceArray.drawables[1].show(),this.controller.Z&&this.controller.Y&&this.faceArray.drawables[2].show())}}]),t}(DataDrawables),CoordOrigin=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.hitTestEpsilon=18,e.id="CoordOrigin",e.style.color="#11DAB7",e.style.border="1px",e}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.drawables=[];var n=e;this.makePolyline([n[0],n[1],n[5],n[4],n[0]],i),this.makePolyline([n[3],n[2],n[6],n[7],n[3]],i),this.makePolyline([n[0],n[3],n[7],n[4],n[0]],i),this.makePolyline([n[1],n[2],n[6],n[5],n[1]],i),this.makePolyline([n[5],n[6],n[7],n[4],n[5]],i),this.makePolyline([n[1],n[2],n[3],n[0],n[1]],i),this.position=new THREE.Vector2(t.x,t.y)}},{key:"getDrawables",value:function(){return this.drawables}},{key:"makePolyline",value:function(e,t){var i=this.getDefaultStyle();i.points=MeasureUtil.calcPolylinePoints(e),t&&(i.width="0px",i.fillColor="#F99D0B"),this.drawables.push(MeasureUtil.makePolyline(i))}},{key:"getDefaultStyle",value:function(){return{color:"#11DAB7",width:"1px"}}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.fill=this.grayColor}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.fill="#F99D0B"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"select",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.fill=this.highlightColor}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="none"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="block"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hitTest",value:function(e){return new THREE.Vector2(e.x,e.y).distanceTo(this.position)<=this.hitTestEpsilon?this:null}},{key:"getDirection",value:function(){return new THREE.Vector3(1,0,0)}}]),t}(Drawable),HighlightBBoxFace=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.id="HighlightBBoxFace",i.update(e),i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){this.drawables=[],e&&this.makePolyline(e)}},{key:"makePolyline",value:function(e){var t={width:"0px",fillColor:"#E3FFF7",opacity:.6};t.points=MeasureUtil.calcPolylinePoints(e),this.drawables.push(MeasureUtil.makePolyline(t))}},{key:"setGray",value:function(){}}]),t}(Drawable),ScaleDrawables=function(e){function t(e,i,n,o,r){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,r))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.drawables=[],this.arrows=[],this.updateBoundingBox(),this.updateBboxArrow(),this.updateCoordOrigin(),this.addCloudViewerEvents()}},{key:"updateCoordOrigin",value:function(){var e=this.getBoundingBoxWorld(),t=this.getRotationMatrix(),i=20*this.factor;e=(new THREE.Box3).setFromCenterAndSize(e.getCenter(),new THREE.Vector3(i,i,i));var n=e.getCenter(),o=[];o.push(new THREE.Vector3(e.max.x,e.max.y,e.max.z).sub(n).applyMatrix4(t).add(n)),o.push(new THREE.Vector3(e.min.x,e.max.y,e.max.z).sub(n).applyMatrix4(t).add(n)),o.push(new THREE.Vector3(e.min.x,e.min.y,e.max.z).sub(n).applyMatrix4(t).add(n)),o.push(new THREE.Vector3(e.max.x,e.min.y,e.max.z).sub(n).applyMatrix4(t).add(n)),o.push(new THREE.Vector3(e.max.x,e.max.y,e.min.z).sub(n).applyMatrix4(t).add(n)),o.push(new THREE.Vector3(e.min.x,e.max.y,e.min.z).sub(n).applyMatrix4(t).add(n)),o.push(new THREE.Vector3(e.min.x,e.min.y,e.min.z).sub(n).applyMatrix4(t).add(n)),o.push(new THREE.Vector3(e.max.x,e.min.y,e.min.z).sub(n).applyMatrix4(t).add(n));var r=[],a=!0,s=!1,l=void 0;try{for(var u,c=o[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;r.push(this.viewer3D.worldToClient(h))}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}var d=this.viewer3D.worldToClient(e.getCenter());this.coordOrigin||(this.coordOrigin=new CoordOrigin,this.drawables.push(this.coordOrigin)),this.coordOrigin.detach(),this.coordOrigin.update(r,d),this.coordOrigin.attach(this.domContainer),this.setScaleEN()}},{key:"updateBboxArrow",value:function(){var e=this.getBoundingBoxWorld(),t=[];t.push(this.getOppositeSideCenter("x+")),t.push(this.getOppositeSideCenter("x-")),t.push(this.getOppositeSideCenter("y+")),t.push(this.getOppositeSideCenter("y-")),t.push(this.getOppositeSideCenter("z+")),t.push(this.getOppositeSideCenter("z-"));var i=[],n=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;i.push(this.viewer3D.worldToClient(l.clone()))}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}var u=this.viewer3D.worldToClient(e.getCenter());u=new THREE.Vector2(u.x,u.y);var c=[],h=!0,d=!1,f=void 0;try{for(var g,v=t[Symbol.iterator]();!(h=(g=v.next()).done);h=!0){var m=g.value,p=m.clone(),y=p.clone().sub(e.getCenter().clone()).normalize().multiplyScalar(50*this.factor).add(p),w=this.viewer3D.worldToClient(y);c.push(w)}}catch(e){d=!0,f=e}finally{try{!h&&v.return&&v.return()}finally{if(d)throw f}}this.arrowArray||(this.arrowArray=new ArrowArray({id:1,color:"#FF0000"}),this.drawables.push(this.arrowArray)),this.arrowArray.detach(),this.arrowArray.update(i,c),this.arrowArray.attach(this.domContainer),this.dashlineArray||(this.dashlineArray=new DashlineArray({colors:["#FF2905","#1922FB","#32D3A6"]})),this.dashlineArray.detach(),this.dashlineArray.update(u,[i[1],i[2],i[5]]),this.dashlineArray.attach(this.domContainer),this.setScaleEN()}},{key:"getDirection",value:function(e){return e.includes("x")?new THREE.Vector3(1,0,0):e.includes("y")?new THREE.Vector3(0,1,0):e.includes("z")?new THREE.Vector3(0,0,1):new THREE.Vector3(1,1,1)}},{key:"addCloudViewerEvents",value:function(){var e=this.viewer3D.getViewer();this.updateBinded=this.update.bind(this),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ROTATING,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"removeCloudViewerEvents",value:function(){var e=this.viewer3D.getViewer();e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ROTATING,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"update",value:function(e){document.getElementsByClassName("bf-ObjectEditor-svg")[0].setAttribute("transform","translate(0,0)"),this.updateFactor(),this.updateHighlightBBoxFace(e),this.updateBoundingBox(),this.updateBboxArrow(),this.updateCoordOrigin()}},{key:"getOppositeSideCenter",value:function(e){var t=this.getBoundaryPoints(),i=null,n=function(e,i,n,o){var r=t[e],a=t[i],s=t[n],l=t[o];return(new THREE.Vector3).add(r).add(a).add(s).add(l).multiplyScalar(.25)};switch(e){case"x+":i=n(0,3,7,4);break;case"x-":i=n(1,2,6,5);break;case"y+":i=n(0,1,5,4);break;case"y-":i=n(2,3,7,6);break;case"z+":i=n(0,1,2,3);break;case"z-":i=n(4,5,6,7);break;default:i=n(0,1,2,3).add(n(4,5,6,7)).multiplyScalar(.5)}return i}},{key:"updateHighlightBBoxFace",value:function(e){var t=this;if(!e&&this.highlightBBoxFace)return void this.highlightBBoxFace.detach();var i=this.getBoundaryPoints(),n=null,o=function(e,n,o,r){var a=t.viewer3D.worldToClient(i[e]);return[a,t.viewer3D.worldToClient(i[n]),t.viewer3D.worldToClient(i[o]),t.viewer3D.worldToClient(i[r]),a]};switch(e){case"x-":n=o(0,3,7,4);break;case"x+":n=o(1,2,6,5);break;case"y-":n=o(0,1,5,4);break;case"y+":n=o(2,3,7,6);break;case"z-":n=o(0,1,2,3);break;case"z+":n=o(4,5,6,7)}this.highlightBBoxFace||(this.highlightBBoxFace=new HighlightBBoxFace,this.drawables.push(this.highlightBBoxFace)),this.highlightBBoxFace.detach(),this.highlightBBoxFace.update(n),this.highlightBBoxFace.attach(this.domContainer)}},{key:"getAllDrawables",value:function(){return this.drawables}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"select",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.getAllDrawables()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){if(o.value.select(e))return}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"hideAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"showAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"dispose",value:function(){this.domContainer.innerHTML="",this.boundingBox=null,this.coordOrigin=null,this.arrowArray=null,this.removeCloudViewerEvents()}},{key:"updateController",value:function(e){void 0!=e.X&&(this.controller.X=e.X),void 0!=e.Y&&(this.controller.Y=e.Y),void 0!=e.Z&&(this.controller.Z=e.Z),void 0!=e.Uniform&&(this.controller.Uniform=e.Uniform)}},{key:"setScaleEN",value:function(){!this.coordOrigin||this.coordOrigin.drawables.length<=0||(this.controller.Y?(this.arrowArray.drawables[2].show(),this.arrowArray.drawables[3].show()):(this.arrowArray.drawables[2].hide(),this.arrowArray.drawables[3].hide()),this.controller.Z?(this.arrowArray.drawables[4].show(),this.arrowArray.drawables[5].show()):(this.arrowArray.drawables[4].hide(),this.arrowArray.drawables[5].hide()),this.controller.X?(this.arrowArray.drawables[0].show(),this.arrowArray.drawables[1].show()):(this.arrowArray.drawables[0].hide(),this.arrowArray.drawables[1].hide()),this.controller.Uniform?this.coordOrigin.show():this.coordOrigin.hide())}}]),t}(DataDrawables),ArrowArray=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=e,i.colors=["#FF2905","#1922FB","#32D3A6"],i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){if(this.drawables.length>0){var i=0,n=!0,o=!1,r=void 0;try{for(var a,s=this.drawables[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){a.value.update(this.toVector3(e[i]),this.toVector3(t[i])),i++}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}}else for(var l=["x-","x+","y-","y+","z-","z+"],u=0;u<e.length;u++){var c=new Arrow({id:l[u],color:this.colors[Math.floor(u/2)],length:40});c.update(this.toVector3(e[u]),this.toVector3(t[u])),this.drawables.push(c)}}},{key:"hitTest",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.drawables[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=new THREE.Vector2(e.x,e.y),l=a.hitTest(s);if(l)return l}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),t}(Drawable),QuarterRing=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.id=e.id,i.config=e,i.config.highlightWidth="2px",i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){this.drawables=[],this.boundaryPts=e;var t={};t.points=MeasureUtil.calcPolylinePoints(e),t.width="1px",t.color=this.config.color,t.fillColor=this.config.color,t.opacity=this.config.opacity;var i=MeasureUtil.makePolyline(t);this.drawables.push(i),delete t.fillColor,delete t.opacity;var n=MeasureUtil.makePolyline(t);this.drawables.push(n)}},{key:"setGray",value:function(){var e=this.drawables[0];e.style.opacity=this.config.opacity,e.style.fill=this.grayColor;var t=this.drawables[1];t.setAttribute("stroke",this.grayColor),t.setAttribute("stroke-width","1px")}},{key:"setDefault",value:function(){var e=this.drawables[0];e.style.opacity=this.config.opacity,e.style.fill=this.config.color;var t=this.drawables[1];t.setAttribute("stroke",this.config.color),t.setAttribute("stroke-width","1px")}},{key:"select",value:function(){var e=this.drawables[0];e.style.opacity=this.config.opacity,e.style.fill=this.highlightColor;var t=this.drawables[1];t.setAttribute("stroke",this.highlightColor),t.setAttribute("stroke-width",this.config.highlightWidth)}},{key:"hitTest",value:function(e){return MeasureUtil.isPointInPolygon(e,this.boundaryPts)?this:null}},{key:"hide",value:function(){this.drawables[0].style.display="none",this.drawables[1].style.display="none"}},{key:"show",value:function(){this.drawables[0].style.display="block",this.drawables[1].style.display="block"}},{key:"getBoundaryPts",value:function(){return this.boundaryPts}}]),t}(Drawable),QuarterRingArray=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=e,i.colors=["#32D3A6","#1922FB","#FF2905"],i.ids=["xy","xz","yz"],i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){if(this.drawables.length>0){var t=0,i=!0,n=!1,o=void 0;try{for(var r,a=this.drawables[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){r.value.update(e[t++])}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}else for(var s=0;s<e.length;s++){var l=new QuarterRing({color:this.colors[s],opacity:.15,id:this.ids[s]});l.update(e[s]),this.drawables.push(l)}}},{
key:"hitTest",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.drawables[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=new THREE.Vector2(e.x,e.y),l=a.hitTest(s);if(l)return l}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return null}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"getFullRingPts",value:function(e){var t=null;return"xy"===e&&(t=this.drawables[0]),"xz"===e&&(t=this.drawables[1]),"yz"===e&&(t=this.drawables[2]),t?t.getBoundaryPts():[]}}]),t}(Drawable),RotationTips=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.id=e.id,i.config=e,i.mapColors={xy:"#32D3A6",xz:"#1922FB",yz:"#FF2905"},i}return _inherits(t,e),_createClass(t,[{key:"updateRingTip",value:function(e,t){this.drawables=[],this.boundaryPts=e;var i={};i.points=MeasureUtil.calcPolylinePoints(e),i.width="1px",i.color=this.mapColors[t],i.fillColor=this.mapColors[t];var n=MeasureUtil.makePolyline(i);this.drawables.push(n)}},{key:"updateRotationAxis",value:function(e,t,i){var n=MeasureUtil.makeDashLine({color:this.mapColors[i],start:e,end:t});this.drawables.push(n)}},{key:"updateRotationRangeLines",value:function(e,t,i,n){var o=MeasureUtil.makeLine({color:this.mapColors[n],start:e,end:t});this.drawables.push(o);var r=MeasureUtil.makeLine({color:this.mapColors[n],start:e,end:i});this.drawables.push(r)}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="none"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.drawables[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="block"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),t}(Drawable),RotateNotation=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.backgroundColor="#111111",e.initialize(),e}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.notationSegment={},this.notationOutline=null,this.annotationStyle={height:30,radius:3}}},{key:"update",value:function(e,t){var i=this.calcAnnotationStyle(t,e),n=MeasureUtil.makeRectangle({x:i.offsetRect.x,y:i.offsetRect.y,width:i.width,height:this.annotationStyle.height,radius:this.annotationStyle.radius,fillColor:this.backgroundColor}),o=MeasureUtil.makeText({x:i.offsetText.x,y:i.offsetText.y,color:"#FFFFFF",fontsize:14,content:t});return this.drawables=[],this.drawables.push(n),this.drawables.push(o),this.drawables}},{key:"calcAnnotationStyle",value:function(e,t){var i=0,n=new THREE.Vector2(t.x,t.y),o=new THREE.Vector2(t.x,t.y);return i=MeasureUtil.measureText(e),n.x-=i/2,n.y-=this.annotationStyle.height/2,o.x=n.x+15,o.y=n.y+20,i+=30,{offsetRect:n,offsetText:o,width:i}}}]),t}(Drawable),RotateDrawables=function(e){function t(e,i,n,o,r){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,r))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.drawables=[],this.isOnQuarterRing=!0,this.rotationAxisLength=400,this.updateBoundingBox(),this.updateCoordinateAxis(),this.updateQuarterRings(),this.addCloudViewerEvents()}},{key:"updateQuarterRings",value:function(e){var t=this.getBoundingBoxWorld(),i=t.getCenter(),n=55*this.factor,o=this.getRotationMatrix(),r=new THREE.Vector3(2*n,0,0).applyMatrix4(o),a=new THREE.Vector3(0,-2*n,0).applyMatrix4(o),s=new THREE.Vector3(0,0,2*n).applyMatrix4(o),l=[Math.PI/2,Math.PI/2,Math.PI/2];this.isOnQuarterRing||("xy"===e&&(l[0]=2*Math.PI),"xz"===e&&(l[1]=2*Math.PI),"yz"===e&&(l[2]=2*Math.PI));var u=i.clone().add(new THREE.Vector3(.02*n,-.02*n,0).applyMatrix4(o)),c=u.clone().add(a),h=u.clone().add(a.clone().multiplyScalar(22/19)),d=this._calcRingPts(u,s,c,h,l[0]),f=i.clone().add(new THREE.Vector3(.02*n,0,.02*n).applyMatrix4(o));c=f.clone().add(r),h=f.clone().add(r.clone().multiplyScalar(22/19));var g=this._calcRingPts(f,a,c,h,l[1]),v=i.clone().add(new THREE.Vector3(0,-.02*n,.02*n).applyMatrix4(o));c=v.clone().add(s),h=v.clone().add(s.clone().multiplyScalar(22/19));var m=this._calcRingPts(v,r,c,h,l[2]);this.quarterRings||(this.quarterRings=new QuarterRingArray,this.drawables.push(this.quarterRings)),this.quarterRings.detach(),this.quarterRings.update([d,g,m]),this.setRotationEN(),this.quarterRings.attach(this.domContainer)}},{key:"updateRotationTips",value:function(e,t,i,n){var o=this.getRotationMatrix(),r=this.quarterRings.getFullRingPts(e),a=r[t],s=r[i],l=this.getEditObjectCenter();this.rotationTips||(this.rotationTips=new RotationTips({})),this.rotationTips.detach();var u=[],c=[],h=i-t>0?1:-1;Math.abs(i-t>180)&&(h=-h);for(var d=t;d!=i+h;d+=h){d>=360&&(d=0),d<0&&(d=359),u.push(r[d]);var f=720-d+1;c.push(r[f])}var g=u.concat(c.reverse());this.rotationTips.updateRingTip(g,e);var v=new THREE.Vector3(0,0,1).applyMatrix4(o);"xz"===e&&(v=new THREE.Vector3(0,1,0).applyMatrix4(o)),"yz"===e&&(v=new THREE.Vector3(1,0,0).applyMatrix4(o));var m=this.calcSegment(l,v,400);this._clientCenter||(this._clientCenter=this.viewer3D.worldToClient(l)),this.rotationTips.updateRotationAxis(m[0],m[1],e),this.rotationTips.updateRotationRangeLines(this._clientCenter,a,s,e),this.rotationTips.attach(this.domContainer),this.rotateNotation||(this.rotateNotation=new RotateNotation),this.rotateNotation.detach();var p=this._calcNotationPos(this._clientCenter,s,48),y=n;y>180&&(y-=360),this.rotateNotation.update(p,y+"°"),this.rotateNotation.attach(this.domContainer)}},{key:"removeRotationTips",value:function(){this.rotationTips&&this.rotationTips.detach(),this.rotateNotation&&this.rotateNotation.detach(),delete this._clientCenter,delete this._clientAixsStart,delete this._clientAixsEnd}},{key:"_calcRingPts",value:function(e,t,i,n,o){var r=ObjectEditorUtil.discreteCircle({center:e.clone(),arcStartPt:i,rotateAngle:o,normal:t.clone().normalize()}),a=ObjectEditorUtil.discreteCircle({center:e.clone(),arcStartPt:n,rotateAngle:o,normal:t.clone().normalize()}),s=[].concat(_toConsumableArray(r),_toConsumableArray(a.reverse())),l=[],u=!0,c=!1,h=void 0;try{for(var d,f=s[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var g=d.value;l.push(this.viewer3D.worldToClient(g))}}catch(e){c=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw h}}return this.isOnQuarterRing&&l.push(l[0]),l}},{key:"_calcNotationPos",value:function(e,t,i){var n=new THREE.Vector2(e.x,e.y),o=new THREE.Vector2(t.x,t.y),r=o.clone().sub(n).normalize();return o.add(r.multiplyScalar(i))}},{key:"getScale",value:function(e,t,i){var n=this.viewer3D.worldToClient(e),o=this.viewer3D.worldToClient(t),r=new THREE.Vector2(n.x,n.y),a=new THREE.Vector2(o.x,o.y);return i/r.distanceTo(a)}},{key:"toFullRing",value:function(e){this.isOnQuarterRing=!1,this.updateQuarterRings(e)}},{key:"fromFullRing",value:function(e){this.isOnQuarterRing=!0,this.updateQuarterRings(e)}},{key:"updateCoordinateAxis",value:function(){var e=this.getBoundingBoxWorld(),t=this.getRotationMatrix(),i=[];i.push(new THREE.Vector3(1,0,0).applyMatrix4(t)),i.push(new THREE.Vector3(0,-1,0).applyMatrix4(t)),i.push(new THREE.Vector3(0,0,1).applyMatrix4(t));var n=this.viewer3D.worldToClient(e.getCenter()),o=[],r=!0,a=!1,s=void 0;try{for(var l,u=i[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value,h=c.clone().multiplyScalar(130*this.factor).add(e.getCenter()),d=this.viewer3D.worldToClient(h);o.push(d)}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}this.dashlineArray||(this.dashlineArray=new DashlineArray({length:130,isEffectedByOthers:!0,colors:["#FF2905","#1922FB","#32D3A6"]}),this.drawables.push(this.dashlineArray)),this.dashlineArray.detach(),this.dashlineArray.update(n,o),this.setRotationEN(),this.dashlineArray.attach(this.domContainer)}},{key:"getDirection",value:function(e){return"arrowX"===e?new THREE.Vector3(1,0,0):"arrowY"===e?new THREE.Vector3(0,-1,0):new THREE.Vector3(0,0,1)}},{key:"calcSegment",value:function(e,t,i){if(!this._clientAixsStart||!this._clientAixsEnd){var n=t.clone().normalize().multiplyScalar(i*this.factor/2),o=e.clone().add(n),r=e.clone().sub(n);this._clientAixsStart=this.viewer3D.worldToClient(o.clone()),this._clientAixsEnd=this.viewer3D.worldToClient(r.clone())}return[this._clientAixsStart,this._clientAixsEnd]}},{key:"addCloudViewerEvents",value:function(){var e=this.viewer3D.getViewer();this.updateBinded=this.update.bind(this),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ROTATING,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"removeCloudViewerEvents",value:function(){var e=this.viewer3D.getViewer();e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ROTATING,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"update",value:function(){this.updateFactor(),this.updateBoundingBox(),this.updateCoordinateAxis(),this.updateQuarterRings()}},{key:"getAllDrawables",value:function(){return this.drawables}},{key:"setDefault",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setDefault()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setGray",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setGray()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"select",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){if(n.value.select())return}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"hideAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"showAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.getAllDrawables()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"dispose",value:function(){this.domContainer.innerHTML="",this.boundingBox=null,this.CoordinateAxis=null,this.removeCloudViewerEvents()}},{key:"getEditObjectCenter",value:function(){return this.getBoundingBoxWorld().getCenter()}},{key:"updateController",value:function(e){void 0!=e.X&&(this.controller.X=e.X),void 0!=e.Y&&(this.controller.Y=e.Y),void 0!=e.Z&&(this.controller.Z=e.Z)}},{key:"setRotationEN",value:function(){!this.quarterRings||this.quarterRings.drawables.length<=0||(this.controller.Y?(this.quarterRings.drawables[1].setDefault(),this.dashlineArray.drawables[1].setDefault()):(this.quarterRings.drawables[1].setGray(),this.dashlineArray.drawables[1].setGray()),this.controller.Z?(this.quarterRings.drawables[0].setDefault(),this.dashlineArray.drawables[2].setDefault()):(this.quarterRings.drawables[0].setGray(),this.dashlineArray.drawables[2].setGray()),this.controller.X?(this.quarterRings.drawables[2].setDefault(),this.dashlineArray.drawables[0].setDefault()):(this.quarterRings.drawables[2].setGray(),this.dashlineArray.drawables[0].setGray()))}}]),t}(DataDrawables),DomNS=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),ObjectEditorNS=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.ObjectEditor"),ObjectEditorManager=function(){function e(t,i){_classCallCheck(this,e),this.viewer=t,this.editObjectType=i,this.activeEditors=[],this.rotationController={X:!0,Y:!0,Z:!0},this.translationController={X:!0,Y:!0,Z:!0},this.scaleController={Uniform:!0,X:!0,Y:!0,Z:!0},this.initilize()}return _createClass(e,[{key:"initilize",value:function(){this.domContainer=DomNS.create("div","bf-ObjectEditor-conext"),this.domContainer.style.position="absolute",this.domContainer.style.left=0,this.domContainer.style.top=0,this.domContainer.style.width="100%",this.domContainer.style.height="100%",this.svgContainer=DomNS.createNS("svg","bf-ObjectEditor-svg"),this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.domContainer.appendChild(this.svgContainer),this.viewer.getDomElement().appendChild(this.domContainer),this.addDomEventListeners(),this.offset=this.viewer.getDomElement().getBoundingClientRect();var e=new Glodon.Web.Lang.EventManager;this.getEventManager=function(){return e},this.activeEditor=new TranslateEditor(this.viewer,this.editObjectType,e,this.translationController)}},{key:"setEditedObjectId",value:function(e){switch(this.editedObjectId=e,this.activeEditor.setEditedObjectId(e),this.dispose(),this.activeEditor.name){case"Translation":var t=new TranslateDrawables(this.viewer,this.svgContainer,this.editedObjectId,this.editObjectType,this.translationController);this.activeEditor.setDrawables(t);break;case"Scaling":var i=new ScaleDrawables(this.viewer,this.svgContainer,this.editedObjectId,this.editObjectType,this.scaleController);this.activeEditor.setDrawables(i)}}},{key:"attachInitDrawables",value:function(){var e=new TranslateDrawables(this.viewer,this.svgContainer,this.editedObjectId,this.editObjectType,this.translationController);this.activeEditor.setDrawables(e)}},{key:"getEditedObjectId",value:function(){return this.editedObjectId}},{key:"activateEditor",value:function(e){switch(this.dispose(),e){case"Translation":this.activeEditor=new TranslateEditor(this.viewer,this.editObjectType,this.getEventManager(),this.translationController);var t=new TranslateDrawables(this.viewer,this.svgContainer,this.editedObjectId,this.editObjectType,this.translationController);this.activeEditor.setDrawables(t);break;case"Scaling":this.activeEditor=new ScaleEditor(this.viewer,this.editObjectType,this.getEventManager(),this.scaleController);var i=new ScaleDrawables(this.viewer,this.svgContainer,this.editedObjectId,this.editObjectType,this.scaleController);this.activeEditor.setDrawables(i);break;case"Rotation":this.activeEditor=new RotateEditor(this.viewer,this.editObjectType,this.getEventManager(),this.rotationController);var n=new RotateDrawables(this.viewer,this.svgContainer,this.editedObjectId,this.editObjectType,this.rotationController);this.activeEditor.setDrawables(n)}this.activeEditor.setEditedObjectId(this.editedObjectId)}},{key:"dispose",value:function(){if(this.activateEditor){var e=this.activeEditor.getDrawables();e&&e.dispose()}}},{key:"hide",value:function(){this.domContainer.style.display="none"}},{key:"show",value:function(){this.domContainer.style.display=""}},{key:"onExit",value:function(){this.dispose(),this.removeDomEventListeners(),this.destroySvgContainer(),this.isExitNow=!0}},{key:"addDomEventListeners",value:function(){this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.onWindowResizeBinded=this.onWindowResize.bind(this);var e=this.svgContainer;e.addEventListener("mousemove",this.onMouseMoveBinded,!1),e.addEventListener("mousedown",this.onMouseDownBinded,!1),document.addEventListener("mouseup",this.onMouseUpBinded,!1),e.addEventListener("dblclick",this.onMouseDoubleClickBinded,!1),window.addEventListener("resize",this.onWindowResizeBinded,!1)}},{key:"removeDomEventListeners",value:function(){var e=this.svgContainer;e.removeEventListener("mousemove",this.onMouseMoveBinded),e.removeEventListener("mousedown",this.onMouseDownBinded),document.removeEventListener("mouseup",this.onMouseUpBinded),e.removeEventListener("dblclick",this.onMouseDoubleClickBinded),window.removeEventListener("resize",this.onWindowResizeBinded)}},{key:"destroySvgContainer",value:function(){this.domContainer.removeChild(this.svgContainer),this.svgContainer=null,this.viewer.getDomElement().removeChild(this.domContainer),this.domContainer=null}},{key:"onMouseDown",value:function(e){this.isExitNow||e.button===THREE.MOUSE.LEFT&&this.activeEditor.begin(e)}},{key:"onMouseMove",value:function(e){this.isExitNow||this.activeEditor.onEditing(e)}},{key:"onMouseUp",value:function(e){this.isExitNow||e.button===THREE.MOUSE.LEFT&&(this.activeEditor.end(e),this.activeEditor.dataDrawables.update())}},{key:"onMouseDoubleClick",value:function(e){this.isExitNow||(e.preventDefault(),e.stopPropagation())}},{key:"onWindowResize",value:function(){this.activeEditor&&this.activeEditor.dataDrawables&&this.activeEditor.dataDrawables.update()}},{key:"updateController",value:function(e,t){switch(t){case"Translation":void 0!=e.X&&(this.translationController.X=e.X),void 0!=e.Y&&(this.translationController.Y=e.Y),void 0!=e.Z&&(this.translationController.Z=e.Z);break;case"Rotation":void 0!=e.X&&(this.rotationController.X=e.X),void 0!=e.Y&&(this.rotationController.Y=e.Y),void 0!=e.Z&&(this.rotationController.Z=e.Z);break;case"Scaling":void 0!=e.X&&(this.scaleController.X=e.X),void 0!=e.Y&&(this.scaleController.Y=e.Y),void 0!=e.Z&&(this.scaleController.Z=e.Z),void 0!=e.Uniform&&(this.scaleController.Uniform=e.Uniform)}if(this.activeEditor.name===t){this.activeEditor.updateController(e);var i=this.activeEditor.getDrawables();i&&i.updateController(e)}this.onWindowResize()}}]),e}();ObjectEditorNS.ObjectEditorManager=ObjectEditorManager;var DomNS$1=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),ObjectEditorToolbar=function(){function e(t){_classCallCheck(this,e),this.viewer=t.viewer,this.objectId=t.objectId,this.viewer._objectEditorToolbar&&this.viewer._objectEditorToolbar.exit(),this.mode=null,this.toolBarButtons={translate:!t.buttonVisibility.hasOwnProperty("translate")||t.buttonVisibility.translate,rotate:!t.buttonVisibility.hasOwnProperty("rotate")||t.buttonVisibility.rotate,scale:!t.buttonVisibility.hasOwnProperty("scale")||t.buttonVisibility.scale},this.viewer._objectEditorToolbar=this,this.rotationController={X:!t.rotationController.hasOwnProperty("X")||t.rotationController.X,Y:!t.rotationController.hasOwnProperty("Y")||t.rotationController.Y,Z:!t.rotationController.hasOwnProperty("Z")||t.rotationController.Z},this.translationController={X:!t.translationController.hasOwnProperty("X")||t.translationController.X,Y:!t.translationController.hasOwnProperty("Y")||t.translationController.Y,Z:!t.translationController.hasOwnProperty("Z")||t.translationController.Z},this.scaleController={Uniform:!t.scaleController.hasOwnProperty("Uniform")||t.scaleController.Uniform,X:!t.scaleController.hasOwnProperty("X")||t.scaleController.X,Y:!t.scaleController.hasOwnProperty("Y")||t.scaleController.Y,Z:!t.scaleController.hasOwnProperty("Z")||t.scaleController.Z}}return _createClass(e,[{key:"setRotationController",value:function(e){e&&(this.rotationController=e),this.objectEditorManager.updateController(this.rotationController,"Rotation")}},{key:"getRotationController",value:function(){var e={};return e.X=!this.rotationController.hasOwnProperty("X")||this.rotationController.X,e.Y=!this.rotationController.hasOwnProperty("Y")||this.rotationController.Y,e.Z=!this.rotationController.hasOwnProperty("Z")||this.rotationController.Z,e}},{key:"setTranslationController",value:function(e){e&&(this.translationController=e),this.objectEditorManager.updateController(this.translationController,"Translation")}},{key:"getTranslationController",value:function(){var e={};return e.X=!this.translationController.hasOwnProperty("X")||this.translationController.X,e.Y=!this.translationController.hasOwnProperty("Y")||this.translationController.Y,e.Z=!this.translationController.hasOwnProperty("Z")||this.translationController.Z,e}},{key:"setScaleController",value:function(e){e&&(this.scaleController=e),this.objectEditorManager.updateController(this.scaleController,"Scaling")}},{key:"getScaleController",value:function(){var e={};return e.X=!this.scaleController.hasOwnProperty("X")||this.scaleController.X,e.Y=!this.scaleController.hasOwnProperty("Y")||this.scaleController.Y,e.Z=!this.scaleController.hasOwnProperty("Z")||this.scaleController.Z,e.Uniform=!this.scaleController.hasOwnProperty("Uniform")||this.scaleController.Uniform,e}},{key:"setButtonVisibility",value:function(e){e&&(this.toolBarButtons=e,this._updateButtonsVisibility())}},{key:"getButtonVisibility",value:function(){var e={};return e.translate=!this.toolBarButtons.hasOwnProperty("translate")||this.toolBarButtons.translate,e.rotate=!this.toolBarButtons.hasOwnProperty("rotate")||this.toolBarButtons.rotate,e.scale=!this.toolBarButtons.hasOwnProperty("scale")||this.toolBarButtons.scale,e}},{key:"_updateButtonsVisibility",value:function(){this.toolBarButtons.scale||this.toolBarButtons.rotate||this.toolBarButtons.translate?(this.switchToolbarAllHide=!1,this.show()):(this.setBimfaceUIVisibility(!1),this.switchToolbar.hide(),this.switchToolbarAllHide=!0);var e=this.switchToolbar.getControls(),t=this.getButton("Translation",e),i=this.getButton("Rotation",e),n=this.getButton("Scaling",e);this.toolBarButtons.translate?t.show():t.hide(),this.toolBarButtons.rotate?i.show():i.hide(),this.toolBarButtons.scale?n.show():n.hide()}},{key:"_updateController",value:function(){this.objectEditorManager&&(this.objectEditorManager.updateController(this.translationController,"Translation"),this.objectEditorManager.updateController(this.rotationController,"Rotation"),this.objectEditorManager.updateController(this.scaleController,"Scaling"))}},{key:"setEditingMode",value:function(e){if(this.objectEditorManager){switch(e){case"rotation":this.mode="rotation",this.objectEditorManager.activateEditor("Rotation");break;case"translation":this.mode="translation",this.objectEditorManager.activateEditor("Translation");break;case"scale":this.mode="scale",this.objectEditorManager.activateEditor("Scaling")}this.objectEditorManager.show()}}},{key:"getEditingMode",value:function(){return this.mode}},{key:"setEditedObjectId",value:function(e){this.objectEditorManager.setEditedObjectId(e)}},{key:"getEditedObjectId",value:function(){return this.objectEditorManager.getEditedObjectId()}},{key:"show",value:function(){this._destroyed||("Viewer3D"===this.viewer.viewerType?this.viewer.hideViewHouse():this.viewer.hideNorthArrow(),this.setBimfaceUIVisibility(!1),this.modelEditor.show(),this.switchToolbarAllHide||this.switchToolbar.show(),this.objectEditorManager.show())}},{key:"hide",value:function(){this._destroyed||("Viewer3D"===this.viewer.viewerType?this.viewer.showViewHouse():this.viewer.showNorthArrow(),this.setBimfaceUIVisibility(!0),this.modelEditor.hide(),this.switchToolbar.hide(),this.objectEditorManager.hide())}},{key:"exit",value:function(){this._destroyed||(this.hide(),this.objectEditorManager.onExit(),delete this.viewer._objectEditorToolbar,this.destroy())}},{key:"destroy",value:function(){this.viewer.getDomElement().removeChild(this.domElement),this.domElement=null,this.viewer=null,this.objectId=null,this.objectEditorManager=null,this._destroyed=!0}},{key:"update",value:function(){}},{key:"updateManagerController",value:function(e,t){this.objectEditorManager.updateController(e,type)}},{key:"initialize",value:function(){this.mapUIVisibility={"bf-tree-toolbar":"none","bf-modelTree-panel":"none","bf-toolbar-bottom":"none","bf-property-panel":"none","bf-measurement-panel":"none","bf-sectionPlane-panel":"none","bf-pickSectionPlane-panel":"none","bf-sectionBox-panel":"none","bf-settings-panel":"none","bf-basicInfo-panel":"none","bf-map-panel":"none"},this.recordUIVisibility()}},{key:"toolBarDom",value:function(){var e=this,t=this,i=[],n=DomNS$1.create("div","bf-roomEditorToolbar");if(t.domElement=n,n.addEventListener("mousedown",function(e){return e.stopPropagation(),!1}),void 0===this.switchToolbar){var o=Glodon$1.Bimface.UI.Toolbar.ToolbarConfig();o.className="bf-toolbar bf-toolbar-roomEditor",o.element=n,o.buttons=["ModelEditingTranslate","ModelEditingRotate","ModelEditingScale"];this.viewer.getDomElement().appendChild(n),this.switchToolbar=new Glodon$1.Bimface.Application.UI.Toolbar.Toolbar(o),i.push(this.switchToolbar)}var r=Glodon$1.Bimface.UI.Control.ControlEvent,a=this.switchToolbar.getControls();this.uncheckOthers("Translation",a);for(var s=["Translation","Rotation","Scaling"],l=0;l<a.length;l++)!function(e){var i=a[e];i.addEventListener(r.Click,function(){i.isChecked()?(t.objectEditorManager.activateEditor(s[e]),t.uncheckOthers(i.getId(),a)):i.toggleCheckedState()})}(l);var u=new Glodon$1.Bimface.UI.Toolbar.ToolbarConfig;u.element=n,u.className="bf-toolbar bf-toolbar-roomEditor";var c=t.modelEditor=new Glodon$1.Bimface.UI.Toolbar.Toolbar(u);t.modelEditor=c,i.push(c);var h=new Glodon$1.Bimface.UI.Button.ButtonConfig;h.className="bf-modeleditor-cancel",h.title=BimfaceLanguage.bf_general_exit;var d=new Glodon$1.Bimface.UI.Button.SingleButton(h);d.setHtml("退出"===BimfaceLanguage.bf_general_exit?"退 出":BimfaceLanguage.bf_general_exit),d.addEventListener("Click",function(){e.exit()}),c.addControl(d),this.viewer.getDomElement().appendChild(n),this._updateButtonsVisibility(),this._updateController()}},{key:"recordUIVisibility",value:function(){var e=Object.keys(this.mapUIVisibility),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value,s=document.getElementsByClassName(a);s.length>0&&(this.mapUIVisibility[a]=s[0].style.display)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"uncheckOthers",value:function(e,t){var i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;s.getId()===e?s.setCheckedState(!0):s.setCheckedState(!1)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"getButton",value:function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(n.getId()===e)return n}}},{key:"setBimfaceUIVisibility",value:function(e){var t=Object.keys(this.mapUIVisibility),i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,l=document.getElementsByClassName(s);0!=l.length&&(l[0].style.display=0==e?"none":this.mapUIVisibility[s])}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"_getEventManager",value:function(){return this.objectEditorManager.getEventManager()}},{key:"addEventListener",value:function(e,t){this._getEventManager().addEvent(e,t)}},{key:"removeEventListener",value:function(e,t){this._getEventManager().removeEvent(e,t)}}]),e}();!function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.ModelEditor"),t=function(){return{viewer:null,modelId:null,app:null,buttonVisibility:{},translationController:{},rotationController:{},scaleController:{}}};e.ModelEditorToolbarConfig=t}(),function(){var e="Bimface.Plugins.ModelEditor",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.ModelEditor")),n=function(i){function n(i){_classCallCheck(this,n),t.send(e,"ModelEditorToolbar"),i.objectId=i.modelId;var o=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,i));return o.name="ModelEditorToolbar",o.initialize(),o.toolBarDom(),o}return _inherits(n,i),_createClass(n,[{key:"setButtonVisibility",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setButtonVisibility",this).call(this,e)}},{key:"getButtonVisibility",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getButtonVisibility",this).call(this)}},{key:"setEditedModelId",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setEditedObjectId",this).call(this,modeId)}},{key:"getEditedModelId",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getEditedObjectId",this).call(this)}},{key:"show",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"show",this).call(this)}},{key:"hide",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"hide",this).call(this)}},{key:"exit",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"exit",this).call(this)}},{key:"setRotationController",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setRotationController",this).call(this,e)}},{key:"getRotationController",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getRotationController",this).call(this)}},{key:"setTranslationController",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setTranslationController",this).call(this,e)}},{key:"getTranslationController",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getTranslationController",this).call(this)}},{key:"setScaleController",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setScaleController",this).call(this,e)}},{key:"getScaleController",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getScaleController",this).call(this)}},{key:"setEditingMode",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setEditingMode",this).call(this,e)}},{key:"getEditingMode",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getEditingMode",this).call(this)}},{key:"initialize",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initialize",this).call(this),this.objectEditorManager=new ObjectEditorManager(this.viewer,"Model"),this.objectEditorManager.setEditedObjectId(this.objectId)}}]),n}(ObjectEditorToolbar);i.ModelEditorToolbar=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.ModelEditor"),t=Object.freeze({ModelTransformStart:"ModelTransformStart",ModelTransforming:"ModelTransforming",ModelTransformEnd:"ModelTransformEnd"});e.ModelEditorToolbarEvent=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.ExternalObject"),t=function(){return{"3DS":{loaderName:"TDSLoader",loaderFiles:["TDSLoader.js"]},FBX:{loaderName:"FBXLoader",loaderFiles:["inflate.min.js","FBXLoader.js"]},OBJ:{loaderName:"OBJLoader",loaderFiles:["OBJLoader.js"]},MTL:{loaderName:"MTLLoader",loaderFiles:["MTLLoader.js"]}}};e.loadersConfig=t}(),function(){
var e="Bimface.Plugins.ExternalObject.ExternalObjectManager",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.HttpRequest,n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.ExternalObject"),o=function(){function n(i){_classCallCheck(this,n),t.send(e,"bf_c_extObjMng_new"),this._viewer=i,i.externalComponentManager&&!i.externalComponentManager.isDestroyed()||(i.externalComponentManager=new CLOUD.ExternalComponentManager(i.getViewer()),i.externalComponentManager._objects={}),this._manager=i.externalComponentManager,this._objects=this._manager._objects,this.modelId="ExternalComponent";var o=new Glodon$1.Web.Lang.EventManager;return this.getEventManager=function(){return o},i.externalObjectManager=this,this}return _createClass(n,[{key:"addEventListener",value:function(e,t){this.getEventManager().addEvent(e,t)}},{key:"removeEventListener",value:function(e,t){this.getEventManager().removeEvent(e,t)}},{key:"addObject",value:function(i,n,o){if(t.send(e,"bf_c_extObjMng_addObj"),this.getObjectIdByName(i))return void console.warn('[ExternalObjectManager.addObject] 已有名为 "'+i+'" 的ExternalObject，请更换名称后再执行ExternalObjectManager.addObject()');var r=Glodon$1.Web.Lang.Utility.UUID.createUUID();return this._manager.addNode(r,n),this._objects[r]=i,this._viewer.getViewer().render(),"Viewer3D"===this._viewer.getViewerType()&&this._manager.bindModel(r,o||this._viewer.getDefaultModel().modelId),r}},{key:"addObjectByUrl",value:function(e,t,n,o){var r=this,a=window.bimfaceStaticHost,s=Glodon$1.Bimface.Plugins.ExternalObject.loadersConfig(),l=[];for(var u in t){var c=t[u].split(".").pop().toUpperCase(),h=s[c]&&s[c].loaderFiles;if(void 0===h)return console.warn("File format not supported, currently supported formats: 3DS, FBX, OBJ."),!1;h.forEach(function(e){l.push(a+"/lib/loaders/"+e)})}i.getScripts(l,function(){var i=t.url,a=t.mtlUrl,l=i.split(".").pop().toUpperCase(),u=s[l].loaderName,c="FBX"===l?new FBXLoader:new THREE[u];if(void 0===a)c.load(i,function(t){r.addObject(e,t,o),n&&n()});else{(new THREE.MTLLoader).load(a,function(t){t.preload(),c.setMaterials(t),c.load(i,function(t){r.addObject(e,t,o),n&&n()})})}})}},{key:"getObjectIdByName",value:function(e){for(var t in this._objects)if(this._objects[t]===e)return t}},{key:"getAllObjectIds",value:function(){return Object.keys(this._objects)}},{key:"removeById",value:function(e){this._objects[e]&&(this._manager.removeNodeById(e),delete this._objects[e],this._viewer.getViewer().render())}},{key:"clear",value:function(){this._manager.clearNodes(),this._objects={},this._viewer.getViewer().render()}},{key:"convert",value:function(e,t){return!1!==t&&(t=!0),this._viewer.getExternalObjectConverter().convertToExternalObject(e,e,t)}},{key:"_fireTransformedEvent",value:function(e){this.getEventManager().fireEvent(Glodon$1.Bimface.Viewer.Viewer3DEvent.ExternalObjectTransformed,e,this.getPosition(e))}},{key:"translate",value:function(e,t){this._manager.setAccumulateTransform(e,t),this._viewer.getViewer().render(),this._fireTransformedEvent(e)}},{key:"rotateOnBasePoint",value:function(e,t,i,n){this._manager.rotateOnBasePoint(e,t,i,n),this._viewer.getViewer().render(),this._fireTransformedEvent(e)}},{key:"scaleOnBasePoint",value:function(e,t,i){this._manager.scaleOnBasePoint(e,t,i),this._viewer.getViewer().render(),this._fireTransformedEvent(e)}},{key:"getBoundingBoxById",value:function(e){return this._manager.getBoundingBoxById(e)}},{key:"_getValid3dParam",value:function(e){if("[object Object]"===Object.prototype.toString.call(e)&&e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z"))return new THREE.Vector3(e.x,e.y,e.z)}},{key:"setPosition",value:function(e,t){var i=this._getValid3dParam(t);i&&(this._manager.setTransform(e,i,void 0,void 0,void 0,!0),this._viewer.getViewer().render(),this._fireTransformedEvent(e))}},{key:"getPosition",value:function(e){var t=this._manager.getTransform(e);if(t&&t.position){var i=t.position;return{x:i.x,y:i.y,z:i.z}}}},{key:"offset",value:function(e,t){var i=this._getValid3dParam(t);i&&(this._manager.setAccumulateOffset(e,i),this._viewer.getViewer().render(),this._fireTransformedEvent(e))}},{key:"offsetX",value:function(e,t){this.offset(e,{x:t,y:0,z:0})}},{key:"offsetY",value:function(e,t){this.offset(e,{x:0,y:t,z:0})}},{key:"offsetZ",value:function(e,t){this.offset(e,{x:0,y:0,z:t})}},{key:"rotate",value:function(e,t){var i=this._getValid3dParam(t);i&&(this._manager.setAccumulateTransform(e,void 0,void 0,i),this._viewer.getViewer().render(),this._fireTransformedEvent(e))}},{key:"rotateX",value:function(e,t){this.rotate(e,{x:t,y:0,z:0})}},{key:"rotateY",value:function(e,t){this.rotate(e,{x:0,y:t,z:0})}},{key:"rotateZ",value:function(e,t){this.rotate(e,{x:0,y:0,z:t})}},{key:"setRotationX",value:function(e,t,i){var n=new THREE.Vector3(1,0,0);this.rotateOnBasePoint(e,t,n,i)}},{key:"setRotationY",value:function(e,t,i){var n=new THREE.Vector3(0,1,0);this.rotateOnBasePoint(e,t,n,i)}},{key:"setRotationZ",value:function(e,t,i){var n=new THREE.Vector3(0,0,1);this.rotateOnBasePoint(e,t,n,i)}},{key:"scale",value:function(e,t){var i=this._getValid3dParam(t);i&&0!==i.x&&0!==i.y&&0!==i.z&&(this._manager.setAccumulateTransform(e,void 0,i),this._viewer.getViewer().render(),this._fireTransformedEvent(e))}},{key:"scaleX",value:function(e,t){this.scale(e,{x:t,y:1,z:1})}},{key:"scaleY",value:function(e,t){this.scale(e,{x:1,y:t,z:1})}},{key:"scaleZ",value:function(e,t){this.scale(e,{x:1,y:1,z:t})}},{key:"getTransformation",value:function(e){if(this._manager._hasObjectId(e)){var t=_slicedToArray(this._manager.meshes[e],1),i=t[0];if(i){return i.matrix.clone().elements}}}},{key:"setTransformation",value:function(e,t){if(this._manager._hasObjectId(e)&&!(["[object Float32Array]","[object Array]"].indexOf(Object.prototype.toString.call(t))<0)){var i=new THREE.Matrix4;i.fromArray(t),this._manager.applyTransformMatrix(e,i,!0),this._viewer.getViewer().render(),this._fireTransformedEvent(e)}}},{key:"setGlowEffectById",value:function(i,n){t.send(e,"setGlowEffectById");var o=new THREE.Color("#11DAB7"),r="body",a=.3,s=3,l=!1;null!=n&&(null!=n.type&&(r=n.type),null!=n.color&&n.color instanceof Glodon$1.Web.Graphics.Color&&(o=new THREE.Color(n.color.red/255,n.color.green/255,n.color.blue/255)),null!=n.intensity&&(a=n.intensity),null!=n.spread&&(s=n.spread),null!=n.isGis&&(l=n.isGis)),this._viewer.getViewer().setGlowEffectById(this.modelId,i,{color:o,type:r,intensity:a,spread:s,isGis:l}),this._viewer.render()}},{key:"removeGlowEffectById",value:function(i){if(t.send(e,"removeGlowEffectById"),null==i||0==i.length)return void console.warn("没有发光效果被删除。");this._viewer.getViewer().removeGlowEffectById(this.modelId,i),this._viewer.render()}},{key:"clearGlowEffect",value:function(){t.send(e,"clearGlowEffect"),this._viewer.getViewer().removeGlowEffectById(this.modelId),this._viewer.render()}},{key:"play",value:function(e){if(!this.isAnimatable(e))return void console.warn("there is no animation in the mesh");this._manager.play(e)}},{key:"pause",value:function(e){this._manager.pause(e)}},{key:"stop",value:function(e){this._manager.stop(e)}},{key:"isAnimatable",value:function(e){return this._manager.isAnimation(e)}}]),n}();n.ExternalObjectManager=o}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.ExternalObject"),t=function(){return{viewer:null,id:null,app:null,buttonVisibility:{},translationController:{},rotationController:{},scaleController:{}}};e.ExternalObjectEditorToolbarConfig=t}(),function(){var e="Bimface.Plugins.ExternalObject",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.ExternalObject")),n=function(i){function n(i){_classCallCheck(this,n),t.send(e,"ExternalObjectEditorToolbar"),i.objectId=i.id;var o=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,i));return o.name="ExternalObjectEditorToolbar",o.initialize(),o.toolBarDom(),o}return _inherits(n,i),_createClass(n,[{key:"setButtonVisibility",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setButtonVisibility",this).call(this,e)}},{key:"getButtonVisibility",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getButtonVisibility",this).call(this)}},{key:"setEditedExternalObjectId",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setEditedObjectId",this).call(this,e)}},{key:"getEditedExternalObjectId",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getEditedObjectId",this).call(this)}},{key:"show",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"show",this).call(this)}},{key:"hide",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"hide",this).call(this)}},{key:"exit",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"exit",this).call(this)}},{key:"setRotationController",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setRotationController",this).call(this,e)}},{key:"getRotationController",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getRotationController",this).call(this)}},{key:"setTranslationController",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setTranslationController",this).call(this,e)}},{key:"getTranslationController",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getTranslationController",this).call(this)}},{key:"setScaleController",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setScaleController",this).call(this,e)}},{key:"getScaleController",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getScaleController",this).call(this)}},{key:"setEditingMode",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setEditingMode",this).call(this,e)}},{key:"getEditingMode",value:function(){return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getEditingMode",this).call(this)}},{key:"initialize",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initialize",this).call(this),this.objectEditorManager=new ObjectEditorManager(this.viewer,"ExternalObject"),this.objectEditorManager.setEditedObjectId(this.objectId)}}]),n}(ObjectEditorToolbar);i.ExternalObjectEditorToolbar=n}(),function(){var e="Bimface.Plugins.SpatialRelation",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SpatialRelation")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"Room"),this.viewer3D=n.viewer,this.databagId=n.viewer._data.databagId,this.toleranceType={STRICT:"STRICT",ORDINARY:"ORDINARY",LENIENT:"LENIENT"},this.tolerence=.25,this.mapRoomBbox={},this.mapRoomBoundary={},this.mapRoomId={},this.mapArea={},this.allComponentIds=null,!0!==n.hasInitialized&&this.initialize()}return _createClass(i,[{key:"initialize",value:function(){var e=this;"singleMode"===this.viewer3D._data.modelType&&this.getRooms(function(t){var i=JSON.parse(t),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;e.mapRoomId[l.id]=!0,e.mapRoomBbox[l.id]=(new THREE.Box3).setFromPoints([l.bboxMin,l.bboxMax])}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}})}},{key:"getRooms",value:function(e){this.viewer3D.getDefaultModel()._getMetaDataManager().dataManager.getRooms(function(t){e&&e(t)})}},{key:"getRoomBoundary",value:function(e,t){if(this.mapRoomId[e]){this.viewer3D.getDefaultModel()._getMetaDataManager().dataManager.getRoomBoundary(e,function(e){t&&t(e)})}}},{key:"getAreaByRoomId",value:function(e){var t=this,i=new Array,n=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u={id:l,unit:"m2",value:null};if(t.mapArea[l])u.value=t.mapArea[l];else{var c=t._getRoomBoundaryById(l);c?u.value=Math.abs(THREE.ShapeUtils.area(c))/1e6:console.warn("Input room id "+l+" is invalid.")}i.push(u)}}catch(e){o=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}return i}},{key:"getBoundaryByRoomId",value:function(e){var t=new Array,i=this.viewer3D.getCustomizedRoom();if(e in i)for(var n=this._getRoomBoundaryById(e),o=0,r=n.length;o<r;o++){var a=new Array;a.push(n[o].x),a.push(n[o].y),a.push(i[e].offset[0]),t.push(a)}else console.warn("Input room id "+e+" is not exist.");return t}},{key:"setBoundaryByRoomId",value:function(e,t){var i=this.viewer3D.getCustomizedRoom();if(e in i){var n=i[e];this.viewer3D.clearRoomsById(e);var o=this.viewer3D.createBoundary(t);if(null==o)return;o.offsetZ-=n.offset[0],this.viewer3D.createRoomByOffset(o,n.offset,e,n.faceColor,n.frameColor),this.viewer3D.render();var r={id:e,unit:"m2",value:null},a=this._getRoomBoundaryById(e);r.value=Math.abs(THREE.ShapeUtils.area(a))/1e6}else console.warn("Input room id "+e+" is not exist.")}},{key:"getModelComponentIds",value:function(){if(this.allComponentIds)return this.allComponentIds;this.allComponentIds=new Array;for(var e=this.viewer3D.getViewer(),t=e.getFilter().getObjectsMap(),i=Object.keys(t),n=0;n<i.length;n++){var o,r=i[n],a=t[r],s=Object.keys(a);(o=this.allComponentIds).push.apply(o,_toConsumableArray(s))}return this.allComponentIds}},{key:"getComponentsByRoomId",value:function(e,t,i,n){void 0==t&&(t=this.toleranceType.ORDINARY),void 0==i&&(i=this.toleranceType.STRICT);var o=this;this.getRoomBoundary(e,function(t){var i=JSON.parse(t);i.hasOwnProperty("loops")&&(i=i.loops[0]);var n=[],r=!0,a=!1,s=void 0;try{for(var l,u=i[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;n.push({x:c[0].x,y:c[0].y})}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}o.mapRoomBoundary[e]=n});for(var r=[],a=this.getModelComponentIds(),s=0;s<a.length;s++){var l=a[s],u=this.viewer3D.getViewer().getComponentInfoByUserId(l).boundingBox;this.roomContains(e,u,t,i)&&r.push(l)}n&&n(r)}},{key:"getRoomsByComponentId",value:function(e,t,i,n){void 0==t&&(t=this.toleranceType.ORDINARY),void 0==i&&(i=this.toleranceType.STRICT);for(var o=[],r=this.viewer3D.getCustomizedRoom(),a=Object.keys(r),s=a,l=0;l<s.length;l++){var u=s[l],c=this.viewer3D.getViewer().getComponentInfoByUserId(e).boundingBox;this.roomContains(u,c,t,i)&&o.push(u)}n&&n(o)}},{key:"roomContains",value:function(e,t,i,n){if(!this.viewer3D.getCustomizedRoom()[e]&&!this.mapRoomBoundary[e])return void console.warn("Input room id is invalid.");var o=this.isRoomContainBoundingBoxByZ(e,t,n);if(0==o)return o;var r=this.isRoomBoundingBoxContainBoundingBoxByXY(e,t,i);if(0==r)return r;var a=this.isRoomBoundaryContainBoundingBoxByXY(e,t,i);return 0!=a||a}},{key:"getRoomBoundingBoxById",value:function(e){var t=this.getCustomizedRoom(e);if(t){var i=t.boundingBox,n=t.offset;return i.min.z=n[0],i.max.z=n[1],i}if(this.mapRoomBbox[e])return this.mapRoomBbox[e]}},{key:"getCustomizedRoom",value:function(e){var t=this.viewer3D.getCustomizedRoom()[e];if(!t)return null;if(t.boundary&&"user"!=t.boundary.belong){var i=[],n=t.boundary,o=n.loops[0],r=!0,a=!1,s=void 0;try{for(var l,u=o[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;i.push([c[0].x,c[0].y,c[0].z])}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}var h=this.viewer3D.createBoundary(i);return h.offset=[].concat(_toConsumableArray(t.offset)),h}return t.boundary.offset=t.offset,t.boundary}},{key:"_getRoomBoundaryById",value:function(e){return this.viewer3D.getCustomizedRoom()[e]?this.getCustomizedRoom(e).roomBoundary:this.mapRoomBoundary[e]}},{key:"isRoomContainBoundingBoxByZ",value:function(e,t,i){var n=this.getRoomBoundingBoxById(e),o=n.min.z,r=n.max.z,a=t.max.z,s=t.min.z,l=this.tolerence;if(i==this.toleranceType.STRICT)return s>=o-l&&a<=r+l;if(i==this.toleranceType.ORDINARY){var u=(s+a)/2;return this.isBetween(u,o,r)&&(this.isBetween(s,o,r)||this.isBetween(a,o,r))}return i==this.toleranceType.LENIENT?s<=r+l&&a>=o-l:void 0}},{key:"getHeightByRoomId",value:function(e){var t=this.getCustomizedRoom(e);if(t)return{bottomHeight:t.offset[0],topHeight:t.offset[1]};console.log("No room exists whose id is "+e)}},{key:"setTopHeightByRoomId",value:function(e,t){var i=this.getCustomizedRoom(e);if(i){var n=this.viewer3D.getCustomizedRoom()[e];this.viewer3D.clearRoomsById([e]);for(var o=[],r=0;r<i.roomBoundary.length-1;r++){var a=i.roomBoundary[r];o.push([a.x,a.y,0])}var s=this.viewer3D.createBoundary(o),l=[i.offset[0],t];this.viewer3D.createRoomByOffset(s,l,e,n.faceColor,n.frameColor)}else console.log("No room exists whose id is "+e)}},{key:"setBottomHeightByRoomId",value:function(e,t){var i=this.getCustomizedRoom(e);if(i){var n=this.viewer3D.getCustomizedRoom()[e];this.viewer3D.clearRoomsById([e]);for(var o=[],r=0;r<i.roomBoundary.length-1;r++){var a=i.roomBoundary[r];o.push([a.x,a.y,0])}var s=this.viewer3D.createBoundary(o),l=[t,i.offset[1]];this.viewer3D.createRoomByOffset(s,l,e,n.faceColor,n.frameColor)}else console.log("No room exists whose id is "+e)}},{key:"isRoomBoundingBoxContainBoundingBoxByXY",value:function(e,t,i){var n=this.getRoomBoundingBoxById(e),o=n.min.x,r=n.max.x,a=n.min.y,s=n.max.y,l=t.min.x,u=t.max.x,c=t.min.y,h=t.max.y,d=this.tolerence;return i==this.toleranceType.STRICT?l>=o-d&&u<=r+d&&c>=a-d&&h<=s+d:i==this.toleranceType.ORDINARY||i==this.toleranceType.LENIENT?l<=r+d&&u>=o-d&&c<=s+d&&h>=a-d:void 0}},{key:"isRoomBoundaryContainBoundingBoxByXY",value:function(e,t,i){for(var n=this.toFivePos(t),o=this._getRoomBoundaryById(e),r=0,a=0;a<n.length;a++){var s=n[a];this.containsInBoundary(s,o)&&r++}var l=!1;return i==this.toleranceType.STRICT?l=5==r:i==this.toleranceType.ORDINARY?l=r>=3:i==this.toleranceType.LENIENT&&(l=r>=1),l}},{key:"isBetween",value:function(e,t,i){var n=this.tolerence;return e<=i+n&&e>=t-n}},{key:"toFivePos",value:function(e){var t=[];return t.push(new THREE.Vector2(e.min.x,e.min.y)),t.push(new THREE.Vector2(e.max.x,e.min.y)),t.push(new THREE.Vector2(e.max.x,e.max.y)),t.push(new THREE.Vector2(e.min.x,e.max.y)),t.push(new THREE.Vector2((e.min.x+e.max.x)/2,(e.min.y+e.max.y)/2)),t}},{key:"containsInBoundary",value:function(e,t){for(var i=!1,n=0;n<t.length-1;n++)if(this.isOnSegment(e,t[n],t[n+1])){i=!0;break}if(i)return!0;for(var o=e.x,r=e.y,a=!1,s=0,l=t.length-1;s<t.length;l=s++){var u=t[s].x||t[s][0],c=t[s].y||t[s][1],h=t[l].x||t[l][0],d=t[l].y||t[l][1];c>r!=d>r&&o<(h-u)*(r-c)/(d-c)+u&&(a=!a)}return a}},{key:"isOnSegment",value:function(e,t,i){if(e.x>Math.max(t.x,i.x)||e.x<Math.min(t.x,i.x))return!1;if(e.y>Math.max(t.y,i.y)||e.y<Math.min(t.y,i.y))return!1;if(t.x!=i.x){var n=(i.y-t.y)/(i.x-t.x),o=i.y-n*i.x;if(n*e.x+o==e.y)return!0}else if(e.x==t.x)return!0;return!1}}]),i}();i.Room=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SpatialRelation"),t=function(){return{viewer:null}};e.RoomConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SpatialRelation"),t=Object.freeze({Saved:"Saved",Cancelled:"Cancelled"});e.RoomEditorToolbarEvent=t}(),function(){var e="Bimface.Plugins.SpatialRelation",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SpatialRelation"),o=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Application.UI.Button"),Glodon$1.Bimface.Plugins.SpatialRelation.RoomEditorToolbarEvent),r=function(){function n(i){_classCallCheck(this,n),t.send(e,"RoomEditorToolbar"),this.id="RoomEditorToolbar",this.viewer=i.viewer,this.roomId=i.roomId,this.databagId=i.viewer._data.databagId,this.eventManager=new Glodon$1.Web.Lang.EventManager,this.initialize(),this.toolBarDom()}return _createClass(n,[{key:"initialize",value:function(){var e=Glodon$1.Bimface.Plugins.RoomEditing,t=new e.RoomEidtorConfig;t.viewer=this.viewer,t.roomId=this.roomId,this.roomEditor=new e.RoomEditor(t),this.roomEditor.onEnter(),this.registerRoomEditorEvents()}},{key:"toolBarDom",value:function(){var e=this,t=[],n=i.create("div","bf-roomEditorToolbar");if(e.domElement=n,void 0===this.switchToolbar){var r=Glodon$1.Bimface.UI.Toolbar.ToolbarConfig();r.className="bf-toolbar bf-toolbar-roomEditor",r.element=n,r.buttons=["RoomEditingDrag","RoomEditingAdd","RoomEditingDelete","RoomEditingHeight"];this.viewer.getDomElement().appendChild(n),this.switchToolbar=new Glodon$1.Bimface.Application.UI.Toolbar.Toolbar(r),t.push(this.switchToolbar)}var a=Glodon$1.Bimface.UI.Control.ControlEvent,s=this.switchToolbar.getControls();this.uncheckOthers("Drag",s);for(var l=["Pick","Add","Delete","Height"],u=0;u<s.length;u++)!function(t){var i=s[t];i.addEventListener(a.Click,function(){i.isChecked()?(e.roomEditor.activateEditor(l[t]),e.uncheckOthers(i.getId(),s)):i.toggleCheckedState()})}(u);var c=new Glodon$1.Bimface.UI.Toolbar.ToolbarConfig;c.element=n,c.className="bf-toolbar bf-toolbar-roomEditor";var h=e.roomToolbar=new Glodon$1.Bimface.UI.Toolbar.Toolbar(c);e.roomToolbar=h,t.push(h);var d=new Glodon$1.Bimface.UI.Button.ButtonConfig;d.className="bf-save",d.title=BimfaceLanguage.bf_general_save;var f=new Glodon$1.Bimface.UI.Button.SingleButton(d);f.setHtml(BimfaceLanguage.bf_general_save),f.addEventListener("Click",function(){e.eventManager.fireEvent(o.Saved),e.update()}),h.addControl(f);var g=new Glodon$1.Bimface.UI.Button.ButtonConfig;g.className="bf-cancel",g.title=BimfaceLanguage.bf_general_cancel;var v=new Glodon$1.Bimface.UI.Button.SingleButton(g);v.setHtml(BimfaceLanguage.bf_general_cancel),v.addEventListener("Click",function(){e.eventManager.fireEvent(o.Cancelled),e.exit()}),h.addControl(v),this.viewer.getDomElement().appendChild(n)}},{key:"registerRoomEditorEvents",value:function(){var e=this;this.viewer.addEventListener("DeletionError",function(){if(!e.deletionErrorTips){var t=new Glodon$1.Bimface.UI.Tips.TipsConfig;t.element=e.viewer.getDomElement(),t.className="bf-tips bf-roomEditor-tips",t.timeOut=3e3,t.html='<div><i class="icon-warning"></i>'+BimfaceLanguage.bf_panel_roomEdit_insufficientNode+"</div>",e.deletionErrorTips=new Glodon$1.Bimface.UI.Tips.Tips(t)}e.deletionErrorTips.show()});var t=this.viewer.getDomElement();this.viewer.addEventListener("RoomEditorAddEnter",function(){t.addClass("roomEditor-addtion")}),this.viewer.addEventListener("RoomEditorAddExit",function(){t.removeClass("roomEditor-addtion")}),this.viewer.addEventListener("RoomEditorDeleteEnter",function(){t.addClass("roomEditor-deletion")}),this.viewer.addEventListener("RoomEditorDeleteExit",function(){t.removeClass("roomEditor-deletion")})}},{key:"uncheckOthers",value:function(e,t){var i=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;s.getId()===e?s.setCheckedState(!0):s.setCheckedState(!1)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"getEventManager",value:function(){return this.eventManager}},{key:"addEventListener",value:function(e,t){this.getEventManager().addEvent(e,t)}},{key:"removeEventListener",value:function(e,t){this.getEventManager().removeEvent(e,t)}},{key:"show",value:function(){this.roomEditor.setBimfaceUIVisibility(!1),this.roomToolbar.show(),this.switchToolbar.show()}},{key:"hide",value:function(){this.roomEditor.setBimfaceUIVisibility(!0),this.roomToolbar.hide(),this.switchToolbar.hide()}},{key:"update",value:function(){if(!0===this.roomEditor.checkIntersect()){if(!this.intersectTips){var e=new Glodon$1.Bimface.UI.Tips.TipsConfig;e.element=this.viewer.getDomElement(),e.className="bf-tips bf-roomEditor-tips",e.timeOut=3e3,e.html='<div><i class="icon-warning"></i>'+BimfaceLanguage.bf_panel_roomEdit_selfIntersection+"</div>",this.intersectTips=new Glodon$1.Bimface.UI.Tips.Tips(e)}return void this.intersectTips.show()}this.hide(),this.roomEditor.onExit()}},{key:"exit",value:function(){this.hide(),this.roomEditor.onExit(!0)}}]),n}();n.RoomEditorToolbar=r}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SpatialRelation"),t=function(){return{viewer:null,roomId:null,app:null}};e.RoomEditorToolbarConfig=t}(),function(){var e="Bimface.Plugins.RevitHelpers",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RevitHelpers")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"MEPTopologyHelper"),this.databagId=n.viewer._data.databagId,this.modelType=n.viewer._data.modelType}return _createClass(i,[{key:"_findNetworkById",value:function(e,t){var i,n=this;n._FILEID_CACHE!=n.fileId&&(n._API_CACHE=null),"integrateModel"==n.modelType?(i=hostConfig.resourceHost+"/"+n.databagId+"/metadata/"+n.fileId+"/mepsystem.json",n._FILEID_CACHE=n.fileId):i=hostConfig.resourceHost+"/"+n.databagId+"/metadata/mepsystem.json",n._API_CACHE?n._getNetwork(e,n._API_CACHE,function(e){t(e)}):Glodon$1.Web.Lang.Utility.HttpRequest.ajax({url:i,success:function(i){var o=JSON.parse(i);n._API_CACHE=o,n._getNetwork(e,o,function(e){t(e)})}})}},{key:"_getNetwork",value:function(e,t,i){var n=this;n._NETWORK_LENGTH=0,t.systems.map(function(o,r){o.network[e]&&(n._NETWORK_LENGTH++,i(o.network)),r==t.systems.length-1&&0==n._NETWORK_LENGTH&&console.log("此ID不存在于Network中")})}},{key:"_transform",value:function(e){var t=[];for(var i in e)/^__STEP/.test(i)||(t[t.length]={type:i,id:e[i]});return t}},{key:"_walk",value:function(e,t,i,n){for(var o="up"===i?"flowFrom":"flowInto",r=[t];r.length;){var a=r.pop(),s=e[a];if(s){s.id=a,n(s,e);var l=s[o];l&&[].push.apply(r,l.reverse())}}}},{key:"_BFSwalk",value:function(e,t,i,n){for(var o="up"===i?"flowFrom":"flowInto",r=[t];0!==r.length;){var a=r.shift(),s=e[a];s&&(s.id=a,n(s,s[o],e),[].push.apply(r,s[o]))}}},{key:"_deduplicate",value:function(e){return e.map(function(e){return e.reduce(function(e,t,i){return i%2==0?-1===e.indexOf(t)&&e.push(t):/\d+/.test(e[e.length-1])||e.push(t),e},[])})}},{key:"_formatToObj",value:function(e){var t,i=this,n={};return e.forEach(function(e){e.forEach(function(e,o){if(o%2==0)t=e,n[e]||(n[e]=[]);else{var r=void 0;r="integrateModel"==i.modelType?i.fileId+"."+e:e,-1===n[t].indexOf(r)&&n[t].push(r)}})}),n}},{key:"getDownstreamComponentsById",value:function(e,t){var i=this;"integrateModel"==i.modelType&&(i.fileId=e.split(".")[0],e=e.split(".")[1]),i._findNetworkById(e,function(n){if(!n)return t();var o={};i._BFSwalk(n,e,"down",function(t){t.id!==e&&("integrateModel"==i.modelType&&(t.id=i.fileId+"."+t.id),o[t.type]?o[t.type].push(t.id):o[t.type]=[t.id])}),t(i._transform(o))})}},{key:"getConnectedComponentsById",value:function(e,t){var i=this,n=this;"integrateModel"==n.modelType&&(n.fileId=e.split(".")[0],e=e.split(".")[1]),n._findNetworkById(e,function(o){if(!o)return t();var r={up:{routes:[[]]},down:{routes:[[]]}};["up","down"].forEach(function(t){return i._walk(o,e,t,function(i,n){var o=r[t],a=o.routes,s=a.length-1;if("末端"===a[s].slice(-2,-1)[0]){if("末端"===i.type)return a[a.length]=a[s].slice(0,-1).concat(i.id);var l=i["up"===t?"flowInto":"flowFrom"][0];a[a.length]=a[s].slice(0,a[s].indexOf(l)+1),s++}e!=i.id&&(a[s].push(i.type),a[s].push(i.id))})});var a=n._deduplicate(r.up.routes),s=n._deduplicate(r.down.routes),l=i._transform(n._formatToObj(a)),u=i._transform(n._formatToObj(s));t({up:l,down:u})})}}]),i}();i.MEPTopologyHelper=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RevitHelpers"),t=function(){return{viewer:null}};e.MEPTopologyHelperConfig=t}(),function(){var e="Bimface.Plugins.RevitHelpers",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.RevitHelpers"),n=function(){function i(n,o){_classCallCheck(this,i),t.send(e,"DrawingView"),this.viewer3D=n,this.drawingViews=o,this.activeViewId=null,this.activeDrawingView=null,this.viewPoint=null,this.planTranslation=null,this.linkFileTranslation=new THREE.Vector3}return _createClass(i,[{key:"activeViewById",value:function(e){this.activeViewId=e;var t=!0,i=!1,n=void 0;try{for(var o,r=this.drawingViews[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if(a.id==this.activeViewId){this.activeDrawingView=a;var s=a.viewPoint.origin;this.coordViewPoint=new THREE.Vector3(s[0],s[1],s[2])}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"formatViewMatrix",value:function(e){var t=this.activeDrawingView.viewPoint.rightDirection,i=this.activeDrawingView.viewPoint.upDirection,n=new THREE.Vector3(t[0],t[1],t[2]),o=new THREE.Vector3(i[0],i[1],i[2]);e=void 0==e?new THREE.Vector3:e;var r=new THREE.Matrix4;return r.makeBasis(n,o,e),r}},{key:"update",value:function(e,t){this.makeTranslation(e,t),"FloorPlan"==this.activeDrawingView.viewType?this.rotateFloorPlan(e):this.rotateElevation(e)}},{key:"makeTranslation",value:function(e,t){var i=this.activeDrawingView.viewPoint.viewDirection,n=new THREE.Vector3(i[0],i[1],i[2]),o=n.multiplyScalar(t),r=this.planTranslation,a=this.linkFileTranslation;e.translateX(r.x+a.x+o.x),e.translateY(r.y+a.y+o.y),e.translateZ(r.z+a.z+o.z)}},{key:"rotateFloorPlan",value:function(e){var t=this.activeDrawingView.viewPoint.upDirection,i=new THREE.Vector3(t[0],t[1],t[2]),n=new THREE.Vector3(0,1,0).angleTo(i);new THREE.Vector3(0,1,0).cross(i).length()>0&&(n=-n),e.rotateZ(n),e.updateMatrixWorld()}},{key:"rotateElevation",value:function(e){var t=this.activeDrawingView.viewPoint.viewDirection,i=new THREE.Vector3(t[0],t[1],t[2]),n=i.angleTo(new THREE.Vector3(0,-1,0));i.cross(new THREE.Vector3(0,-1,0)).z>0&&(n=-n),e.rotateX(Math.PI/2),e.rotateY(n),e.updateMatrixWorld()}},{key:"getOutline3D",value:function(){var e=this.activeDrawingView.outline,t=this.activeDrawingView.viewPoint.scale,i=this.activeDrawingView.elevation,n=new THREE.Vector3(e[0]*t,e[1]*t,0),o=new THREE.Vector3(e[0]*t,e[3]*t,0),r=new THREE.Vector3(e[2]*t,e[3]*t,0),a=new THREE.Vector3(e[2]*t,e[1]*t,0),s=this.formatViewMatrix(),l=n.applyMatrix4(s),u=o.applyMatrix4(s),c=r.applyMatrix4(s),h=a.applyMatrix4(s);this.planTranslation=l.clone().add(c).multiplyScalar(.5),this.planTranslation.add(this.coordViewPoint);var d=u.clone().sub(l).length(),f=h.clone().sub(l).length(),g=new THREE.Vector3(-f/2,-d/2,i),v=new THREE.Vector3(f/2,d/2,i);return new THREE.Box3(g,v)}},{key:"setLinkFileTranslation",value:function(e){this.linkFileTranslation.x=e.elements[12],this.linkFileTranslation.y=e.elements[13],this.linkFileTranslation.z=e.elements[14]}}]),i}();n.toObject=function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n instanceof Array&&(t[i]={x:n[0],y:n[1],z:n[2]})}return t},i.DrawingView=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Snap"),t=function(){return{id:null,color:new Glodon$1.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon$1.Web.Graphics.Color(17,218,183,.2),objectColor:new Glodon$1.Web.Graphics.Color(17,218,183,.9),width:3,radius:25,viewer:null}};e.SnapConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Snap"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=function(e){this.viewer=e.viewer,this.maxPointsNum=1;var i=new Glodon$1.Web.Graphics.Color(17,218,183,.2),n=t.createNS("circle","bf-snap-handle");n.setAttribute("r",e.width),n.setAttribute("fill",i.getRGB()),
n.style.fill=i.getRGB();var o=t.createNS("line","bf-snap-line");o.style.strokeWidth=2,o.style.stroke=i.getRGB();var r=t.createNS("polygon","bf-snap-rect");r.setAttribute("fill",i.getRGBA()),r.setAttribute("stroke",i.getRGB()),r.setAttribute("stroke-width",1),this.hoverLine=o,this.hoverPoint=n,this.hoverPanel=r,this.hoverPanelSize={width:20,height:20}},n={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.hoverLine,i=this.hoverPoint,n=this.hoverPanel,o=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":i.setAttribute("cx",e.hoverPosition.x),i.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(i);break;case"Line":t.setAttribute("x1",e.lineStartPoint.x),t.setAttribute("y1",e.lineStartPoint.y),t.setAttribute("x2",e.lineEndPoint.x),t.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(t);break;case"Panel":var r=e.clientPts,a=r[0].distanceTo(r[1]),s=r[0].distanceTo(r[3]),l=a/o.width,u=s/o.height;if(1!=l){var c=this.stretchOnDirection(r[0],r[1],o.width),h=this.stretchOnDirection(r[2],r[3],o.width);r=c.concat(h)}if(1!=u){var c=this.stretchOnDirection(r[0],r[3],o.height),h=this.stretchOnDirection(r[1],r[2],o.height);r=[c[0],h[0],h[1],c[1]]}for(var d="",f=0;f<r.length;f++)d+=r[f].x+",",d+=r[f].y+" ";n.setAttribute("points",d),e.svg.appendChild(n)}}};i.prototype=Object.assign(i.prototype,n),e.SnapItem=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Snap"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=null,n=[],o=null,r=null,a=function(e){var i=e.viewer,n=this;this.snapMode=e.snapMode,n.isOpen=!1;var o=new Glodon$1.Web.Lang.EventManager,r=t.create("div","bf-snap-conext");this.context={rootDomElement:r},this._opt=e,this.getEventManager=function(){return o},n.init(e),i.addEventListener("Rendered",function(){n.isOpen&&n.update()})};a.prototype={init:function(e){var i=this,n=i.context,o=i._opt.viewer;i.isOpen=!0,o.getDomElement().appendChild(n.rootDomElement),o.getModels().forEach(function(e){e.setSelectedComponentsById()});var r=t.createNS("svg","bf-snap-svg");n.rootDomElement.innerHTML="",n.rootDomElement.appendChild(r),n.svg=r;var a=new Glodon$1.Bimface.Plugins.Snap.SnapItem(e);i.snapItem=a,o.render()},snapByPoint:function(e){this.isNeedSnap(e)&&(i=e.pickPoint?e.pickPoint:null,e.pickPlane?(o="Panel",r=e.normal):e.pickLine?(o="Line",n=e.pickLine):o=e.pickPoint?"Point":null,this.update())},isNeedSnap:function(e){if(!this.snapMode)return!0;if(!e||!e.userId)return this.reset(),!1;var t=this.snapMode.getSnap3DList(),i={Plane:"face",Line:"line",Point:"endpoint"},n=!1;e.pickPlane?n=t.includes(i.Plane):e.pickLine?n=t.includes(i.Line):e.pickPoint&&(n=t.includes(i.Point));var o=this.snapMode.getSnapConditions(),r=this._opt.viewer.getViewer(),a=r.getUserdataByUserId(e.userId),s=this.isMatchConditions(a,o),l=n&&s;return l||this.reset(),l},isMatchConditions:function(e,t){for(var i=!0,n=0,o=t.length;n<o;n++){var r=t[n];for(var a in r)if(e[a]!==r[a]){i=!1;break}if(i)break;n<t.length-1&&(i=!0)}return i},update:function(){var e=this.context,t=this._opt.viewer,a=t.getDomElement(),s=a.getBoundingClientRect(),l=t.getViewer(),u=[],c=[];if(this.context.svg.innerHTML="",i?(e.hoverPosition=t.worldToClient(i),e.hoverPositionDS=l.getScene().worldToDrawing(i)):e.hoverPosition=null,e.hoverObjectType=o,"Line"==o&&2==n.length){e.lineStartPoint=t.worldToClient(n[0]),e.lineEndPoint=t.worldToClient(n[1]);var h=new THREE.Vector2(e.lineStartPoint.x,e.lineStartPoint.y),d=new THREE.Vector2(e.lineEndPoint.x,e.lineEndPoint.y),f=new THREE.Box2;f.min.set(a.clientLeft,a.clientTop),f.max.set(f.min.x+a.clientWidth,f.min.y+a.clientHeight);var g=!f.containsPoint(h),v=!f.containsPoint(d),m={start:h,end:d},p=CLOUD$1.CameraUtil.lineIntersectWithRect(m,f);if(g&&v)2==p.length&&(e.lineStartPoint=p[0],e.lineEndPoint=p[1]);else if(g||v)for(var y=new THREE.Vector2(e.hoverPosition.x,e.hoverPosition.y),w=g?d.clone():h.clone(),b=w.clone().sub(y).normalize(),C=0;C<p.length;C++){var x=w.clone().sub(p[C]).normalize();if(x.dot(b)>0){e.lineStartPoint=w,e.lineEndPoint=p[C];break}}}if("Panel"==e.hoverObjectType){e.normal=l.getScene().worldToDrawing(r),e.normal.normalize();var E=l.cameraControl,k=new THREE.Plane;k.setFromNormalAndCoplanarPoint(e.normal,e.hoverPositionDS);var P=new THREE.Vector2(e.hoverPosition.x-10,e.hoverPosition.y-10),_=new THREE.Vector2(e.hoverPosition.x+10,e.hoverPosition.y-10),M=e.hoverPositionDS,I=E.getRaycaster(P.x,P.y),h=I.ray.intersectPlane(k);I=E.getRaycaster(_.x,_.y);var d=I.ray.intersectPlane(k);if(null==h||null==d)return;var S=new THREE.Vector3(1,0,0),B=new THREE.Vector3(0,1,0),D=new THREE.Vector3(0,0,1),T=Math.abs(e.normal.clone().dot(S))<=.0025,A=Math.abs(e.normal.clone().dot(D))<=.0025;if(T&&A)var L=S.clone(),O=D.clone();else var G=B.clone(),L=G.cross(e.normal).normalize(),O=e.normal.clone().cross(L).normalize();var R=h.distanceTo(d)/2,V=L.clone().multiplyScalar(R),N=O.clone().multiplyScalar(R),U=M.clone().sub(V).add(N),H=M.clone().add(V).add(N),W=M.clone().sub(V).sub(N),$=M.clone().add(V).sub(N),z=[];z.push(U,H,$,W);for(var j=[],F=E.getContainerDimensions(),X=0;X<z.length;X++){var Y=CLOUD$1.CameraUtil.drawingToCanvas(E.camera,z[X],F.width,F.height);j.push(new THREE.Vector3(Y.x,Y.y,0))}e.clientPts=j}for(var C=0;C<u.length-1;C++){var Z=l.worldPointsToClient(u[C],u[C+1]);if(Z){var q={x:Z.start.x-s.left,y:Z.start.y-s.top};c.push(q)}}e.clientPoints=c,this.snapItem.draw(e)},reset:function(){o=null,this.context.svg.innerHTML=""},destroy:function(){var e=this.context.rootDomElement,t=this;t.reset(),e.remove(),t.snapItem=null,t.isOpen=!1}},e.Snap=a}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Walkthrough"),t=function(){return{viewer:null}};e.WalkthroughManagerConfig=t}(),function(){var e=(Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Walkthrough")),t=function(){function e(t){_classCallCheck(this,e);var i=t.viewer;return i?"Viewer3D"!==i.getViewerType()&&"ViewerGIS"!==i.getViewerType()?void console.log("ViewerType is not supported."):(this._viewer=i,void(this._walkthroughMap={})):void console.log("viewer must not be empty.")}return _createClass(e,[{key:"addWalkthrough",value:function(e,t){var i=Glodon$1.Web.Lang.Utility.UUID.createUUID(),n={id:i,walkthrough:t};return t._walkthrough.setName(e),this._walkthroughMap[i]=n,i}},{key:"removeWalkthrough",value:function(e){var t=this;"[object String]"===Object.prototype.toString.call(e)&&(e=[e]),"[object Array]"===Object.prototype.toString.call(e)&&e.forEach(function(e){delete t._walkthroughMap[e]})}},{key:"setWalkthroughList",value:function(e){var t=this;if("[object Object]"===Object.prototype.toString.call(e)){var i=e.coordinate;e.data.forEach(function(e){var n=new Glodon$1.Bimface.Plugins.Walkthrough.WalkthroughConfig;n.viewer=t._viewer;var o=new Glodon$1.Bimface.Plugins.Walkthrough.Walkthrough(n),r=e.coordinateSystem||i;"world"===r&&e.keyFrames.forEach(function(e){e.coordinateSystem=r}),o.setKeyFrames(e.keyFrames),o.setWalkthroughTime(e.time),o._walkthrough.setName(e.name),t._walkthroughMap[e.id]={id:e.id,walkthrough:o}})}}},{key:"getWalkthroughList",value:function(){var e={data:[],version:1};for(var t in this._walkthroughMap){var i={id:t},n=this._walkthroughMap[t].walkthrough;i.keyFrames=n.getKeyFrames(),i.keyFrames.forEach(function(e){delete e.coordinateSystem}),i.name=n._walkthrough.getName(),i.time=n._walkthrough.walkthroughTime,i.coordinateSystem="world",e.data.push(i)}return e}}]),e}();e.WalkthroughManager=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{domElement:null,viewer:null,right:10,top:10}};e.NorthArrowConfig=t}();var NorthArrowYaw=function(){function e(t,i,n){_classCallCheck(this,e),this.element=t,this.northArrowElement=i,this.textElement=t.lastElementChild,this._camera=n,this._rotate=0,this._minRadius=4,this._maxRadius=48,this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;this.isDragging=!1;var t=void 0,i=void 0,n=void 0,o=void 0,r=void 0;this.events={mouseout:function(){e.isDragging||e.element.firstElementChild.setAttribute("filter","")},mousedown:function(n){e.isDragging=!0,t=n.offsetX-50,i=n.offsetY-60,r=e._camera.getYawPitch().pitch,e.element.setAttribute("class","bf-northarrow-yawactive")},mouseover:function(){this.firstElementChild.setAttribute("filter","url(#bf-northarrow-dropshadow)")}};for(var a in this.events)this.element.addEventListener(a,this.events[a].bind(this.element));var s=function(){e.isDragging=!1,e.element.firstElementChild.setAttribute("filter",""),e.element.setAttribute("class","bf-northarrow-yaw")},l=function(n,o){var a=n-t,s=o-i,l=Math.atan(o/n),u=Math.atan(i/t),c=180*Math.abs(l-u)/Math.PI;n>0&&n>Math.abs(o)&&t>0&&t>Math.abs(i)?s>0?e._rotate+=c:e._rotate-=c:n<0&&n<-Math.abs(o)&&t<0&&t<-Math.abs(i)?s>0?e._rotate-=c:e._rotate+=c:(l=Math.atan(n/o),u=Math.atan(t/i),c=180*Math.abs(l-u)/Math.PI,o>0&&i>0?a>0?e._rotate-=c:e._rotate+=c:a>0?e._rotate+=c:e._rotate-=c),e.element.setAttribute("transform","rotate("+e._rotate+", 0, 0)");var h=e._rotate*Math.PI/180;e._camera.setCameraFromYawPitch({yaw:h,pitch:r,target:!0},!0),t=n,i=o};this.northArrowEvents={mousemove:function(t){e.isDragging&&(n=t.offsetX-50,o=t.offsetY-60,l(n,o))},mouseup:function(t){e.isDragging&&s()}};for(var u in this.northArrowEvents)this.northArrowElement.addEventListener(u,this.northArrowEvents[u]);this.northArrowParentEvents={mousemove:function(t){e.isDragging&&(n=t.offsetX-50-e.northArrowElement.offsetLeft,o=t.offsetY-60-e.northArrowElement.offsetTop,l(n,o))},mouseup:function(t){e.isDragging&&s()}};for(var c in this.northArrowParentEvents)this.northArrowElement.parentElement.addEventListener(c,this.northArrowParentEvents[c]);this.textEvents={dblclick:function(t){r=e._camera.getYawPitch().pitch,e._camera.setCameraFromYawPitch({yaw:0,pitch:r,target:!0},!1)}};for(var h in this.textEvents)this.textElement.addEventListener(h,this.textEvents[h])}},{key:"update",value:function(){if(!this.isDragging){var e=this._camera.getYawPitch(),t=e.yaw;this._rotate=180*t/Math.PI,this.element.setAttribute("transform","rotate("+this._rotate+", 0, 0)")}}},{key:"destroy",value:function(){if(this.events)for(var e in this.events)this.element.removeEventListener(e,this.events[e]);if(this.northArrowEvents)for(var t in this.northArrowEvents)this.northArrowElement.removeEventListener(t,this.northArrowEvents[t]);if(this.northArrowParentEvents)for(var i in this.northArrowParentEvents)this.northArrowElement.parentElement.removeEventListener(i,this.northArrowParentEvents[i]);if(this.textEvents)for(var n in this.textEvents)this.textElement.removeEventListener(n,this.textEvents[n])}}]),e}(),NorthArrowPitch=function(){function e(t,i){_classCallCheck(this,e),this.elements=t,this._camera=i,this.minPitch=-Math.PI/2,this.maxPitch=Math.PI/2,this.init()}return _createClass(e,[{key:"init",value:function(){var e=this._camera,t=this,i=!1,n=void 0,o=void 0,r=!1;this.events={mousedown:function(){var a=this;i=!0;var s=e.getYawPitch();o=s.yaw,n=s.pitch;var l=Math.PI/1e3;!function s(){if(n=-n,n>t.maxPitch&&(n=t.maxPitch),n<t.minPitch&&(n=t.minPitch),n>t.minPitch&&n-l>t.minPitch&&"bf-northarrow-pitchdown"===a.className.baseVal)n-=l,r=!0;else{if(!(n<t.maxPitch&&n+l<t.maxPitch&&"bf-northarrow-pitchup"===a.className.baseVal))return;n+=l,r=!1}n=-n,e.setCameraFromYawPitch({yaw:o,pitch:n,target:!0,isDownDirection:r},!0),i&&requestAnimationFrame(s)}()},mouseup:function(){i=!1},mouseover:function(){this.firstElementChild.setAttribute("filter","url(#bf-northarrow-dropshadow)")},mouseout:function(){this.firstElementChild.setAttribute("filter",""),i=!1}};for(var a in this.events)for(var s in this.elements)this.elements[s].addEventListener(a,this.events[a].bind(this.elements[s]))}},{key:"destroy",value:function(){for(var e in this.events)for(var t in this.elements)this.elements[t].removeEventListener(e,this.events[e])}}]),e}(),NorthArrowPan=function(){function e(t,i){_classCallCheck(this,e),this.elements=t,this._camera=i,this.init()}return _createClass(e,[{key:"init",value:function(){var e=this._camera,t=!1;this.events={mousedown:function(){var i=this;t=!0;!function n(){switch(/bf-northarrow-pan(.*)/.exec(i.className.baseVal)[1]){case"up":e.panInDirection(!0);break;case"down":e.panInDirection(!1);break;case"left":e.panInLat(!1);break;case"right":e.panInLat(!0)}t&&requestAnimationFrame(n)}()},mouseup:function(){t=!1},mouseover:function(){this.setAttribute("filter","url(#bf-northarrow-dropshadow)")},mouseout:function(){this.setAttribute("filter",""),t=!1}};for(var i in this.events)for(var n in this.elements)this.elements[n].addEventListener(i,this.events[i].bind(this.elements[n]))}},{key:"destroy",value:function(){for(var e in this.events)for(var t in this.elements)this.elements[t].removeEventListener(e,this.events[e])}}]),e}(),NorthArrowZoom=function(){function e(t,i){_classCallCheck(this,e),this.elements=t,this._camera=i,this.init()}return _createClass(e,[{key:"init",value:function(){var e=this._camera,t=!1;this.events={mousedown:function(){var i=this;t=!0;!function n(){"bf-northarrow-zoomin"===i.className.baseVal?e.zoomIn():e.zoomOut(),t&&requestAnimationFrame(n)}()},mouseup:function(){t=!1}},this.events.mouseout=this.events.mouseup;for(var i in this.events)for(var n in this.elements)this.elements[n].addEventListener(i,this.events[i].bind(this.elements[n]))}},{key:"destroy",value:function(){for(var e in this.events)for(var t in this.elements)this.elements[t].removeEventListener(e,this.events[e])}}]),e}();!function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=function(){function e(i){_classCallCheck(this,e),this._opt=i;var n=i.domElement,o=t.create("div","bf-northarrow");o.style.top=i.top+"px",o.style.right=i.right+"px",n.appendChild(o),this.domElement=o,this._camera=i.viewer._camera,this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;this.drawElements(function(){e.addDomElementEvents(),e.northArrowYaw=new NorthArrowYaw(e.elements.yaw,e.domElement,e._camera),e.northArrowPitch=new NorthArrowPitch({pitchUp:e.elements.pitchUp,pitchDown:e.elements.pitchDown},e._camera),e.northArrowZoom=new NorthArrowZoom({zoomIn:e.elements.zoomIn,zoomOut:e.elements.zoomOut},e._camera),e.northArrowPan=new NorthArrowPan({panUp:e.elements.panUp,panDown:e.elements.panDown,panLeft:e.elements.panLeft,panRight:e.elements.panRight},e._camera),e.addRenderCallback()})}},{key:"drawElements",value:function(e){var t=this;this.domElement.innerHTML='\n        <svg height="180" width="100" class="bf-northarrow-svg" onselectstart="return false;">\n          <defs>\n            <filter id="bf-northarrow-dropshadow" x="-10" y="-10" width="100" height="100">\n              <feDropShadow dx="0" dy="0" stdDeviation="0" \n              flood-color="cyan"/>\n            </filter>\n          </defs>\n          \n          <g class="bf-northarrow-pitchup" transform="translate(50, 12)" width="500" height="100">\n            <path d="M-15,0 A50,50 0 0,1 15,0 A3,3 0 0,1 14.5,8 A42,42 0 0,0 -14.5,8 A3,3 0 0,1 -15,0 Z" shape-rendering="geometricPrecision" />\n            <path d="M-4,3 L0,-1 4,3" shape-rendering="geometricPrecision" />\n          </g>\n\n          <g transform="translate(50, 60)">\n            <g class="bf-northarrow-yaw">\n              <path d="M39,0 A39,39 0 0,0 -39,0 L-29,0 A29,29 0 0,1 29,0 L39,0 A39,39 0 0,1 0,39 L0,29 A29,29 0 0,0 29,0 L39,0 M-39,0 A39,39 0 0,0 0,39 L0,29 A29,29 0 0,1 -29,0 L-39,0 Z" shape-rendering="geometricPrecision" />\n              <g transform="translate(-40, -40)">\n                <path />\n                <path d="M40,0 C62.09139,0 80,17.90861 80,40 C80,62.09139 62.09139,80 40,80 C17.90861,80 0,62.09139 0,40 C0,17.90861 17.90861,0 40,0 Z M40,1 C18.4608948,1 1,18.4608948 1,40 C1,61.5391052 18.4608948,79 40,79 C61.5391052,79 79,61.5391052 79,40 C79,18.4608948 61.5391052,1 40,1 Z" shape-rendering="geometricPrecision" />\n                <path d="M40,11 C56.0162577,11 69,23.9837423 69,40 C69,56.0162577 56.0162577,69 40,69 C23.9837423,69 11,56.0162577 11,40 C11,23.9837423 23.9837423,11 40,11 Z M40,12 C24.536027,12 12,24.536027 12,40 C12,55.463973 24.536027,68 40,68 C55.463973,68 68,55.463973 68,40 C68,24.536027 55.463973,12 40,12 Z" shape-rendering="geometricPrecision" />\n                <rect x="1" y="40" width="10" height="1" />\n                <rect x="69" y="40" width="10" height="1" />\n                <rect x="39" y="69" width="1" height="10" />\n                <path />\n              </g>\n              <text x="0" y="-30">N</text>\n            </g>\n          </g>\n\n          <g class="bf-northarrow-pitchdown" transform="translate(50, 108)">\n            <path d="M-15,0 A50,50 0 0,0 15,0 A3,3 0 0,0 14.5,-8 A42,42 0 0,1 -14.5,-8 A3,3 0 0,0 -15,0 Z" shape-rendering="geometricPrecision" />\n            <path d="M-4,-3 L0,1 4,-3" shape-rendering="geometricPrecision" />\n          </g>\n\n          <g transform="translate(50, 60)">\n            <g class="bf-northarrow-panup" transform="translate(-7, -24)">\n              <path d="M7,0 L14,10 0,10 Z" />\n              <path d="M7,0 L14,10 L0,10 L7,0 Z M7,1.745 L1.921,9 L12.078,9 L7,1.745 Z" />\n            </g>\n            <g class="bf-northarrow-pandown" transform="translate(-7, 14) rotate(180, 7 5)">\n              <path d="M7,0 L14,10 0,10 Z" />\n              <path d="M7,0 L14,10 L0,10 L7,0 Z M7,1.745 L1.921,9 L12.078,9 L7,1.745 Z" />\n            </g>\n            <g class="bf-northarrow-panleft" transform="translate(-24, -5) rotate(-90, 7 5)">\n              <path d="M7,0 L14,10 0,10 Z" />\n              <path d="M7,0 L14,10 L0,10 L7,0 Z M7,1.745 L1.921,9 L12.078,9 L7,1.745 Z" />\n            </g>\n            <g class="bf-northarrow-panright" transform="translate(10, -5) rotate(90, 7 5)">\n              <path d="M7,0 L14,10 0,10 Z" />\n              <path d="M7,0 L14,10 L0,10 L7,0 Z M7,1.745 L1.921,9 L12.078,9 L7,1.745 Z" />\n            </g>\n\n          </g>\n\n          <g transform="translate(50, 118)">\n            <g transform="translate(-13, 0)">\n              <rect id="Rectangle" fill="#2A313B" opacity="0.78" x="0" y="0" width="26" height="53" />\n              <path d="M26,0 L26,53 L0,53 L0,0 L26,0 Z M25,1 L1,1 L1,52 L25,52 L25,1 Z" fill="#969FAE" fill-rule="nonzero" />\n              <rect fill="#969FAE" x="3" y="26" width="20" height="1" />\n            </g>\n            <g class="bf-northarrow-zoomin">\n              <path d="M-13,0 L13,0 13,26 -13,26 Z" />\n              <polygon points="5 5 5 0 7 0 7 5 12 5 12 7 7 7 7 12 5 12 5 7 0 7 0 5" transform="translate(-6, 7)" />\n            </g>\n            <g class="bf-northarrow-zoomout">\n              <path d="M-13,26 L13,26 13,52 -13,52 Z" />\n              <rect x="0" y="0" width="12" height="2" transform="translate(-6, 39)" />\n            </g>\n          </g>\n        </svg>\n      ',this.elements={},["pitchUp","pitchDown","yaw","panUp","panDown","panLeft","panRight","zoomIn","zoomOut"].forEach(function(e){var i=t.domElement.querySelector(".bf-northarrow-"+e.toLowerCase());t.elements[e]=i}),e()}},{key:"addDomElementEvents",value:function(){var e=this;this.domElementEvents={mouseover:function(){e.elements.pitchUp.style.opacity=1,e.elements.pitchDown.style.opacity=1},mouseout:function(){e.elements.pitchUp.style.opacity=0,e.elements.pitchDown.style.opacity=0},mousedown:function(e){return e.stopPropagation(),!1}},this.domElementEvents.mousemove=this.domElementEvents.mouseup=this.domElementEvents.mousedown,this.domElementEvents.mouseout();for(var t in this.domElementEvents)this.domElement.addEventListener(t,this.domElementEvents[t])}},{key:"addRenderCallback",value:function(){var e=this;this.renderCallback=function(){e.northArrowYaw&&e.northArrowYaw.update()},this._opt.viewer.getViewer().addRenderCallback(this.renderCallback)}},{key:"destroy",value:function(){if(this.domElement&&this.domElementEvents)for(var e in this.domElementEvents)this.domElement.removeEventListener(e,this.domElementEvents[e]);this.northArrowYaw&&this.northArrowYaw.destroy(),this.northArrowPitch&&this.northArrowPitch.destroy(),this.northArrowPan&&this.northArrowPan.destroy(),this.northArrowZoom&&this.northArrowZoom.destroy(),this.renderCallback&&this._opt.viewer.getViewer().removeRenderCallback(this.renderCallback),this._opt.domElement.removeChild(this.domElement)}},{key:"setLimitPitch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.northArrowPitch.minPitch=null!=e?e:-Math.PI/2,this.northArrowPitch.maxPitch=null!=t?t:Math.PI/2}},{key:"show",value:function(){this.domElement.style.display="block"}},{key:"hide",value:function(){this.domElement.style.display="none"}}]),e}();e.NorthArrow=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{domElement:null,viewer:null,right:10,bottom:10}};e.ScaleConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=[1,2,3,5,10,20,30,50,100,200,300,500,1e3,2e3,3e3,5e3,1e4,2e4,3e4,5e4,1e5,2e5,3e5,5e5,1e6,2e6,3e6,5e6,1e7,2e7,3e7,5e7],n=function(){function e(i){_classCallCheck(this,e),this._opt=i;var n=i.domElement,o=t.create("div","bf-scale");o.style.bottom=i.bottom+"px",o.style.right=i.right+"px",n.appendChild(o),this.domElement=o,this.barElement=void 0,this.labelElement=void 0,this.lastUpdateTime=Date.now(),this.enableScale=!0,this._value=void 0,this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;this.drawElements(function(){e.addRenderCallback()})}},{key:"drawElements",value:function(e){this.domElement.innerHTML='\n            <svg height="36px" width="140px" class="bf-scale-svg" onselectstart="return false;">\n                <rect x="0" y="0" width="140px" height="36px" style="fill:#20262F;opacity:0.85;stroke-width:1px;stroke:#3B4554"/>\n                <path class="bf-scale-bar" fill="none"/>\n                <text class= "bf-scale-label" fill="#cccccc"></text>\n            </svg>\n          ',this.barElement=this.domElement.querySelector(".bf-scale-bar"),this.labelElement=this.domElement.querySelector(".bf-scale-label"),this.domElement.style.display="none",e()}},{key:"addRenderCallback",value:function(){var e=this;this.renderCallback=function(){if(e.enableScale){var t=Date.now();if(!(t<e.lastUpdateTime+250)){e.lastUpdateTime=t;var n=e._opt.viewer.getViewer().camera,o=e._opt.viewer.getViewer().getViewportSize();if(n.position.y<0)return void(e.domElement.style.display="none");var r=new THREE.Vector3(o.width/2,o.height-1),a=new THREE.Vector3(o.width/2+1,o.height-1),s=e._opt.viewer.getViewer().pickByPoint(r,!0),l=e._opt.viewer.getViewer().pickByPoint(a,!0);if(!(s&&l&&s.worldPosition&&l.worldPosition))return void(e.domElement.style.display="none");var u=s.worldPosition.distanceTo(l.worldPosition);if(e._pixelDistance=u,u<0)return void(e.domElement.style.display="none");for(var c,h=i.length-1;!c&&h>=0;--h)i[h]/u<=120&&(c=i[h]);if(c){e._value=c;var d;d=c>=1e3?(c/1e3).toString()+"km":c.toString()+"m",e.labelElement.textContent=d;var f=e.labelElement.getBoundingClientRect().width||43;e.labelElement.setAttribute("x",70-f/2),e.labelElement.setAttribute("y",23);var g=c/u,v="M"+(70-g/2).toString()+" 20 L"+(70-g/2).toString()+" 28 L"+(70+g/2).toString()+" 28 L"+(70+g/2).toString()+" 20";e.barElement.setAttribute("d",v),e.domElement.style.display="block"}else e._value=void 0,e._pixelDistance=void 0,e.domElement.style.display="none"}}},this._opt.viewer.getViewer().addRenderCallback(this.renderCallback)}},{key:"destroy",value:function(){this.renderCallback&&this._opt.viewer.getViewer().removeRenderCallback(this.renderCallback),this._opt.domElement.removeChild(this.domElement)}},{key:"show",value:function(){this.domElement.style.display="block",this.enableScale=!0}},{key:"hide",value:function(){this.domElement.style.display="none",this.enableScale=!1}},{key:"isVisible",value:function(){return this.enableScale}},{key:"getValue",value:function(){return this._pixelDistance}}]),e}();e.Scale=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{domElement:null,viewer:null,right:0,bottom:0}};e.InfoBarConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=function(){function e(i){var n=this;_classCallCheck(this,e),this._opt=i;var o=i.domElement,r=t.create("div","bf-infobar");r.style.bottom=i.bottom+"px",r.style.right=i.right+"px",r.style.display="none",o.appendChild(r),this.domElement=r,this.enable=!0,this._info={},this._inited=!1,this._mousemoveCallback=function(e){if(n.enable){var t=n._opt.viewer.getViewer().pickByPoint(e);if(t){var i=t.worldPosition,o=i.z,r=n._opt.viewer.worldToLatLon(i),a=r.lat,s=r.lon;n._info={latitude:a,longtitude:s,altitude:o};var l=a.toFixed(6)+(a>=0?"N":"S")+"&nbsp;&nbsp;"+s.toFixed(6)+(s>=0?"E":"W")+"&nbsp;&nbsp;"+("-0.000"===o.toFixed(3)?"0.000":o.toFixed(3))+"m";n.domElement.innerHTML=l,n._inited||(n.domElement.style.display="block",n._inited=!0)}}},this.init()}return _createClass(e,[{key:"init",value:function(){this._opt.domElement.addEventListener("mousemove",this._mousemoveCallback)}},{key:"destroy",value:function(){this._opt.domElement.removeEventListener("mousemove",this._mousemoveCallback),this._opt.domElement.removeChild(this.domElement)}},{key:"show",value:function(){this.domElement.style.display="block",this.enable=!0}},{key:"hide",value:function(){this.domElement.style.display="none",this.enable=!1}},{key:"isVisible",value:function(){return this.enable}},{key:"getValue",value:function(){return this._info}}]),e}();e.InfoBar=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function(){return{domElement:null,viewer:null,right:10,bottom:10}};e.CreditConfig=t}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),i=function(){function e(i){_classCallCheck(this,e),this._opt=i;var n=i.domElement,o=t.create("div","bf-credit "+(i.class||""));n.appendChild(o),this.domElement=o,this.barElement=void 0,this.labelElement=void 0}return _createClass(e,[{key:"drawElements",value:function(){var e=this._opt,t=e.credit,i=e.text,n=e.link,o=e.copyright;switch(t){case Glodon$1.Bimface.Common.Credit.None:this.domElement.innerHTML="";break;case Glodon$1.Bimface.Common.Credit.OSM:this.domElement.innerHTML="\n            <div class='copyright'>©<a class='text' href='"+n+"' target='_blank'>OpenStreetMap</a> contributors</div>\n          ";break;default:this.domElement.innerHTML="\n            <div class='copyright'>"+o+"\n            <div class='divider'></div>\n            <a class='text' href='"+n+"' target='_blank'>"+i+"</a>         \n            </div>\n          "}}},{key:"destroy",value:function(){this._opt.domElement.removeChild(this.domElement)}},{key:"update",value:function(e){this._opt=Object.assign({},this._opt,e),this.drawElements()}},{key:"show",value:function(){this.domElement.style.display="block"}},{key:"hide",value:function(){this.domElement.style.display="none"}}]),e}();e.Credit=i}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Search"),t=function(){return{wrapElement:null,viewer:null}};e.SearchConfig=t}(),function(){var e="Bimface.Plugins.Search",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Search"),n=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Web.Lang.Utility.Dom"),o=function(e){var t=this,i=e;if(t._opt=i,this.clear(),!i.viewer)return console.log("viewer is not defined."),!1;var o=new Glodon$1.Web.Lang.EventManager;this.getEventManager=function(){return o},this.element=n.create("div","bf-search-toolbar"),i.wrapElement.appendChild(this.element),t.init()};o.prototype={addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},clickSearch:function(e){var t=this,i=this._opt.viewer,n=this.element.querySelector("input").value;return""==n?(this.clear(),void this.update(e)):n===this._data.text?this.clickArrow(!0,e):void i.searchText(n,function(i){t._data.index=i.length>0&&1||0;var o=t.formatResult(i);t._data.all=o.length,t._data.result=o,t._data.text=n,t.update(e),t._data.index&&t.zoomToBbox(o[t._data.index-1])})},clickArrow:function(e,t){var i=e?this._data.index+1:this._data.index-1,n=this._data.result;n.length>0&&(this._data.index=e?i>n.length&&1||i:i>0&&i||n.length,this.update(t),this.zoomToBbox(n[this._data.index-1]))},init:function(){var i=this;t.send(e,"init"),document.addEventListener("keyup",function(e){e&&13==e.keyCode&&i.element.querySelector("input")==document.activeElement&&i.clickSearch(!0)}),this.element.addEventListener("click",function(e){var t=e.target;t.hasClass("gld-bf-search")?i.clickSearch():t.hasClass("gld-bf-arrowup")?i.clickArrow():t.hasClass("gld-bf-arrowdown")&&i.clickArrow(!0)}),this.update()},formatResult:function(e){for(var t=[],i=0;i<e.length;i++)for(var n=e[i],o=0;o<n.boundingBox.length;o++){var r=n.boundingBox[o];t.push({viewId:n.viewId,content:n.content,boundingBox:r})}return t},update:function(i){if(t.send(e,"update"),this.element.innerHTML='<input value="'+(this._data.text||"")+'" placeholder="'+BimfaceLanguage.bf_btn_search_textInput+'" /><div title="'+BimfaceLanguage.bf_btn_search_search+"\" class='bf-button gld-bf-search'></div><div class='line'></div><span class='count'>"+this._data.index+"/"+this._data.all+'</span><div  title="'+BimfaceLanguage.bf_btn_search_previous+"\" class='bf-button gld-bf-arrowup'></div><div title=\""+BimfaceLanguage.bf_btn_search_next+"\" class='bf-button gld-bf-arrowdown'></div>",i){var n=this.element.querySelector("input");n.focus();var o=this._data.text;n.value="",n.value=o}},clear:function(){var e;this._data=(e={index:0,all:0,text:""},_defineProperty(e,"text",""),_defineProperty(e,"result",[]),e)},zoomToBbox:function(e){var t=this._opt.viewer;t.showViewById(e.viewId),t.zoomToBoundingBox(e.boundingBox)}},i.Search=o}(),function(){Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SkyBox").SkyBoxStyle=Object.freeze({BlueSky:"BlueSky",CloudySky:"CloudySky",DarkNight:"DarkNight",Galaxy:"Galaxy",Customized:"Customized"})}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SkyBox"),t=function e(){_classCallCheck(this,e),this.customizedImage=null,this.style=null,this.viewer=null};e.SkyBoxManagerConfig=t}(),function(){var e="Bimface.Plugins.SkyBox.SkyBoxManager",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.SkyBox"),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"bf_c_skyBoxMng_new"),this._customizedImage=n.customizedImage,this._style=n.style,this._viewer=n.viewer,this._enabled=!1,this.enableSkyBox(!0)}return _createClass(i,[{key:"setCustomizedImage",value:function(e){this._customizedImage!=e&&(this._customizedImage=e,this._updateSkyBox())}},{key:"getCustomizedImage",value:function(){return this._customizedImage}},{key:"setStyle",value:function(e){
this._style!=e&&(this._style=e,this._updateSkyBox())}},{key:"getStyle",value:function(){return this._style}},{key:"enableSkyBox",value:function(e){if(this._enabled!=e){if(this._enabled=e,!this._enabled){this._viewer.getViewer().IBLManager.removeSkyBox()}this._updateSkyBox()}}},{key:"_updateSkyBox",value:function(){if(this._enabled){var e=this._viewer.getViewer().IBLManager,t=this._style,i=this._viewer._data,n=[];if(this._style==Glodon$1.Bimface.Plugins.SkyBox.SkyBoxStyle.Customized&&this._customizedImage?(n.push(this._customizedImage.right),n.push(this._customizedImage.left),n.push(this._customizedImage.top),n.push(this._customizedImage.bottom),n.push(this._customizedImage.front),n.push(this._customizedImage.back)):t=this._style==Glodon$1.Bimface.Plugins.SkyBox.SkyBoxStyle.Customized?Glodon$1.Bimface.Plugins.SkyBox.SkyBoxStyle.CloudySky:this._style,0==n.length&&t)for(var o=i.dataEnvType==BimfaceEnvOption.Local?i.sdkPath:hostConfig.staticHost,r=o+"/resources/SkyBox/Pics/"+t,a=["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"],s=0;s<6;++s)n.push(r+"/EnvMap_"+a[s]);e.loadSkyBox(n,!1),e.setSkyBoxType(t)}}}]),i}();i.SkyBoxManager=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins"),t=function e(){_classCallCheck(this,e),this.elevation=0,this.color=null,this.viewer=null};e.GroundConfig=t}(),function(){var e="Bimface.Plugins.Ground.Ground",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Ground"),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"createGround"),this._color=n.color,this._viewer=n.viewer,this._elevation=n.elevation,this._ground=this._viewer.getViewer().createGround(n)}return _createClass(i,[{key:"remove",value:function(){this._viewer.getViewer().removeGround(),this._ground=null}},{key:"setElevation",value:function(e){this._ground.setElevation(e)}},{key:"show",value:function(){console.log("This function is not available now")}},{key:"hide",value:function(){console.log("This function is not available now")}},{key:"update",value:function(){console.log("This function is not available now")}},{key:"setColor",value:function(){console.log("This function is not available now")}}]),i}();i.Ground=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Clipping"),t=function e(){_classCallCheck(this,e),this.boundary=null};e.TerrainClippingConfig=t}(),function(){var e="Bimface.Plugins.Clipping.TerrainClipping",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Clipping"),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"bf_c_terrainClipping_new"),this._boundary=n.boundary,this._id=Glodon$1.Web.Lang.Utility.UUID.createUUID(),this._clippingManager=null}return _createClass(i,[{key:"getId",value:function(){return this._id}},{key:"show",value:function(){this._clippingManager&&this._clippingManager.showItems([this.getId()])}},{key:"hide",value:function(){this._clippingManager&&this._clippingManager.hideItems([this.getId()])}},{key:"getBoundary",value:function(){return this._boundary}},{key:"setBoundary",value:function(e){this._boundary=e,this._clippingManager&&(this._clippingManager.removeItems([this.getId()]),this._clippingManager.addItem(this))}},{key:"_onAdded",value:function(e){this._clippingManager=e}}]),i}();i.TerrainClipping=n}(),function(){var e=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Clipping"),t=function e(){_classCallCheck(this,e),this.viewer=null};e.ClippingManagerConfig=t}(),function(){var e="Bimface.Plugins.Clipping.ClippingManager",t=Glodon$1.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon$1.Web.Lang.Utility.Namespace.ensureNamespace(Glodon$1,"Bimface.Plugins.Clipping"),n=function(){function i(n){if(_classCallCheck(this,i),t.send(e,"bf_c_clippingMng_new"),this._viewer=n.viewer,!this._viewer||!this._viewer instanceof Glodon$1.Bimface.Viewer.Viewer3D||!this._viewer instanceof Glodon$1.Bimface.Viewer.ViewerGIS)return void console.log("ERROR::viewer must be viewer3D or viewerGIS.");this._idsAll=[],this._clippingItems=[]}return _createClass(i,[{key:"addItem",value:function(e){var t=e.getBoundary();if(!t)return void console.log("ERROR::clippingItem must contains boundary.");var i=this._viewer.getViewer();if(i&&i.terrainOperationManager){for(var n=new Array(t.length),o=0;o<t.length;++o){var r=i.worldToDrawing(t[o]);n[o]=r}i.terrainOperationManager.addExcavationRegion(e.getId(),n),i.render(),this._idsAll.push(e.getId()),this._clippingItems.push(e),e._onAdded(this)}}},{key:"removeItems",value:function(e){if(e){var t=this._viewer.getViewer();t&&t.terrainOperationManager&&(t.terrainOperationManager.removeExcavationRegionsById(e),t.render()),this._idsAll=this._idsAll.filter(function(t){return e.indexOf(t)<0}),this._clippingItems=this._clippingItems.filter(function(t){return e.indexOf(t.getId())<0})}}},{key:"clear",value:function(){var e=this._viewer.getViewer();e&&e.terrainOperationManager&&(e.terrainOperationManager.clearExcavationRegions(),e.render()),this._idsAll=[],this._clippingItems=[]}},{key:"showItems",value:function(e){var t=this._viewer.getViewer();t&&t.terrainOperationManager&&(t.terrainOperationManager.showExcavationRegionsById(e),t.render())}},{key:"showAll",value:function(){this.showItems(this._idsAll)}},{key:"hideItems",value:function(e){var t=this._viewer.getViewer();t&&t.terrainOperationManager&&(t.terrainOperationManager.hideExcavationRegionsById(e),t.render())}},{key:"hideAll",value:function(){this.hideItems(this._idsAll)}},{key:"getAllItems",value:function(){return[].concat(_toConsumableArray(this._clippingItems))}},{key:"update",value:function(){}}]),i}();i.ClippingManager=n}(),function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)}([function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){n(this,e)}return o(e,null,[{key:"distance",value:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}},{key:"center",value:function(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}},{key:"centerByArr",value:function(e,t){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}},{key:"distanceByArr",value:function(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)}},{key:"angleByArr",value:function(e,t,i){var n=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)),o=Math.sqrt(Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2)),r=Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2)),a=(Math.pow(n,2)+Math.pow(o,2)-Math.pow(r,2))/(2*n*o);return a=a.toFixed(12),180*Math.acos(a)/Math.PI}},{key:"normalize",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}},{key:"isPointInBBox",value:function(e,t,i,n){var o=.5*n[0];if(e<i[0]-o||e>i[0]+o)return!1;var r=.5*n[1];return!(t<i[1]-r||t>i[1]+r)}}]),e}();t.default=r},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){n(this,e),this.mouseDownPt=null}return o(e,[{key:"init",value:function(e){this.notify("enter")}},{key:"redraw",value:function(e){e.updateOverlays()}},{key:"onDrawing",value:function(e,t){}},{key:"begin",value:function(e,t,i,n){}},{key:"end",value:function(e,t,i,n){}},{key:"onKeyDown",value:function(e,t){this.keyDown&&this.keyDown(e,t)}},{key:"onKeyUp",value:function(e,t){this.keyUp&&this.keyUp(e,t)}},{key:"onDoubleClick",value:function(e,t){}},{key:"onMouseWheel",value:function(e,t){var i=this;(e.hover||this.timer)&&(this.timer&&clearTimeout(this.timer),e.hover=!1,e.viewer.ClearHighlight(),this.timer=setTimeout(function(){e.hover=!0,i.timer=null},750));var n=t.deltaY||-t.wheelDelta||t.detail,o=Math.abs(e.ratio-1),r=o+1,a=1/r,s=n<0?r:a,l=e.getZoomFactor();n>0&&l<.15||(e.zoomPan(s,t.offsetX,t.offsetY),this.observer&&this.observer(null,"zoomFactorChanged",e.getZoomFactor()))}},{key:"onMouseMove",value:function(e,t){var i=this.formatEventOffset(e,t);this.isPanMode(t.buttons)&&e.panTo(i.x,i.y),this.onEditing(e,i.x,i.y,t.buttons)}},{key:"onMouseDown",value:function(e,t){var i=this.formatEventOffset(e,t);this.mouseDownPt=i,e.setStartPoint(i.x,i.y),this.begin(e,i.x,i.y,t.buttons)}},{key:"onMouseUp",value:function(e,t){var i=this.formatEventOffset(e,t);return this.end(e,i.x,i.y,t.button)}},{key:"onEditing",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.notify("exit")}},{key:"formatEventOffset",value:function(e,t){var i=t.offsetX,n=t.offsetY;if("CANVAS"!=t.target.tagName.toLocaleUpperCase()){var o=e.dom.getBoundingClientRect();i=t.clientX-o.x,n=t.clientY-o.y}return{x:i,y:n}}},{key:"notify",value:function(e,t,i,n,o){this.observer&&this.observer(this.name,e,t,i,n,o)}},{key:"isPanMode",value:function(t){return t==e.MiddleButton||t==e.RightButton}},{key:"sameAsMousedownPt",value:function(e,t){if(!this.mouseDownPt)return!1;var i=this.mouseDownPt.x,n=this.mouseDownPt.y;return e===i&&t===n}}]),e}();r.CONTINUE=0,r.FINISHED=1,r.LelftButton=1,r.RightButton=2,r.MiddleButton=4,r.MouseMode=1,r.TouchMode=2,t.default=r},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){n(this,e)};o.Measure={lineWidth:3,color:"#F99D0B",snapColor:"#11DAB7",auxLineDash:[6,4],auxLineWidth:1,auxColorX:"#7CCF21",auxColorY:"#CC021B",outlineColor:"#FFFFFF",outlineWidth:2},o.Zoom={color:"#00ff00",lineWidth:2},t.default=o},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(14),s=n(a),l=i(6),u=n(l),c=i(7),h=n(c),d=function(){function e(t,i,n,r){o(this,e);var a=document.getElementById(r);this.width=a.clientWidth,this.height=a.clientHeight,this.viewer=Module.createViewer(r,this.width,this.height),this.divId=r,this.dom=a,this.dc=s.default.create(t,i,n),this.ratio=1.1,this.drawHandle=null,this.scale=1,this.snapDistance=5,this.hover=!0,this.bindRendering=this.rendering.bind(this),this.customManager=new u.default,this.onViewChanges=function(){};var l=this;this.dc.overlayDrawers.custom=function(e){l.customManager.draw(l,e)},this.sendHighlightMsg=!0}return r(e,[{key:"setZoomRatio",value:function(e){this.ratio=e}},{key:"getZoomRatio",value:function(){return this.ratio}},{key:"getViewScale",value:function(e){return this.scale}},{key:"setViewScale",value:function(e){this.scale=e}},{key:"setSnapDistance",value:function(e){this.snapDistance=e}},{key:"snapshot",value:function(e){var t=this.dc.canvasMain,i=(this.dc.canvasOverlay,this.getDivId()),n=document.getElementById(i),o=document.createElement("canvas");o.width=n.clientWidth,o.height=n.clientHeight;var r=o.getContext("2d");return r.beginPath(),r.fillStyle=e||t.style.background,r.fillRect(0,0,o.width,o.height),r.drawImage(t,0,0),o.toDataURL()}},{key:"snapshotPure",value:function(){var e=this.dc.canvasMain,t=(this.dc.canvasOverlay,this.getDivId()),i=document.getElementById(t),n=document.createElement("canvas");n.width=i.clientWidth,n.height=i.clientHeight;var o=n.getContext("2d");return o.beginPath(),o.drawImage(e,0,0),n}},{key:"setBackgroundColor",value:function(e){this.dc.setBackgroundColor(e)}},{key:"showFilledFace",value:function(e){this.viewer.FilledFace=e}},{key:"isShowFilledFace",value:function(){return this.viewer.FilledFace}},{key:"setModel",value:function(e){if(this.viewer.SetModel(e),this.dc.setResourceUrl(e.Url),this.viewer.UpdateVisibleSettings(),void 0!=e.indexJson.sealImages){var t;for(t=0;t<e.indexJson.sealImages.length;++t){var i=e.indexJson.sealImages[t],n=i.path,o=n.split("\\"),r=o[o.length-1];this.viewer.AddSealImage(r,parseFloat(i.x),parseFloat(i.y),parseFloat(i.width),parseFloat(i.height))}}}},{key:"rendering",value:function(){this.viewer.Draw(this.dc)>0?this.rendering():(this.updateOverlays(),requestAnimationFrame(this.bindRendering))}},{key:"getDivId",value:function(){return this.divId}},{key:"getModel",value:function(){return this.viewer.GetModel()}},{key:"getViewAngle",value:function(){return this.viewer.ViewAngle}},{key:"setViewAngle",value:function(e){this.viewer.ViewAngle=e,this.update()}},{key:"getLayers",value:function(){for(var e=[],t=this.getModel(),i=t.GetLayerIds(),n=0,o=i.size();n<o;++n){var r=i.get(n),a=t.GetLayer(r);null!=a?e.push({id:a.Id,name:a.Name,color:a.Color,visible:a.Visible}):console.log("Layer not found!"+r)}return e}},{key:"changeLayers",value:function(e){for(var t=this.getModel(),i=0;i<e.length;++i){var n=e[i];t.GetLayer(n.id).Visible=n.visible}this.viewer.UpdateVisibleSettings()}},{key:"getLayouts",value:function(){var e=[],t=this.getModel(),i=t.GetLayoutIds();e.push({id:0,name:"Model"});for(var n=0,o=i.size();n<o;++n){var r=i.get(n),a=t.GetLayout(r);e.push({id:a.Id,name:a.Name})}return e}},{key:"activeLayoutById",value:function(e){this.viewer.ActiveLayout(e),this.update()}},{key:"getActiveLayoutId",value:function(){return this.viewer.GetActiveLayoutId()}},{key:"isModelView",value:function(){return 0==this.getActiveLayoutId()}},{key:"updateOverlays",value:function(){this.dc.drawingOverlay(this.width,this.height)}},{key:"update",value:function(e){function t(){i.viewer.Draw(i.dc)>0?i.drawHandle=requestAnimationFrame(t):(i.drawHandle=null,i.updateOverlays())}1==e&&(this.viewer.RequstDraw(Module.EnumRedrawHints.FinialDraw),this.onViewChanges());var i=this;null!==i.drawHandle&&cancelAnimationFrame(i.drawHandle),this.minimap&&this.minimap.update(),i.drawHandle=requestAnimationFrame(t)}},{key:"onResize",value:function(){this.resize(this.dom.clientWidth,this.dom.clientHeight)}},{key:"clearAll",value:function(){this.dc.clearAll(this.width,this.height)}},{key:"resize",value:function(e,t){this.width=e||this.dom.clientWidth,this.height=t||this.dom.clientHeight,this.dc.resize(e,t),this.viewer.Resize(e,t),this.update(),this.onViewChanges()}},{key:"zoomToExtent",value:function(e){void 0==e&&(e=1),this.viewer.ZoomToExtent(e),this.onViewChanges()}},{key:"zoomToObject",value:function(e,t){void 0==t&&(t=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),this.viewer.ZoomToElement(e,t),this.onViewChanges()}},{key:"zoomToObjectWithBlock",value:function(e,t,i){void 0==i&&(i=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this.viewer.ZoomToElementWithBlock(e,t,i),this.onViewChanges()}},{key:"setStartPoint",value:function(e,t){this.startX=e,this.startY=t}},{key:"zoom",value:function(e,t,i,n){this.viewer.ZoomToRect(e,t,i,n),this.update(!0),this.onViewChanges()}},{key:"panTo",value:function(e,t){return this.startX&&this.startY?(this.offsetX=e-this.startX,this.offsetY=t-this.startY,(0!=this.offsetX||0!=this.offsetY)&&(this.viewer.Pan(this.offsetX,this.offsetY),this.update(),this.startX=e,this.startY=t,this.onViewChanges(),!0)):(this.startX=e,this.startY=t,!1)}},{key:"zoomPan",value:function(e,t,i){this.offsetX=(t||this.width/2)-this.width/2,this.offsetY=(i||this.height/2)-this.height/2,this.viewer.ZoomPan(e,this.offsetX,this.offsetY),this.update(),this.onViewChanges()}},{key:"preSelect",value:function(e,t,i){return i?this.viewer.PreSelect(this.startX,this.startY,e,t):this.viewer.PreSelect(e,t,e,t)}},{key:"select",value:function(){this.viewer.Select()}},{key:"getSelectedIds",value:function(){for(var e=[],t=this.viewer.GetSelection(),i=0,n=t.size();i<n;++i)e.push(t.get(i));return e}},{key:"getHighlightIds",value:function(){for(var e=[],t=this.viewer.GetHighlightIds(),i=0,n=t.size();i<n;++i)e.push(t.get(i));return e}},{key:"clearSelection",value:function(){this.viewer.ClearSelection()}},{key:"clearHighlight",value:function(){this.viewer.ClearHighlight()}},{key:"selectByIds",value:function(e){var t=this.viewer.GetSelection();t.resize(0,0);for(var i=0,n=e.length;i<n;++i)t.push_back(parseInt(e[i]));this.viewer.SelectIds(t)}},{key:"highlightById",value:function(e){this.viewer.HighlightId(parseInt(e))}},{key:"getObjectBoundingBox",value:function(e){var t=this.getModel().FindElement(e);if(t){var i=t.BoundingBox;return[i.GetMinPt(),i.GetMaxPt()]}return null}},{key:"enableHover",value:function(e){this.hover=e}},{key:"toWorldPoint",value:function(e){return this.viewer.ToWorldPoint(e)}},{key:"toScreenPoint",value:function(e){return this.viewer.ToScreenPoint(e)}},{key:"toViewportScreenPoint",value:function(e){return this.viewer.ToViewportScreenPoint(e)}},{key:"toModelWorld",value:function(e){return this.viewer.ToModelWorldPoint(e)}},{key:"snapToPoint",value:function(e,t,i){return void 0==i&&(i=this.snapDistance),this.viewer.SnapToPoint(e,t,i)}},{key:"snapToPoint2",value:function(e,t,i,n,o){return void 0==o&&(o=this.snapDistance),this.viewer.SnapToPoint2(e,t,i,n,o)}},{key:"getZoomFactor",value:function(){var e=this.viewer.GetWorldSize();return this.viewer.WorldScale/Math.min(1/e[0],1/e[1])}},{key:"getState",value:function(){var e={ver:1,WorldScale:this.viewer.WorldScale,ViewAngle:this.viewer.ViewAngle,ViewCenter:this.viewer.ViewCenter,ZoomFactor:this.getZoomFactor()};return JSON.stringify(e)}},{key:"setState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(this.viewer.WorldScale=t.WorldScale,this.viewer.ViewAngle=t.ViewAngle,this.viewer.ViewCenter=t.ViewCenter,this.viewer.UpdateViewMatrix(),!0)}},{key:"getAlignState",value:function(){var e={ver:1,AlignMatrixCol1:this.viewer.GetAlignMatrixCol(0),AlignMatrixCol2:this.viewer.GetAlignMatrixCol(1),AlignMatrixCol3:this.viewer.GetAlignMatrixCol(2),AlignMatrixCol4:this.viewer.GetAlignMatrixCol(3)};return JSON.stringify(e)}},{key:"setAlignState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(void 0!=t.AlignMatrixCol1&&null!=t.AlignMatrixCol1&&(this.viewer.SetAlignMatrixCol(0,t.AlignMatrixCol1),this.viewer.SetAlignMatrixCol(1,t.AlignMatrixCol2),this.viewer.SetAlignMatrixCol(2,t.AlignMatrixCol3),this.viewer.SetAlignMatrixCol(3,t.AlignMatrixCol4)),this.viewer.UpdateViewMatrix(),!0)}},{key:"showElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.ShowElementBox(e)}},{key:"showElementBoxByBBox",value:function(e,t){e&&this.customManager.add([e[0][0],e[0][1]],[e[1][0],e[1][1]],t)}},{key:"setElementBoxColor",value:function(e,t,i,n){this.customManager.setColor(e,t,i,n)}},{key:"getElementBoxColor",value:function(){return this.customManager.getColor()}},{key:"getElementBoxStyle",value:function(){return this.customManager.getStyle()}},{key:"setElementBoxStyle",value:function(e){this.customManager.setStyle(e)}},{key:"hideElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.HideElementBox(e)}},{key:"clearElementBox",value:function(){this.viewer.ClearElementBox(),this.customManager.clear()}},{key:"getVisibleBoxIds",value:function(){for(var e=[],t=this.viewer.GetVisibleBoxIds(),i=0;i<t.size();++i)e.push(t.get(i));return e}},{key:"enableHighlightEvent",value:function(e){this.sendHighlightMsg=e}},{key:"isHighlightEventEnabled",value:function(){return this.sendHighlightMsg}},{key:"addClickCallback",value:function(e){this.clickCallback=e}},{key:"getClickCallback",value:function(){return this.clickCallback}},{key:"getModelBBox",value:function(){return this.viewer.GetModelBBox()}},{key:"enableSelectInBlock",value:function(){this.viewer.EnableSelectInBlock()}},{key:"disableSelectInBlock",value:function(){this.viewer.DisableSelectInBlock()}},{key:"canSelectInBlock",value:function(){return this.viewer.CanSelectInBlock()}},{key:"getSelectionWithBlock",value:function(){return this.viewer.GetSelectionWithBlock()}},{key:"GetHighlightIdsWithBlock",value:function(){return this.viewer.GetHighlightIdsWithBlock()}},{key:"highlightIdWithBlock",value:function(e,t){this.viewer.HighlightIdWithBlock(e,t)}},{key:"selectIdWithBlock",value:function(e,t){this.viewer.SelectIdWithBlock(e,t)}},{key:"createMinimap",value:function(e,t,i,n){if(0==this.isModelView())return void console.warn("Only model view support minimap.");void 0==this.minimap&&(this.minimap=new h.default(e,t,i,n),this.minimap.setDrawingImpl(this),this.minimap.initialize())}},{key:"enableMinimap",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.enableMiniMap(e)}},{key:"setMinimapBoundingBox",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.setDrawingContentsBbox(e)}},{key:"setMinimapOffset",value:function(e){this.minimap.setOffset(e)}},{key:"hasMinimap",value:function(){return 0==this.isModelView()?void console.warn("Only model view support minimap."):void 0!=this.minimap}},{key:"setGlobalColor",value:function(e){this.dc.customColor=e}},{key:"getGlobalColor",value:function(){return this.dc.customColor}},{key:"setPrintMode",value:function(e){this.dc.setPrintMode(e)}},{key:"zoomToWorldBox",value:function(e,t,i){void 0==i&&(i=1);var n=this.getModelBBox();n.SetMinMax(e,t),this.viewer.ZoomToWorldBox(n,i)}},{key:"alignDrawing",value:function(e,t){this.viewer.AlignDrawing(e,t)}},{key:"getAlignTranslate",value:function(){return this.viewer.GetAlignTranslate()}},{key:"scaleDrawing",value:function(e,t){this.viewer.AlignDrawingWithScale(e,t)}},{key:"getAlignScale",value:function(){return this.viewer.GetAlignScale()}},{key:"getViewportBBox",value:function(e){var t=this.viewer.GetViewportBBox(e),i=t.GetMinPt(),n=t.GetMaxPt();return{min:[i[0],i[1]],max:[n[0],n[1]]}}},{key:"getCustomManager",value:function(){return this.customManager}},{key:"setSnapMode",value:function(e){this.snapMode=e}},{key:"getSnapMode",value:function(){return this.snapMode}}]),e}();t.default=d},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(1),u=n(l),c=i(2),h=n(c),d=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.step=0,e.tmpPoint=null,e.viewPort=null,e.originPoint=null,e.points=[],e.isMatchSnapMode=!0,e.isEnableSnap=!0,e}return a(t,e),s(t,[{key:"drawSnapPoint",value:function(e,t){if(this.drawing2D||(this.drawing2D=e,this.ctx=t),!this.ctx&&(this.ctx=t),null!=this.tmpPoint&&(0!=this.tmpPoint.GetID()||"Intersection"==this.tmpPoint.GetSnapTypeName())){if(!this.isMatchSnapMode)return!0;this.isFootPoint=!1;var i=void 0,n=this.tmpPoint;if(this.points[0]&&this.step>0){var o=e.toScreenPoint(this.points[0].GetPoint()),r=this.tmpPointScreenPoint;n=e.snapToPoint2(r[0],r[1],o[0],o[1]),i=n.GetSnapTypeName()}else i=this.tmpPoint.GetSnapTypeName();var a=void 0;return a=e.viewer.IsActiveLayoutElement(n.GetID())?e.toScreenPoint(n.GetPoint()):e.toViewportScreenPoint(n.GetPoint()),this.drawTmpPoint(e,t,a,i),!0}return this.finalScreenPoint=null,this.captureFail(this.tmpPointScreenPoint),!1}},{key:"captureFail",value:function(e){}},{key:"drawTmpPoint",value:function(e,t,i,n){this.isEnableSnap&&(e=e||this.drawing2D,t=t||this.ctx,t.strokeStyle=t.fillStyle=h.default.Measure.snapColor,t.beginPath(),"EndPoint"==n?(t.lineWidth=2,t.rect(i[0]-4,i[1]-4,8,8),t.stroke()):"PointOnLine"==n?(t.arc(i[0],i[1],4.5,0,2*Math.PI,!0),t.fill()):"MiddlePoint"==n?(t.lineWidth=2,t.moveTo(i[0],i[1]-4),t.lineTo(i[0]-5,i[1]+4),t.lineTo(i[0]+5,i[1]+4),t.closePath(),t.stroke()):"FootPoint"==n?(this.isFootPoint=!0,t.lineWidth=2,t.moveTo(i[0]-6,i[1]-6),t.lineTo(i[0]-6,i[1]+6),t.lineTo(i[0]+6,i[1]+6),t.moveTo(i[0]-6,i[1]-1),t.lineTo(i[0]+1,i[1]-1),t.lineTo(i[0]+1,i[1]+6),t.stroke()):"Intersection"==n&&(t.lineWidth=2,t.moveTo(i[0]-4,i[1]-4),t.lineTo(i[0]+4,i[1]+4),t.moveTo(i[0]-4,i[1]+4),t.lineTo(i[0]+4,i[1]-4),t.stroke()),this.finalScreenPoint=i,this.tmpPointScreenPoint=i)}},{key:"onDrawing",value:function(e,t){if(this.drawSnapPoint(e,t),this.markPoint){var i=e.toScreenPoint(this.markPoint.slice(0,2));t.beginPath(),t.lineWidth=2,t.strokeStyle=h.default.Measure.color,t.fillStyle=t.strokeStyle,t.moveTo(i[0]-7.5,i[1]),t.lineTo(i[0]+7.5,i[1]),t.moveTo(i[0],i[1]-7.5),t.lineTo(i[0],i[1]+7.5),t.stroke(),t.rect(i[0]-2.5,i[1]-2.5,5,5),t.fill(),this.tmpPointScreenPoint&&(t.save(),t.lineDashOffset=10,t.setLineDash([3,3]),t.globalAlpha=.5,t.strokeStyle="#FF9D0B",t.moveTo(i[0],i[1]),t.lineTo(this.tmpPointScreenPoint[0],this.tmpPointScreenPoint[1]),t.stroke(),t.restore())}}},{key:"setIsOnlySnap",value:function(e){this.onlySnap=e}},{key:"begin",value:function(e,t,i,n){1!=n||this.onlySnap||(this.markPoint?this.markPoint=null:this.finalScreenPoint?this.markPoint=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]]):this.markPoint=e.toModelWorld([t,i]),this.redraw(e))}},{key:"onEditing",value:function(e,t,i,n){this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.isMatchSnapMode=this.matchSnapMode(this.tmpPoint,e.getSnapMode()),this.redraw(e)}},{key:"end",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.redraw(e)}},{key:"setIsEnableSnap",value:function(e){this.isEnableSnap=e}},{key:"matchSnapMode",value:function(e,t){if(!e)return!1;if(!t)return!0;var i=e.GetSnapTypeName(),n=t.snapList,o={PointOnLine:"line",Intersection:"intersection",MiddlePoint:"midpoint",EndPoint:"endpoint"};return n.includes(o[i])}}]),t}(u.default);t.default=d},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},u=i(0),c=n(u),h=i(10),d=n(h),f=i(2),g=n(f),v=i(4),m=n(v),p=i(22),y=n(p),w=function(e){function t(e){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.worldPtForOtherDrawing={},i.pressShift=!1,i.parallel=!1,i.viewPortBBox={},i.viewPortBBoxMask={},i.auxMobileMeasureTool=d.default.isDesktop()?null:new y.default(e,i),i}return a(t,e),s(t,[{key:"reset",value:function(){this.step=0,this.points=[],this.tmpPoint=null,this.needMaskVPId=0}},{key:"captureFail",value:function(e){return!1}},{key:"clearSnapPoint",value:function(){this.finalScreenPoint=null,this.tmpPoint=null}},{key:"needToMaskViewport",value:function(e,t){if(void 0==this.needMaskVPId||0==this.needMaskVPId)return!1;var i=void 0,n=void 0;if(this.viewPortBBoxMask[this.needMaskVPId])i=this.viewPortBBoxMask[this.needMaskVPId].min,n=this.viewPortBBoxMask[this.needMaskVPId].max;else{var o=e.getViewportBBox(this.needMaskVPId);i=o.min,n=o.max,this.viewPortBBoxMask[this.needMaskVPId]={min:i,max:n}}var r=e.toScreenPoint(i),a=e.toScreenPoint(n);return t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(r[0],r[1],a[0]-r[0],a[1]-r[1]),!0}},{key:"worldToScreen",value:function(e,t){for(var i=[],n=0;n<t.length;n++){var o=t[n],r=o.GetPoint();r=o.GetID()&&!e.viewer.IsActiveLayoutElement(o.GetID())?e.toViewportScreenPoint(r):e.toScreenPoint(r),i.push(r)}return i}},{key:"drawMask",value:function(e,t){if(this.showMask){var i=void 0,n=void 0;if(this.viewPortBBox[this.viewPort])i=this.viewPortBBox[this.viewPort].min,n=this.viewPortBBox[this.viewPort].max;else{var o=e.getViewportBBox(this.needMaskVPId);i=o.min,n=o.max,this.viewPortBBox[this.viewPort]={min:i,max:n}}var r=e.toScreenPoint(i),a=e.toScreenPoint(n);t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(0,0,3e3,3e3),t.globalCompositeOperation="destination-out",t.globalAlpha=1,t.fillRect(r[0],r[1],a[0]-r[0],a[1]-r[1]),t.globalCompositeOperation="source-over"}}},{key:"parallelDetect",value:function(e,t){if(!this.pressShift||!this.tmpPoint)return void(this.parallel=!1);var i=this.worldToScreen(e,[this.tmpPoint])[0],n=t[t.length-1];this.originPoint=i;var o=Math.abs(i[0]-n[0]),r=Math.abs(i[1]-n[1]),a=o<10,s=r<10;a||s?(a&&s?o>r?(i=[i[0],n[1]],this.parallel="Y"):(i=[n[0],i[1]],this.parallel="X"):a?(i=[n[0],i[1]],this.parallel="X"):(i=[i[0],n[1]],this.parallel="Y"),this.tmpPoint=e.snapToPoint(i[0],i[1])):this.parallel=!1}},{key:"onDrawing",value:function(e,t){if(this.drawMask(e,t),this.showMask||this.needToMaskViewport(e,t)||this.drawSnapPoint(e,t),0!=this.points.length){var i=this.worldToScreen(e,this.points);this.parallelDetect(e,i);var n=this.tmpPoint?this.worldToScreen(e,[this.tmpPoint])[0]:null;t.strokeStyle=g.default.Measure.color,t.lineWidth=g.default.Measure.lineWidth;var o=n?i.length+1:i.length;if(o>=2)for(var r=1;r<o;r++){var a=i[r-1],s=n&&r==o-1?n:i[r];t.beginPath(),t.moveTo(a[0],a[1]),t.lineTo(s[0],s[1]),t.stroke()}for(var l=0;l<i.length;l++){var u=i[l];this.strokeCircle(t,u),t.fillStyle=t.strokeStyle,t.beginPath(),t.arc(u[0],u[1],4,0,2*Math.PI,!0),t.fill()}}}},{key:"begin",value:function(e,t,i,n){}},{key:"end",value:function(e,t,i,n){if(!(this.showMask||this.needMaskVPId>0)){if(this.isPanMode(n)){if(this.sameAsMousedownPt(t,i)){if(0==this.points.length)return;this.reset(),this.notify("change",{type:"Distance",status:"reset"})}}else{var o=e.toModelWorld([t,i])
;if(0==this.step&&(this.points=[],this.viewPort=o[2],-1==o[2]?this.firstPointOutsideVP=!0:this.firstPointOutsideVP=!1),this.parallel||(this.finalScreenPoint?(this.points[this.step]=e.snapToPoint(this.finalScreenPoint[0],this.finalScreenPoint[1]),this.worldPtForOtherDrawing[this.step]=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]])):(this.points[this.step]=e.snapToPoint(t,i),this.worldPtForOtherDrawing[this.step]=null)),o[2]!=this.viewPort)return this.points.splice(1,1);if(this.step=this.step+1,this.tmpPoint=null,this.step>=2){var r=this.points[0].GetPoint(),a=this.points[1].GetPoint(),s=[r,a];if(this.worldPtForOtherDrawing[0])s[0]=this.worldPtForOtherDrawing[0];else if(!this.points[0].GetID()){var l=e.toScreenPoint(r),u=e.toModelWorld(l);u[2]>0&&(s[0]=u)}if(this.worldPtForOtherDrawing[1])s[1]=this.worldPtForOtherDrawing[1];else if(!this.points[1].GetID()){var h=e.toScreenPoint(a),d=e.toModelWorld(h);d[2]>0&&(s[1]=d)}"X"==this.parallel?s[1][0]=s[0][0]:"Y"==this.parallel&&(s[1][1]=s[0][1]);var f=c.default.distanceByArr(s[0],s[1]);this.notify("change",{distance:f,type:"Distance",status:"measured",start:s[0],end:s[1],points:s,isOnLayout:o[2]>0}),this.points=[],this.step=0,this.pressShift=!1,this.parallel=!1,this.viewPort=null}else{var g=this.points[0].GetPoint();this.notify("change",{type:"Distance",status:"measuring",points:[g],end:null})}}this.redraw(e)}}},{key:"onEditing",value:function(e,t,i,n){if(this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.step>0){var o=e.toModelWorld([t,i]);this.viewPort&&o[2]!=this.viewPort&&-1!=this.viewPort?this.showMask=!0:this.showMask=!1,this.firstPointOutsideVP&&o[2]>0?this.needMaskVPId=o[2]:this.needMaskVPId=0}this.redraw(e)}},{key:"keyDown",value:function(e,t){this.pressShift||16!=t.keyCode||0==this.step?27==t.keyCode&&this.step>0&&(this.points.pop(),this.step--,this.redraw(e)):(this.pressShift=!0,this.redraw(e),this.onDrawing(e,this.ctx))}},{key:"keyUp",value:function(e,t){this.pressShift=!1,16==t.keyCode&&0!=this.step&&this.originPoint&&this.onEditing(e,this.originPoint[0],this.originPoint[1])}},{key:"onExit",value:function(e){this.reset(),this.redraw(e),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onExit",this).call(this,e)}},{key:"strokeCircle",value:function(e,t){e.save(),e.globalCompositeOperation="source-over",e.strokeStyle=g.default.Measure.outlineColor,e.lineWidth=g.default.Measure.outlineWidth,e.beginPath(),e.arc(t[0],t[1],5,0,2*Math.PI,!0),e.stroke(),e.closePath(),e.restore()}}]),t}(m.default);t.default=w},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(15),s=n(a),l=i(16),u=n(l),c=i(17),h=n(c),d=function(){function e(){o(this,e),this.markups=[],this.red=255,this.green=0,this.blue=0,this.alpha=1,this.strokeStyle="rgba(255,0,0,1)",this.lineWidth=3,this.fontSize=14,this.fontFamily="Arial",this.type="Rectangle",this.fillStyle="red",this.enableFillStyle=!1}return r(e,[{key:"add",value:function(e,t,i,n,o){var r=void 0,a={strokeStyle:this.strokeStyle,lineWidth:this.lineWidth};switch(this.type){case"Rectangle":r=new s.default(e,t,a,i);break;case"CloudRect":r=new u.default(e,t,a,i);break;case"Chartlet":r=new h.default(n,e,t,o,i)}this.markups.push(r)}},{key:"setColor",value:function(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n,this.strokeStyle="rgba("+e+","+t+","+i+","+n+")"}},{key:"getColor",value:function(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}},{key:"setStyle",value:function(e){this.type=e}},{key:"getStyle",value:function(){return this.type}},{key:"clear",value:function(){this.markups=[]}},{key:"draw",value:function(e,t){for(var i=this.markups,n=0,o=i.length;n<o;++n){var r=i[n];t.strokeStyle=r.strokeStyle,t.lineWidth=r.lineWidth,t.fillStyle=r.fillStyle,r.draw(e,t)}}},{key:"setFillColor",value:function(e){this.enableFillStyle=!0,this.fillStyle=e}},{key:"setFillStyleState",value:function(e){this.enableFillStyle=e}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setFont",value:function(e){this.font=e}},{key:"get",value:function(e){return this.markups[e]}},{key:"remove",value:function(e){e<0||this.markups.splice(e,1)}},{key:"setFontSize",value:function(e){this.fontSize=e}},{key:"getMarkupSize",value:function(e,t){var i=this.getMarkupBbox(e,t);return[Math.abs(i[2]-i[0]),Math.abs(i[3]-i[1])]}},{key:"setFontFamily",value:function(e){this.fontFamily=e}},{key:"translatePos",value:function(e,t,i,n){for(var o=(this.getMarkupCenter(e,t),n[0]-i[0]),r=n[1]-i[1],a=this.markups[t],s=a.getPoints(),l=0;l<s.length;l+=2)s[l]+=o,s[l+1]+=r;a.setPoints(s)}},{key:"hitGrip",value:function(e,t,i){for(var n=this.markups[i],o=n.getGrips(e),r=0;r<o.length;r+=2){var a=[o[r],o[r+1]];if(a=e.toScreenPoint(a),this.isPointInCircle(t,a,8))return 4==o.length?0==r?0:4:r/2}return-1}}]),e}();t.default=d},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(18),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=function(){function e(t,i,o,r){n(this,e),this.width=o||300,this.height=r||240,this.imageUrl=i,this.domContainer=document.getElementById(t),this.xmlns="http://www.w3.org/2000/svg",this.naviAlgorithm=new a.default,this.boundingBox=null,this.originalDrawingContentsBbox=null,this.drawingImpl=null,this.isEnabled=!0}return o(e,[{key:"initialize",value:function(){this.initMinimapContainer(),this.initImageNode(this.imageUrl),this.initOutline(),this.initSvgRect()}},{key:"initMinimapContainer",value:function(){this.minimapContainer=document.createElementNS(this.xmlns,"svg"),this.minimapContainer.setAttribute("class","minimap");var e={width:this.width+"",height:this.height+""};this.setAttribute(this.minimapContainer,e);var t={position:"absolute","z-index":10,right:"10px",bottom:"60px",display:"block",backgroundColor:"#000000",opacity:"0.88"};this.setStyle(this.minimapContainer,t),this.domContainer.appendChild(this.minimapContainer);var i=this;this.minimapContainer.addEventListener("mousedown",function(e){i.bMousedown=!0,e.stopPropagation()}),this.minimapContainer.addEventListener("mouseup",function(e){if(1==i.bMousedown){i.bMousedown=!1,e.stopPropagation();var t={x:e.offsetX,y:e.offsetY},n=i.naviAlgorithm;n.minimapToNormalizedPoint(t,i.getMinimapContentsBbox()),n.normalizedPointToWorld(t,i.getDrawingContentsBbox());var o=i.drawingImpl.toScreenPoint([t.x,t.y]),r=i.drawingImpl.toScreenPoint([i.lastPoint.x,i.lastPoint.y]),a=[r[0]-o[0],r[1]-o[1]];i.drawingImpl.viewer.Pan(a[0],a[1]),i.drawingImpl.update(),i.drawingImpl.onViewChanges()}})}},{key:"setOffset",value:function(e){var t=this.minimapContainer;this.setStyle(t,e)}},{key:"initImageNode",value:function(e){this.svgImage=document.createElementNS(this.xmlns,"image"),this.svgImage.href.baseVal=e;var t={preserveAspectRatio:"xMidYMid meet",width:this.width+"",height:this.height+""};this.setAttribute(this.svgImage,t),this.minimapContainer.appendChild(this.svgImage)}},{key:"initSvgRect",value:function(){this.svgRect=document.createElementNS(this.xmlns,"rect");var e={width:"300",height:"240"};this.setAttribute(this.svgRect,e);var t={position:"absolute",display:"block",fillOpacity:"0.1",fill:"#11DAB7",stroke:"#11DAB7",strokeWidth:"2px"};this.setStyle(this.svgRect,t),this.minimapContainer.appendChild(this.svgRect),this.resize(this.width-2,this.height-2),this.moveTo(1,1)}},{key:"initOutline",value:function(){this.outline=document.createElementNS(this.xmlns,"rect");var e={width:"300",height:"240"};this.setAttribute(this.outline,e);var t={position:"absolute",fill:"none",stroke:"#555555",strokeWidth:"1px"};this.setStyle(this.outline,t),this.minimapContainer.appendChild(this.outline)}},{key:"moveTo",value:function(e,t){this.svgRect.setAttribute("transform","translate("+e+","+t+")")}},{key:"resize",value:function(e,t){var i={width:e+"",height:t+""};this.setAttribute(this.svgRect,i)}},{key:"setStyle",value:function(e,t){for(var i in t)e.style[i]=t[i]}},{key:"setAttribute",value:function(e,t){for(var i in t)e.setAttribute(i,t[i])}},{key:"enableMiniMap",value:function(e,t){var i={display:"none"};!0===e&&(i.display="block"),1!=t&&(this.isEnabled=e),this.setStyle(this.minimapContainer,i)}},{key:"setDrawingImpl",value:function(e){this.drawingImpl=e}},{key:"getMinimapContentsBbox",value:function(){var e=this.height,t=this.width,i=(this.width-this.height)/2,n={x:this.width/2,y:this.height/2};return{min:{x:n.x-t/2+i,y:n.y-e/2},max:{x:n.x+t/2-i,y:n.y+e/2}}}},{key:"setDrawingContentsBbox",value:function(e){this.setOriginalDrawingContentsBbox(e);var t=Math.abs(e.max.x-e.min.x),i=Math.abs(e.max.y-e.min.y),n={x:(e.max.x+e.min.x)/2,y:(e.max.y+e.min.y)/2},o=Math.max(t,i);e.min.x=n.x-o/2,e.min.y=n.y-o/2,e.max.x=n.x+o/2,e.max.y=n.y+o/2,void 0==this.lastPoint&&(this.lastPoint={x:(e.min.x+e.max.x)/2,y:(e.min.y+e.max.y)/2}),this.boundingBox=e}},{key:"getDrawingContentsBbox",value:function(){return this.boundingBox}},{key:"setOriginalDrawingContentsBbox",value:function(e){var t=JSON.parse(JSON.stringify(e));this.originalDrawingContentsBbox=t}},{key:"getOriginalDrawingContentsBbox",value:function(){return JSON.parse(JSON.stringify(this.originalDrawingContentsBbox))}},{key:"update",value:function(){if(0==this.drawingImpl.isModelView())return void this.enableMiniMap(!1,!0);this.enableMiniMap(this.isEnabled);var e=this.domContainer.clientWidth,t=this.domContainer.clientHeight,i=this.drawingImpl.toWorldPoint([0,t]),n=this.drawingImpl.toWorldPoint([e,0]);this.lastPoint={x:(n[0]+i[0])/2,y:(n[1]+i[1])/2};var o={x:i[0],y:i[1]},r={x:n[0],y:n[1]},a=this.naviAlgorithm,s=this.getOriginalDrawingContentsBbox(),l={min:o,max:r};if(a.containsBox(l,s))return this.resize(this.width-2,this.height-2),void this.moveTo(1,1);a.worldToNormalizedPoint(o,this.getDrawingContentsBbox()),a.normalizedPointToMinimap(o,this.getMinimapContentsBbox()),a.worldToNormalizedPoint(r,this.getDrawingContentsBbox()),a.normalizedPointToMinimap(r,this.getMinimapContentsBbox());var u=[(o.x+r.x)/2,(o.y+r.y)/2],c=Math.abs(r.x-o.x),h=Math.abs(r.y-o.y);s={min:{x:u[0]-c/2,y:u[1]-h/2},max:{x:u[0]+c/2,y:u[1]+h/2}},l={min:{x:0,y:0},max:{x:this.width,y:this.height}};var d=a.intersect(s,l);a.boundsChecking(d,{x:this.width,y:this.height}),u=[(d.min.x+d.max.x)/2,(d.min.y+d.max.y)/2],c=Math.abs(d.max.x-d.min.x),h=Math.abs(d.max.y-d.min.y),this.resize(c,h),this.moveTo(u[0]-c/2,u[1]-h/2)}}]),e}();t.default=s},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(3),u=(n(l),i(0)),c=n(u),h=i(1),d=n(h),f=i(9),g=n(f),v=function(e){function t(e){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,d.default.TouchMode));return i.rltTopHeight=i.relativeHight(e),i}return a(t,e),s(t,[{key:"relativeHight",value:function(e){var t=e.getDivId();return document.getElementById(t).getBoundingClientRect().top}},{key:"__getMobileEvt",value:function(e){for(var e=e.originalEvent||e,t=[],i=null,n=0,o=e.touches.length;n<o;n++)i=e.touches[n],t.push({x:i.pageX,y:i.pageY});return 0==e.touches.length&&(i=e.changedTouches[0],t.push({x:i.pageX,y:i.pageY})),t.length<=1?{isMulti:!1,point:t[0]}:{isMulti:!0,distance:c.default.distance(t[0],t[1]),point:t}}},{key:"onTouchStart",value:function(e){var t=this.__getMobileEvt(e),i=this.getEditor();if(t.isMulti){var n=c.default.center(t.point[0],t.point[1]);this.drawing2D.setStartPoint(n.x,n.y)}else this.isMeasureEditor()?(t.point.y-=this.rltTopHeight,i.auxMobileMeasureTool.onTouchStart(t)):(this.drawing2D.setStartPoint(t.point.x,t.point.y-this.rltTopHeight),i.begin(this.drawing2D,t.point.x,t.point.y-this.rltTopHeight,1));this.startEvent=t}},{key:"onTouchEnd",value:function(e){var t=e.changedTouches,i=this.getEditor();if(1==t.length){if(this.isMeasureEditor()){var n=this.__getMobileEvt(e);return n.point.y-=this.rltTopHeight,void i.auxMobileMeasureTool.onTouchEnd(n)}if(i.end(this.drawing2D,t[0].pageX,t[0].pageY-this.rltTopHeight,1)===d.default.FINISHED&&(i.onExit(this.drawing2D),this.editors.pop()),1==e.touches.length){var o=e.touches[0];this.drawing2D.setStartPoint(o.pageX,o.pageY-this.rltTopHeight)}}}},{key:"onTouchMove",value:function(e){var t=this.__getMobileEvt(e),i=this.getEditor();if(t.isMulti){if(!this.startEvent.distance)return;var n=t.distance/this.startEvent.distance;if(1!=n){var o=t.point;this.drawing2D.zoomPan(n,(o[0].x+o[1].x)/2,(o[0].y+o[1].y)/2),this.observer&&this.observer(null,"zoomFactorChanged",this.drawing2D.getZoomFactor())}}else this.isMeasureEditor()?(t.point.y-=this.rltTopHeight,i.auxMobileMeasureTool.onTouchMove(t)):i.onEditing(this.drawing2D,t.point.x,t.point.y-this.rltTopHeight,1);this.startEvent=t}},{key:"bindEvents",value:function(){function e(e){e.preventDefault(),n.onTouchStart(e)}function t(e){e.preventDefault(),n.onTouchEnd(e)}function i(e){e.preventDefault(),n.onTouchMove(e)}var n=this;this.allEvent={onTouchStart:e,onTouchEnd:t,onTouchMove:i};var o=n.getDom();o.addEventListener("touchstart",this.allEvent.onTouchStart,!1),o.addEventListener("touchend",this.allEvent.onTouchEnd,!1),o.addEventListener("touchmove",this.allEvent.onTouchMove,!1)}},{key:"unbindAllEvent",value:function(){var e=this.getDom();e.removeEventListener("touchstart",this.allEvent.onTouchStart,!1),e.removeEventListener("touchend",this.allEvent.onTouchEnd,!1),e.removeEventListener("touchmove",this.allEvent.onTouchMove,!1)}},{key:"isMeasureEditor",value:function(){var e=this.getEditorName();return"DistanceMeasure"==e||"AngleMeasure"==e||"AreaMeasure"==e}}]),t}(g.default);t.default=v},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(3),s=(n(a),i(1)),l=(n(s),i(19)),u=n(l),c=i(20),h=n(c),d=i(21),f=n(d),g=i(5),v=n(g),m=i(23),p=n(m),y=i(24),w=n(y),b=i(4),C=n(b),x=function(){function e(t,i){o(this,e),this.drawing2D=t,this.id="editor-"+i,this.mode=i,this.editors=[],this.editors.push(new h.default),this.observer=null,e.editorMode=this.mode;var n=this;t.dc.overlayDrawers[this.id]=function(e){for(var i=0;i<n.editors.length;++i)n.editors[i].onDrawing(t,e)}}return r(e,[{key:"destroy",value:function(){delete this.drawing2D.dc.overlayDrawers[this.id],this.drawing2D=null}},{key:"getDom",value:function(){return this.drawing2D.dom}},{key:"getEditor",value:function(){return this.editors[this.editors.length-1]}},{key:"getEditorName",value:function(){return this.getEditor().name}},{key:"activeEditorByName",value:function(e){if("zoom"==e){var t=this.editors.length;if(t>0&&this.editors[t-1].name==e)return}else this.getEditor().onExit(this.drawing2D),this.editors=[];var i=null;switch(e){case"zoom":i=new u.default;break;case"pick":i=new f.default;break;case"pan":i=new h.default;break;case"DistanceMeasure":i=new v.default(this.drawing2D);break;case"AngleMeasure":i=new w.default(this.drawing2D);break;case"AreaMeasure":i=new p.default(this.drawing2D);break;case"capture":i=new C.default}i.name=e,i.mode=this.mode,i.observer=this.observer,i.init(this.drawing2D),this.editors.push(i)}},{key:"enableSnap",value:function(e){this.getEditor().enableSnap&&this.getEditor().enableSnap(e)}},{key:"enablePickEffect",value:function(e){this.getEditor().enablePickEffect&&this.getEditor().enablePickEffect(e)}},{key:"setSnapMode",value:function(e){this.getEditor().setSnapMode&&this.getEditor().setSnapMode(e)}}]),e}();x.editorMode=-1,t.default=x},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){n(this,e)}return o(e,null,[{key:"isDesktop",value:function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),o=/(?:Firefox)/.test(e),r=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||o&&/(?:Tablet)/.test(e));return!(/(?:iPhone)/.test(e)&&!r||n||i||r)}}]),e}();t.default=r},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(3),u=(n(l),i(1)),c=n(u),h=i(9),d=n(h),f=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,c.default.MouseMode))}return a(t,e),s(t,[{key:"onDoubleClick",value:function(e){this.getEditor().onDoubleClick(this.drawing2D,e)}},{key:"onMouseDown",value:function(e){this.getEditor().onMouseDown(this.drawing2D,e);var t=this.drawing2D.getClickCallback();t&&t([e.offsetX,e.offsetY])}},{key:"onMouseUp",value:function(e){var t=this.getEditor();t.onMouseUp(this.drawing2D,e)===c.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"onMouseMove",value:function(e){this.getEditor().onMouseMove(this.drawing2D,e)}},{key:"onMouseWheel",value:function(e){this.getEditor().onMouseWheel(this.drawing2D,e)}},{key:"onKeyDown",value:function(e){var t=this.getEditor();t.onKeyDown(this.drawing2D,e)==c.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"onKeyUp",value:function(e){var t=this.getEditor();t.onKeyUp(this.drawing2D,e)==c.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"unbindAllEvent",value:function(){var e=this.getDom();e.removeEventListener("dblclick",this.allEvent.onDoubleClick,!1),e.removeEventListener("mousedown",this.allEvent.onMouseDown,!1),e.removeEventListener("mouseup",this.allEvent.onMouseUp,!1),e.removeEventListener("mousemove",this.allEvent.onMouseMove,!1),e.removeEventListener("mousewheel",this.allEvent.onMouseWheel,!1),e.removeEventListener("DOMMouseScroll",this.allEvent.onMouseWheel,!1),document.removeEventListener("keydown",this.allEvent.onKeyDown),document.removeEventListener("keyup",this.allEvent.onKeyUp)}},{key:"bindEvents",value:function(){function e(e){e.preventDefault(),s.onDoubleClick(e)}function t(e){e.preventDefault(),s.onMouseDown(e)}function i(e){s.onMouseMove(e)}function n(e){e.preventDefault(),s.onMouseWheel(e)}function o(e){e.preventDefault(),s.onMouseUp(e)}function r(e){s.onKeyDown(e)}function a(e){s.onKeyUp(e)}var s=this;this.allEvent={onDoubleClick:e,onMouseDown:t,onMouseMove:i,onMouseWheel:n,onMouseUp:o,onKeyDown:r,onKeyUp:a};var l=s.getDom();l.addEventListener("dblclick",this.allEvent.onDoubleClick,!1),l.addEventListener("mousedown",this.allEvent.onMouseDown,!1),l.addEventListener("mouseup",this.allEvent.onMouseUp,!1),l.addEventListener("mousemove",this.allEvent.onMouseMove,!1),l.addEventListener("mousewheel",this.allEvent.onMouseWheel,!1),l.addEventListener("DOMMouseScroll",this.allEvent.onMouseWheel,!1),l.oncontextmenu=function(e){e.preventDefault()},document.addEventListener("keydown",this.allEvent.onKeyDown),document.addEventListener("keyup",this.allEvent.onKeyUp)}}]),t}(d.default);t.default=f},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}var o=i(13),r=n(o),a=i(25),s=n(a),l=i(28),u=n(l),c={preRun:[],postRun:[],print:function(e){console.log(e)},printErr:function(e){e=Array.prototype.slice.call(arguments).join(" "),console.log(e)},progress:function(e,t,i){""==e?(console.log("Initialized."),r.default.ready()):console.log(e)},locateFile:function(e){return r.default.sdkUrl+e},setStatus:function(e){if(c.setStatus.last||(c.setStatus.last={time:Date.now(),text:""}),e!==c.setStatus.text){var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);t?c.progress(e,100*parseInt(t[2]),100*parseInt(t[4])):c.progress(e,null,null)}},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),c.setStatus(e?"Preparing... ("+(this.totalDependencies-e+1)+"/"+this.totalDependencies+")":"Complete.")}};c.setStatus("20180528"),r.default.loadModel=function(e,t,i){var n=new XMLHttpRequest,o=this;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status||0==n.status){var a=c.LoadCallback.extend("LoadCallback",{OnLoad:function(e){e.indexJson=JSON.parse(n.responseText),t(e)},OnError:function(){t(null)},OnDownloading:function(e){r.default.onLoadProgress(e)}}),s=JSON.parse(n.responseText),l=!0;0!=s.metadata.gz&&"false"!=s.metadata.gz||(l=!1);var u=new a;c.loadModel(e+"/",u,l)}else 404===n.status&&(i?o.loadModel(e,t):t(null))},n.open("GET",e+"/index.json"+(i&&".gz"||"")),n.send()},r.default.loadGrids=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0==i.status){var e=JSON.parse(i.responseText);t(e)}else 404===i.status&&t(null)},i.open("GET",e+"/grids.json"),i.send()},s.default.loadModel=function(e,t,i,n,o,r){var a=new XMLHttpRequest,l=this;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status||0==a.status){var u=JSON.parse(a.responseText),c=!0;if(!o){0!=u.metadata.gz&&"false"!=u.metadata.gz||(c=!1);var h=0,d=0;void 0!=u.metadata.translate_x&&null!=u.metadata.translate_x&&(h=parseFloat(u.metadata.translate_x)),void 0!=u.metadata.translate_y&&null!=u.metadata.translate_y&&(d=parseFloat(u.metadata.translate_y))}var f=i.viewer,g=new i.butterfly.LoadReactor;g.OnLoad=function(){0==f.PrepareModel()&&console.error("The model data is not ready!"),f.translateX=h,f.translateY=d,n(f)},g.OnDownloading=function(e){s.default.onLoadProgress(1-e)},g.OnError=function(){console.error("error when parse")},o&&(e=e+"/"+o),f.url=e,f.Load(e,g,c)}else 404===a.status&&(r?l.loadModel(e,t,i,n,o):n(null))},a.open("GET",e+"/index.json"+(r&&".gz"||"")),a.send()},s.default.addModel=function(e,t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status||0==n.status){var o=JSON.parse(n.responseText);0!=o.metadata.gz&&o.metadata.gz;var r=new t.butterfly.LoadReactor;r.OnLoad=function(){0==t.viewer.PrepareLastModel()&&console.error("The model data is not ready!"),i()},r.OnDownloading=function(e){s.default.onLoadProgress(1-e)},r.OnError=function(){console.error("error when parse")},t.viewer.Add(e,r)}else 404===n.status&&i(null)},n.open("GET",e+"/index.json"),n.send()},s.default.loadGrids=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0==i.status){var e=JSON.parse(i.responseText);t(e)}else 404===i.status&&t(null)},i.open("GET",e+"/grids.json"),i.send()},window.Module=c,window.Glodon=window.Glodon||{},window.Glodon.Bimface=window.Glodon.Bimface||{},window.Glodon.Bimface.DrawingSheet=r.default,window.Glodon.Bimface.WebglDrawingSheet=s.default,window.Glodon.Bimface.RevitInterop=u.default},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(3),s=n(a),l=i(8),u=n(l),c=i(11),h=n(c),d=function(){function e(){o(this,e)}return r(e,null,[{key:"initialize",value:function(t){void 0!==t&&(e.ready=t);var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",n.src=e.sdkUrl+"/mdvjs.js",i.appendChild(n)}},{key:"ready",value:function(){console.log("Drawing2D engine is ready!")}},{key:"onLoadProgress",value:function(e){console.log(e)}},{key:"loadModel",value:function(e,t){console.log("not implemented!")}},{key:"createDrawing",value:function(e){var t=document.getElementById(e),i=document.createElement("canvas");i.id=e+"-main-drawing",i.width=t.clientWidth,i.height=t.clientHeight,i.style.position="absolute",t.appendChild(i);var n=document.createElement("canvas");n.id=e+"-aux-drawing",n.width=t.clientWidth,n.height=t.clientHeight,n.style.position="absolute",t.appendChild(n);var o=document.createElement("canvas");return o.id=e+"-ovl-drawing",o.width=t.clientWidth,o.height=t.clientHeight,o.style.position="absolute",t.appendChild(o),new s.default(i,n,o,e)}},{key:"createMouseEditorManager",value:function(e){return new h.default(e)}},{key:"createTouchEditorManager",value:function(e){return new u.default(e)}}]),e}();d.sdkUrl="js/",t.default=d},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=function(){function e(){n(this,e)}return o(e,null,[{key:"create",value:function(e,t,i){var n=Module.DeviceContext.extend("DeviceContext",{initialize:function(e,t){this.canvasMain=e,this.canvasTemp=t,this.canvasOverlay=i,this.ctxMain=this.canvasMain.getContext("2d"),this.ctxTemp=this.canvasTemp.getContext("2d"),this.ctxOverlay=this.canvasOverlay.getContext("2d"),this.inPath=!1,this.fontSize=12,this.colorTable={},this.faceColorTable={},this.globalOpacity=null,this.Normal=0,this.White=1,this.Black=2,this.Gray=3,this.Custom=4,this.printMode=this.Normal,this.printColorTable={},this.printFaceColorTable={},this.resUrl="",this.images={},this.ignoreImage=!1,this.targetId=0,this.overlayDrawers={},this.customColor=-1},drawingOverlay:function(e,t){var i=this.ctxOverlay;i.clearRect(0,0,e,t);var n=this.overlayDrawers;for(var o in n)n[o](i)},setBackgroundColor:function(e){this.canvasMain.style.background=e},setPrintMode:function(e){if("Normal"==e)this.printMode=this.Normal;else if("Gray"==e)this.printMode=this.Gray;else if("Black"==e)this.printMode=this.Black;else if("White"==e)this.printMode=this.White;else{if("Custom"!=e)return;this.printMode=this.Custom}},setResourceUrl:function(e){this.resUrl=e},setGlobalOpacity:function(e){this.globalOpacity=e},getGlobalOpacity:function(){return this.globalOpacity},restoreGlobalOpacity:function(){this.globalOpacity=null},getHexColor:function(e){var t=null===this.globalOpacity?1:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var r=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printColorTable[e]="rgba("+r+","+r+","+r+","+t+")",this.printColorTable[e]}return this.colorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.colorTable[e]},getFaceColor:function(e){var t=null===this.globalOpacity?.9:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var r=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printFaceColorTable[e]="rgba("+r+","+r+","+r+","+t+")",this.printFaceColorTable[e]}return this.faceColorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.faceColorTable[e]},resize:function(e,t){this.canvasMain.setAttribute("width",e),this.canvasMain.setAttribute("height",t),this.canvasTemp.setAttribute("width",e),this.canvasTemp.setAttribute("height",t),this.canvasOverlay.setAttribute("width",e),this.canvasOverlay.setAttribute("height",t)},clearAll:function(e,t){this.ctxMain.clearRect(0,0,e,t),this.ctxTemp.clearRect(0,0,e,t),this.ctxOverlay.clearRect(0,0,e,t)},SetTarget:function(e){0==e?this.ctx=this.ctxMain:(this.ctx=this.ctxTemp,this.ctx.strokeStyle="#ff0000"),this.targetId=e},BeginDraw:function(e,t){this.ctx.clearRect(t[0],t[1],t[2],t[3])},EndDraw:function(e){},BeginPath:function(){this.inPath=!0,this.ctx.beginPath()},EndPath:function(e,t){this.inPath=!1,e&&(this.ctx.fillStyle=this.getFaceColor(t),this.ctx.closePath(),this.ctx.fill()),this.ctx.stroke()},BeginClip:function(e){e&&(this.ctx.save(),this.ctx.clip())},EndClip:function(e){e&&this.ctx.restore()},SetLineColor:function(e){var t=this.getHexColor(e);this.ctx.strokeStyle=t,this.ctx.fillStyle=t},SetLineWidth:function(e){this.ctx.lineWidth=e},SetLineDash:function(e,t){if(0==e)return void this.ctx.setLineDash([]);if(1==e)return void this.ctx.setLineDash([10]);for(var i=[],n=0,o=t.size();n<o;++n)i.push(t.get(n));this.ctx.setLineDash(i)},SetFont:function(e){this.fontSize=e,this.ctx.font=this.fontSize+"px 仿宋"},DrawPoint:function(e,t,i){},DrawLine:function(e,t){if(this.inPath)this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(t[0],t[1]);else{for(var i=this.ctx.getLineDash(),n=0,o=0;o<i.length;++o)n+=i[o];this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])<n*n&&this.ctx.setLineDash([]),this.ctx.lineTo(t[0],t[1]),
this.ctx.stroke(),this.ctx.setLineDash(i)}},DrawArc:function(e,t,i,n){this.inPath?this.ctx.arc(e[0],e[1],t,-i,-n,!0):(this.ctx.beginPath(),this.ctx.arc(e[0],e[1],t,-i,-n,!0),this.ctx.stroke())},DrawRec:function(e,t){this.inPath?this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]):(this.ctx.beginPath(),this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]),this.ctx.stroke())},DrawCloudRec:function(e,t,i){var n=e,o=t;i=i||this.ctx,n=[n[0]+18/3.5,n[1]+18/3.5],o=[o[0]-18/3.5,o[1]-18/3.5];var r=o[1]-n[1],a=o[0]-n[0],s=Math.abs(a),l=Math.abs(r),u=parseInt(s/18),c=parseInt(l/18),h=0==u?s:s/u,d=0==c?l:l/c;i.beginPath(),this.drawSide("orientation",h,s,n[0],n[1],i),this.drawSide("orientation",h,s,n[0]+s,n[1]+l,i,!0),this.drawSide("portrait",d,l,n[0]+s,n[1],i),this.drawSide("portrait",d,l,n[0],n[1]+l,i,!0),i.stroke()},drawSide:function(e,t,i,n,o,r,a){var s=0,l=0,u=i/t,c=void 0,h=n,d=o;"orientation"==e?s=t:l=t;for(var f=0;f<u;f++){r.moveTo(n,o),c=a?[n-s,o-l]:[n+s,o+l],s&&Math.abs(c[0]-h)>i?c[0]=a?h-i:h+i:l&&Math.abs(c[1]-d)>i&&(c[1]=a?d-i:d+i);var g=this.getControlPt([n,o],c);r.quadraticCurveTo(g[0],g[1],c[0],c[1]),n=c[0],o=c[1]}},getControlPt:function(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=.4*a.default.distanceByArr(e,t),r=[t[1]-e[1],e[0]-t[0]];return r=a.default.normalize(r),[n[0]+r[0]*o,n[1]+r[1]*o]},DrawPolyline:function(e){var t=e.size();if(!(t<1))if(this.inPath){this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var i=1;i<t;++i)this.pt=e.get(i),this.ctx.lineTo(this.pt[0],this.pt[1])}else{for(var n=this.ctx.getLineDash(),o=0,r=0;r<n.length;++r)o+=n[r];this.ctx.beginPath(),this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var a=1;a<t;++a){var s=(this.pt[0]-e.get(a)[0])*(this.pt[0]-e.get(a)[0])+(this.pt[1]-e.get(a)[1])*(this.pt[1]-e.get(a)[1]);s<o*o?this.ctx.setLineDash([]):this.ctx.setLineDash(n),this.pt=e.get(a),this.ctx.lineTo(this.pt[0],this.pt[1]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.pt[0],this.pt[1])}this.ctx.setLineDash(n)}},DrawText:function(e,t){this.ctx.fillText(e,t[0],t[1])},DrawTextW:function(e,t,i){0!=i?(this.ctx.save(),this.ctx.translate(t[0],t[1]),this.ctx.rotate(i),this.ctx.fillText(e,0,0),this.ctx.restore()):this.ctx.fillText(e,t[0],t[1])},DrawImageImpl:function(e,t,i,n,o,r,a){function s(t,i,n,o,r,a){0==a?e.drawImage(t,i,n,o,r):(e.save(),e.translate(i,n+r),e.rotate(a),e.drawImage(t,0,-r,o,r),e.restore())}var l=this,u=l.images[t];if(l.ignoreImage)return!1;void 0===u?(u=new Image,u.onload=function(){s(u,i,n,o,r,a),l.images[t]=u},u.src=t):s(u,i,n,o,r,a)},DrawImage:function(e,t,i,n,o,r){this.DrawImageImpl(this.ctx,this.resUrl+"image/"+e,t,i,n,o,r)}}),o=new n;return o.initialize(e,t),o}}]),e}();t.default=s},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,i,o,r){n(this,e),this.min=t,this.max=i,this.markupType="Rect",this.strokeStyle=o.strokeStyle,this.lineWidth=o.lineWidth||4,this.fontSize=14,this.fontFamily="Arial",this.margin=r||0,this.fillStyle="white",this.id=""}return o(e,[{key:"draw",value:function(e,t){var i=e.toScreenPoint([this.min[0]-this.margin,this.min[1]-this.margin]),n=e.toScreenPoint([this.max[0]+this.margin,this.max[1]+this.margin]);if(e.dc.ctx)e.dc.ctx.strokeStyle=this.strokeStyle,e.dc.SetLineWidth(this.lineWidth),e.dc.SetLineDash(0),e.dc.DrawRec([i[0],n[1]],[n[0],i[1]]);else{e.dc.ctxOverlay.strokeStyle=this.strokeStyle,e.dc.ctxOverlay.lineWidth=this.lineWidth;var o=[i[0],n[1]],r=[n[0],i[1]];this.inPath?e.dc.ctxOverlay.rect(o[0],o[1],r[0]-o[0],r[1]-o[1]):(e.dc.ctxOverlay.beginPath(),e.dc.ctxOverlay.rect(o[0],o[1],r[0]-o[0],r[1]-o[1]),e.dc.ctxOverlay.stroke())}}}]),e}();t.default=r},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,i,o,r){n(this,e),this.min=t,this.max=i,this.margin=r||0,this.markupType="CloudRect",this.strokeStyle=o.strokeStyle,this.lineWidth=o.lineWidth||4,this.fontSize=14,this.fontFamily="Arial",this.fillStyle="white",this.id=""}return o(e,[{key:"draw",value:function(e,t){var i=e.toScreenPoint([this.min[0]-this.margin,this.min[1]-this.margin]),n=e.toScreenPoint([this.max[0]+this.margin,this.max[1]+this.margin]);e.dc.ctx?(e.dc.ctx.strokeStyle=this.strokeStyle,e.dc.SetLineWidth(this.lineWidth),e.dc.SetLineDash(0),e.dc.DrawCloudRec([i[0],n[1]],[n[0],i[1]])):(e.dc.ctxOverlay.strokeStyle=this.strokeStyle,e.dc.ctxOverlay.lineWidth=this.lineWidth,e.dc.DrawCloudRec([i[0],n[1]],[n[0],i[1]],e.dc.ctxOverlay))}}]),e}();t.default=r},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,i,o,r,a){n(this,e),this.min=i,this.max=o,this.markupType="Chartlet",this.margin=a||0,this.id=r,this.img=t}return o(e,[{key:"draw",value:function(e){var t=e.toScreenPoint([this.min[0]-this.margin,this.min[1]-this.margin]),i=e.toScreenPoint([this.max[0]+this.margin,this.max[1]+this.margin]),n=i[0]-t[0],o=i[1]-t[1];e.dc.ctx?e.dc.ctx.drawImage(this.img,t[0],t[1],n,o):e.dc.ctxOverlay.drawImage(this.img,t[0],t[1],n,o)}}]),e}();t.default=r},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){n(this,e)}return o(e,[{key:"worldToNormalizedPoint",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=(e.x-t.min.x)/i*2-1,e.y=(e.y-t.min.y)/n*2-1,e.y=-e.y}},{key:"normalizedPointToWorld",value:function(e,t){e.y=-e.y;var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=.5*(e.x+1)*i+t.min.x,e.y=.5*(e.y+1)*n+t.min.y}},{key:"normalizedPointToMinimap",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=.5*(e.x+1)*i+t.min.x,e.y=.5*(e.y+1)*n+t.min.y}},{key:"minimapToNormalizedPoint",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=(e.x-t.min.x)/i*2-1,e.y=(e.y-t.min.y)/n*2-1}},{key:"containsBox",value:function(e,t){return e.min.x<=t.min.x&&t.max.x<=e.max.x&&e.min.y<=t.min.y&&t.max.y<=e.max.y}},{key:"intersect",value:function(e,t){var i={x:0,y:0},n={x:0,y:0};return i.x=Math.max(e.min.x,t.min.x),i.y=Math.max(e.min.y,t.min.y),n.x=Math.min(e.max.x,t.max.x),n.y=Math.min(e.max.y,t.max.y),{min:i,max:n}}},{key:"boundsChecking",value:function(e,t){0===e.min.x&&e.min.x++,0===e.min.y&&e.min.y++,e.max.x===t.x&&e.max.x--,e.max.y===t.y&&e.max.y--}},{key:"intersectsBox",value:function(e,t){return!(e.max.x<t.min.x||e.min.x>t.max.x||e.max.y<t.min.y||e.min.y>t.max.y)}}]),e}();t.default=r},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(1),u=n(l),c=i(2),h=n(c),d=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.startPt=[0,0],e.endPt=null,e}return a(t,e),s(t,[{key:"onDrawing",value:function(e,t){null!=this.endPt&&(t.strokeStyle=h.default.Zoom.color,t.lineWidth=h.default.Zoom.lineWidth,t.strokeRect(this.startPt[0],this.startPt[1],this.endPt[0]-this.startPt[0],this.endPt[1]-this.startPt[1]))}},{key:"begin",value:function(e,t,i,n){n==u.default.LelftButton&&(this.startPt[0]=t,this.startPt[1]=i,this.starting=!0)}},{key:"onEditing",value:function(e,t,i,n){this.starting&&(this.endPt=[t,i],this.redraw(e))}},{key:"end",value:function(e,t,i,n){return!this.starting||t==this.startPt[0]&&i==this.startPt[1]||e.zoom(this.startPt[0],this.startPt[1],t,i),this.endPt=null,this.redraw(e),u.default.FINISHED}}]),t}(u.default);t.default=d},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1),l=function(e){return e&&e.__esModule?e:{default:e}}(s),u=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),a(t,[{key:"begin",value:function(e,t,i,n){this.isPanMode(n)||(this.start=!0)}},{key:"onEditing",value:function(e,t,i,n){this.start&&e.panTo(t,i)}},{key:"end",value:function(e,t,i,n){1==this.start&&(e.update(!0),this.start=!1)}}]),t}(l.default);t.default=u},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},l=i(4),u=function(e){return e&&e.__esModule?e:{default:e}}(l),c=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.snapIsEnabled=!1,e.pickEnabled=!0,e}return r(t,e),a(t,[{key:"init",value:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.picked=!1,this.preSelectCount=0}},{key:"begin",value:function(e,t,i,n){n==u.default.LelftButton?(this.picked=!0,this.start=!0):n==u.default.MiddleButton&&(this.moving=!0,this.start=!0),this.mode==u.default.TouchMode&&(this.pickMode=!0,e.isHighlightEventEnabled()&&this.notify("highlight",e.getHighlightIds(),t,i))}},{key:"onEditing",value:function(e,t,i,n,o){if(this.mode==u.default.TouchMode)e.panTo(t,i)&&(this.pickMode=!1);else if(this.pickMode=!0,e.hover){var r=e.preSelect(t,i,1===n);if(r==this.preSelectCount&&0==this.preSelectCount||(e.update(),this.preSelectCount=r),e.isHighlightEventEnabled()&&this.notify("highlight",e.getHighlightIds(),t,i,o),this.snapIsEnabled){this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.isMatchSnapMode=this.matchSnapMode(this.tmpPoint,e.getSnapMode());var a=e.dc.ctxOverlay;this.redraw(e,a)}}}},{key:"end",value:function(e,t,i,n){!0===this.pickMode&&this.picked&&this.pickEnabled&&(this.mode==u.default.TouchMode&&e.preSelect(t,i,!1),e.preSelect(t,i,!1),e.select(),e.update(),this.notify("selection",e.getSelectedIds()),this.pickMode=!1,this.picked=!1),this.start&&(this.start=!1)}},{key:"onMouseMove",value:function(e,t){var i=this.formatEventOffset(e,t);1!=t.ctrlKey&&this.isPanMode(t.buttons)?this.start&&e.panTo(i.x,i.y)&&(this.pickMode=!1):this.onEditing(e,i.x,i.y,t.buttons,t)}},{key:"isPanMode",value:function(e){return 0!=e}},{key:"enableSnap",value:function(e){this.snapIsEnabled=e}},{key:"enablePickEffect",value:function(e){this.pickEnabled=e}}]),t}(u.default);t.default=c},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,i){n(this,e),this.drawing2D=t,this.touchEndCounts=0,this.editor=i,this.outerCircleRadius=60,this.outerCircleFillStyle="rgba(255, 255, 255, 0.3)",this.outerCircleBorderWidth=2,this.outerCircleBorderColor="#999999",this.innerCircleRadius=50,this.innerCircleFillStyle="rgba(204, 204, 204, 0.5)",this.innerCircleBorderWidth=2,this.triangleWidth=20,this.triangleFillStyle="rgba(204, 204, 204, 0.5)",this.triangleBorderWidth=2,this.triangleBorderColor="#999999";var o={x:t.width/2,y:t.height/2};this.draw(this.updateAuxMeasure(o))}return o(e,[{key:"setEditor",value:function(e){this.editor=e}},{key:"updateAuxMeasure",value:function(e){this.center=e;var t={};t.outerCircle={},t.outerCircle.center=e,t.outerCircle.radius=this.outerCircleRadius,t.innerCircle={},t.innerCircle.center=e,t.innerCircle.radius=this.innerCircleRadius,t.triangle=[];var i={x:e.x-this.outerCircleRadius,y:e.y-this.outerCircleRadius};return t.triangle.push({x:i.x,y:i.y}),t.triangle.push({x:i.x+this.triangleWidth,y:i.y}),t.triangle.push({x:i.x,y:i.y+this.triangleWidth}),t}},{key:"draw",value:function(e){var t=this.drawing2D.dc.ctxOverlay,i=e.outerCircle;t.strokeStyle=this.outerCircleBorderColor,t.lineWidth=this.outerCircleBorderWidth,t.fillStyle=this.outerCircleFillStyle,t.beginPath(),t.arc(i.center.x,i.center.y,i.radius,0,2*Math.PI,!0),t.fill(),t.stroke();var n=e.innerCircle;t.fillStyle=this.innerCircleFillStyle,t.beginPath(),t.arc(n.center.x,n.center.y,n.radius,0,2*Math.PI,!0),t.fill();var o=e.triangle;t.lineWidth=this.triangleBorderWidth,t.fillStyle=this.triangleFillStyle,t.beginPath(),t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y),t.closePath(),t.fill(),t.stroke()}},{key:"getRealPoint",value:function(e){var t={x:this.outerCircleRadius,y:this.outerCircleRadius};return{x:e.x-t.x,y:e.y-t.y}}},{key:"onTouchStart",value:function(e){}},{key:"onTouchMove",value:function(e){if(this.touchOnAux(e)){var t=this.updateAuxMeasure({x:e.point.x,y:e.point.y});this.draw(t);var i=this.editor,n=this.getRealPoint(e.point);i.onEditing(this.drawing2D,n.x,n.y,1)}}},{key:"onTouchEnd",value:function(e,t){if(this.touchOnAux(e)){var i=this.editor,n=this.getRealPoint(e.point);++this.touchEndCounts%2==1&&this.drawing2D.setStartPoint(n.x,n.y),this.touchEndCounts%2==0&&i.end(this.drawing2D,n.x,n.y,1),!t&&i.redraw(this.drawing2D),i.clearSnapPoint()}}},{key:"redraw",value:function(){if(this.center){var e=this.updateAuxMeasure(this.center);this.draw(e)}}},{key:"touchOnAux",value:function(e){var t=this.center,i=this.outerCircleRadius,n={x:e.point.x,y:e.point.y},o=t.x-n.x,r=t.y-n.y;return Math.sqrt(o*o+r*r)<=i}}]),e}();t.default=r},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},u=i(5),c=n(u),h=i(0),d=(n(h),i(10)),f=n(d),g=i(2),v=n(g),m=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,e),s(t,[{key:"onDrawing",value:function(e,i){if(!f.default.isDesktop())return void l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onDrawing",this).call(this,e,i);if(this.drawMask(e,i),this.showMask||this.needToMaskViewport(e,i)||this.drawSnapPoint(e,i),0!==this.points.length){i.strokeStyle=v.default.Measure.color,i.lineWidth=v.default.Measure.lineWidth,i.fillStyle=i.strokeStyle;var n=this.worldToScreen(e,this.points);this.parallelDetect(e,n);var o=this.tmpPoint?this.worldToScreen(e,[this.tmpPoint])[0]:null,r=o?n.concat([o]):n,a=r.length;if(2==a){var s=r[0],u=r[1];i.beginPath(),i.moveTo(s[0],s[1]),i.lineTo(u[0],u[1]),i.stroke()}else if(a>2)for(var c=1;c<a+1;c++){var h=r[c-1],d=c==a?r[0]:r[c];i.beginPath(),i.moveTo(h[0],h[1]),i.lineTo(d[0],d[1]),i.stroke()}for(var g=o?a-1:a,m=0;m<g;m++){var p=r[m];this.strokeCircle(i,p),i.beginPath(),i.arc(p[0],p[1],4,0,2*Math.PI,!0),i.fill()}}}},{key:"begin",value:function(e,t,i,n){}},{key:"end",value:function(e,t,i,n){if(!(this.showMask||this.needMaskVPId>0))if(this.isPanMode(n)){if(this.sameAsMousedownPt(t,i)&&this.step<3){if(0==this.step)return;this.points=[],this.step=0,this.redraw(e),this.notify("change",{type:"Area",status:"reset"})}else if(this.sameAsMousedownPt(t,i)&&this.step>=3){var o=this.getArea(this.points.slice()),r=[],a=!0,s=!1,l=void 0;try{for(var u,c=this.points[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value,d=h.GetID()>0&&!e.viewer.IsActiveLayoutElement(h.GetID());r.push({point:h.GetPoint(),isActiveLayoutElement:!d})}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}this.pressShift=!1,this.parallel=!1,this.viewPort=null,this.points=[],this.step=0,this.redraw(e),this.notify("change",{area:o,type:"Area",status:"measured",points:r})}}else{var g=e.toModelWorld([t,i]);if(0==this.step&&(this.viewPort=g[2],-1==g[2]?this.firstPointOutsideVP=!0:this.firstPointOutsideVP=!1),this.finalScreenPoint){var v=e.snapToPoint(this.finalScreenPoint[0],this.finalScreenPoint[1]);this.worldPtForOtherDrawing[this.step]=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]])}else{var v=e.snapToPoint(t,i);this.worldPtForOtherDrawing[this.step]=null}if(this.parallel?this.points[this.step]=this.tmpPoint:this.points[this.step]=v,g[2]!=this.viewPort)return this.points.splice(1,1);this.step++,this.tmpPoint=null;var m=this.points,p=m.length,y=m[0].GetPoint(),w=v.GetPoint();if(p>2&&!f.default.isDesktop()&&this.isClosePath(e,y,w)){this.pressShift=!1,this.parallel=!1,this.viewPort=null;var b=this.getArea(m.slice()),C=[],x=!0,E=!1,k=void 0;try{for(var P,_=m[Symbol.iterator]();!(x=(P=_.next()).done);x=!0){var M=P.value,I=M.GetID()>0&&!e.viewer.IsActiveLayoutElement(M.GetID());C.push({point:M.GetPoint(),isActiveLayoutElement:!I})}}catch(e){E=!0,k=e}finally{try{!x&&_.return&&_.return()}finally{if(E)throw k}}this.notify("change",{area:b,type:"Area",status:"measured",points:C}),this.points=[],this.step=0}else{var S=[],B=!0,D=!1,T=void 0;try{for(var A,L=m[Symbol.iterator]();!(B=(A=L.next()).done);B=!0){var O=A.value,G=O.GetID()>0&&!e.viewer.IsActiveLayoutElement(O.GetID());S.push({point:O.GetPoint(),isActiveLayoutElement:!G})}}catch(e){D=!0,T=e}finally{try{!B&&L.return&&L.return()}finally{if(D)throw T}}this.notify("change",{type:"Area",status:"measuring",points:S})}this.redraw(e)}}},{key:"isClosePath",value:function(e,t,i){var n=e.toScreenPoint(t),o=e.toScreenPoint(i);return Math.abs(n[0]-o[0])<6&&Math.abs(n[1]-o[1])<6}},{key:"getArea",value:function(e){for(var t=e.length,i=0;i<t;i++)e[i]=this.worldPtForOtherDrawing[i]||e[i].GetPoint();if(t<3)return 0;for(var n=e[0][1]*(e[t-1][0]-e[1][0]),i=1;i<t;++i)n+=e[i][1]*(e[i-1][0]-e[(i+1)%t][0]);return Math.abs(n/2)}}]),t}(c.default);t.default=m},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(5),u=n(l),c=i(0),h=n(c),d=i(2),f=(n(d),function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,e),s(t,[{key:"end",value:function(e,t,i,n){if(!(this.showMask||this.needMaskVPId>0)){if(this.isPanMode(n)){if(this.sameAsMousedownPt(t,i)){if(0==this.points.length)return;this.reset(),this.notify("change",{type:"Angle",status:"reset"})}}else{var o=e.toModelWorld([t,i]);if(0==this.step&&(this.points=[],this.viewPort=o[2],-1==o[2]?this.firstPointOutsideVP=!0:this.firstPointOutsideVP=!1),this.parallel||(this.finalScreenPoint?(this.points[this.step]=e.snapToPoint(this.finalScreenPoint[0],this.finalScreenPoint[1]),this.worldPtForOtherDrawing[this.step]=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]])):(this.points[this.step]=e.snapToPoint(t,i),this.worldPtForOtherDrawing[this.step]=null)),this.step>0){var r=this.points[this.step].GetPoint(),a=this.points[this.step-1].GetPoint();if(r[0]==a[0]&&r[1]==a[1])return}if(o[2]!=this.viewPort)return this.points.splice(1,1);if(this.step=this.step+1,this.tmpPoint=null,this.step>=3){for(var s=[],l=this.points,u=0;u<l.length;u++){var c=l[u].GetPoint();if(this.worldPtForOtherDrawing[u])c=this.worldPtForOtherDrawing[u];else if(this.points[u].GetID()){var d=e.toScreenPoint(c),f=e.toModelWorld(d);f[2]>0&&(c=f)}s.push(c)}"X"==this.parallel?s[2][0]=s[0][0]:"Y"==this.parallel&&(s[2][1]=s[0][1]);var g=h.default.angleByArr(s[0],s[1],s[2]);this.notify("change",{angle:g,type:"Angle",status:"measured",points:s,isOnLayout:o[2]>0}),this.points=[],this.step=0,this.pressShift=!1,this.parallel=!1,this.viewPort=null}else{for(var v=[],m=0;m<this.points.length;m++)v.push(this.points[0].GetPoint());this.notify("change",{type:"Angle",status:"measuring",points:v})}}this.redraw(e)}}}]),t}(u.default));t.default=f},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(26),s=n(a),l=i(8),u=n(l),c=i(11),h=n(c),d=function(){function e(){o(this,e)}return r(e,null,[{key:"initialize",value:function(t){void 0!==t&&(e.ready=t);var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",i.appendChild(n)}},{key:"ready",value:function(){console.log("Drawing2D engine is ready!")}},{key:"onLoadProgress",value:function(e){console.log(e)}},{key:"loadModel",value:function(e,t,i){console.log("not implemented!")}},{key:"addModel",value:function(e,t,i){console.log("not implemented!")}},{key:"createDrawing",value:function(t){var i=document.getElementById(t),i=document.getElementById(t),n=document.createElement("canvas");n.id=t+"-main-drawing",n.width=i.clientWidth,n.height=i.clientHeight,n.style.position="absolute",i.appendChild(n);var o=BimButterfly({canvas:n}),r={preserveDrawingBuffer:!0};n.getContext("webgl",r);for(var a=new o.DrawingView("No.1");e.drawingIDs.indexOf(a.ptr)>-1;)a=new o.DrawingView("No.1");e.drawingIDs.push(a.ptr),a.Create(i.clientWidth,i.clientHeight);var l=document.createElement("canvas");l.id=t+"-aux-drawing",l.width=i.clientWidth,l.height=i.clientHeight,l.style.position="absolute",i.appendChild(l);var u=document.createElement("canvas");return u.id=t+"-ovl-drawing",u.width=i.clientWidth,u.height=i.clientHeight,u.style.position="absolute",i.appendChild(u),new s.default(n,l,u,t,a,o)}},{key:"createMouseEditorManager",value:function(e){return new h.default(e)}},{key:"createTouchEditorManager",value:function(e){var t=new u.default(e);return e.auxMobileMeasureTool=t.auxMobileMeasureTool,t}}]),e}();d.sdkUrl="js/",d.drawingIDs=[],t.default=d},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(27),s=n(a),l=i(6),u=n(l),c=i(7),h=n(c),d=function(){function e(t,i,n,r,a,l){o(this,e),console.log(a.GetId());var c=document.getElementById(r);this.width=c.clientWidth,this.height=c.clientHeight,this.viewer=a,this.translateX=void 0!=a.translateX?a.translateX:0,this.translateY=void 0!=a.translateY?a.translateY:0,this.divId=r,this.dom=c,this.dc=s.default.create(t,i,n),this.ratio=1.1,this.drawHandle=null,this.scale=1,this.snapDistance=5,this.hover=!0,this.bindRendering=this.rendering.bind(this),this.butterfly=l,this.customManager=new u.default,this.onViewChanges=function(){};var h=this;this.dc.overlayDrawers.custom=function(e){h.customManager.draw(h,e)},this.sendHighlightMsg=!0,this.url=void 0!=a.url?a.url+"/":null,this.model={Url:void 0!=a.url?a.url+"/":null}}return r(e,[{key:"getUrl",value:function(){return this.url}},{key:"setUrl",value:function(e){this.url=e}},{key:"setZoomRatio",value:function(e){this.ratio=e}},{key:"getZoomRatio",value:function(){return this.ratio}},{key:"getViewScale",value:function(e){return this.scale}},{key:"setViewScale",value:function(e){this.scale=e}},{key:"setSnapDistance",value:function(e){this.snapDistance=e}},{key:"snapshot",value:function(e){var t=this.dc.canvasMain,i=(this.dc.canvasOverlay,this.getDivId()),n=document.getElementById(i),o=document.createElement("canvas");o.width=n.clientWidth,o.height=n.clientHeight;var r=o.getContext("2d");return r.beginPath(),r.fillStyle=e||t.style.background,r.fillRect(0,0,o.width,o.height),r.drawImage(t,0,0),o.toDataURL()}},{key:"snapshotPure",value:function(){var e=this.dc.canvasMain,t=(this.dc.canvasOverlay,this.getDivId()),i=document.getElementById(t),n=document.createElement("canvas");n.width=i.clientWidth,n.height=i.clientHeight;var o=n.getContext("2d");return o.beginPath(),o.drawImage(e,0,0),n}},{key:"setBackgroundColor",value:function(e){this.dc.setBackgroundColor(e)}},{key:"showFilledFace",value:function(e){this.viewer.FilledFace=e}},{key:"isShowFilledFace",value:function(){return this.viewer.FilledFace}},{key:"setModel",value:function(e){if(console.error("abondon! DON't use this function"),this.viewer.SetModel(e),this.dc.setResourceUrl(e.Url),this.viewer.UpdateVisibleSettings(),void 0!=e.indexJson.sealImages){var t;for(t=0;t<e.indexJson.sealImages.length;++t){var i=e.indexJson.sealImages[t],n=i.path,o=n.split("\\"),r=o[o.length-1];this.viewer.AddSealImage(r,parseFloat(i.x),parseFloat(i.y),parseFloat(i.width),parseFloat(i.height))}}}},{key:"rendering",value:function(){this.viewer.Draw(),this.rendering(),this.updateOverlays()}},{key:"getDivId",value:function(){return this.divId}},{key:"getModel",value:function(){return console.log("carefully to use getModel()"),this.model}},{key:"getViewAngle",value:function(){return this.viewer.GetViewAngle()}},{key:"setViewAngle",value:function(e){this.viewer.SetViewAngle(e)}},{key:"getLayers",value:function(){for(var e=[],t=this.viewer.GetLayerIds(),i=0,n=t.size();i<n;++i){var o=t.at(i),r=this.viewer.GetLayer(o);null!=r?e.push({id:r.id,name:r.name,color:r.color,visible:r.visible}):console.log("Layer not found!"+o)}return e}},{key:"changeLayers",value:function(e){for(var t=0;t<e.length;++t){var i=e[t];i.visible?this.viewer.ShowByLayerId(i.id):this.viewer.HideByLayerId(i.id)}}},{key:"getLayouts",value:function(){for(var e=[],t=this.viewer.GetLayoutIds(),i=this.viewer.GetLayoutNames(),n=0,o=t.size();n<o;++n){var r=t.at(n);e.push({id:r,name:i.at(n)})}return e}},{key:"activeLayoutById",value:function(e){this.viewer.ActiveLayout(e),this.update()}},{key:"getActiveLayoutId",value:function(){return this.viewer.GetActiveLayoutId()}},{key:"isModelView",value:function(){return 0==this.getActiveLayoutId()}},{key:"updateOverlays",value:function(){this.dc.drawingOverlay(this.width,this.height,this)}},{key:"update",value:function(e){function t(){i.viewer.Draw()>0?i.drawHandle=requestAnimationFrame(t):(i.drawHandle=null,i.updateOverlays())}1==e&&this.onViewChanges(),this.viewer.RequestDraw();var i=this;null!==i.drawHandle&&cancelAnimationFrame(i.drawHandle),this.minimap&&this.minimap.update(),i.drawHandle=requestAnimationFrame(t)}},{key:"onResize",value:function(){this.resize(this.dom.clientWidth,this.dom.clientHeight)}},{key:"clearAll",value:function(){this.viewer.ReleaseModel(),this.dc.clearAll(this.width,this.height)}},{key:"resize",value:function(e,t){this.width=e||this.dom.clientWidth,this.height=t||this.dom.clientHeight,this.dc.resize(e,t),
this.viewer.Resize(e,t),this.update(),this.onViewChanges()}},{key:"zoomToExtent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.viewer.ZoomToExtent(e),this.onViewChanges()}},{key:"zoomToObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;("string"==typeof e||e instanceof String)&&(e=parseInt(e)),this.viewer.ZoomToElement(e,t),this.onViewChanges()}},{key:"zoomToObjectWithBlock",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this.viewer.ZoomToElementWithBlock(e,t,i),this.onViewChanges()}},{key:"zoomToWorldBox",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;this.viewer.ZoomToWorldBoxMinMax(e[0],e[1],e[2],t[0],t[1],t[2],i)}},{key:"setStartPoint",value:function(e,t){this.startX=e,this.startY=t}},{key:"zoom",value:function(e,t,i,n){this.viewer.ZoomToRect(e,t,i,n),this.update(!0),this.onViewChanges()}},{key:"panTo",value:function(e,t){return this.startX&&this.startY?(this.offsetX=e-this.startX,this.offsetY=t-this.startY,(0!=this.offsetX||0!=this.offsetY)&&(this.viewer.Pan(this.offsetX,this.offsetY),this.update(),this.startX=e,this.startY=t,this.onViewChanges(),!0)):(this.startX=e,this.startY=t,!1)}},{key:"zoomPan",value:function(e,t,i){this.offsetX=(t||this.width/2)-this.width/2,this.offsetY=(i||this.height/2)-this.height/2,this.viewer.ZoomPan(this.offsetX,this.offsetY,e),this.update(),this.onViewChanges()}},{key:"preSelect",value:function(e,t,i){return i?this.viewer.PreSelect(this.startX,this.startY,e,t):this.viewer.PreSelect(e,t,e,t)}},{key:"select",value:function(){this.viewer.Select()}},{key:"getSelectedIds",value:function(){for(var e=[],t=this.viewer.GetSelection(),i=0,n=t.size();i<n;++i)e.push(t.at(i));return e}},{key:"getHighlightIds",value:function(){for(var e=[],t=this.viewer.GetHighlightIds(),i=0,n=t.size();i<n;++i)e.push(t.at(i));return e}},{key:"clearSelection",value:function(){this.viewer.ClearSelection(),this.hover||this.viewer.ClearHighlight()}},{key:"clearHighlight",value:function(){this.viewer.ClearHighlight()}},{key:"selectByIds",value:function(e){var t=this.viewer.GetSelection();t.clear();for(var i=0,n=e.length;i<n;++i)t.push_back(parseInt(e[i]));this.viewer.SelectIds(t)}},{key:"highlightById",value:function(e){this.viewer.HighlightId(parseInt(e))}},{key:"getObjectBoundingBox",value:function(e){var t=this.viewer.GetObjectBoundingBox(e),i=t.GetMinPt(),n=t.GetMaxPt();return[[i.x+this.translateX,i.y+this.translateY,i.z],[n.x+this.translateX,n.y+this.translateY,n.z]]}},{key:"getViewportBBox",value:function(e){var t=this.viewer.GetViewportBBox(e),i=t.GetMinPt(),n=t.GetMaxPt();return{min:[i.x,i.y],max:[n.x,n.y]}}},{key:"enableHover",value:function(e){this.hover=e}},{key:"normalizePt",value:function(e){return e.constructor==Array?void 0==e[2]?{x:e[0],y:e[1]}:{x:e[0],y:e[1],z:e[2]}:void 0!=e.x&&void 0!=e.y?e:null}},{key:"toWorldPoint",value:function(e){var t=this.normalizePt(e),i=this.viewer.ToWorldPointXY(t.x,t.y);return[i.x+this.translateX,i.y+this.translateY]}},{key:"toScreenPoint",value:function(e){var t=this.normalizePt(e);t.x=t.x-this.translateX,t.y=t.y-this.translateY;var i=this.viewer.ToScreenPointXY(t.x,t.y);return[i.x,i.y]}},{key:"toViewportScreenPoint",value:function(e){var t=this.normalizePt(e);t.x=t.x-this.translateX,t.y=t.y-this.translateY;var i=this.viewer.ToViewportScreenPointXY(t.x,t.y);return[i.x,i.y,i.z]}},{key:"toModelWorld",value:function(e){var t=this.normalizePt(e),i=this.viewer.ToModelWorldPointXY(t.x,t.y);return[i.x+this.translateX,i.y+this.translateY,i.z]}},{key:"snapToPoint",value:function(e,t,i){void 0==i&&(i=this.snapDistance);var n=this.viewer.SnapToPoint(e,t,i),o=[n.snapPoint.x+this.translateX,n.snapPoint.y+this.translateY,void 0!=n.snapPoint.z?n.snapPoint.z:-1],r=["None","Vertex","PointOnLine","Inner","PointInText","FootPoint","MiddlePoint","EndPoint","Intersection"],a=n.snapID,s=n.snapType;return{GetPoint:function(){return o},GetID:function(){return a},GetSnapType:function(){return s},GetSnapTypeName:function(){return n.snapType<r.length?r[s]:r[0]}}}},{key:"snapToPoint2",value:function(e,t,i,n,o){void 0==o&&(o=this.snapDistance);var r=this.viewer.SnapToPoint2(e,t,i,n,o),a={x:r.snapPoint.x+this.translateX,y:r.snapPoint.y+this.translateY,z:void 0!=r.snapPoint.z?r.snapPoint.z:-1},s=["None","Vertex","PointOnLine","Inner","PointInText","FootPoint","MiddlePoint","EndPoint","Intersection"],l=r.snapID,u=r.snapType;return{GetPoint:function(){return a},GetID:function(){return l},GetSnapType:function(){return u},GetSnapTypeName:function(){return r.snapType<s.length?s[r.snapType]:s[0]}}}},{key:"getZoomFactor",value:function(){var e=this.viewer.GetWorldSize();return this.viewer.GetWorldScale()/Math.min(1/e.x,1/e.y)}},{key:"getState",value:function(){var e={ver:1,WorldScale:this.viewer.GetWorldScale(),ViewAngle:this.viewer.GetViewAngle(),ViewCenter:{x:this.viewer.GetViewCenter().x,y:this.viewer.GetViewCenter().y},ZoomFactor:this.getZoomFactor()};return JSON.stringify(e)}},{key:"setState",value:function(e){var t=JSON.parse(e);if(1!==t.ver)return!1;this.viewer.SetWorldScale(t.WorldScale),this.viewer.SetViewAngle(t.ViewAngle);var i;return i=t.ViewCenter instanceof Array?{x:t.ViewCenter[0],y:t.ViewCenter[1]}:{x:t.ViewCenter.x,y:t.ViewCenter.y},this.viewer.SetViewCenter(i.x,i.y),this.viewer.UpdateViewMatrix(),!0}},{key:"showElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.ShowElementBox(e)}},{key:"showElementBoxByBBox",value:function(e,t){e&&this.customManager.add([e[0][0],e[0][1]],[e[1][0],e[1][1]],t)}},{key:"setElementBoxColor",value:function(e,t,i,n){this.customManager.setColor(e,t,i,n)}},{key:"getElementBoxColor",value:function(){return this.customManager.getColor()}},{key:"getElementBoxStyle",value:function(){return this.customManager.getStyle()}},{key:"setElementBoxStyle",value:function(e){this.customManager.setStyle(e)}},{key:"hideElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.HideElementBox(e)}},{key:"clearElementBox",value:function(){this.viewer.ClearElementBox(),this.customManager.clear()}},{key:"getVisibleBoxIds",value:function(){for(var e=[],t=this.viewer.GetVisibleBoxIds(),i=0;i<t.size();++i)e.push(t.get(i));return e}},{key:"enableHighlightEvent",value:function(e){this.sendHighlightMsg=e}},{key:"isHighlightEventEnabled",value:function(){return this.sendHighlightMsg}},{key:"addClickCallback",value:function(e){this.clickCallback=e}},{key:"getClickCallback",value:function(){return this.clickCallback}},{key:"getModelBBox",value:function(){var e=this.viewer.GetModelBBox(),t=e.GetMinPt(),i=e.GetMaxPt();return new function(e,t,i,n){this.GetMinPt=function(){return[e.x+i,e.y+n,e.z]},this.GetMaxPt=function(){return[t.x+i,t.y+n,t.z]}}(t,i,this.translateX,this.translateY)}},{key:"enableSelectInBlock",value:function(){this.viewer.EnableSelectInBlock()}},{key:"disableSelectInBlock",value:function(){this.viewer.DisableSelectInBlock()}},{key:"canSelectInBlock",value:function(){return this.viewer.CanSelectInBlock()}},{key:"getSelectionWithBlock",value:function(){return this.viewer.GetSelectionWithBlock()}},{key:"GetHighlightIdsWithBlock",value:function(){return this.viewer.GetHighlightIdsWithBlock()}},{key:"highlightIdWithBlock",value:function(e,t){this.viewer.HighlightIdWithBlock(e,t)}},{key:"selectIdWithBlock",value:function(e,t){this.viewer.SelectIdWithBlock(e,t)}},{key:"createMinimap",value:function(e,t,i,n){if(0==this.isModelView())return void console.warn("Only model view support minimap.");void 0==this.minimap&&(this.minimap=new h.default(e,t,i,n),this.minimap.setDrawingImpl(this),this.minimap.initialize())}},{key:"enableMinimap",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.enableMiniMap(e)}},{key:"setMinimapBoundingBox",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.setDrawingContentsBbox(e)}},{key:"setMinimapOffset",value:function(e){this.minimap.setOffset(e)}},{key:"hasMinimap",value:function(){return 0==this.isModelView()?void console.warn("Only model view support minimap."):void 0!=this.minimap}},{key:"setGlobalColor",value:function(e){this.dc.printMode==this.dc.Custom&&(this.dc.customColor=e),this.dc.globalColor=e,this.setElementColor(e.red,e.green,e.blue,e.alpha)}},{key:"restoreGlobalColor",value:function(){this.dc.printMode==this.dc.Custom?this.setGlobalColor({red:128,green:128,blue:128,alpha:1}):this.dc.printMode==this.dc.Black?this.setGlobalColor({red:0,green:0,blue:0,alpha:1}):this.viewer.RestoreGlobalColor()}},{key:"getGlobalColor",value:function(){return this.dc.globalColor}},{key:"setPrintMode",value:function(e){this.dc.setPrintMode(e),"Black"==e?(this.setGlobalColor({red:0,green:0,blue:0,alpha:1}),this.viewer.RestoreOverrideElementsColor()):"Custom"==e?(this.setGlobalColor(this.dc.customColor),this.viewer.RestoreOverrideElementsColor()):(this.viewer.RestoreGlobalColor(),this.viewer.RestoreOverrideElementsColor())}},{key:"overrideElementsColorById",value:function(e,t){var i=.0039*t.red,n=.0039*t.green,o=.0039*t.blue,r=new this.butterfly.ObjectIDList;r.clear();for(var a=0,s=e.length;a<s;a++)r.push_back(e[a]);this.viewer.OverrideElementsColorById(r,i,n,o,t.alpha),this.update()}},{key:"restoreElementsColorById",value:function(e){var t=new this.butterfly.ObjectIDList;t.clear();for(var i=0,n=e.length;i<n;i++)t.push_back(e[i]);this.viewer.RestoreElementsColorById(t),this.update()}},{key:"setClearColor",value:function(e,t,i,n){var o=.0039*e,r=.0039*t,a=.0039*i;this.viewer.SetClearColor(o,r,a,n)}},{key:"setElementColor",value:function(e,t,i,n){var o=.0039*e,r=.0039*t,a=.0039*i;this.viewer.SetGlobalColor(o,r,a,n)}},{key:"alignDrawing",value:function(e,t){this.viewer.AlignDrawing(e[0],e[1],t[0],t[1])}},{key:"getAlignTranslate",value:function(){var e=this.viewer.GetAlignTranslate();return[e.x,e.y]}},{key:"scaleDrawing",value:function(e,t){this.viewer.AlignDrawingWithScale(e[0],e[1],t),this.update()}},{key:"getAlignScale",value:function(){return this.viewer.GetAlignScale()}},{key:"getAlignState",value:function(){var e=this.viewer.GetAlignMatrixCol(0),t={x:e.x,y:e.y,z:e.z,w:e.w},i=this.viewer.GetAlignMatrixCol(1),n={x:i.x,y:i.y,z:i.z,w:i.w},o=this.viewer.GetAlignMatrixCol(2),r={x:o.x,y:o.y,z:o.z,w:o.w},a=this.viewer.GetAlignMatrixCol(3),s={x:a.x,y:a.y,z:a.z,w:a.w},l={ver:1,AlignMatrixCol1:[t.x,t.y,t.z,t.w],AlignMatrixCol2:[n.x,n.y,n.z,n.w],AlignMatrixCol3:[r.x,r.y,r.z,r.w],AlignMatrixCol4:[s.x,s.y,s.z,s.w]};return JSON.stringify(l)}},{key:"setAlignState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(void 0!=t.AlignMatrixCol1&&null!=t.AlignMatrixCol1&&(this.viewer.SetAlignMatrixCol(0,t.AlignMatrixCol1[0],t.AlignMatrixCol1[1],t.AlignMatrixCol1[2],t.AlignMatrixCol1[3]),this.viewer.SetAlignMatrixCol(1,t.AlignMatrixCol2[0],t.AlignMatrixCol2[1],t.AlignMatrixCol2[2],t.AlignMatrixCol2[3]),this.viewer.SetAlignMatrixCol(2,t.AlignMatrixCol3[0],t.AlignMatrixCol3[1],t.AlignMatrixCol3[2],t.AlignMatrixCol3[3]),this.viewer.SetAlignMatrixCol(3,t.AlignMatrixCol4[0],t.AlignMatrixCol4[1],t.AlignMatrixCol4[2],t.AlignMatrixCol4[3])),this.viewer.UpdateViewMatrix(),!0)}},{key:"activeDrawing",value:function(e){this.viewer.ActiveDrawing(e)}},{key:"getActiveDrawing",value:function(){return this.viewer.GetActiveDrawingIndex()}},{key:"getDrawingCount",value:function(){return this.viewer.GetDrawingCount()}},{key:"replaceElementColor",value:function(e,t,i,n,o,r){this.viewer.RaplaceElementColor(e,t,i,n,o,r)}},{key:"enableReplaceElementColor",value:function(e){this.viewer.EnableRaplaceElementColor(e)}},{key:"enableViewport",value:function(e){this.viewer.EnaleViewport(e),this.update()}},{key:"getLayerIdFromElementId",value:function(e){return this.viewer.GetLayerIdFromElementId(e)}},{key:"hideElementsById",value:function(e){var t=new this.butterfly.ObjectIDList;t.clear();for(var i=0,n=e.length;i<n;i++)t.push_back(e[i]);this.viewer.HideElementsById(t)}},{key:"showElementsById",value:function(e){var t=new this.butterfly.ObjectIDList;t.clear();for(var i=0,n=e.length;i<n;i++)t.push_back(e[i]);this.viewer.ShowElementsById(t)}},{key:"showAllElements",value:function(){this.viewer.ShowAllElements()}},{key:"getCustomManager",value:function(){return this.customManager}},{key:"setSnapMode",value:function(e){this.snapMode=e}},{key:"getSnapMode",value:function(){return this.snapMode}},{key:"setSelectWireframeColor",value:function(e,t,i,n){this.viewer.SetSelectWireframeColor(e,t,i,n)}}]),e}();t.default=d},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=function(){function e(){n(this,e)}return o(e,[{key:"initialize",value:function(e,t,i){this.canvasMain=e,this.canvasTemp=t,this.canvasOverlay=i,this.ctxMain=this.canvasMain.getContext("2d"),this.ctxTemp=this.canvasTemp.getContext("2d"),this.ctxOverlay=this.canvasOverlay.getContext("2d"),this.inPath=!1,this.fontSize=12,this.colorTable={},this.faceColorTable={},this.globalOpacity=null,this.Normal=0,this.White=1,this.Black=2,this.Gray=3,this.Custom=4,this.printMode=this.Normal,this.printColorTable={},this.printFaceColorTable={},this.resUrl="",this.images={},this.ignoreImage=!1,this.targetId=0,this.overlayDrawers={},this.customColor={red:128,green:128,blue:128,alpha:1},this.globalColor=this.customColor}},{key:"drawingOverlay",value:function(e,t,i){var n=this.ctxOverlay;n.clearRect(0,0,e,t);var o=this.overlayDrawers;for(var r in o)o[r](n);var a=i.mouseEditorMgr.getEditor().auxMobileMeasureTool;a&&a.redraw()}},{key:"setBackgroundColor",value:function(e){this.canvasMain.style.background=e}},{key:"setPrintMode",value:function(e){if("Normal"==e)this.printMode=this.Normal;else if("Gray"==e)this.printMode=this.Gray;else if("Black"==e)this.printMode=this.Black;else if("White"==e)this.printMode=this.White;else{if("Custom"!=e)return;this.printMode=this.Custom}}},{key:"setResourceUrl",value:function(e){this.resUrl=e}},{key:"setGlobalOpacity",value:function(e){this.globalOpacity=e}},{key:"getGlobalOpacity",value:function(){return this.globalOpacity}},{key:"restoreGlobalOpacity",value:function(){this.globalOpacity=null}},{key:"getHexColor",value:function(e){var t=null===this.globalOpacity?1:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var r=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printColorTable[e]="rgba("+r+","+r+","+r+","+t+")",this.printColorTable[e]}return this.colorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.colorTable[e]}},{key:"getFaceColor",value:function(e){var t=null===this.globalOpacity?.9:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var r=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printFaceColorTable[e]="rgba("+r+","+r+","+r+","+t+")",this.printFaceColorTable[e]}return this.faceColorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.faceColorTable[e]}},{key:"resize",value:function(e,t){this.canvasMain.setAttribute("width",e),this.canvasMain.setAttribute("height",t),this.canvasTemp.setAttribute("width",e),this.canvasTemp.setAttribute("height",t),this.canvasOverlay.setAttribute("width",e),this.canvasOverlay.setAttribute("height",t)}},{key:"clearAll",value:function(e,t){this.ctxTemp.clearRect(0,0,e,t),this.ctxOverlay.clearRect(0,0,e,t)}},{key:"SetTarget",value:function(e){0==e?this.ctx=this.ctxMain:(this.ctx=this.ctxTemp,this.ctx.strokeStyle="#ff0000"),this.targetId=e}},{key:"BeginDraw",value:function(e,t){this.ctx.clearRect(t[0],t[1],t[2],t[3])}},{key:"EndDraw",value:function(e){}},{key:"BeginPath",value:function(){this.inPath=!0,this.ctx.beginPath()}},{key:"EndPath",value:function(e,t){this.inPath=!1,e&&(this.ctx.fillStyle=this.getFaceColor(t),this.ctx.closePath(),this.ctx.fill()),this.ctx.stroke()}},{key:"BeginClip",value:function(e){e&&(this.ctx.save(),this.ctx.clip())}},{key:"EndClip",value:function(e){e&&this.ctx.restore()}},{key:"SetLineColor",value:function(e){var t=this.getHexColor(e);this.ctx.strokeStyle=t,this.ctx.fillStyle=t}},{key:"SetLineWidth",value:function(e){this.ctx.lineWidth=e}},{key:"SetLineDash",value:function(e,t){if(0==e)return void this.ctx.setLineDash([]);if(1==e)return void this.ctx.setLineDash([10]);for(var i=[],n=0,o=t.size();n<o;++n)i.push(t.get(n));this.ctx.setLineDash(i)}},{key:"SetFont",value:function(e){this.fontSize=e,this.ctx.font=this.fontSize+"px 仿宋"}},{key:"DrawPoint",value:function(e,t,i){}},{key:"DrawLine",value:function(e,t){if(this.inPath)this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(t[0],t[1]);else{for(var i=this.ctx.getLineDash(),n=0,o=0;o<i.length;++o)n+=i[o];this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])<n*n&&this.ctx.setLineDash([]),this.ctx.lineTo(t[0],t[1]),this.ctx.stroke(),this.ctx.setLineDash(i)}}},{key:"DrawArc",value:function(e,t,i,n){this.inPath?this.ctx.arc(e[0],e[1],t,-i,-n,!0):(this.ctx.beginPath(),this.ctx.arc(e[0],e[1],t,-i,-n,!0),this.ctx.stroke())}},{key:"DrawRec",value:function(e,t){this.inPath?this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]):(this.ctx.beginPath(),this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]),this.ctx.stroke())}},{key:"DrawCloudRec",value:function(e,t,i){var n=e,o=t;i=i||this.ctx,n=[n[0]+18/3.5,n[1]+18/3.5],o=[o[0]-18/3.5,o[1]-18/3.5];var r=o[1]-n[1],a=o[0]-n[0],s=Math.abs(a),l=Math.abs(r),u=parseInt(s/18),c=parseInt(l/18),h=0==u?s:s/u,d=0==c?l:l/c;i.beginPath(),this.drawSide("orientation",h,s,n[0],n[1],i),this.drawSide("orientation",h,s,n[0]+s,n[1]+l,i,!0),this.drawSide("portrait",d,l,n[0]+s,n[1],i),this.drawSide("portrait",d,l,n[0],n[1]+l,i,!0),i.stroke()}},{key:"drawSide",value:function(e,t,i,n,o,r,a){var s=0,l=0,u=i/t,c=void 0,h=n,d=o;"orientation"==e?s=t:l=t;for(var f=0;f<u;f++){r.moveTo(n,o),c=a?[n-s,o-l]:[n+s,o+l],s&&Math.abs(c[0]-h)>i?c[0]=a?h-i:h+i:l&&Math.abs(c[1]-d)>i&&(c[1]=a?d-i:d+i);var g=this.getControlPt([n,o],c);r.quadraticCurveTo(g[0],g[1],c[0],c[1]),n=c[0],o=c[1]}}},{key:"getControlPt",value:function(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=.4*a.default.distanceByArr(e,t),r=[t[1]-e[1],e[0]-t[0]];return r=a.default.normalize(r),[n[0]+r[0]*o,n[1]+r[1]*o]}},{key:"DrawPolyline",value:function(e){var t=e.size();if(!(t<1))if(this.inPath){this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var i=1;i<t;++i)this.pt=e.get(i),this.ctx.lineTo(this.pt[0],this.pt[1])}else{for(var n=this.ctx.getLineDash(),o=0,r=0;r<n.length;++r)o+=n[r];this.ctx.beginPath(),this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var a=1;a<t;++a){var s=(this.pt[0]-e.get(a)[0])*(this.pt[0]-e.get(a)[0])+(this.pt[1]-e.get(a)[1])*(this.pt[1]-e.get(a)[1]);s<o*o?this.ctx.setLineDash([]):this.ctx.setLineDash(n),this.pt=e.get(a),this.ctx.lineTo(this.pt[0],this.pt[1]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.pt[0],this.pt[1])}this.ctx.setLineDash(n)}}},{key:"DrawText",value:function(e,t){this.ctx.fillText(e,t[0],t[1])}},{key:"DrawTextW",value:function(e,t,i){0!=i?(this.ctx.save(),this.ctx.translate(t[0],t[1]),this.ctx.rotate(i),this.ctx.fillText(e,0,0),this.ctx.restore()):this.ctx.fillText(e,t[0],t[1])}},{key:"DrawImageImpl",value:function(e,t,i,n,o,r,a){function s(t,i,n,o,r,a){0==a?e.drawImage(t,i,n,o,r):(e.save(),e.translate(i,n+r),e.rotate(a),e.drawImage(t,0,-r,o,r),e.restore())}var l=this,u=l.images[t];if(l.ignoreImage)return!1;void 0===u?(u=new Image,u.onload=function(){s(u,i,n,o,r,a),l.images[t]=u},u.src=t):s(u,i,n,o,r,a)}},{key:"DrawImage",value:function(e,t,i,n,o,r){this.DrawImageImpl(this.ctx,this.resUrl+"image/"+e,t,i,n,o,r)}}],[{key:"create",value:function(t,i,n){var o=new e;return o.initialize(t,i,n),o}}]),e}();t.default=s},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){n(this,e),this.revitIds={}}return o(e,[{key:"initialize",value:function(e){function t(e){return new Promise(function(t,i){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200==n.status||0==n.status?t(JSON.parse(n.response)):i(n.statusText)},n.send()})}var i=this;i.revitIds={},i.linkRevitIds={},i.revitToCad={};var n,o=e.getModel().Url,r=o+"index.json",a=o+"revitIds.json",s=!1,l=".gz";t(r).then(function(e){return n=e,0!=e.metadata.gz&&"false"!=e.metadata.gz||(l=""),a+=l,t(a)},function(e){console.warn(e)}).then(function(e){if(i.revitIds=e,n.metadata.hasOwnProperty("links")&&""!=n.metadata.links)return s=!0,r=o+n.metadata.links,t(r)}).then(function(n){if(0!=s){i.linkRevitIds=n,n&&e.enableSelectInBlock();var r=[],a=[];for(var u in i.linkRevitIds)if(0!=u){var c=o+"links/"+u+".json"+l,h=t(c);a.push(h),r.push(u)}Promise.all(a).then(function(e){for(var t=0;t<e.length;t++){var n=e[t],o={};for(var a in n)i.revitIds[a]=n[a],o.hasOwnProperty(n[a])||(o[n[a]]=[]),o[n[a]].push(a);var s=r[t];i.revitToCad[i.linkRevitIds[s]]=o}})}},function(e){console.warn(e)})}},{key:"toRevitId",value:function(e){return this.revitIds[e]}},{key:"toLinkRevitId",value:function(e,t){return 0==e||void 0==this.linkRevitIds?this.toRevitId(t):this.linkRevitIds.hasOwnProperty(e)?{fileId:this.linkRevitIds[e],revitId:this.toRevitId(t)}:this.toRevitId(e)}},{key:"fromRevitId",value:function(e){var t=this.revitIds;for(var i in t)if(t[i]==e)return i}},{key:"fromLinkRevitId",value:function(e,t){if(0==e||void 0==this.linkRevitIds||""==e)return this.fromRevitId(t);var i=0;for(var n in this.linkRevitIds)this.linkRevitIds[n]==e&&(i=n);var o=this.revitToCad[e];return o?{blockId:i,ids:o[t]}:null}}]),e}();t.default=r}]),window.Glodon=Glodon$1;