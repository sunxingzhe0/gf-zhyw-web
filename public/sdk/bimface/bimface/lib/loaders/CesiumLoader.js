"use strict";function _defineProperty(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function BDImageryProvider(e){this._url="https://api.map.baidu.com/customimage/tile?udt=20181205&scale=1&ak=1XjLLEhZhQNUzd93EjU5nOGQ&customid=white",this._tileWidth=256,this._tileHeight=256,this._maximumLevel=18,this._height=33746824,this._width=33554054;var i=new Cesium.Cartesian2(-this._width,-this._height),t=new Cesium.Cartesian2(this._width,this._height);this._tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:i,rectangleNortheastInMeters:t}),this._credit=void 0,this._rectangle=this._tilingScheme.rectangle,this._ready=!0}function buildImageUrl(e,i,t,r){var a=e._url+"&x={x}&y={y}&z={z}",n=e._tilingScheme.getNumberOfXTilesAtLevel(r),s=e._tilingScheme.getNumberOfYTilesAtLevel(r);return a=a.replace("{x}",i-n/2).replace("{y}",s/2-t-1).replace("{z}",r)}function createAMapByUrl(e,i){i=e.defaultValue(i,{});var t=e.defaultValue(i.url,"//webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"),r=new e.Credit("AMap"),a=new e.WebMercatorTilingScheme({ellipsoid:i.ellipsoid}),n=e.defaultValue(i.minimumLevel,0),s=e.defaultValue(i.minimumLevel,18),o=e.defaultValue(i.rectangle,a.rectangle),l=a.positionToTileXY(e.Rectangle.southwest(o),n),u=a.positionToTileXY(e.Rectangle.northeast(o),n),m=(Math.abs(u.x-l.x)+1)*(Math.abs(u.y-l.y)+1);if(m>4)throw new e.DeveloperError("The rectangle and minimumLevel indicate that there are "+m+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");var c=e.defaultValue(i.credit,r);return"string"==typeof c&&(c=new e.Credit(c)),new e.UrlTemplateImageryProvider({url:t,proxy:i.proxy,credit:c,tilingScheme:a,tileWidth:256,tileHeight:256,minimumLevel:n,maximumLevel:s,rectangle:o})}var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(i,t,r){return t&&e(i.prototype,t),r&&e(i,r),i}}(),CLOUD=CLOUD||{};Cesium.defineProperties(BDImageryProvider.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),BDImageryProvider.prototype.getTileCredits=function(e,i,t){},BDImageryProvider.prototype.requestImage=function(e,i,t){if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");var r=buildImageUrl(this,e,i,t);return Cesium.ImageryProvider.loadImage(this,r)};var fixGltf=function(e){if(e.extensionsUsed){var i=e.extensionsUsed.indexOf("KHR_technique_webgl");if(-1!==i){e.extensionsRequired.splice(r,1,"KHR_techniques_webgl"),e.extensionsUsed.splice(i,1,"KHR_techniques_webgl"),e.extensions=e.extensions||{},e.extensions.KHR_techniques_webgl={},e.extensions.KHR_techniques_webgl.programs=e.programs,e.extensions.KHR_techniques_webgl.shaders=e.shaders,e.extensions.KHR_techniques_webgl.techniques=e.techniques;var t=e.extensions.KHR_techniques_webgl.techniques;if(e.materials.forEach(function(i,r){e.materials[r].extensions||(e.materials[r].extensions={KHR_technique_webgl:{}}),e.materials[r].extensions.KHR_technique_webgl.values=e.materials[r].values,e.materials[r].extensions.KHR_techniques_webgl=e.materials[r].extensions.KHR_technique_webgl;var a=e.materials[r].extensions.KHR_techniques_webgl;a.technique||(a.technique=e.materials[r].technique);for(var n in a.values){var s=t[a.technique].uniforms;for(var o in s)if(s[o]===n){a.values[o]=a.values[n],delete a.values[n];break}}}),Cesium.defined(e.extensionsRequired)){var r=e.extensionsRequired.indexOf("KHR_technique_webgl");t.forEach(function(e){for(var i in e.attributes){var t=e.attributes[i];e.attributes[i]=e.parameters[t]}for(var r in e.uniforms){var t=e.uniforms[r];e.uniforms[r]=e.parameters[t]}})}}}};Object.defineProperties(Cesium.Model.prototype,{_cachedGltf:{set:function(e){this._vtxf_cachedGltf=e,this._vtxf_cachedGltf&&this._vtxf_cachedGltf._gltf&&fixGltf(this._vtxf_cachedGltf._gltf)},get:function(){return this._vtxf_cachedGltf}}});var CesiumLoader=function(){function e(i){_classCallCheck(this,e),this.container=i.container,this.worldCoordinates=[0,0],this.worldCoordinates[0]=void 0==i.longitude?121.32403:i.longitude,this.worldCoordinates[1]=void 0==i.latitude?31.198192:i.latitude,this.useTerrain=void 0!=i.useTerrain&&i.useTerrain,this.imageryLayer=void 0==i.imageryLayer?CLOUD.EnumCesiumImageryLayerType.AUTO:i.imageryLayer,this.clipHeight=void 0==i.clipHeight?0:i.clipHeight,this.duration=void 0==i.duration?5:i.duration,this.accessToken=i.accessToken,this.globalPlane=void 0,this.viewer=void 0,this.terrainProvider=void 0,this.terrainHeight={},this.globeMatrix=void 0,this.cameraScale=.001,this.viewport=void 0,this.originBimCameraTar=void 0,this.closeToModel=0,this.gdRoadNoLabel=void 0}return _createClass(e,[{key:"init",value:function(e,i){var t=this;this.accessToken&&(Cesium.Ion.defaultAccessToken=this.accessToken),this.useTerrain&&!this.accessToken&&console.warn("when useTerrain,the accessToken can not be null"),this.terrainProvider=Cesium.createWorldTerrain();var r=[Cesium.Cartographic.fromDegrees(this.worldCoordinates[0],this.worldCoordinates[1])],a=Cesium.sampleTerrainMostDetailed(this.terrainProvider,r),n=void 0;switch(t.imageryLayer){case CLOUD.EnumCesiumImageryLayerType.AUTO:n=void 0==t.accessToken&&new Cesium.TileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")});break;case CLOUD.EnumCesiumImageryLayerType.BAIDU:n=new BDImageryProvider;break;case CLOUD.EnumCesiumImageryLayerType.GAODE:var s=createAMapByUrl(Cesium,{url:"//webst01.is.autonavi.com/appmaptile?style=7&x={x}&y={y}&z={z}"});createAMapByUrl(Cesium,{url:"//wprd04.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=11"}),createAMapByUrl(Cesium,{url:"//wprd04.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=12"});n=s;break;case CLOUD.EnumCesiumImageryLayerType.MAPBOX:n=new Cesium.MapboxImageryProvider({mapId:"mapbox.streets-satellite"});break;case CLOUD.EnumCesiumImageryLayerType.GOOGLE:n=n=new Cesium.UrlTemplateImageryProvider({url:"//www.google.cn/maps/vt?lyrs=s&gl=CN&x={x}&y={y}&z={z}",tilingScheme:new Cesium.WebMercatorTilingScheme,minimumLevel:1,maximumLevel:20});break;case CLOUD.EnumCesiumImageryLayerType.ARCGIS:n=new Cesium.ArcGisMapServerImageryProvider({url:"//nationalmap.gov.au/proxy/http://services.ga.gov.au/site_3/rest/services/Electricity_Infrastructure/MapServer"});break;default:n=t.createGoogleMapsByUrl(Cesium,{url:"//mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}"})}!0===t.useTerrain?Cesium.when(a,function(r){t.terrainHeight=r[0].height,t.viewer.terrainProvider=Cesium.createWorldTerrain(),t.initView(n,e,i)}):(t.terrainHeight=0,t.initView(n,e,i))}},{key:"initView",value:function(e,i,t){var r,a=this;a.viewer=new Cesium.Viewer(a.container,(r={useDefaultRenderLoop:!0,selectionIndicator:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,infoBox:!1},_defineProperty(r,"navigationHelpButton",!1),_defineProperty(r,"navigationInstructionsInitiallyVisible",!1),_defineProperty(r,"animation",!1),_defineProperty(r,"timeline",!1),_defineProperty(r,"fullscreenButton",!1),_defineProperty(r,"allowTextureFilterAnisotropic",!1),_defineProperty(r,"contextOptions",{webgl:{alpha:!0,antialias:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1,depth:!0,stencil:!1,anialias:!0}}),_defineProperty(r,"targetFrameRate",60),_defineProperty(r,"resolutionScale",.1),_defineProperty(r,"orderIndependentTranslucency",!0),_defineProperty(r,"imageryProvider",e),_defineProperty(r,"baseLayerPicker",!1),_defineProperty(r,"geocoder",!1),_defineProperty(r,"automaticallyTrackDataSourceClocks",!1),_defineProperty(r,"dataSources",null),_defineProperty(r,"clock",null),_defineProperty(r,"terrainShadows",Cesium.ShadowMode.DISABLED),r)),a.viewer._cesiumWidget._creditContainer.style.display="none",a.viewer.scene.skyBox.show=!1,a.viewer.scene.backgroundColor=new Cesium.Color(0,0,0,0),a.updateCesiumOriginPos();var n=new Cesium.UrlTemplateImageryProvider({url:"//webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&style=8&scale=1",minimumLevel:3,maximumLevel:18});a.gdRoad=a.viewer.imageryLayers.addImageryProvider(n),a.gdRoad.alpha=.5,a.gdRoad.show=!1,new Cesium.ScreenSpaceEventHandler(a.viewer.scene.canvas).setInputAction(function(e){var i=a.viewer.scene.pickPosition(e.position);console.log(i),i=a.kadierTollh(i),console.log(i)},Cesium.ScreenSpaceEventType.LEFT_CLICK),a.viewer.camera.flyTo({destination:void 0!=t.cesiumDestination?t.cesiumDestination:a.cesiumOriginPos,orientation:void 0!=t.cesiumOrientation?t.cesiumOrientation:{heading:Cesium.Math.toRadians(175),pitch:Cesium.Math.toRadians(-35),roll:0},duration:a.duration,complete:function(){i&&i(t)}}),this.viewer.scene.globe.depthTestAgainstTerrain=!0}},{key:"createGoogleMapsByUrl",value:function(e,i){i=e.defaultValue(i,{});var t=e.defaultValue(i.url,"https://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}"),r=new e.Credit("Google Maps"),a=new e.WebMercatorTilingScheme({ellipsoid:i.ellipsoid}),n=e.defaultValue(i.minimumLevel,0),s=e.defaultValue(i.minimumLevel,17),o=e.defaultValue(i.rectangle,a.rectangle),l=a.positionToTileXY(e.Rectangle.southwest(o),n),u=a.positionToTileXY(e.Rectangle.northeast(o),n),m=(Math.abs(u.x-l.x)+1)*(Math.abs(u.y-l.y)+1);if(m>4)throw new e.DeveloperError("The rectangle and minimumLevel indicate that there are "+m+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");var c=e.defaultValue(i.credit,r);return"string"==typeof c&&(c=new e.Credit(c)),new e.UrlTemplateImageryProvider({url:t,proxy:i.proxy,credit:c,tilingScheme:a,tileWidth:256,tileHeight:256,minimumLevel:n,maximumLevel:s,rectangle:o})}},{key:"updateCesiumOriginPos",value:function(){this.cesiumOriginPos=Cesium.Cartesian3.fromDegrees(this.worldCoordinates[0],this.worldCoordinates[1],this.terrainHeight+100)}},{key:"kadierTollh",value:function(e){if(Cesium.defined(e)){var i=Cesium.Cartographic.fromCartesian(e);return{lon:Cesium.Math.toDegrees(i.longitude),lat:Cesium.Math.toDegrees(i.latitude),alt:i.height}}}},{key:"llhToKadier",value:function(e,i,t){return Cesium.Cartesian3.fromDegrees(e,i,t)}},{key:"loadGltf",value:function(e,i,t,r,a,n,s,o){var l=(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(i,t,r)),Cesium.Cartesian3.fromDegrees(i,t,r)),u=Cesium.Math.toRadians(a),m=Cesium.Math.toRadians(n),c=Cesium.Math.toRadians(s),d=new Cesium.HeadingPitchRoll(u,m,c),h=Cesium.Transforms.headingPitchRollQuaternion(l,d),g=this.viewer.entities.add({name:e,position:l,orientation:h,model:{uri:e,minimumPixelSize:128,maximumScale:2e4}});o&&o(g)}},{key:"load3dTiles",value:function(e,i,t,r){var a=this;new Cesium.Cesium3DTileset({url:e,maximumScreenSpaceError:t}).readyPromise.then(function(e){a.viewer.scene.primitives.add(e);var t=e.boundingSphere,n=Cesium.Cartographic.fromCartesian(t.center),s=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,0),o=(Cesium.Cartographic.fromDegrees(n.longitude,n.latitude),Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,i)),l=Cesium.Cartesian3.subtract(o,s,new Cesium.Cartesian3);e.modelMatrix=Cesium.Matrix4.fromTranslation(l),r&&r(e)}).otherwise(function(e){window.alert(e)})}},{key:"load3dTilesByPosition",value:function(e,i,t,r,a,n){var s=this,o=s.viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:e,maximumScreenSpaceError:a,scale:1}));o.readyPromise.then(function(e){var a=new Cesium.Matrix3,s=new Cesium.HeadingPitchRoll(Math.PI,Math.PI,Math.PI);a=Cesium.Matrix3.fromHeadingPitchRoll(s,a);var l=Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(i,t,r)),new Cesium.Cartesian3,new Cesium.Matrix4);Cesium.Matrix4.multiplyByMatrix3(l,a,l),o._root.transform=l,n&&n(o)})}},{key:"loadSkyBox",value:function(){this.viewer.scene.skyBox=new Cesium.SkyBox({sources:{positiveX:"../cesium/ThirdParty/Cesium/Apps/SampleData/px.jpg",negativeX:"../cesium/ThirdParty/Cesium/Apps/SampleData/nx.jpg",positiveY:"../cesium/ThirdParty/Cesium/Apps/SampleData/py.jpg",negativeY:"../cesium/ThirdParty/Cesium/Apps/SampleData/ny.jpg",positiveZ:"../cesium/ThirdParty/Cesium/Apps/SampleData/pz.jpg",negativeZ:"../cesium/ThirdParty/Cesium/Apps/SampleData/nz.jpg"}})}},{key:"loadGeoJson",value:function(e){Cesium.GeoJsonDataSource.load(e).then(function(e){self.viewer.dataSources.add(e),e.entities.values}).otherwise(function(e){window.alert(e)})}},{key:"setUpGDRoad",value:function(e,i){this.gdRoad.alpha=i,this.gdRoad.show=e}}]),e}();CLOUD.CesiumLoader=CesiumLoader;